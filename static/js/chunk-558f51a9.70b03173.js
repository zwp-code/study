(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-558f51a9"],{"1da1":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i("d3b7");function n(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(u){return void i(u)}o.done?t(l):Promise.resolve(l).then(n,r)}function r(e){return function(){var t=this,i=arguments;return new Promise((function(r,a){var s=e.apply(t,i);function o(e){n(s,r,a,o,l,"next",e)}function l(e){n(s,r,a,o,l,"throw",e)}o(void 0)}))}}},2532:function(e,t,i){"use strict";var n=i("23e7"),r=i("e330"),a=i("5a34"),s=i("1d80"),o=i("577e"),l=i("ab13"),u=r("".indexOf);n({target:"String",proto:!0,forced:!l("includes")},{includes:function(e){return!!~u(o(s(this)),o(a(e)),arguments.length>1?arguments[1]:void 0)}})},"25ec":function(e,t,i){"use strict";i("7f62")},4472:function(e,t,i){(function t(i){(function(t,i){e.exports=i()})(0,(function(){"use strict";function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function n(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?e(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function a(e){var t=r(e,"string");return"symbol"==typeof t?t:String(t)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function o(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,i){return t=a(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},u.apply(this,arguments)}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,h(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function f(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function m(e,t,i){return m=f()?Reflect.construct.bind():function(e,t,i){var n=[null];n.push.apply(n,t);var r=Function.bind.apply(e,n),a=new r;return i&&h(a,i.prototype),a},m.apply(null,arguments)}function p(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"===typeof e}}function v(e){var t="function"===typeof Map?new Map:void 0;return v=function(e){if(null===e||!p(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return m(e,arguments,d(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),h(i,e)},v(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}var b={exports:{}};(function(e,t){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),t=t.trim(),!t){if(!i.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=s.normalizePath(d)}else u.path=o.path,a.params||(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(u)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(r,"");while(e.length!==(e=e.replace(a,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s})()})(b);var L=b.exports,S=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},T=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=k},k=Number.MAX_SAFE_INTEGER||9007199254740991,x=function(e){return e["MEDIA_ATTACHING"]="hlsMediaAttaching",e["MEDIA_ATTACHED"]="hlsMediaAttached",e["MEDIA_DETACHING"]="hlsMediaDetaching",e["MEDIA_DETACHED"]="hlsMediaDetached",e["BUFFER_RESET"]="hlsBufferReset",e["BUFFER_CODECS"]="hlsBufferCodecs",e["BUFFER_CREATED"]="hlsBufferCreated",e["BUFFER_APPENDING"]="hlsBufferAppending",e["BUFFER_APPENDED"]="hlsBufferAppended",e["BUFFER_EOS"]="hlsBufferEos",e["BUFFER_FLUSHING"]="hlsBufferFlushing",e["BUFFER_FLUSHED"]="hlsBufferFlushed",e["MANIFEST_LOADING"]="hlsManifestLoading",e["MANIFEST_LOADED"]="hlsManifestLoaded",e["MANIFEST_PARSED"]="hlsManifestParsed",e["LEVEL_SWITCHING"]="hlsLevelSwitching",e["LEVEL_SWITCHED"]="hlsLevelSwitched",e["LEVEL_LOADING"]="hlsLevelLoading",e["LEVEL_LOADED"]="hlsLevelLoaded",e["LEVEL_UPDATED"]="hlsLevelUpdated",e["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated",e["LEVELS_UPDATED"]="hlsLevelsUpdated",e["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated",e["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching",e["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched",e["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading",e["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded",e["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated",e["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared",e["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch",e["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading",e["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded",e["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed",e["CUES_PARSED"]="hlsCuesParsed",e["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound",e["INIT_PTS_FOUND"]="hlsInitPtsFound",e["FRAG_LOADING"]="hlsFragLoading",e["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted",e["FRAG_LOADED"]="hlsFragLoaded",e["FRAG_DECRYPTED"]="hlsFragDecrypted",e["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment",e["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata",e["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata",e["FRAG_PARSED"]="hlsFragParsed",e["FRAG_BUFFERED"]="hlsFragBuffered",e["FRAG_CHANGED"]="hlsFragChanged",e["FPS_DROP"]="hlsFpsDrop",e["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping",e["MAX_AUTO_LEVEL_UPDATED"]="hlsMaxAutoLevelUpdated",e["ERROR"]="hlsError",e["DESTROYING"]="hlsDestroying",e["KEY_LOADING"]="hlsKeyLoading",e["KEY_LOADED"]="hlsKeyLoaded",e["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached",e["BACK_BUFFER_REACHED"]="hlsBackBufferReached",e["STEERING_MANIFEST_LOADED"]="hlsSteeringManifestLoaded",e}({}),R=function(e){return e["NETWORK_ERROR"]="networkError",e["MEDIA_ERROR"]="mediaError",e["KEY_SYSTEM_ERROR"]="keySystemError",e["MUX_ERROR"]="muxError",e["OTHER_ERROR"]="otherError",e}({}),w=function(e){return e["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys",e["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess",e["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession",e["KEY_SYSTEM_NO_CONFIGURED_LICENSE"]="keySystemNoConfiguredLicense",e["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED"]="keySystemServerCertificateRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED"]="keySystemServerCertificateUpdateFailed",e["KEY_SYSTEM_SESSION_UPDATE_FAILED"]="keySystemSessionUpdateFailed",e["KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED"]="keySystemStatusOutputRestricted",e["KEY_SYSTEM_STATUS_INTERNAL_ERROR"]="keySystemStatusInternalError",e["MANIFEST_LOAD_ERROR"]="manifestLoadError",e["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut",e["MANIFEST_PARSING_ERROR"]="manifestParsingError",e["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError",e["LEVEL_EMPTY_ERROR"]="levelEmptyError",e["LEVEL_LOAD_ERROR"]="levelLoadError",e["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut",e["LEVEL_PARSING_ERROR"]="levelParsingError",e["LEVEL_SWITCH_ERROR"]="levelSwitchError",e["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError",e["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut",e["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError",e["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut",e["FRAG_LOAD_ERROR"]="fragLoadError",e["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut",e["FRAG_DECRYPT_ERROR"]="fragDecryptError",e["FRAG_PARSING_ERROR"]="fragParsingError",e["FRAG_GAP"]="fragGap",e["REMUX_ALLOC_ERROR"]="remuxAllocError",e["KEY_LOAD_ERROR"]="keyLoadError",e["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut",e["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError",e["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError",e["BUFFER_APPEND_ERROR"]="bufferAppendError",e["BUFFER_APPENDING_ERROR"]="bufferAppendingError",e["BUFFER_STALLED_ERROR"]="bufferStalledError",e["BUFFER_FULL_ERROR"]="bufferFullError",e["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole",e["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall",e["INTERNAL_EXCEPTION"]="internalException",e["INTERNAL_ABORTED"]="aborted",e["UNKNOWN"]="unknown",e}({}),E=function(){},Z={trace:E,debug:E,log:E,warn:E,info:E,error:E},C=Z;function I(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):E}function M(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach((function(t){C[t]=e[t]?e[t].bind(e):I(t)}))}function G(e,t){if("object"===typeof console&&!0===e||"object"===typeof e){M(e,"debug","log","info","warn","error");try{C.log('Debug logs enabled for "'+t+'" in hls.js version 1.5.13')}catch(i){C=Z}}else C=Z}var X=C,_=/^(\d+)x(\d+)$/,P=/(.+?)=(".*?"|.*?)(?:,|$)/g,D=function(){function e(t){"string"===typeof t&&(t=e.parseAttrList(t)),u(this,t)}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=_.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i={},n='"';P.lastIndex=0;while(null!==(t=P.exec(e))){var r=t[2];0===r.indexOf(n)&&r.lastIndexOf(n)===r.length-1&&(r=r.slice(1,-1));var a=t[1].trim();i[a]=r}return i},o(e,[{key:"clientAttrs",get:function(){return Object.keys(this).filter((function(e){return"X-"===e.substring(0,2)}))}}]),e}();function W(e){return"ID"!==e&&"CLASS"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function V(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}var N=function(){function e(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){var i=t.attr;for(var n in i)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==i[n]){X.warn('DATERANGE tag attribute: "'+n+'" does not match for tags with ID: "'+e.ID+'"'),this._badValueForSameId=n;break}e=u(new D({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){var r=new Date(this.attr["END-DATE"]);S(r.getTime())&&(this._endDate=r)}}return o(e,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(S(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&S(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),e}(),F=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},A={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},Y=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(t={},t[A.AUDIO]=null,t[A.VIDEO]=null,t[A.AUDIOVIDEO]=null,t),this.baseurl=e}var t=e.prototype;return t.setByteRange=function(e,t){var i,n=e.split("@",2);i=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]},o(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=L.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),O=function(e){function t(t,i){var n;return n=e.call(this,i)||this,n._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkeys=void 0,n.type=void 0,n.loader=null,n.keyLoader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new F,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.endList=void 0,n.gap=void 0,n.urlId=0,n.type=t,n}c(t,e);var i=t.prototype;return i.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},i.abortRequests=function(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()},i.setElementaryStreamInfo=function(e,t,i,n,r,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,r)):s[e]={startPTS:t,endPTS:i,startDTS:n,endDTS:r,partial:a}},i.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[A.AUDIO]=null,e[A.VIDEO]=null,e[A.AUDIOVIDEO]=null},o(t,[{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var i=Object.keys(this.levelkeys);if(1===i.length)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!S(this.programDateTime))return null;var e=S(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),i=t.length;if(i>1||1===i&&this.levelkeys[t[0]].encrypted)return!0}return!1}}]),t}(Y),H=function(e){function t(t,i,n,r,a){var s;s=e.call(this,n)||this,s.fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.stats=new F,s.duration=t.decimalFloatingPoint("DURATION"),s.gap=t.bool("GAP"),s.independent=t.bool("INDEPENDENT"),s.relurl=t.enumeratedString("URI"),s.fragment=i,s.index=r;var o=t.enumeratedString("BYTERANGE");return o&&s.setByteRange(o,a),a&&(s.fragOffset=a.fragOffset+a.duration),s}return c(t,e),o(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(Y),K=10,U=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}var t=e.prototype;return t.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},o(e,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&S(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||K}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;if(e>0){var t=this.driftEnd-this.driftStart;return 1e3*t/e}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}(),B=void 0,z=y(B);function j(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}var J,Q=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},q=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},$=function(e,t){var i=t,n=0;while(Q(e,t)){n+=10;var r=ee(e,t+6);n+=r,q(e,t+10)&&(n+=10),t+=n}if(n>0)return e.subarray(i,i+n)},ee=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3],i},te=function(e,t){return Q(e,t)&&ee(e,t+6)+10<=e.length-t},ie=function(e){for(var t=ae(e),i=0;i<t.length;i++){var n=t[i];if(ne(n))return ce(n)}},ne=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},re=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=ee(e,4),n=10;return{type:t,size:i,data:e.subarray(n,n+i)}},ae=function(e){var t=0,i=[];while(Q(e,t)){var n=ee(e,t+6);t+=10;var r=t+n;while(t+8<r){var a=re(e.subarray(t)),s=se(a);s&&i.push(s),t+=a.size+10}q(e,t)&&(t+=10)}return i},se=function(e){return"PRIV"===e.type?oe(e):"W"===e.type[0]?ue(e):le(e)},oe=function(e){if(!(e.size<2)){var t=de(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}}},le=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,i=de(e.data.subarray(t),!0);t+=i.length+1;var n=de(e.data.subarray(t));return{key:e.type,info:i,data:n}}var r=de(e.data.subarray(1));return{key:e.type,data:r}}},ue=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,i=de(e.data.subarray(t),!0);t+=i.length+1;var n=de(e.data.subarray(t));return{key:e.type,info:i,data:n}}var r=de(e.data);return{key:e.type,data:r}},ce=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,i&&(n+=47721858.84),Math.round(n)}},de=function(e,t){void 0===t&&(t=!1);var i=he();if(i){var n=i.decode(e);if(t){var r=n.indexOf("\0");return-1!==r?n.substring(0,r):n}return n.replace(/\0/g,"")}var a,s,o,l=e.length,u="",c=0;while(c<l){if(a=e[c++],0===a&&t)return u;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(a);break;case 12:case 13:s=e[c++],u+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[c++],o=e[c++],u+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&o)<<0);break}}return u};function he(){if(!navigator.userAgent.includes("PlayStation 4"))return J||"undefined"===typeof self.TextDecoder||(J=new self.TextDecoder("utf-8")),J}var fe={hexDump:function(e){for(var t="",i=0;i<e.length;i++){var n=e[i].toString(16);n.length<2&&(n="0"+n),t+=n}return t}},me=Math.pow(2,32)-1,pe=[].push,ve={video:1,audio:2,id3:3,text:4};function ge(e){return String.fromCharCode.apply(null,e)}function ye(e,t){var i=e[t]<<8|e[t+1];return i<0?65536+i:i}function be(e,t){var i=Se(e,t);return i<0?4294967296+i:i}function Le(e,t){var i=be(e,t);return i*=Math.pow(2,32),i+=be(e,t+4),i}function Se(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Te(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function ke(e){for(var t=e.byteLength,i=0;i<t;){var n=be(e,i);if(n>8&&109===e[i+4]&&111===e[i+5]&&111===e[i+6]&&102===e[i+7])return!0;i=n>1?i+n:t}return!1}function xe(e,t){var i=[];if(!t.length)return i;for(var n=e.byteLength,r=0;r<n;){var a=be(e,r),s=ge(e.subarray(r+4,r+8)),o=a>1?r+a:n;if(s===t[0])if(1===t.length)i.push(e.subarray(r+8,o));else{var l=xe(e.subarray(r+8,o),t.slice(1));l.length&&pe.apply(i,l)}r=o}return i}function Re(e){var t=[],i=e[0],n=8,r=be(e,n);n+=4;var a=0,s=0;0===i?(a=be(e,n),s=be(e,n+4),n+=8):(a=Le(e,n),s=Le(e,n+8),n+=16),n+=2;var o=e.length+s,l=ye(e,n);n+=2;for(var u=0;u<l;u++){var c=n,d=be(e,c);c+=4;var h=2147483647&d,f=(2147483648&d)>>>31;if(1===f)return X.warn("SIDX has hierarchical references (not supported)"),null;var m=be(e,c);c+=4,t.push({referenceSize:h,subsegmentDuration:m,info:{duration:m/r,start:o,end:o+h-1}}),o+=h,c+=4,n=c}return{earliestPresentationTime:a,timescale:r,version:i,referencesCount:l,references:t}}function we(e){for(var t=[],i=xe(e,["moov","trak"]),r=0;r<i.length;r++){var a=i[r],s=xe(a,["tkhd"])[0];if(s){var o=s[0],l=be(s,0===o?12:20),u=xe(a,["mdia","mdhd"])[0];if(u){o=u[0];var c=be(u,0===o?12:20),d=xe(a,["mdia","hdlr"])[0];if(d){var h=ge(d.subarray(8,12)),f={soun:A.AUDIO,vide:A.VIDEO}[h];if(f){var m=xe(a,["mdia","minf","stbl","stsd"])[0],p=Ee(m);t[l]={timescale:c,type:f},t[f]=n({timescale:c,id:l},p)}}}}}var v=xe(e,["moov","mvex","trex"]);return v.forEach((function(e){var i=be(e,4),n=t[i];n&&(n.default={duration:be(e,12),flags:be(e,20)})})),t}function Ee(e){var t=e.subarray(8),i=t.subarray(86),n=ge(t.subarray(4,8)),r=n,a="enca"===n||"encv"===n;if(a){var s=xe(t,[n])[0],o=s.subarray("enca"===n?28:78),l=xe(o,["sinf"]);l.forEach((function(e){var t=xe(e,["schm"])[0];if(t){var i=ge(t.subarray(4,8));if("cbcs"===i||"cenc"===i){var n=xe(e,["frma"])[0];n&&(r=ge(n))}}}))}switch(r){case"avc1":case"avc2":case"avc3":case"avc4":var u=xe(i,["avcC"])[0];r+="."+Ce(u[1])+Ce(u[2])+Ce(u[3]);break;case"mp4a":var c=xe(t,[n])[0],d=xe(c.subarray(28),["esds"])[0];if(d&&d.length>12){var h=4;if(3!==d[h++])break;h=Ze(d,h),h+=2;var f=d[h++];if(128&f&&(h+=2),64&f&&(h+=d[h++]),4!==d[h++])break;h=Ze(d,h);var m=d[h++];if(64!==m)break;if(r+="."+Ce(m),h+=12,5!==d[h++])break;h=Ze(d,h);var p=d[h++],v=(248&p)>>3;31===v&&(v+=1+((7&p)<<3)+((224&d[h])>>5)),r+="."+v}break;case"hvc1":case"hev1":var g=xe(i,["hvcC"])[0],y=g[1],b=["","A","B","C"][y>>6],L=31&y,S=be(g,2),T=(32&y)>>5?"H":"L",k=g[12],x=g.subarray(6,12);r+="."+b+L,r+="."+S.toString(16).toUpperCase(),r+="."+T+k;for(var R="",w=x.length;w--;){var E=x[w];if(E||R){var Z=E.toString(16).toUpperCase();R="."+Z+R}}r+=R;break;case"dvh1":case"dvhe":var C=xe(i,["dvcC"])[0],I=C[2]>>1&127,M=C[2]<<5&32|C[3]>>3&31;r+="."+Ie(I)+"."+Ie(M);break;case"vp09":var G=xe(i,["vpcC"])[0],X=G[4],_=G[5],P=G[6]>>4&15;r+="."+Ie(X)+"."+Ie(_)+"."+Ie(P);break;case"av01":var D=xe(i,["av1C"])[0],W=D[1]>>>5,V=31&D[1],N=D[2]>>>7?"H":"M",F=(64&D[2])>>6,A=(32&D[2])>>5,Y=2===W&&F?A?12:10:F?10:8,O=(16&D[2])>>4,H=(8&D[2])>>3,K=(4&D[2])>>2,U=3&D[2],B=1,z=1,j=1,J=0;r+="."+W+"."+Ie(V)+N+"."+Ie(Y)+"."+O+"."+H+K+U+"."+Ie(B)+"."+Ie(z)+"."+Ie(j)+"."+J;break}return{codec:r,encrypted:a}}function Ze(e,t){var i=t+5;while(128&e[t++]&&t<i);return t}function Ce(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Ie(e){return(e<10?"0":"")+e}function Me(e,t){if(!e||!t)return e;var i=t.keyId;if(i&&t.isCommonEncryption){var n=xe(e,["moov","trak"]);n.forEach((function(e){var t=xe(e,["mdia","minf","stbl","stsd"])[0],n=t.subarray(8),r=xe(n,["enca"]),a=r.length>0;a||(r=xe(n,["encv"])),r.forEach((function(e){var t=a?e.subarray(28):e.subarray(78),n=xe(t,["sinf"]);n.forEach((function(e){var t=Ge(e);if(t){var n=t.subarray(8,24);n.some((function(e){return 0!==e}))||(X.log("[eme] Patching keyId in 'enc"+(a?"a":"v")+">sinf>>tenc' box: "+fe.hexDump(n)+" -> "+fe.hexDump(i)),t.set(i,8))}}))}))}))}return e}function Ge(e){var t=xe(e,["schm"])[0];if(t){var i=ge(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return xe(e,["schi","tenc"])[0]}return X.error("[eme] missing 'schm' box"),null}function Xe(e,t){return xe(t,["moof","traf"]).reduce((function(t,i){var n=xe(i,["tfdt"])[0],r=n[0],a=xe(i,["tfhd"]).reduce((function(t,i){var a=be(i,4),s=e[a];if(s){var o=be(n,4);if(1===r){if(o===me)return X.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;o*=me+1,o+=be(n,8)}var l=s.timescale||9e4,u=o/l;if(S(u)&&(null===t||u<t))return u}return t}),null);return null!==a&&S(a)&&(null===t||a<t)?a:t}),null)}function _e(e,t){for(var i=0,n=0,r=0,a=xe(e,["moof","traf"]),s=0;s<a.length;s++){var o=a[s],l=xe(o,["tfhd"])[0],u=be(l,4),c=t[u];if(c){var d=c.default,h=be(l,0)|(null==d?void 0:d.flags),f=null==d?void 0:d.duration;8&h&&(f=be(l,2&h?12:8));for(var m=c.timescale||9e4,p=xe(o,["trun"]),v=0;v<p.length;v++){if(i=Pe(p[v]),!i&&f){var g=be(p[v],4);i=f*g}c.type===A.VIDEO?n+=i/m:c.type===A.AUDIO&&(r+=i/m)}}}if(0===n&&0===r){for(var y=1/0,b=0,L=0,T=xe(e,["sidx"]),k=0;k<T.length;k++){var x=Re(T[k]);if(null!=x&&x.references){y=Math.min(y,x.earliestPresentationTime/x.timescale);var R=x.references.reduce((function(e,t){return e+t.info.duration||0}),0);b=Math.max(b,R+x.earliestPresentationTime/x.timescale),L=b-y}}if(L&&S(L))return L}return n||r}function Pe(e){var t=be(e,0),i=8;1&t&&(i+=4),4&t&&(i+=4);for(var n=0,r=be(e,4),a=0;a<r;a++){if(256&t){var s=be(e,i);n+=s,i+=4}512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4)}return n}function De(e,t,i){xe(t,["moof","traf"]).forEach((function(t){xe(t,["tfhd"]).forEach((function(n){var r=be(n,4),a=e[r];if(a){var s=a.timescale||9e4;xe(t,["tfdt"]).forEach((function(e){var t=e[0],n=i*s;if(n){var r=be(e,4);if(0===t)r-=n,r=Math.max(r,0),Te(e,4,r);else{r*=Math.pow(2,32),r+=be(e,8),r-=n,r=Math.max(r,0);var a=Math.floor(r/(me+1)),o=Math.floor(r%(me+1));Te(e,4,a),Te(e,8,o)}}}))}}))}))}function We(e){var t={valid:null,remainder:null},i=xe(e,["moof"]);if(i.length<2)return t.remainder=e,t;var n=i[i.length-1];return t.valid=j(e,0,n.byteOffset-8),t.remainder=j(e,n.byteOffset-8),t}function Ve(e,t){var i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function Ne(e,t){var i=[],n=t.samples,r=t.timescale,a=t.id,s=!1,o=xe(n,["moof"]);return o.map((function(o){var l=o.byteOffset-8,u=xe(o,["traf"]);u.map((function(o){var u=xe(o,["tfdt"]).map((function(e){var t=e[0],i=be(e,4);return 1===t&&(i*=Math.pow(2,32),i+=be(e,8)),i/r}))[0];return void 0!==u&&(e=u),xe(o,["tfhd"]).map((function(u){var c=be(u,4),d=16777215&be(u,0),h=0!==(1&d),f=0!==(2&d),m=0!==(8&d),p=0,v=0!==(16&d),g=0,y=0!==(32&d),b=8;c===a&&(h&&(b+=8),f&&(b+=4),m&&(p=be(u,b),b+=4),v&&(g=be(u,b),b+=4),y&&(b+=4),"video"===t.type&&(s=Fe(t.codec)),xe(o,["trun"]).map((function(a){var o=a[0],u=16777215&be(a,0),c=0!==(1&u),d=0,h=0!==(4&u),f=0!==(256&u),m=0,v=0!==(512&u),y=0,b=0!==(1024&u),L=0!==(2048&u),S=0,T=be(a,4),k=8;c&&(d=be(a,k),k+=4),h&&(k+=4);for(var x=d+l,R=0;R<T;R++){if(f?(m=be(a,k),k+=4):m=p,v?(y=be(a,k),k+=4):y=g,b&&(k+=4),L&&(S=0===o?be(a,k):Se(a,k),k+=4),t.type===A.VIDEO){var w=0;while(w<y){var E=be(n,x);if(x+=4,Ae(s,n[x])){var Z=n.subarray(x,x+E);Ye(Z,s?2:1,e+S/r,i)}x+=E,w+=E+4}}e+=m/r}})))}))}))})),i}function Fe(e){if(!e)return!1;var t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}function Ae(e,t){if(e){var i=t>>1&63;return 39===i||40===i}var n=31&t;return 6===n}function Ye(e,t,i,n){var r=Oe(e),a=0;a+=t;var s=0,o=0,l=0;while(a<r.length){s=0;do{if(a>=r.length)break;l=r[a++],s+=l}while(255===l);o=0;do{if(a>=r.length)break;l=r[a++],o+=l}while(255===l);var u=r.length-a,c=a;if(o<u)a+=o;else if(o>u){X.error("Malformed SEI payload. "+o+" is too small, only "+u+" bytes left to parse.");break}if(4===s){var d=r[c++];if(181===d){var h=ye(r,c);if(c+=2,49===h){var f=be(r,c);if(c+=4,1195456820===f){var m=r[c++];if(3===m){var p=r[c++],v=31&p,g=64&p,y=g?2+3*v:0,b=new Uint8Array(y);if(g){b[0]=p;for(var L=1;L<y;L++)b[L]=r[c++]}n.push({type:m,payloadType:s,pts:i,bytes:b})}}}}}else if(5===s&&o>16){for(var S=[],T=0;T<16;T++){var k=r[c++].toString(16);S.push(1==k.length?"0"+k:k),3!==T&&5!==T&&7!==T&&9!==T||S.push("-")}for(var x=o-16,R=new Uint8Array(x),w=0;w<x;w++)R[w]=r[c++];n.push({payloadType:s,pts:i,uuid:S.join(""),userData:de(R),userDataBytes:R})}}}function Oe(e){var t=e.byteLength,i=[],n=1;while(n<t-2)0===e[n]&&0===e[n+1]&&3===e[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return e;var r=t-i.length,a=new Uint8Array(r),s=0;for(n=0;n<r;s++,n++)s===i[0]&&(s++,i.shift()),a[n]=e[s];return a}function He(e){var t=e[0],i="",n="",r=0,a=0,s=0,o=0,l=0,u=0;if(0===t){while("\0"!==ge(e.subarray(u,u+1)))i+=ge(e.subarray(u,u+1)),u+=1;i+=ge(e.subarray(u,u+1)),u+=1;while("\0"!==ge(e.subarray(u,u+1)))n+=ge(e.subarray(u,u+1)),u+=1;n+=ge(e.subarray(u,u+1)),u+=1,r=be(e,12),a=be(e,16),o=be(e,20),l=be(e,24),u=28}else if(1===t){u+=4,r=be(e,u),u+=4;var c=be(e,u);u+=4;var d=be(e,u);u+=4,s=Math.pow(2,32)*c+d,T(s)||(s=Number.MAX_SAFE_INTEGER,X.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=be(e,u),u+=4,l=be(e,u),u+=4;while("\0"!==ge(e.subarray(u,u+1)))i+=ge(e.subarray(u,u+1)),u+=1;i+=ge(e.subarray(u,u+1)),u+=1;while("\0"!==ge(e.subarray(u,u+1)))n+=ge(e.subarray(u,u+1)),u+=1;n+=ge(e.subarray(u,u+1)),u+=1}var h=e.subarray(u,e.byteLength);return{schemeIdUri:i,value:n,timeScale:r,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:h}}var Ke=function(){function e(e,t,i,n,r){void 0===n&&(n=[1]),void 0===r&&(r=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=n,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}e.clearKeyUriToKeyIdMap=function(){};var t=e.prototype;return t.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method}return!1},t.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!==typeof t&&("AES-128"!==this.method||this.iv||X.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var i=Ue(t),n=new e(this.method,this.uri,"identity",this.keyFormatVersions,i);return n}return this},e}();function Ue(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}function Be(e){if(void 0===e&&(e=!0),"undefined"!==typeof self){var t=(e||!self.MediaSource)&&self.ManagedMediaSource;return t||self.MediaSource||self.WebKitMediaSource}}function ze(e){return"undefined"!==typeof self&&e===self.ManagedMediaSource}var je={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Je(e,t){var i=je[t];return!!i&&!!i[e.slice(0,4)]}function Qe(e,t,i){return void 0===i&&(i=!0),!e.split(",").some((function(e){return!qe(e,t,i)}))}function qe(e,t,i){var n;void 0===i&&(i=!0);var r=Be(i);return null!=(n=null==r?void 0:r.isTypeSupported($e(e,t)))&&n}function $e(e,t){return t+'/mp4;codecs="'+e+'"'}function et(e){if(e){var t=e.substring(0,4);return je.video[t]}return 2}function tt(e){return e.split(",").reduce((function(e,t){var i=je.video[t];return i?(2*i+e)/(e?3:2):(je.audio[t]+e)/(e?2:1)}),0)}var it={};function nt(e,t){if(void 0===t&&(t=!0),it[e])return it[e];for(var i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e],n=0;n<i.length;n++)if(qe(i[n],"audio",t))return it[e]=i[n],i[n];return e}var rt=/flac|opus/i;function at(e,t){return void 0===t&&(t=!0),e.replace(rt,(function(e){return nt(e.toLowerCase(),t)}))}function st(e,t){return e&&"mp4a"!==e?e:t?t.split(",")[0]:t}function ot(e){for(var t=e.split(","),i=0;i<t.length;i++){var n=t[i].split(".");if(n.length>2){var r=n.shift()+".";r+=parseInt(n.shift()).toString(16),r+=("000"+parseInt(n.shift()).toString(16)).slice(-4),t[i]=r}}return t.join(",")}var lt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ut=/#EXT-X-MEDIA:(.*)/g,ct=/^#EXT(?:INF|-X-TARGETDURATION):/m,dt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),ht=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ft=function(){function e(){}return e.findGroup=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}},e.resolve=function(e,t){return L.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.isMediaPlaylist=function(e){return ct.test(e)},e.parseMasterPlaylist=function(t,i){var n,r=!1,a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];lt.lastIndex=0;while(null!=(n=lt.exec(t)))if(n[1]){var o,l=new D(n[1]),u=n[2],c={attrs:l,bitrate:l.decimalInteger("BANDWIDTH")||l.decimalInteger("AVERAGE-BANDWIDTH"),name:l.NAME,url:e.resolve(u,i)},d=l.decimalResolution("RESOLUTION");d&&(c.width=d.width,c.height=d.height),vt(l.CODECS,c),null!=(o=c.unknownCodecs)&&o.length||s.push(c),a.levels.push(c)}else if(n[3]){var h=n[3],f=n[4];switch(h){case"SESSION-DATA":var m=new D(f),p=m["DATA-ID"];p&&(null===a.sessionData&&(a.sessionData={}),a.sessionData[p]=m);break;case"SESSION-KEY":var v=mt(f,i);v.encrypted&&v.isSupported()?(null===a.sessionKeys&&(a.sessionKeys=[]),a.sessionKeys.push(v)):X.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+f+'"');break;case"DEFINE":break;case"CONTENT-STEERING":var g=new D(f);a.contentSteering={uri:e.resolve(g["SERVER-URI"],i),pathwayId:g["PATHWAY-ID"]||"."};break;case"START":a.startTimeOffset=pt(f);break}}var y=s.length>0&&s.length<a.levels.length;return a.levels=y?s:a.levels,0===a.levels.length&&(a.playlistParsingError=new Error("no levels found in manifest")),a},e.parseMasterPlaylistMedia=function(t,i,n){var r,a={},s=n.levels,o={AUDIO:s.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),SUBTITLES:s.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),"CLOSED-CAPTIONS":[]},l=0;ut.lastIndex=0;while(null!==(r=ut.exec(t))){var u=new D(r[1]),c=u.TYPE;if(c){var d=o[c],h=a[c]||[];a[c]=h;var f=u.LANGUAGE,m=u["ASSOC-LANGUAGE"],p=u.CHANNELS,v=u.CHARACTERISTICS,g=u["INSTREAM-ID"],y={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?e.resolve(u.URI,i):""};if(m&&(y.assocLang=m),p&&(y.channels=p),v&&(y.characteristics=v),g&&(y.instreamId=g),null!=d&&d.length){var b=e.findGroup(d,y.groupId)||d[0];gt(y,b,"audioCodec"),gt(y,b,"textCodec")}h.push(y)}}return a},e.parseLevelPlaylist=function(e,t,i,n,r,a){var s,o,l,c=new U(t),d=c.fragments,h=null,f=0,m=0,p=0,v=0,g=null,y=new O(n,t),b=-1,L=!1,T=null;dt.lastIndex=0,c.m3u8=e,c.hasVariableRefs=!1;while(null!==(s=dt.exec(e))){L&&(L=!1,y=new O(n,t),y.start=p,y.sn=f,y.cc=v,y.level=i,h&&(y.initSegment=h,y.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null,T&&(y.setByteRange(T),T=null)));var k=s[1];if(k){y.duration=parseFloat(k);var x=(" "+s[2]).slice(1);y.title=x||null,y.tagList.push(x?["INF",k,x]:["INF",k])}else if(s[3]){if(S(y.duration)){y.start=p,l&&St(y,l,c),y.sn=f,y.level=i,y.cc=v,d.push(y);var R=(" "+s[3]).slice(1);y.relurl=R,bt(y,g),g=y,p+=y.duration,f++,m=0,L=!0}}else if(s[4]){var w=(" "+s[4]).slice(1);g?y.setByteRange(w,g):y.setByteRange(w)}else if(s[5])y.rawProgramDateTime=(" "+s[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===b&&(b=d.length);else{if(s=s[0].match(ht),!s){X.warn("No matches on slow regex match for level playlist!");continue}for(o=1;o<s.length;o++)if("undefined"!==typeof s[o])break;var E=(" "+s[o]).slice(1),Z=(" "+s[o+1]).slice(1),C=s[o+2]?(" "+s[o+2]).slice(1):"";switch(E){case"PLAYLIST-TYPE":c.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":f=c.startSN=parseInt(Z);break;case"SKIP":var I=new D(Z),M=I.decimalInteger("SKIPPED-SEGMENTS");if(S(M)){c.skippedSegments=M;for(var G=M;G--;)d.unshift(null);f+=M}var _=I.enumeratedString("RECENTLY-REMOVED-DATERANGES");_&&(c.recentlyRemovedDateranges=_.split("\t"));break;case"TARGETDURATION":c.targetduration=Math.max(parseInt(Z),1);break;case"VERSION":c.version=parseInt(Z);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(Z||C)&&y.tagList.push(C?[Z,C]:[Z]);break;case"DISCONTINUITY":v++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([E]);break;case"BITRATE":y.tagList.push([E,Z]);break;case"DATERANGE":var P=new D(Z),W=new N(P,c.dateRanges[P.ID]);W.isValid||c.skippedSegments?c.dateRanges[W.id]=W:X.warn('Ignoring invalid DATERANGE tag: "'+Z+'"'),y.tagList.push(["EXT-X-DATERANGE",Z]);break;case"DEFINE":break;case"DISCONTINUITY-SEQUENCE":v=parseInt(Z);break;case"KEY":var V=mt(Z,t);if(V.isSupported()){if("NONE"===V.method){l=void 0;break}l||(l={}),l[V.keyFormat]&&(l=u({},l)),l[V.keyFormat]=V}else X.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+Z+'"');break;case"START":c.startTimeOffset=pt(Z);break;case"MAP":var F=new D(Z);if(y.duration){var A=new O(n,t);Lt(A,F,i,l),h=A,y.initSegment=h,h.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=h.rawProgramDateTime)}else{var Y=y.byteRangeEndOffset;if(Y){var K=y.byteRangeStartOffset;T=Y-K+"@"+K}else T=null;Lt(y,F,i,l),h=y,L=!0}break;case"SERVER-CONTROL":var B=new D(Z);c.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),c.holdBack=B.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var z=new D(Z);c.partTarget=z.decimalFloatingPoint("PART-TARGET");break;case"PART":var j=c.partList;j||(j=c.partList=[]);var J=m>0?j[j.length-1]:void 0,Q=m++,q=new D(Z),$=new H(q,y,t,Q,J);j.push($),y.duration+=$.duration;break;case"PRELOAD-HINT":var ee=new D(Z);c.preloadHint=ee;break;case"RENDITION-REPORT":var te=new D(Z);c.renditionReports=c.renditionReports||[],c.renditionReports.push(te);break;default:X.warn("line parsed but not handled: "+s);break}}}g&&!g.relurl?(d.pop(),p-=g.duration,c.partList&&(c.fragmentHint=g)):c.partList&&(bt(y,g),y.cc=v,c.fragmentHint=y,l&&St(y,l,c));var ie=d.length,ne=d[0],re=d[ie-1];if(p+=c.skippedSegments*c.targetduration,p>0&&ie&&re){c.averagetargetduration=p/ie;var ae=re.sn;c.endSN="initSegment"!==ae?ae:0,c.live||(re.endList=!0),ne&&(c.startCC=ne.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(p+=c.fragmentHint.duration),c.totalduration=p,c.endCC=v,b>0&&yt(d,b),c},e}();function mt(e,t,i){var n,r,a=new D(e),s=null!=(n=a.METHOD)?n:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(r=a.KEYFORMAT)?r:"identity";o&&a.IV&&!l&&X.error("Invalid IV: "+a.IV);var d=o?ft.resolve(o,t):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ke(s,d,c,h,l)}function pt(e){var t=new D(e),i=t.decimalFloatingPoint("TIME-OFFSET");return S(i)?i:null}function vt(e,t){var i=(e||"").split(/[ ,]+/).filter((function(e){return e}));["video","audio","text"].forEach((function(e){var n=i.filter((function(t){return Je(t,e)}));n.length&&(t[e+"Codec"]=n.join(","),i=i.filter((function(e){return-1===n.indexOf(e)})))})),t.unknownCodecs=i}function gt(e,t,i){var n=t[i];n&&(e[i]=n)}function yt(e,t){for(var i=e[t],n=t;n--;){var r=e[n];if(!r)return;r.programDateTime=i.programDateTime-1e3*r.duration,i=r}}function bt(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),S(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function Lt(e,t,i,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function St(e,t,i){e.levelkeys=t;var n=i.encryptedFragments;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||n.push(e)}var Tt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},kt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function xt(e){var t=e.type;switch(t){case Tt.AUDIO_TRACK:return kt.AUDIO;case Tt.SUBTITLE_TRACK:return kt.SUBTITLE;default:return kt.MAIN}}function Rt(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i}var wt=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var t=e.prototype;return t.startLoad=function(e){},t.stopLoad=function(){this.destroyInternalLoaders()},t.registerListeners=function(){var e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,r=i||n,a=new r(t);return this.loaders[e.type]=a,a},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var i=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Tt.MANIFEST,url:i,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var i=t.id,n=t.level,r=t.pathwayId,a=t.url,s=t.deliveryDirectives;this.load({id:i,level:n,pathwayId:r,responseType:"text",type:Tt.LEVEL,url:a,deliveryDirectives:s})},t.onAudioTrackLoading=function(e,t){var i=t.id,n=t.groupId,r=t.url,a=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:Tt.AUDIO_TRACK,url:r,deliveryDirectives:a})},t.onSubtitleTrackLoading=function(e,t){var i=t.id,n=t.groupId,r=t.url,a=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:Tt.SUBTITLE_TRACK,url:r,deliveryDirectives:a})},t.load=function(e){var t,i,n,r=this,a=this.hls.config,s=this.getInternalLoader(e);if(s){var o=s.context;if(o&&o.url===e.url&&o.level===e.level)return void X.trace("[playlist-loader]: playlist request ongoing");X.log("[playlist-loader]: aborting previous loader for type: "+e.type),s.abort()}if((i=e.type===Tt.MANIFEST?a.manifestLoadPolicy.default:u({},a.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),S(null==(t=e.deliveryDirectives)?void 0:t.part))&&(e.type===Tt.LEVEL&&null!==e.level?n=this.hls.levels[e.level].details:e.type===Tt.AUDIO_TRACK&&null!==e.id?n=this.hls.audioTracks[e.id].details:e.type===Tt.SUBTITLE_TRACK&&null!==e.id&&(n=this.hls.subtitleTracks[e.id].details),n)){var l=n.partTarget,c=n.targetduration;if(l&&c){var d=1e3*Math.max(3*l,.8*c);i=u({},i,{maxTimeToFirstByteMs:Math.min(d,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(d,i.maxTimeToFirstByteMs)})}}var h=i.errorRetry||i.timeoutRetry||{},f={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},m={onSuccess:function(e,t,i,n){var a=r.getInternalLoader(i);r.resetInternalLoader(i.type);var s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),ft.isMediaPlaylist(s)?r.handleTrackOrLevelPlaylist(e,t,i,n||null,a):r.handleMasterPlaylist(e,t,i,n)):r.handleManifestParsingError(e,i,new Error("no EXTM3U delimiter"),n||null,t)},onError:function(e,t,i,n){r.handleNetworkError(t,i,!1,e,n)},onTimeout:function(e,t,i){r.handleNetworkError(t,i,!0,void 0,e)}};s.load(e,f,m)},t.handleMasterPlaylist=function(e,t,i,n){var r=this.hls,a=e.data,s=Rt(e,i),o=ft.parseMasterPlaylist(a,s);if(o.playlistParsingError)this.handleManifestParsingError(e,i,o.playlistParsingError,n,t);else{var l=o.contentSteering,u=o.levels,c=o.sessionData,d=o.sessionKeys,h=o.startTimeOffset,f=o.variableList;this.variableList=f;var m=ft.parseMasterPlaylistMedia(a,s,o),p=m.AUDIO,v=void 0===p?[]:p,g=m.SUBTITLES,y=m["CLOSED-CAPTIONS"];if(v.length){var b=v.some((function(e){return!e.url}));b||!u[0].audioCodec||u[0].attrs.AUDIO||(X.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new D({}),bitrate:0,url:""}))}r.trigger(x.MANIFEST_LOADED,{levels:u,audioTracks:v,subtitles:g,captions:y,contentSteering:l,url:s,stats:t,networkDetails:n,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f})}},t.handleTrackOrLevelPlaylist=function(e,t,i,n,r){var a=this.hls,s=i.id,o=i.level,l=i.type,u=Rt(e,i),c=0,d=S(o)?o:S(s)?s:0,h=xt(i),f=ft.parseLevelPlaylist(e.data,u,d,h,c,this.variableList);if(l===Tt.MANIFEST){var m={attrs:new D({}),bitrate:0,details:f,name:"",url:u};a.trigger(x.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=f,this.handlePlaylistLoaded(f,e,t,i,n,r)},t.handleManifestParsingError=function(e,t,i,n,r){this.hls.trigger(x.ERROR,{type:R.NETWORK_ERROR,details:w.MANIFEST_PARSING_ERROR,fatal:t.type===Tt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:n,stats:r})},t.handleNetworkError=function(e,t,i,r,a){void 0===i&&(i=!1);var s="A network "+(i?"timeout":"error"+(r?" (status "+r.code+")":""))+" occurred while loading "+e.type;e.type===Tt.LEVEL?s+=": "+e.level+" id: "+e.id:e.type!==Tt.AUDIO_TRACK&&e.type!==Tt.SUBTITLE_TRACK||(s+=" id: "+e.id+' group-id: "'+e.groupId+'"');var o=new Error(s);X.warn("[playlist-loader]: "+s);var l=w.UNKNOWN,u=!1,c=this.getInternalLoader(e);switch(e.type){case Tt.MANIFEST:l=i?w.MANIFEST_LOAD_TIMEOUT:w.MANIFEST_LOAD_ERROR,u=!0;break;case Tt.LEVEL:l=i?w.LEVEL_LOAD_TIMEOUT:w.LEVEL_LOAD_ERROR,u=!1;break;case Tt.AUDIO_TRACK:l=i?w.AUDIO_TRACK_LOAD_TIMEOUT:w.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Tt.SUBTITLE_TRACK:l=i?w.SUBTITLE_TRACK_LOAD_TIMEOUT:w.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);var d={type:R.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:a};if(r){var h=(null==t?void 0:t.url)||e.url;d.response=n({url:h,data:void 0},r)}this.hls.trigger(x.ERROR,d)},t.handlePlaylistLoaded=function(e,t,i,n,r,a){var s=this.hls,o=n.type,l=n.level,u=n.id,c=n.groupId,d=n.deliveryDirectives,h=Rt(t,n),f=xt(n),m="number"===typeof n.level&&f===kt.MAIN?l:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var p=e.playlistParsingError;if(p)s.trigger(x.ERROR,{type:R.NETWORK_ERROR,details:w.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:p,reason:p.message,response:t,context:n,level:m,parent:f,networkDetails:r,stats:i});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Tt.MANIFEST:case Tt.LEVEL:s.trigger(x.LEVEL_LOADED,{details:e,level:m||0,id:u||0,stats:i,networkDetails:r,deliveryDirectives:d});break;case Tt.AUDIO_TRACK:s.trigger(x.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:i,networkDetails:r,deliveryDirectives:d});break;case Tt.SUBTITLE_TRACK:s.trigger(x.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:i,networkDetails:r,deliveryDirectives:d});break}}else{var v=new Error("No Segments found in Playlist");s.trigger(x.ERROR,{type:R.NETWORK_ERROR,details:w.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:v,reason:v.message,response:t,context:n,level:m,parent:f,networkDetails:r,stats:i})}},e}();function Et(e,t){var i;try{i=new Event("addtrack")}catch(n){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function Zt(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var i=e.cues.length;i--;)e.removeCue(e.cues[i]);"disabled"===t&&(e.mode=t)}function Ct(e,t,i,n){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var a=Mt(e.cues,t,i),s=0;s<a.length;s++)n&&!n(a[s])||e.removeCue(a[s]);"disabled"===r&&(e.mode=r)}function It(e,t){if(t<e[0].startTime)return 0;var i=e.length-1;if(t>e[i].endTime)return-1;var n=0,r=i;while(n<=r){var a=Math.floor((r+n)/2);if(t<e[a].startTime)r=a-1;else{if(!(t>e[a].startTime&&n<i))return a;n=a+1}}return e[n].startTime-t<t-e[r].startTime?n:r}function Mt(e,t,i){var n=[],r=It(e,t);if(r>-1)for(var a=r,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=i)n.push(o);else if(o.startTime>i)return n}return n}var Gt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},Xt=.25;function _t(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function Pt(e,t,i,r,a){var s=new e(t,i,"");try{s.value=r,a&&(s.type=a)}catch(o){s=new e(t,i,JSON.stringify(a?n({type:a},r):r))}return s}var Dt=function(){var e=_t();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Wt(e,t){return e.getTime()/1e3-t}function Vt(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var Nt=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},t._registerListeners=function(){var e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)},t._unregisterListeners=function(){var e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&(Zt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},t.onManifestLoading=function(){this.dateRangeCuesAppended={}},t.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return Et(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,r=i.enableID3MetadataCues;if(n||r){var a=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var s=_t();if(s)for(var o=0;o<a.length;o++){var l=a[o].type;if((l!==Gt.emsg||n)&&r){var u=ae(a[o].data);if(u){var c=a[o].pts,d=c+a[o].duration;d>Dt&&(d=Dt);var h=d-c;h<=0&&(d=c+Xt);for(var f=0;f<u.length;f++){var m=u[f];if(!ne(m)){this.updateId3CueEnds(c,l);var p=Pt(s,c,d,m,l);p&&this.id3Track.addCue(p)}}}}}}}},t.updateId3CueEnds=function(e,t){var i,n=null==(i=this.id3Track)?void 0:i.cues;if(n)for(var r=n.length;r--;){var a=n[r];a.type===t&&a.startTime<e&&a.endTime===Dt&&(a.endTime=e)}},t.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,r=t.type,a=this.id3Track,s=this.hls;if(s){var o,l=s.config,u=l.enableEmsgMetadataCues,c=l.enableID3MetadataCues;if(a&&(u||c))o="audio"===r?function(e){return e.type===Gt.audioId3&&c}:"video"===r?function(e){return e.type===Gt.emsg&&u}:function(e){return e.type===Gt.audioId3&&c||e.type===Gt.emsg&&u},Ct(a,i,n,o)}},t.onLevelUpdated=function(e,t){var i=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var r=this.dateRangeCuesAppended,a=this.id3Track,s=n.dateRanges,o=Object.keys(s);if(a)for(var l=Object.keys(r).filter((function(e){return!o.includes(e)})),u=function(){var e=l[c];Object.keys(r[e].cues).forEach((function(t){a.removeCue(r[e].cues[t])})),delete r[e]},c=l.length;c--;)u();var d=n.fragments[n.fragments.length-1];if(0!==o.length&&S(null==d?void 0:d.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=d.programDateTime/1e3-d.start,f=_t(),m=function(){var e=o[p],t=s[e],n=Wt(t.startDate,h),a=r[e],l=(null==a?void 0:a.cues)||{},u=(null==a?void 0:a.durationKnown)||!1,c=Dt,d=t.endDate;if(d)c=Wt(d,h),u=!0;else if(t.endOnNext&&!u){var m=o.reduce((function(e,i){if(i!==t.id){var n=s[i];if(n.class===t.class&&n.startDate>t.startDate&&(!e||t.startDate<e.startDate))return n}return e}),null);m&&(c=Wt(m.startDate,h),u=!0)}for(var v=Object.keys(t.attr),g=0;g<v.length;g++){var y=v[g];if(W(y)){var b=l[y];if(b)u&&!a.durationKnown&&(b.endTime=c);else if(f){var L=t.attr[y];V(y)&&(L=Vt(L));var S=Pt(f,n,c,{key:y,data:L},Gt.dateRange);S&&(S.id=e,i.id3Track.addCue(S),l[y]=S)}}}r[e]={cues:l,dateRange:t,durationKnown:u}},p=0;p<o.length;p++)m()}}},e}(),Ft=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(x.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(x.ERROR,this.onError,this)},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(e,t){var i=t.details;this.levelDetails=i,i.advanced&&this.timeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(e,t){var i;t.details===w.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(i=this.levelDetails)&&i.live&&X.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var i=this.computeLatency();if(null!==i){this._latency=i;var n=this.config,r=n.lowLatencyMode,a=n.maxLiveSyncPlaybackRate;if(r&&1!==a&&t.live){var s=this.targetLatency;if(null!==s){var o=i-s,l=Math.min(this.maxLatency,s+t.targetduration),u=o<l;if(u&&o>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,a)),d=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,d))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},t.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},o(e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,i=e.partHoldBack,n=e.targetduration,r=this.config,a=r.liveSyncDuration,s=r.liveSyncDurationCount,o=r.lowLatencyMode,l=this.hls.userConfig,u=o&&i||t;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==a?a:s*n);var c=n,d=1;return u+Math.min(this.stallCount*d,c)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;var n=i.edge,r=e-t-this.edgeStalled,a=n-i.totalduration,s=n-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,r),s)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}}]),e}(),At=["NONE","TYPE-0","TYPE-1",null];function Yt(e){return At.indexOf(e)>-1}var Ot=["SDR","PQ","HLG"];function Ht(e){return!!e&&Ot.indexOf(e)>-1}var Kt={No:"",Yes:"YES",v2:"v2"};function Ut(e){var t=e.canSkipUntil,i=e.canSkipDateRanges,n=e.age,r=n<t/2;return t&&r?i?Kt.v2:Kt.Yes:Kt.No}var Bt=function(){function e(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}var t=e.prototype;return t.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},e}(),zt=function(){function e(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return!!e})).map((function(e){return e.substring(0,4)})).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}var t=e.prototype;return t.hasAudioGroup=function(e){return jt(this._audioGroups,e)},t.hasSubtitleGroup=function(e){return jt(this._subtitleGroups,e)},t.addGroupId=function(e,t){if(t)if("audio"===e){var i=this._audioGroups;i||(i=this._audioGroups=[]),-1===i.indexOf(t)&&i.push(t)}else if("text"===e){var n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),-1===n.indexOf(t)&&n.push(t)}},t.addFallback=function(){},o(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(e){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroups)?void 0:e[0]}},{key:"textGroupId",get:function(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}}]),e}();function jt(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Jt(e,t){var i=t.startPTS;if(S(i)){var n,r=0;t.sn>e.sn?(r=i-e.start,n=e):(r=e.start-i,n=t),n.duration!==r&&(n.duration=r)}else if(t.sn>e.sn){var a=e.cc===t.cc;a&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function Qt(e,t,i,n,r,a){var s=n-i;s<=0&&(X.warn("Fragment should have a positive duration",t),n=i+t.duration,a=r+t.duration);var o=i,l=n,u=t.startPTS,c=t.endPTS;if(S(u)){var d=Math.abs(u-i);S(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(i,u),i=Math.min(i,u),r=Math.min(r,t.startDTS),l=Math.min(n,c),n=Math.max(n,c),a=Math.max(a,t.endDTS)}var h=i-t.start;0!==t.start&&(t.start=i),t.duration=n-t.start,t.startPTS=i,t.maxStartPTS=o,t.startDTS=r,t.endPTS=n,t.minEndPTS=l,t.endDTS=a;var f,m=t.sn;if(!e||m<e.startSN||m>e.endSN)return 0;var p=m-e.startSN,v=e.fragments;for(v[p]=t,f=p;f>0;f--)Jt(v[f],v[f-1]);for(f=p;f<v.length-1;f++)Jt(v[f],v[f+1]);return e.fragmentHint&&Jt(v[v.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,h}function qt(e,t){for(var i=null,n=e.fragments,r=n.length-1;r>=0;r--){var a=n[r].initSegment;if(a){i=a;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var s,o=0;if(ti(e,t,(function(e,n){e.relurl&&(o=e.cc-n.cc),S(e.startPTS)&&S(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(s=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,e.initSegment&&(n.initSegment=e.initSegment,i=e.initSegment)})),i){var l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;l.forEach((function(e){var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=i)?void 0:t.relurl)||(e.initSegment=i)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){X.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=$t(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var c=t.fragments;if(o){X.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<c.length;d++)c[d].cc+=o}t.skippedSegments&&(t.startCC=t.fragments[0].cc),ei(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),s?Qt(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):ii(e,t),c.length&&(t.totalduration=t.edge-c[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var h=t.advancedDateTime;if(t.advanced&&h){var f=t.edge;t.driftStart||(t.driftStartTime=h,t.driftStart=f),t.driftEndTime=h,t.driftEnd=f}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function $t(e,t,i){var n=u({},e);return i&&i.forEach((function(e){delete n[e]})),Object.keys(t).forEach((function(e){var i=new N(t[e].attr,n[e]);i.isValid?n[e]=i:X.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[e].attr)+'"')})),n}function ei(e,t,i){if(e&&t)for(var n=0,r=0,a=e.length;r<=a;r++){var s=e[r],o=t[r+n];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?i(s,o):n--}}function ti(e,t,i){for(var n=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=r;u<=a;u++){var c=l[s+u],d=o[u];n&&!d&&u<n&&(d=t.fragments[u]=c),c&&d&&i(c,d)}}function ii(e,t){var i=t.startSN+t.skippedSegments-e.startSN,n=e.fragments;i<0||i>=n.length||ni(t,n[i].start)}function ni(e,t){if(t){for(var i=e.fragments,n=e.skippedSegments;n<i.length;n++)i[n].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function ri(e,t){void 0===t&&(t=1/0);var i=1e3*e.targetduration;if(e.updated){var n=e.fragments,r=4;if(n.length&&i*r>t){var a=1e3*n[n.length-1].duration;a<i&&(i=a)}}else i/=2;return Math.round(i)}function ai(e,t,i){if(null==e||!e.details)return null;var n=e.details,r=n.fragments[t-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===t?r:t<n.startSN&&i&&i.sn===t?i:null)}function si(e,t,i){var n;return null!=e&&e.details?oi(null==(n=e.details)?void 0:n.partList,t,i):null}function oi(e,t,i){if(e)for(var n=e.length;n--;){var r=e[n];if(r.index===i&&r.fragment.sn===t)return r}return null}function li(e){e.forEach((function(e,t){var i=e.details;null!=i&&i.fragments&&i.fragments.forEach((function(e){e.level=t}))}))}function ui(e){switch(e.details){case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_TIMEOUT:case w.LEVEL_LOAD_TIMEOUT:case w.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ci(e,t){var i=ui(t);return e.default[(i?"timeout":"error")+"Retry"]}function di(e,t){var i="linear"===e.backoff?1:Math.pow(2,t);return Math.min(i*e.retryDelayMs,e.maxRetryDelayMs)}function hi(e){return n(n({},e),{errorRetry:null,timeoutRetry:null})}function fi(e,t,i,n){if(!e)return!1;var r=null==n?void 0:n.code,a=t<e.maxNumRetry&&(mi(r)||!!i);return e.shouldRetry?e.shouldRetry(e,t,i,n,a):a}function mi(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}var pi={search:function(e,t){var i=0,n=e.length-1,r=null,a=null;while(i<=n){r=(i+n)/2|0,a=e[r];var s=t(a);if(s>0)i=r+1;else{if(!(s<0))return a;n=r-1}}return null}};function vi(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!S(t))return null;var n=e[0].programDateTime;if(t<(n||0))return null;var r=e[e.length-1].endProgramDateTime;if(t>=(r||0))return null;i=i||0;for(var a=0;a<e.length;++a){var s=e[a];if(Li(t,i,s))return s}return null}function gi(e,t,i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=.005);var a=null;if(e){a=t[e.sn-t[0].sn+1]||null;var s=e.endDTS-i;s>0&&s<15e-7&&(i+=15e-7)}else 0===i&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===bi(i,n,a)||yi(a,e,Math.min(r,n))))return a;var o=pi.search(t,bi.bind(null,i,n));return!o||o===e&&a?a:o}function yi(e,t,i){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){var n=t.tagList.reduce((function(e,t){return"INF"===t[0]&&(e+=parseFloat(t[1])),e}),i);return e.start<=n}return!1}function bi(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=0),i.start<=e&&i.start+i.duration>e)return 0;var n=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-n<=e?1:i.start-n>e&&i.start?-1:0}function Li(e,t,i){var n=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0)),r=i.endProgramDateTime||0;return r-n>e}function Si(e,t){return pi.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}var Ti={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ki={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},xi=function(){function e(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=X.log.bind(X,"[info]:"),this.warn=X.warn.bind(X,"[warning]:"),this.error=X.error.bind(X,"[error]:"),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(x.ERROR,this.onError,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)},t.unregisterListeners=function(){var e=this.hls;e&&(e.off(x.ERROR,this.onError,this),e.off(x.ERROR,this.onErrorOut,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))},t.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},t.startLoad=function(e){},t.stopLoad=function(){this.playlistError=0},t.getVariantLevelIndex=function(e){return(null==e?void 0:e.type)===kt.MAIN?e.level:this.hls.loadLevel},t.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},t.onLevelUpdated=function(){this.playlistError=0},t.onError=function(e,t){var i,n;if(!t.fatal){var r=this.hls,a=t.context;switch(t.details){case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case w.FRAG_PARSING_ERROR:if(null!=(i=t.frag)&&i.gap)return void(t.errorAction={action:Ti.DoNothing,flags:ki.None});case w.FRAG_GAP:case w.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Ti.SendAlternateToPenaltyBox);case w.LEVEL_EMPTY_ERROR:case w.LEVEL_PARSING_ERROR:var s,o,l=t.parent===kt.MAIN?t.level:r.loadLevel;return void(t.details===w.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(o=s.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l)));case w.LEVEL_LOAD_ERROR:case w.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==a?void 0:a.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level)));case w.AUDIO_TRACK_LOAD_ERROR:case w.AUDIO_TRACK_LOAD_TIMEOUT:case w.SUBTITLE_LOAD_ERROR:case w.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){var u=r.levels[r.loadLevel];if(u&&(a.type===Tt.AUDIO_TRACK&&u.hasAudioGroup(a.groupId)||a.type===Tt.SUBTITLE_TRACK&&u.hasSubtitleGroup(a.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Ti.SendAlternateToPenaltyBox,void(t.errorAction.flags=ki.MoveAllAlternatesMatchingHost)}return;case w.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var c=r.levels[r.loadLevel],d=null==c?void 0:c.attrs["HDCP-LEVEL"];return void(d?t.errorAction={action:Ti.SendAlternateToPenaltyBox,flags:ki.MoveAllAlternatesMatchingHDCP,hdcpLevel:d}:this.keySystemError(t));case w.BUFFER_ADD_CODEC_ERROR:case w.REMUX_ALLOC_ERROR:case w.BUFFER_APPEND_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(n=t.level)?n:r.loadLevel));case w.INTERNAL_EXCEPTION:case w.BUFFER_APPENDING_ERROR:case w.BUFFER_FULL_ERROR:case w.LEVEL_SWITCH_ERROR:case w.BUFFER_STALLED_ERROR:case w.BUFFER_SEEK_OVER_HOLE:case w.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Ti.DoNothing,flags:ki.None})}t.type===R.KEY_SYSTEM_ERROR&&this.keySystemError(t)}},t.keySystemError=function(e){var t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)},t.getPlaylistRetryOrSwitchAction=function(e,t){var i=this.hls,n=ci(i.config.playlistLoadPolicy,e),r=this.playlistError++,a=fi(n,r,ui(e),e.response);if(a)return{action:Ti.RetryRequest,flags:ki.None,retryConfig:n,retryCount:r};var s=this.getLevelSwitchAction(e,t);return n&&(s.retryConfig=n,s.retryCount=r),s},t.getFragRetryOrSwitchAction=function(e){var t=this.hls,i=this.getVariantLevelIndex(e.frag),n=t.levels[i],r=t.config,a=r.fragLoadPolicy,s=r.keyLoadPolicy,o=ci(e.details.startsWith("key")?s:a,e),l=t.levels.reduce((function(e,t){return e+t.fragmentError}),0);if(n){e.details!==w.FRAG_GAP&&n.fragmentError++;var u=fi(o,l,ui(e),e.response);if(u)return{action:Ti.RetryRequest,flags:ki.None,retryConfig:o,retryCount:l}}var c=this.getLevelSwitchAction(e,i);return o&&(c.retryConfig=o,c.retryCount=l),c},t.getLevelSwitchAction=function(e,t){var i=this.hls;null!==t&&void 0!==t||(t=i.loadLevel);var n=this.hls.levels[t];if(n){var r,a,s=e.details;n.loadError++,s===w.BUFFER_APPEND_ERROR&&n.fragmentError++;var o=-1,l=i.levels,u=i.loadLevel,c=i.minAutoLevel,d=i.maxAutoLevel;i.autoLevelEnabled||(i.loadLevel=-1);for(var h,f=null==(r=e.frag)?void 0:r.type,m=f===kt.AUDIO&&s===w.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(s===w.BUFFER_ADD_CODEC_ERROR||s===w.BUFFER_APPEND_ERROR),p=m&&l.some((function(e){var t=e.audioCodec;return n.audioCodec!==t})),v="video"===e.sourceBufferName&&(s===w.BUFFER_ADD_CODEC_ERROR||s===w.BUFFER_APPEND_ERROR),g=v&&l.some((function(e){var t=e.codecSet,i=e.audioCodec;return n.codecSet!==t&&n.audioCodec===i})),y=null!=(a=e.context)?a:{},b=y.type,L=y.groupId,S=function(){var t=(T+u)%l.length;if(t!==u&&t>=c&&t<=d&&0===l[t].loadError){var i,r,a=l[t];if(s===w.FRAG_GAP&&f===kt.MAIN&&e.frag){var h=l[t].details;if(h){var m=gi(e.frag,h.fragments,e.frag.start);if(null!=m&&m.gap)return 0}}else{if(b===Tt.AUDIO_TRACK&&a.hasAudioGroup(L)||b===Tt.SUBTITLE_TRACK&&a.hasSubtitleGroup(L))return 0;if(f===kt.AUDIO&&null!=(i=n.audioGroups)&&i.some((function(e){return a.hasAudioGroup(e)}))||f===kt.SUBTITLE&&null!=(r=n.subtitleGroups)&&r.some((function(e){return a.hasSubtitleGroup(e)}))||p&&n.audioCodec===a.audioCodec||!p&&n.audioCodec!==a.audioCodec||g&&n.codecSet===a.codecSet)return 0}return o=t,1}},T=l.length;T--;)if(h=S(),0!==h&&1===h)break;if(o>-1&&i.loadLevel!==o)return e.levelRetry=!0,this.playlistError=0,{action:Ti.SendAlternateToPenaltyBox,flags:ki.None,nextAutoLevel:o}}return{action:Ti.SendAlternateToPenaltyBox,flags:ki.MoveAllAlternatesMatchingHost}},t.onErrorOut=function(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case Ti.DoNothing:break;case Ti.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===w.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'+t.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError()):t.fatal=!0;break}t.fatal&&this.hls.stopLoad()},t.sendAlternateToPenaltyBox=function(e){var t=this.hls,i=e.errorAction;if(i){var n=i.flags,r=i.hdcpLevel,a=i.nextAutoLevel;switch(n){case ki.None:this.switchLevel(e,a);break;case ki.MoveAllAlternatesMatchingHDCP:r&&(t.maxHdcpLevel=At[At.indexOf(r)-1],i.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower');break}i.resolved||this.switchLevel(e,a)}},t.switchLevel=function(e,t){void 0!==t&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},e}(),Ri=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=X.log.bind(X,t+":"),this.warn=X.warn.bind(X,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.clearTimer=function(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)},t.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t,i){var n=null==t?void 0:t.renditionReports;if(n){for(var r=-1,a=0;a<n.length;a++){var s=n[a],o=void 0;try{o=new self.URL(s.URI,t.url).href}catch(f){X.warn("Could not construct new URL for Rendition Report: "+f),o=s.URI||""}if(o===e){r=a;break}o===e.substring(0,o.length)&&(r=a)}if(-1!==r){var l=n[r],u=parseInt(l["LAST-MSN"])||(null==t?void 0:t.lastPartSn),c=parseInt(l["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var d=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&d>t.partTarget&&(c+=1)}var h=i&&Ut(i);return new Bt(u,c>=0?c:void 0,h)}}},t.loadPlaylist=function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},t.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},t.shouldReloadPlaylist=function(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)},t.playlistLoaded=function(e,t,i){var n=this,r=t.details,a=t.stats,s=self.performance.now(),o=a.loading.first?Math.max(0,s-a.loading.first):0;if(r.advancedDateTime=Date.now()-o,r.live||null!=i&&i.live){if(r.reloaded(i),i&&this.log("live playlist "+e+" "+(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED")),i&&r.fragments.length>0&&qt(i,r),!this.canLoad||!r.live)return;var l,u=void 0,c=void 0;if(r.canBlockReload&&r.endSN&&r.advanced){var d=this.hls.config.lowLatencyMode,h=r.lastPartSn,f=r.endSN,m=r.lastPartIndex,p=-1!==m,v=h===f,g=d?0:m;p?(u=v?f+1:h,c=v?g:m+1):u=f+1;var y=r.age,b=y+r.ageHeader,L=Math.min(b-r.partTarget,1.5*r.targetduration);if(L>0){if(i&&L>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+L+" with playlist age: "+r.age),L=0;else{var S=Math.floor(L/r.targetduration);if(u+=S,void 0!==c){var T=Math.round(L%r.targetduration/r.partTarget);c+=T}this.log("CDN Tune-in age: "+r.ageHeader+"s last advanced "+y.toFixed(2)+"s goal: "+L+" skip sn "+S+" to part "+c)}r.tuneInGoal=L}if(l=this.getDeliveryDirectives(r,t.deliveryDirectives,u,c),d||!v)return void this.loadPlaylist(l)}else(r.canBlockReload||r.canSkipUntil)&&(l=this.getDeliveryDirectives(r,t.deliveryDirectives,u,c));var k=this.hls.mainForwardBufferInfo,x=k?k.end-k.len:0,R=1e3*(r.edge-x),w=ri(r,R);r.updated&&s>this.requestScheduled+w&&(this.requestScheduled=a.loading.start),void 0!==u&&r.canBlockReload?this.requestScheduled=a.loading.first+w-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+w<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=w);var E=this.requestScheduled-s;E=Math.max(0,E),this.log("reload live playlist "+e+" in "+Math.round(E)+" ms"),this.timer=self.setTimeout((function(){return n.loadPlaylist(l)}),E)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,i,n){var r=Ut(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,r=Kt.No),new Bt(i,n,r)},t.checkRetry=function(e){var t=this,i=e.details,n=ui(e),r=e.errorAction,a=r||{},s=a.action,o=a.retryCount,l=void 0===o?0:o,u=a.retryConfig,c=!!r&&!!u&&(s===Ti.RetryRequest||!r.resolved&&s===Ti.SendAlternateToPenaltyBox);if(c){var d;if(this.requestScheduled=-1,l>=u.maxNumRetry)return!1;if(n&&null!=(d=e.context)&&d.deliveryDirectives)this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var h=di(u,l);this.timer=self.setTimeout((function(){return t.loadPlaylist()}),h),this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+' after "'+i+'" in '+h+"ms")}e.levelRetry=!0,r.resolved=!0}return c},e}(),wi=function(){function e(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var t=e.prototype;return t.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}(),Ei=function(){function e(e,t,i,n){void 0===n&&(n=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new wi(e),this.fast_=new wi(t),this.defaultTTFB_=n,this.ttfb_=new wi(e)}var t=e.prototype;return t.update=function(e,t){var i=this.slow_,n=this.fast_,r=this.ttfb_;i.halfLife!==e&&(this.slow_=new wi(e,i.getEstimate(),i.getTotalWeight())),n.halfLife!==t&&(this.fast_=new wi(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new wi(e,r.getEstimate(),r.getTotalWeight()))},t.sample=function(e,t){e=Math.max(e,this.minDelayMs_);var i=8*t,n=e/1e3,r=i/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.sampleTTFB=function(e){var t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))},t.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},t.destroy=function(){},e}();function Zi(){if("function"===typeof matchMedia){var e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}function Ci(e,t){var i=!1,n=[];return e&&(i="SDR"!==e,n=[e]),t&&(n=t.allowedVideoRanges||Ot.slice(0),i=void 0!==t.preferHDR?t.preferHDR:Zi(),n=i?n.filter((function(e){return"SDR"!==e})):["SDR"]),{preferHDR:i,allowedVideoRanges:n}}function Ii(e,t,i,n,r){for(var a=Object.keys(e),s=null==n?void 0:n.channels,o=null==n?void 0:n.audioCodec,l=s&&2===parseInt(s),u=!0,c=!1,d=1/0,h=1/0,f=1/0,m=0,p=[],v=Ci(t,r),g=v.preferHDR,y=v.allowedVideoRanges,b=function(){var t=e[a[L]];u=t.channels[2]>0,d=Math.min(d,t.minHeight),h=Math.min(h,t.minFramerate),f=Math.min(f,t.minBitrate);var i=y.filter((function(e){return t.videoRanges[e]>0}));i.length>0&&(c=!0,p=i)},L=a.length;L--;)b();d=S(d)?d:0,h=S(h)?h:0;var T=Math.max(1080,d),k=Math.max(30,h);f=S(f)?f:i,i=Math.max(f,i),c||(t=void 0,p=[]);var x=a.reduce((function(t,n){var r=e[n];if(n===t)return t;if(r.minBitrate>i)return Mi(n,"min bitrate of "+r.minBitrate+" > current estimate of "+i),t;if(!r.hasDefaultAudio)return Mi(n,"no renditions with default or auto-select sound found"),t;if(o&&n.indexOf(o.substring(0,4))%5!==0)return Mi(n,'audio codec preference "'+o+'" not found'),t;if(s&&!l){if(!r.channels[s])return Mi(n,"no renditions with "+s+" channel sound found (channels options: "+Object.keys(r.channels)+")"),t}else if((!o||l)&&u&&0===r.channels["2"])return Mi(n,"no renditions with stereo sound found"),t;return r.minHeight>T?(Mi(n,"min resolution of "+r.minHeight+" > maximum of "+T),t):r.minFramerate>k?(Mi(n,"min framerate of "+r.minFramerate+" > maximum of "+k),t):p.some((function(e){return r.videoRanges[e]>0}))?r.maxScore<m?(Mi(n,"max score of "+r.maxScore+" < selected max of "+m),t):t&&(tt(n)>=tt(t)||r.fragmentError>e[t].fragmentError)?t:(m=r.maxScore,n):(Mi(n,"no variants with VIDEO-RANGE of "+JSON.stringify(p)+" found"),t)}),void 0);return{codecSet:x,videoRanges:p,preferHDR:g,minFramerate:h,minBitrate:f}}function Mi(e,t){X.log('[abr] start candidates with "'+e+'" ignored because '+t)}function Gi(e){return e.reduce((function(e,t){var i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);var n=t.channels||"2";return i.channels[n]=(i.channels[n]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Xi(e,t,i,n){return e.slice(i,n+1).reduce((function(e,t){if(!t.codecSet)return e;var i=t.audioGroups,n=e[t.codecSet];n||(e[t.codecSet]=n={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),n.minBitrate=Math.min(n.minBitrate,t.bitrate);var r=Math.min(t.height,t.width);return n.minHeight=Math.min(n.minHeight,r),n.minFramerate=Math.min(n.minFramerate,t.frameRate),n.maxScore=Math.max(n.maxScore,t.score),n.fragmentError+=t.fragmentError,n.videoRanges[t.videoRange]=(n.videoRanges[t.videoRange]||0)+1,e}),{})}var _i=function(){function e(e){var t=this;this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=function(){var e=t.fragCurrent,i=t.partCurrent,n=t.hls,r=n.autoLevelEnabled,a=n.media;if(e&&a){var s=performance.now(),o=i?i.stats:e.stats,l=i?i.duration:e.duration,u=s-o.loading.start,c=n.minAutoLevel;if(o.aborted||o.loaded&&o.loaded===o.total||e.level<=c)return t.clearTimer(),void(t._nextAutoLevel=-1);if(r&&!a.paused&&a.playbackRate&&a.readyState){var d=n.mainForwardBufferInfo;if(null!==d){var h=t.bwEstimator.getEstimateTTFB(),f=Math.abs(a.playbackRate);if(!(u<=Math.max(h,l/(2*f)*1e3))){var m=d.len/f,p=o.loading.first?o.loading.first-o.loading.start:-1,v=o.loaded&&p>-1,g=t.getBwEstimate(),y=n.levels,b=y[e.level],L=o.total||Math.max(o.loaded,Math.round(l*b.averageBitrate/8)),T=v?u-p:u;T<1&&v&&(T=Math.min(u,8*o.loaded/g));var k=v?1e3*o.loaded/T:0,R=k?(L-o.loaded)/k:8*L/g+h/1e3;if(!(R<=m)){var w,E=k?8*k:g,Z=Number.POSITIVE_INFINITY;for(w=e.level-1;w>c;w--){var C=y[w].maxBitrate;if(Z=t.getTimeToLoadFrag(h/1e3,E,l*C,!y[w].details),Z<m)break}if(!(Z>=R)&&!(Z>10*l)){n.nextLoadLevel=n.nextAutoLevel=w,v?t.bwEstimator.sample(u-Math.min(h,p),o.loaded):t.bwEstimator.sampleTTFB(u);var I=y[w].maxBitrate;t.getBwEstimate()*t.hls.config.abrBandWidthUpFactor>I&&t.resetEstimator(I),t.clearTimer(),X.warn("[abr] Fragment "+e.sn+(i?" part "+i.index:"")+" of level "+e.level+" is loading too slowly;\n      Time to underbuffer: "+m.toFixed(3)+" s\n      Estimated load time for current fragment: "+R.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+Z.toFixed(3)+" s\n      TTFB estimate: "+(0|p)+" ms\n      Current BW estimate: "+(S(g)?0|g:"Unknown")+" bps\n      New BW estimate: "+(0|t.getBwEstimate())+" bps\n      Switching to level "+w+" @ "+(0|I)+" bps"),n.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:i,stats:o})}}}}}}},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}var t=e.prototype;return t.resetEstimator=function(e){e&&(X.log("setting initial bwe to "+e),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},t.initEstimator=function(){var e=this.hls.config;return new Ei(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)},t.registerListeners=function(){var e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(x.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(x.ERROR,this.onError,this))},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},t.onManifestLoading=function(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},t.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},t.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},t.onFragLoading=function(e,t){var i=t.frag;if(!this.ignoreFragment(i)){var n;if(!i.bitrateTest)this.fragCurrent=i,this.partCurrent=null!=(n=t.part)?n:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},t.onLevelSwitching=function(e,t){this.clearTimer()},t.onError=function(e,t){if(!t.fatal)switch(t.details){case w.BUFFER_ADD_CODEC_ERROR:case w.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case w.FRAG_LOAD_TIMEOUT:var i=t.frag,n=this.fragCurrent,r=this.partCurrent;if(i&&n&&i.sn===n.sn&&i.level===n.level){var a=performance.now(),s=r?r.stats:i.stats,o=a-s.loading.start,l=s.loading.first?s.loading.first-s.loading.start:-1,u=s.loaded&&l>-1;if(u){var c=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(o-Math.min(c,l),s.loaded)}else this.bwEstimator.sampleTTFB(o)}break}},t.getTimeToLoadFrag=function(e,t,i,n){var r=e+i/t,a=n?this.lastLevelLoadSec:0;return r+a},t.onLevelLoaded=function(e,t){var i=this.hls.config,n=t.stats.loading,r=n.end-n.start;S(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)},t.onFragLoaded=function(e,t){var i=t.frag,n=t.part,r=n?n.stats:i.stats;if(i.type===kt.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var a=n?n.duration:i.duration,s=this.hls.levels[i.level],o=(s.loaded?s.loaded.bytes:0)+r.loaded,l=(s.loaded?s.loaded.duration:0)+a;s.loaded={bytes:o,duration:l},s.realBitrate=Math.round(8*o/l)}if(i.bitrateTest){var u={stats:r,frag:i,part:n,id:i.type};this.onFragBuffered(x.FRAG_BUFFERED,u),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}},t.onFragBuffered=function(e,t){var i=t.frag,n=t.part,r=null!=n&&n.stats.loaded?n.stats:i.stats;if(!r.aborted&&!this.ignoreFragment(i)){var a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},t.ignoreFragment=function(e){return e.type!==kt.MAIN||"initSegment"===e.sn},t.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},t.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},t.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls,n=i.maxAutoLevel,r=i.config,a=i.minAutoLevel,s=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay(),u=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){var d=this.findBestLevel(o,a,n,l,0,u,c);if(d>=0)return d}var h=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){var f=this.bitrateTestDelay;if(f){var m=s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay;h=m-f,X.info("[abr] bitrate test took "+Math.round(1e3*f)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms"),u=c=1}}var p=this.findBestLevel(o,a,n,l,h,u,c);if(X.info("[abr] "+(l?"rebuffering expected":"buffer is empty")+", optimal quality level "+p),p>-1)return p;var v=i.levels[a],g=i.levels[i.loadLevel];return(null==v?void 0:v.bitrate)<(null==g?void 0:g.bitrate)?a:i.loadLevel},t.getStarvationDelay=function(){var e=this.hls,t=e.media;if(!t)return 1/0;var i=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/i},t.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},t.findBestLevel=function(e,t,i,n,r,a,s){var o,l=this,u=n+r,c=this.lastLoadedFragLevel,d=-1===c?this.hls.firstLevel:c,h=this.fragCurrent,f=this.partCurrent,m=this.hls,p=m.levels,v=m.allAudioTracks,g=m.loadLevel,y=m.config;if(1===p.length)return 0;var b,L=p[d],T=!(null==L||null==(o=L.details)||!o.live),k=-1===g||-1===c,x="SDR",R=(null==L?void 0:L.frameRate)||0,w=y.audioPreference,E=y.videoPreference,Z=this.audioTracksByGroup||(this.audioTracksByGroup=Gi(v));if(k){if(-1!==this.firstSelection)return this.firstSelection;var C=this.codecTiers||(this.codecTiers=Xi(p,Z,t,i)),I=Ii(C,x,e,w,E),M=I.codecSet,G=I.videoRanges,_=I.minFramerate,P=I.minBitrate,D=I.preferHDR;b=M,x=D?G[G.length-1]:G[0],R=_,e=Math.max(e,P),X.log("[abr] picked start tier "+JSON.stringify(I))}else b=null==L?void 0:L.codecSet,x=null==L?void 0:L.videoRange;for(var W,V=f?f.duration:h?h.duration:0,N=this.bwEstimator.getEstimateTTFB()/1e3,F=[],A=function(){var t,o=p[Y],h=Y>d;if(!o)return 0;if(b&&o.codecSet!==b||x&&o.videoRange!==x||h&&R>o.frameRate||!h&&R>0&&R<o.frameRate||o.supportedResult&&(null==(t=o.supportedResult.decodingInfoResults)||!t[0].smooth))return F.push(Y),0;var m,v=o.details,y=(f?null==v?void 0:v.partTarget:null==v?void 0:v.averagetargetduration)||V;m=h?s*e:a*e;var w=V&&n>=2*V&&0===r?p[Y].averageBitrate:p[Y].maxBitrate,E=l.getTimeToLoadFrag(N,m,w*y,void 0===v),Z=m>=w&&(Y===c||0===o.loadError&&0===o.fragmentError)&&(E<=N||!S(E)||T&&!l.bitrateTestDelay||E<u);if(Z){var C=l.forcedAutoLevel;return Y===g||-1!==C&&C===g||(F.length&&X.trace("[abr] Skipped level(s) "+F.join(",")+" of "+i+' max with CODECS and VIDEO-RANGE:"'+p[F[0]].codecs+'" '+p[F[0]].videoRange+'; not compatible with "'+L.codecs+'" '+x),X.info("[abr] switch candidate:"+d+"->"+Y+" adjustedbw("+Math.round(m)+")-bitrate="+Math.round(m-w)+" ttfb:"+N.toFixed(1)+" avgDuration:"+y.toFixed(1)+" maxFetchDuration:"+u.toFixed(1)+" fetchDuration:"+E.toFixed(1)+" firstSelection:"+k+" codecSet:"+b+" videoRange:"+x+" hls.loadLevel:"+g)),k&&(l.firstSelection=Y),{v:Y}}},Y=i;Y>=t;Y--)if(W=A(),0!==W&&W)return W.v;return-1},o(e,[{key:"firstAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.minAutoLevel,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(n,i,t,0,r,1,1);if(a>-1)return a;var s=this.hls.firstLevel,o=Math.min(Math.max(s,i),t);return X.warn("[abr] Could not find best starting auto level. Defaulting to first in playlist "+s+" clamped to "+o),o}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,t=this.bwEstimator,i=t.canEstimate(),n=this.lastLoadedFragLevel>-1;if(-1!==e&&(!i||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var r=i&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){var a=this.hls.levels;if(a.length>Math.max(e,r)&&a[e].loadError<=a[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r},set:function(e){var t=this.hls,i=t.maxAutoLevel,n=t.minAutoLevel,r=Math.min(Math.max(e,n),i);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}}]),e}(),Pi={length:0,start:function(){return 0},end:function(){return 0}},Di=function(){function e(){}return e.isBuffered=function(t,i){try{if(t)for(var n=e.getBuffered(t),r=0;r<n.length;r++)if(i>=n.start(r)&&i<=n.end(r))return!0}catch(a){}return!1},e.bufferInfo=function(t,i,n){try{if(t){var r,a=e.getBuffered(t),s=[];for(r=0;r<a.length;r++)s.push({start:a.start(r),end:a.end(r)});return this.bufferedInfo(s,i,n)}}catch(o){}return{len:0,start:i,end:i,nextStart:void 0}},e.bufferedInfo=function(e,t,i){t=Math.max(0,t),e.sort((function(e,t){var i=e.start-t.start;return i||t.end-e.end}));var n=[];if(i)for(var r=0;r<e.length;r++){var a=n.length;if(a){var s=n[a-1].end;e[r].start-s<i?e[r].end>s&&(n[a-1].end=e[r].end):n.push(e[r])}else n.push(e[r])}else n=e;for(var o,l=0,u=t,c=t,d=0;d<n.length;d++){var h=n[d].start,f=n[d].end;if(t+i>=h&&t<f)u=h,c=f,l=c-t;else if(t+i<h){o=h;break}}return{len:l,start:u||0,end:c||0,nextStart:o}},e.getBuffered=function(e){try{return e.buffered}catch(t){return X.log("failed to get media.buffered",t),Pi}},e}(),Wi=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t,i){var n=this.queues[t];n.push(e),1!==n.length||i||this.executeNext(t)},t.insertAbort=function(e,t){var i=this.queues[t];i.unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,i=new Promise((function(e){t=e})),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),i},t.executeNext=function(e){var t=this.queues[e];if(t.length){var i=t[0];try{i.execute()}catch(r){X.warn('[buffer-operation-queue]: Exception executing "'+e+'" SourceBuffer operation: '+r),i.onError(r);var n=this.buffers[e];null!=n&&n.updating||this.shiftAndExecuteNext(e)}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}(),Vi=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ni=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=function(e){t.hls&&t.hls.pauseBuffering()},this._onStartStreaming=function(e){t.hls&&t.hls.resumeBuffering()},this._onMediaSourceOpen=function(){var e=t.media,i=t.mediaSource;t.log("Media source opened"),e&&(e.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(x.MEDIA_ATTACHED,{media:e,mediaSource:i})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){t.log("Media source closed")},this._onMediaSourceEnded=function(){t.log("Media source ended")},this._onMediaEmptied=function(){var e=t.mediaSrc,i=t._objectUrl;e!==i&&X.error("Media element src was set while attaching MediaSource ("+i+" > "+e+")")},this.hls=e;var i="[buffer-controller]";this.appendSource=ze(Be(e.config.preferManagedMediaSource)),this.log=X.log.bind(X,i),this.warn=X.warn.bind(X,i),this.error=X.error.bind(X,i),this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null},t.registerListeners=function(){var e=this.hls;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_APPENDING,this.onBufferAppending,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.BUFFER_EOS,this.onBufferEos,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.FRAG_PARSED,this.onFragParsed,this),e.on(x.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_APPENDING,this.onBufferAppending,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_EOS,this.onBufferEos,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.FRAG_PARSED,this.onFragParsed,this),e.off(x.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Wi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null},t.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},t.onManifestParsed=function(e,t){var i=2;t.audio&&!t.video||t.altAudio,i=1,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var i=this.media=t.media,n=Be(this.appendSource);if(i&&n){var r,a=this.mediaSource=new n;this.log("created media source: "+(null==(r=a.constructor)?void 0:r.name)),a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming));var s=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");var o=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||o&&a instanceof o,Fi(i),Ai(i,s),i.load()}catch(l){i.src=s}else i.src=s;i.addEventListener("emptied",this._onMediaEmptied)}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(n){this.warn("onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(e.removeAttribute("src"),this.appendSource&&Fi(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(x.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){e.resetBuffer(t)})),this._initSourceBuffer()},t.resetBuffer=function(e){var t=this.sourceBuffer[e];try{var i;if(t)this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}catch(n){this.warn("onBufferReset "+e,n)}},t.onBufferCodecs=function(e,t){var i=this,n=this.getSourceBufferTypes().length,r=Object.keys(t);if(r.forEach((function(e){if(n){var r=i.tracks[e];if(r&&"function"===typeof r.buffer.changeType){var a,s=t[e],o=s.id,l=s.codec,u=s.levelCodec,c=s.container,d=s.metadata,h=st(r.codec,r.levelCodec),f=null==h?void 0:h.replace(Vi,"$1"),m=st(l,u),p=null==(a=m)?void 0:a.replace(Vi,"$1");if(m&&f!==p){"audio"===e.slice(0,5)&&(m=at(m,i.appendSource));var v=c+";codecs="+m;i.appendChangeType(e,v),i.log("switching codec "+h+" to "+m),i.tracks[e]={buffer:r.buffer,codec:l,container:c,levelCodec:u,metadata:d,id:o}}}}else i.pendingTracks[e]=t[e]})),!n){var a=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==a&&(this.log(a+" bufferCodec event(s) expected "+r.join(",")),this.bufferCodecEventsExpected=a),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}},t.appendChangeType=function(e,t){var i=this,n=this.operationQueue,r={execute:function(){var r=i.sourceBuffer[e];r&&(i.log("changing "+e+" sourceBuffer type to "+t),r.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){i.warn("Failed to change "+e+" SourceBuffer type",t)}};n.append(r,e,!!this.pendingTracks[e])},t.onBufferAppending=function(e,t){var i=this,n=this.hls,r=this.operationQueue,a=this.tracks,s=t.data,o=t.type,l=t.frag,u=t.part,c=t.chunkMeta,d=c.buffering[o],h=self.performance.now();d.start=h;var f=l.stats.buffering,m=u?u.stats.buffering:null;0===f.start&&(f.start=h),m&&0===m.start&&(m.start=h);var p=a.audio,v=!1;"audio"===o&&"audio/mpeg"===(null==p?void 0:p.container)&&(v=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var g=l.start,y={execute:function(){if(d.executeStart=self.performance.now(),v){var e=i.sourceBuffer[o];if(e){var t=g-e.timestampOffset;Math.abs(t)>=.1&&(i.log("Updating audio SourceBuffer timestampOffset to "+g+" (delta: "+t+") sn: "+l.sn+")"),e.timestampOffset=g)}}i.appendExecutor(s,o)},onStart:function(){},onComplete:function(){var e=self.performance.now();d.executeEnd=d.end=e,0===f.first&&(f.first=e),m&&0===m.first&&(m.first=e);var t=i.sourceBuffer,n={};for(var r in t)n[r]=Di.getBuffered(t[r]);i.appendErrors[o]=0,"audio"===o||"video"===o?i.appendErrors.audiovideo=0:(i.appendErrors.audio=0,i.appendErrors.video=0),i.hls.trigger(x.BUFFER_APPENDED,{type:o,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:n})},onError:function(e){var t={type:R.MEDIA_ERROR,parent:l.type,details:w.BUFFER_APPEND_ERROR,sourceBufferName:o,frag:l,part:u,chunkMeta:c,error:e,err:e,fatal:!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=w.BUFFER_FULL_ERROR;else{var r=++i.appendErrors[o];t.details=w.BUFFER_APPEND_ERROR,i.warn("Failed "+r+"/"+n.config.appendErrorMaxRetry+' times to append segment in "'+o+'" sourceBuffer'),r>=n.config.appendErrorMaxRetry&&(t.fatal=!0)}n.trigger(x.ERROR,t)}};r.append(y,o,!!this.pendingTracks[o])},t.onBufferFlushing=function(e,t){var i=this,n=this.operationQueue,r=function(e){return{execute:i.removeExecutor.bind(i,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(x.BUFFER_FLUSHED,{type:e})},onError:function(t){i.warn("Failed to remove from "+e+" SourceBuffer",t)}}};t.type?n.append(r(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){n.append(r(e),e)}))},t.onFragParsed=function(e,t){var i=this,n=t.frag,r=t.part,a=[],s=r?r.elementaryStreams:n.elementaryStreams;s[A.AUDIOVIDEO]?a.push("audiovideo"):(s[A.AUDIO]&&a.push("audio"),s[A.VIDEO]&&a.push("video"));var o=function(){var e=self.performance.now();n.stats.buffering.end=e,r&&(r.stats.buffering.end=e);var t=r?r.stats:n.stats;i.hls.trigger(x.FRAG_BUFFERED,{frag:n,part:r,stats:t,id:n.type})};0===a.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(o,a)},t.onFragChanged=function(e,t){this.trimBuffers()},t.onBufferEos=function(e,t){var i=this,n=this.getSourceBufferTypes().reduce((function(e,n){var r=i.sourceBuffer[n];return!r||t.type&&t.type!==n||(r.ending=!0,r.ended||(r.ended=!0,i.log(n+" sourceBuffer now EOS"))),e&&!(r&&!r.ended)}),!0);n&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){i.getSourceBufferTypes().forEach((function(e){var t=i.sourceBuffer[e];t&&(t.ending=!1)}));var e=i.mediaSource;e&&"open"===e.readyState?(i.log("Calling mediaSource.endOfStream()"),e.endOfStream()):e&&i.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState)})))},t.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.trimBuffers=function(){var e=this.hls,t=this.details,i=this.media;if(i&&null!==t){var n=this.getSourceBufferTypes();if(n.length){var r=e.config,a=i.currentTime,s=t.levelTargetDuration,o=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(S(o)&&o>0){var l=Math.max(o,s),u=Math.floor(a/s)*s-l;this.flushBackBuffer(a,s,u)}if(S(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){var c=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),d=Math.max(c,s),h=Math.floor(a/s)*s+d;this.flushFrontBuffer(a,s,h)}}}},t.flushBackBuffer=function(e,t,i){var n=this,r=this.details,a=this.sourceBuffer,s=this.getSourceBufferTypes();s.forEach((function(s){var o=a[s];if(o){var l=Di.getBuffered(o);if(l.length>0&&i>l.start(0)){if(n.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:i}),null!=r&&r.live)n.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(o.ended&&l.end(l.length-1)-e<2*t)return void n.log("Cannot flush "+s+" back buffer while SourceBuffer is in ended state");n.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}}))},t.flushFrontBuffer=function(e,t,i){var n=this,r=this.sourceBuffer,a=this.getSourceBufferTypes();a.forEach((function(a){var s=r[a];if(s){var o=Di.getBuffered(s),l=o.length;if(l<2)return;var u=o.start(l-1),c=o.end(l-1);if(i>u||e>=u&&e<=c)return;if(s.ended&&e-c<2*t)return void n.log("Cannot flush "+a+" front buffer while SourceBuffer is in ended state");n.hls.trigger(x.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:a})}}))},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,i=this.media,n=this.mediaSource,r=e.fragments[0].start+e.totalduration,a=i.duration,s=S(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(n.duration=1/0,this.updateSeekableRange(e)):(r>s&&r>a||!S(a))&&(this.log("Updating Media Source duration to "+r.toFixed(3)),n.duration=r)}},t.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments,n=i.length;if(n&&e.live&&null!=t&&t.setLiveSeekableRange){var r=Math.max(0,i[0].start),a=Math.max(r,r+e.totalduration);this.log("Media Source duration is set to "+t.duration+". Setting seekable range to "+r+"-"+a+"."),t.setLiveSeekableRange(r,a)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&(!e||2===n||"audiovideo"in i)){this.createSourceBuffers(i),this.pendingTracks={};var r=this.getSourceBufferTypes();if(r.length)this.hls.trigger(x.BUFFER_CREATED,{tracks:this.tracks}),r.forEach((function(e){t.executeNext(e)}));else{var a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}},t.createSourceBuffers=function(e){var t=this,i=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var r=function(r){if(!i[r]){var a,s=e[r];if(!s)throw Error("source buffer exists for track "+r+", however track does not");var o=-1===(null==(a=s.levelCodec)?void 0:a.indexOf(","))?s.levelCodec:s.codec;o&&"audio"===r.slice(0,5)&&(o=at(o,t.appendSource));var l=s.container+";codecs="+o;t.log("creating sourceBuffer("+l+")");try{var u=i[r]=n.addSourceBuffer(l),c=r;t.addBufferListener(c,"updatestart",t._onSBUpdateStart),t.addBufferListener(c,"updateend",t._onSBUpdateEnd),t.addBufferListener(c,"error",t._onSBUpdateError),t.appendSource&&t.addBufferListener(c,"bufferedchange",(function(e,i){var n=i.removedRanges;null!=n&&n.length&&t.hls.trigger(x.BUFFER_FLUSHED,{type:r})})),t.tracks[r]={buffer:u,codec:o,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(d){t.error("error while trying to add sourceBuffer: "+d.message),t.hls.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:r,mimeType:l})}}};for(var a in e)r(a)},t._onSBUpdateStart=function(e){var t=this.operationQueue,i=t.current(e);i.onStart()},t._onSBUpdateEnd=function(e){var t;if("closed"!==(null==(t=this.mediaSource)?void 0:t.readyState)){var i=this.operationQueue,n=i.current(e);n.onComplete(),i.shiftAndExecuteNext(e)}else this.resetBuffer(e)},t._onSBUpdateError=function(e,t){var i,n=new Error(e+" SourceBuffer error. MediaSource readyState: "+(null==(i=this.mediaSource)?void 0:i.readyState));this.error(""+n,t),this.hls.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});var r=this.operationQueue.current(e);r&&r.onError(n)},t.removeExecutor=function(e,t,i){var n=this.media,r=this.mediaSource,a=this.operationQueue,s=this.sourceBuffer,o=s[e];if(!n||!r||!o)return this.warn("Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(e);var l=S(n.duration)?n.duration:1/0,u=S(r.duration)?r.duration:1/0,c=Math.max(0,t),d=Math.min(i,l,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log("Removing ["+c+","+d+"] from the "+e+" SourceBuffer"),o.remove(c,d)):a.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var i=this.sourceBuffer[t];if(i)i.ended=!1,i.appendBuffer(e);else if(!this.pendingTracks[t])throw new Error("Attempting to append to the "+t+" SourceBuffer, but it does not exist")},t.blockBuffers=function(e,t){var i=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,r=t.map((function(e){return n.appendBlocker(e)}));Promise.all(r).then((function(){e(),t.forEach((function(e){var t=i.sourceBuffer[e];null!=t&&t.updating||n.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,i){var n=this.sourceBuffer[e];if(n){var r=i.bind(this,e);this.listeners[e].push({event:t,listener:r}),n.addEventListener(t,r)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},o(e,[{key:"mediaSrc",get:function(){var e,t=(null==(e=this.media)?void 0:e.firstChild)||this.media;return null==t?void 0:t.src}}]),e}();function Fi(e){var t=e.querySelectorAll("source");[].slice.call(t).forEach((function(t){e.removeChild(t)}))}function Ai(e,t){var i=self.document.createElement("source");i.type="video/mp4",i.src=t,e.appendChild(i)}var Yi=function(){function e(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var e=this.hls;e.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var e=this.hls;e.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(e,t){var i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})},t.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},t.onManifestParsed=function(e,t){var i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onLevelsUpdated=function(e,t){this.timer&&S(this.autoLevelCapping)&&this.detectPlayerSize()},t.onBufferCodecs=function(e,t){var i=this.hls;i.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);var e=this.hls.levels;if(e.length){var t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&X.log("Setting autoLevelCapping to "+i+": "+e[i].height+"p@"+e[i].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),t.autoLevelCapping=i,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.getMaxLevel=function(t){var i=this,n=this.hls.levels;if(!n.length)return-1;var r=n.filter((function(e,n){return i.isLevelAllowed(e)&&n<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t},t.isLevelAllowed=function(e){var t=this.restrictedLevels;return!t.some((function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height}))},e.getMaxLevelByMediaSize=function(e,t,i){if(null==e||!e.length)return-1;for(var n=function(e,t){return!t||(e.width!==t.width||e.height!==t.height)},r=e.length-1,a=Math.max(t,i),s=0;s<e.length;s+=1){var o=e[s];if((o.width>=a||o.height>=a)&&n(o,e[s+1])){r=s;break}}return r},o(e,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}}]),e}(),Oi=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&"function"===typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var r=n-this.lastTime,a=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/r,l=this.hls;if(l.trigger(x.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),o>0&&a>l.config.fpsDroppedMonitoringThreshold*s){var u=l.currentLevel;X.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}(),Hi=3e5,Ki=function(){function e(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=X.log.bind(X,"[content-steering]:"),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.ERROR,this.onError,this))},t.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}},t.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},t.clearTimeout=function(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},t.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},t.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter((function(t){return t!==e})))},t.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},t.onManifestLoaded=function(e,t){var i=t.contentSteering;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())},t.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},t.onError=function(e,t){var i=t.errorAction;if((null==i?void 0:i.action)===Ti.SendAlternateToPenaltyBox&&i.flags===ki.MoveAllAlternatesMatchingHost){var n=this.levels,r=this.pathwayPriority,a=this.pathwayId;if(t.context){var s=t.context,o=s.groupId,l=s.pathwayId,u=s.type;o&&n?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&n&&(r=n.reduce((function(e,t){return-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e}),[])),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==a),i.resolved||X.warn("Could not resolve "+t.details+' ("'+t.error.message+'") with content-steering for Pathway: '+a+" levels: "+(n?n.length:n)+" priorities: "+JSON.stringify(r)+" penalized: "+JSON.stringify(this.penalizedPathways))}},t.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){var i=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+i+'"'),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t):e},t.getLevelsForPathway=function(e){return null===this.levels?[]:this.levels.filter((function(t){return e===t.pathwayId}))},t.updatePathwayPriority=function(e){var t;this.pathwayPriority=e;var i=this.penalizedPathways,n=performance.now();Object.keys(i).forEach((function(e){n-i[e]>Hi&&delete i[e]}));for(var r=0;r<e.length;r++){var a=e[r];if(!(a in i)){if(a===this.pathwayId)return;var s=this.hls.nextLoadLevel,o=this.hls.levels[s];if(t=this.getLevelsForPathway(a),t.length>0){this.log('Setting Pathway to "'+a+'"'),this.pathwayId=a,li(t),this.hls.trigger(x.LEVELS_UPDATED,{levels:t});var l=this.hls.levels[s];o&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==o.bitrate&&this.log("Unstable Pathways change from bitrate "+o.bitrate+" to "+l.bitrate),this.hls.nextLoadLevel=s);break}}}},t.getPathwayForGroupId=function(e,t,i){for(var n=this.getLevelsForPathway(i).concat(this.levels||[]),r=0;r<n.length;r++)if(t===Tt.AUDIO_TRACK&&n[r].hasAudioGroup(e)||t===Tt.SUBTITLE_TRACK&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return i},t.clonePathways=function(e){var t=this,i=this.levels;if(i){var n={},r={};e.forEach((function(e){var a=e.ID,s=e["BASE-ID"],o=e["URI-REPLACEMENT"];if(!i.some((function(e){return e.pathwayId===a}))){var l=t.getLevelsForPathway(s).map((function(e){var t=new D(e.attrs);t["PATHWAY-ID"]=a;var i=t.AUDIO&&t.AUDIO+"_clone_"+a,s=t.SUBTITLES&&t.SUBTITLES+"_clone_"+a;i&&(n[t.AUDIO]=i,t.AUDIO=i),s&&(r[t.SUBTITLES]=s,t.SUBTITLES=s);var l=Bi(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o),u=new zt({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(var c=1;c<e.audioGroups.length;c++)u.addGroupId("audio",e.audioGroups[c]+"_clone_"+a);if(e.subtitleGroups)for(var d=1;d<e.subtitleGroups.length;d++)u.addGroupId("text",e.subtitleGroups[d]+"_clone_"+a);return u}));i.push.apply(i,l),Ui(t.audioTracks,n,o,a),Ui(t.subtitleTracks,r,o,a)}}))}},t.loadSteeringManifest=function(e){var t,i=this,n=this.hls.config,r=n.loader;this.loader&&this.loader.destroy(),this.loader=new r(n);try{t=new self.URL(e)}catch(d){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+e)}if("data:"!==t.protocol){var a=0|(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+a)}var s={responseType:"json",url:t.href},o=n.steeringManifestLoadPolicy.default,l=o.errorRetry||o.timeoutRetry||{},u={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},c={onSuccess:function(e,n,r,a){i.log('Loaded steering manifest: "'+t+'"');var s=e.data;if(1===s.VERSION){i.updated=performance.now(),i.timeToLoad=s.TTL;var o=s["RELOAD-URI"],l=s["PATHWAY-CLONES"],u=s["PATHWAY-PRIORITY"];if(o)try{i.uri=new self.URL(o,t).href}catch(d){return i.enabled=!1,void i.log("Failed to parse Steering Manifest RELOAD-URI: "+o)}i.scheduleRefresh(i.uri||r.url),l&&i.clonePathways(l);var c={steeringManifest:s,url:t.toString()};i.hls.trigger(x.STEERING_MANIFEST_LOADED,c),u&&i.updatePathwayPriority(u)}else i.log("Steering VERSION "+s.VERSION+" not supported!")},onError:function(e,t,n,r){if(i.log("Error loading steering manifest: "+e.code+" "+e.text+" ("+t.url+")"),i.stopLoad(),410===e.code)return i.enabled=!1,void i.log("Steering manifest "+t.url+" no longer available");var a=1e3*i.timeToLoad;if(429!==e.code)i.scheduleRefresh(i.uri||t.url,a);else{var s=i.loader;if("function"===typeof(null==s?void 0:s.getResponseHeader)){var o=s.getResponseHeader("Retry-After");o&&(a=1e3*parseFloat(o))}i.log("Steering manifest "+t.url+" rate limited")}},onTimeout:function(e,t,n){i.log("Timeout loading steering manifest ("+t.url+")"),i.scheduleRefresh(i.uri||t.url)}};this.log("Requesting steering manifest: "+t),this.loader.load(s,u,c)},t.scheduleRefresh=function(e,t){var i=this;void 0===t&&(t=1e3*this.timeToLoad),this.clearTimeout(),this.reloadTimer=self.setTimeout((function(){var t,n=null==(t=i.hls)?void 0:t.media;!n||n.ended?i.scheduleRefresh(e,1e3*i.timeToLoad):i.loadSteeringManifest(e)}),t)},e}();function Ui(e,t,i,n){e&&Object.keys(t).forEach((function(r){var a=e.filter((function(e){return e.groupId===r})).map((function(e){var a=u({},e);return a.details=void 0,a.attrs=new D(a.attrs),a.url=a.attrs.URI=Bi(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),a.groupId=a.attrs["GROUP-ID"]=t[r],a.attrs["PATHWAY-ID"]=n,a}));e.push.apply(e,a)}))}function Bi(e,t,i,n){var r,a=n.HOST,s=n.PARAMS,o=n[i];t&&(r=null==o?void 0:o[t],r&&(e=r));var l=new self.URL(e);return a&&!r&&(l.host=a),s&&Object.keys(s).sort().forEach((function(e){e&&l.searchParams.set(e,s[e])})),l.href}var zi=/^age:\s*[\d.]+\s*$/im,ji=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new F,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()},t.loadInternal=function(){var e=this,t=this.config,i=this.context;if(t&&i){var n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;var a=this.xhrSetup;a?Promise.resolve().then((function(){if(e.loader===n&&!e.stats.aborted)return a(n,i.url)})).catch((function(t){if(e.loader===n&&!e.stats.aborted)return n.open("GET",i.url,!0),a(n,i.url)})).then((function(){e.loader!==n||e.stats.aborted||e.openAndSendXhr(n,i,t)})).catch((function(t){e.callbacks.onError({code:n.status,text:t.message},i,n,r)})):this.openAndSendXhr(n,i,t)}},t.openAndSendXhr=function(e,t,i){e.readyState||e.open("GET",t.url,!0);var n=t.headers,r=i.loadPolicy,a=r.maxTimeToFirstByteMs,s=r.maxLoadTimeMs;if(n)for(var o in n)e.setRequestHeader(o,n[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&S(a)?a:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()},t.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var n=t.readyState,r=this.config;if(!i.aborted&&n>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var a=t.status,s="text"!==t.responseType;if(a>=200&&a<300&&(s&&t.response||null!==t.responseText)){i.loading.end=Math.max(self.performance.now(),i.loading.first);var o=s?t.response:t.responseText,l="arraybuffer"===t.responseType?o.byteLength:o.length;if(i.loaded=i.total=l,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first),!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(i,e,o,t),!this.callbacks)return;var c={url:t.responseURL,data:o,code:a};this.callbacks.onSuccess(c,i,e,t)}else{var d=r.loadPolicy.errorRetry,h=i.retry,f={url:e.url,data:void 0,code:a};fi(d,h,!1,f)?this.retry(d):(X.error(a+" while loading "+e.url),this.callbacks.onError({code:a,text:t.statusText},e,t,i))}}}},t.loadtimeout=function(){if(this.config){var e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(fi(e,t,!0))this.retry(e);else{var i;X.warn("timeout while loading "+(null==(i=this.context)?void 0:i.url));var n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}},t.retry=function(e){var t=this.context,i=this.stats;this.retryDelay=di(e,i.retry),i.retry++,X.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+(null==t?void 0:t.url)+", retrying "+i.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&zi.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},t.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},e}(),Ji=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=1===t.length?t[0]:Qi(t,i),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}();function Qi(e,t){for(var i=new Uint8Array(t),n=0,r=0;r<e.length;r++){var a=e[r];i.set(a,n),n+=a.length}return i}function qi(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var $i=/(\d+)-(\d+)\/(\d+)/,en=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||an,this.controller=new self.AbortController,this.stats=new F}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},t.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,i){var n=this,r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();var a=tn(e,this.controller.signal),s=i.onProgress,o="arraybuffer"===e.responseType,l=o?"byteLength":"length",u=t.loadPolicy,c=u.maxTimeToFirstByteMs,d=u.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=c&&S(c)?c:d,this.requestTimeout=self.setTimeout((function(){n.abortInternal(),i.onTimeout(r,e,n.response)}),t.timeout),self.fetch(this.request).then((function(a){n.response=n.loader=a;var l=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(n.requestTimeout),t.timeout=d,n.requestTimeout=self.setTimeout((function(){n.abortInternal(),i.onTimeout(r,e,n.response)}),d-(l-r.loading.start)),!a.ok){var u=a.status,c=a.statusText;throw new on(c||"fetch, bad network response",u,a)}return r.loading.first=l,r.total=rn(a.headers)||r.total,s&&S(t.highWaterMark)?n.loadProgressively(a,r,e,t.highWaterMark,s):o?a.arrayBuffer():"json"===e.responseType?a.json():a.text()})).then((function(a){var o=n.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(n.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);var u=a[l];u&&(r.loaded=r.total=u);var c={url:o.url,data:a,code:o.status};s&&!S(t.highWaterMark)&&s(r,e,a,o),i.onSuccess(c,r,e,o)})).catch((function(t){if(self.clearTimeout(n.requestTimeout),!r.aborted){var a=t&&t.code||0,s=t?t.message:null;i.onError({code:a,text:s},e,t?t.details:null,r)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},t.loadProgressively=function(e,t,i,n,r){void 0===n&&(n=0);var a=new Ji,s=e.body.getReader(),o=function o(){return s.read().then((function(s){if(s.done)return a.dataLength&&r(t,i,a.flush(),e),Promise.resolve(new ArrayBuffer(0));var l=s.value,u=l.length;return t.loaded+=u,u<n||a.dataLength?(a.push(l),a.dataLength>=n&&r(t,i,a.flush(),e)):r(t,i,l,e),o()})).catch((function(){return Promise.reject()}))};return o()},e}();function tn(e,t){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(u({},e.headers))};return e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),i}function nn(e){var t=$i.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}function rn(e){var t=e.get("Content-Range");if(t){var i=nn(t);if(S(i))return i}var n=e.get("Content-Length");if(n)return parseInt(n)}function an(e,t){return new self.Request(e.url,t)}var sn,on=function(e){function t(t,i,n){var r;return r=e.call(this,t)||this,r.code=void 0,r.details=void 0,r.code=i,r.details=n,r}return c(t,e),t}(v(Error)),ln={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},un=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ji,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:_i,bufferController:Ni,capLevelController:Yi,errorController:xi,fpsController:Oi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!1,certLoadPolicy:{default:ln},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},cn()),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0,contentSteeringController:Ki});function cn(){return{cueHandler:z,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function dn(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var i=hn(e),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach((function(e){var n=("level"===e?"playlist":e)+"LoadPolicy",r=void 0===t[n],s=[];a.forEach((function(a){var o=e+"Loading"+a,l=t[o];if(void 0!==l&&r){s.push(o);var u=i[n].default;switch(t[n]={default:u},a){case"TimeOut":u.maxLoadTimeMs=l,u.maxTimeToFirstByteMs=l;break;case"MaxRetry":u.errorRetry.maxNumRetry=l,u.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":u.errorRetry.retryDelayMs=l,u.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":u.errorRetry.maxRetryDelayMs=l,u.timeoutRetry.maxRetryDelayMs=l;break}}})),s.length&&X.warn('hls.js config: "'+s.join('", "')+'" setting(s) are deprecated, use "'+n+'": '+JSON.stringify(t[n]))})),n(n({},i),t)}function hn(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(hn):Object.keys(e).reduce((function(t,i){return t[i]=hn(e[i]),t}),{}):e}function fn(e){var t=e.loader;if(t!==en&&t!==ji)X.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var i=qi();i&&(e.loader=en,e.progressive=!0,e.enableSoftwareAES=!0,X.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var mn=function(e){function t(t,i){var n;return n=e.call(this,t,"[level-controller]")||this,n._levels=[],n._firstLevel=-1,n._maxAutoLevel=-1,n._startLevel=void 0,n.currentLevel=null,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.steering=void 0,n.onParsedComplete=void 0,n.steering=i,n._registerListeners(),n}c(t,e);var i=t.prototype;return i._registerListeners=function(){var e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.ERROR,this.onError,this)},i._unregisterListeners=function(){var e=this.hls;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),e.prototype.destroy.call(this)},i.stopLoad=function(){var t=this._levels;t.forEach((function(e){e.loadError=0,e.fragmentError=0})),e.prototype.stopLoad.call(this)},i.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},i.onManifestLoading=function(e,t){this.resetLevels()},i.onManifestLoaded=function(e,t){var i=this.hls.config.preferManagedMediaSource,n=[],r={},a={},s=!1,o=!1,l=!1;t.levels.forEach((function(e){var t,u,c=e.attrs,d=e.audioCodec,h=e.videoCodec;-1!==(null==(t=d)?void 0:t.indexOf("mp4a.40.34"))&&(sn||(sn=/chrome|firefox/i.test(navigator.userAgent)),sn&&(e.audioCodec=d=void 0)),d&&(e.audioCodec=d=at(d,i)),0===(null==(u=h)?void 0:u.indexOf("avc1"))&&(h=e.videoCodec=ot(h));var f=e.width,m=e.height,p=e.unknownCodecs;if(s||(s=!(!f||!m)),o||(o=!!h),l||(l=!!d),!(null!=p&&p.length||d&&!Qe(d,"audio",i)||h&&!Qe(h,"video",i))){var v=c.CODECS,g=c["FRAME-RATE"],y=c["HDCP-LEVEL"],b=c["PATHWAY-ID"],L=c.RESOLUTION,S=c["VIDEO-RANGE"],T=(b||".")+"-",k=""+T+e.bitrate+"-"+L+"-"+g+"-"+v+"-"+S+"-"+y;if(r[k])if(r[k].uri===e.url||e.attrs["PATHWAY-ID"])r[k].addGroupId("audio",c.AUDIO),r[k].addGroupId("text",c.SUBTITLES);else{var x=a[k]+=1;e.attrs["PATHWAY-ID"]=new Array(x+1).join(".");var R=new zt(e);r[k]=R,n.push(R)}else{var w=new zt(e);r[k]=w,a[k]=1,n.push(w)}}})),this.filterAndSortMediaOptions(n,t,s,o,l)},i.filterAndSortMediaOptions=function(e,t,i,n,r){var a=this,s=[],o=[],l=e;if((i||n)&&r&&(l=l.filter((function(e){var t=e.videoCodec,i=e.videoRange,n=e.width,r=e.height;return(!!t||!(!n||!r))&&Ht(i)}))),0!==l.length){if(t.audioTracks){var u=this.hls.config.preferManagedMediaSource;s=t.audioTracks.filter((function(e){return!e.audioCodec||Qe(e.audioCodec,"audio",u)})),pn(s)}t.subtitles&&(o=t.subtitles,pn(o));var c=l.slice(0);l.sort((function(e,t){if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return Ot.indexOf(e.videoRange)-Ot.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){var n=et(e.videoCodec),r=et(t.videoCodec);if(n!==r)return r-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){var a=tt(e.codecSet),s=tt(t.codecSet);if(a!==s)return s-a}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));var d=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length))for(var h=0;h<c.length;h++)if(c[h].pathwayId===l[0].pathwayId){d=c[h];break}this._levels=l;for(var f=0;f<l.length;f++)if(l[f]===d){var m;this._firstLevel=f;var p=d.bitrate,v=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+p),void 0===(null==(m=this.hls.userConfig)?void 0:m.abrEwmaDefaultEstimate)){var g=Math.min(p,this.hls.config.abrEwmaDefaultEstimateMax);g>v&&v===un.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=g)}break}var y=r&&!n,b={levels:l,audioTracks:s,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:!y&&s.some((function(e){return!!e.url}))};this.hls.trigger(x.MANIFEST_PARSED,b),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(a.hls){t.levels.length&&a.warn("One or more CODECS in variant not supported: "+JSON.stringify(t.levels[0].attrs));var e=new Error("no level with compatible codecs found in manifest");a.hls.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}))},i.onError=function(e,t){!t.fatal&&t.context&&t.context.type===Tt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)},i.onFragBuffered=function(e,t){var i=t.frag;if(void 0!==i&&i.type===kt.MAIN){var n=i.elementaryStreams;if(!Object.keys(n).some((function(e){return!!n[e]})))return;var r=this._levels[i.level];null!=r&&r.loadError&&(this.log("Resetting level error count of "+r.loadError+" on frag buffered"),r.loadError=0)}},i.onLevelLoaded=function(e,t){var i,n,r=t.level,a=t.details,s=this._levels[r];if(!s)return this.warn("Invalid level index "+r),void(null!=(n=t.deliveryDirectives)&&n.skip&&(a.deltaUpdateFailed=!0));r===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(r,t,s.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(a.deltaUpdateFailed=!0)},i.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var i=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){var r=n.uri;if(t)try{r=t.addDirectives(r)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}var a=n.attrs["PATHWAY-ID"];this.log("Loading level index "+i+(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"")+" with"+(a?" Pathway "+a:"")+" "+r),this.clearTimer(),this.hls.trigger(x.LEVEL_LOADING,{url:r,level:i,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}},i.removeLevel=function(e){var t,i=this,n=this._levels.filter((function(t,n){return n!==e||(i.steering&&i.steering.removeLevel(t),t===i.currentLevel&&(i.currentLevel=null,i.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((function(e){return e.level=-1}))),!1)}));li(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(x.LEVELS_UPDATED,{levels:n})},i.onLevelsUpdated=function(e,t){var i=t.levels;this._levels=i},i.checkMaxAutoUpdated=function(){var e=this.hls,t=e.autoLevelCapping,i=e.maxAutoLevel,n=e.maxHdcpLevel;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))},o(t,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(0!==t.length){if(e<0||e>=t.length){var i=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(x.ERROR,{type:R.OTHER_ERROR,details:w.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:i,reason:i.message}),n)return;e=Math.min(e,t.length-1)}var r=this.currentLevelIndex,a=this.currentLevel,s=a?a.attrs["PATHWAY-ID"]:void 0,o=t[e],l=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r!==e||!o.details||!a||s!==l){this.log("Switching to level "+e+" ("+(o.height?o.height+"p ":"")+(o.videoRange?o.videoRange+" ":"")+(o.codecSet?o.codecSet+" ":"")+"@"+o.bitrate+")"+(l?" with Pathway "+l:"")+" from level "+r+(s?" with Pathway "+s:""));var u={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,u);var c=o.details;if(!c||c.live){var d=this.switchParams(o.uri,null==a?void 0:a.details,c);this.loadPlaylist(d)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(Ri);function pn(e){var t={};e.forEach((function(e){var i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++}))}var vn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},gn=function(){function e(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},t.getAppendedFrag=function(e,t){var i=this.activePartLists[t];if(i)for(var n=i.length;n--;){var r=i[n];if(!r)break;var a=r.end;if(r.start<=e&&null!==a&&e<=a)return r}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var i=this.fragments,n=Object.keys(i),r=n.length;r--;){var a=i[n[r]];if((null==a?void 0:a.body.type)===t&&a.buffered){var s=a.body;if(s.start<=e&&e<=s.end)return s}}return null},t.detectEvictedFragments=function(e,t,i,n){var r=this;this.timeRanges&&(this.timeRanges[e]=t);var a=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(n){var s=r.fragments[n];if(s&&!(a>=s.body.sn))if(s.buffered||s.loaded){var o=s.range[e];o&&o.time.some((function(e){var i=!r.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&r.removeFragment(s.body),i}))}else s.body.type===i&&r.removeFragment(s.body)}))},t.detectPartialFragments=function(e){var t=this,i=this.timeRanges,n=e.frag,r=e.part;if(i&&"initSegment"!==n.sn){var a=bn(n),s=this.fragments[a];if(!(!s||s.buffered&&n.gap)){var o=!n.relurl;if(Object.keys(i).forEach((function(e){var a=n.elementaryStreams[e];if(a){var l=i[e],u=o||!0===a.partial;s.range[e]=t.getBufferedTimes(n,r,u,l)}})),s.loaded=null,Object.keys(s.range).length){s.buffered=!0;var l=s.body.endList=n.endList||s.body.endList;l&&(this.endListFragments[s.body.type]=s),yn(s)||this.removeParts(n.sn-1,n.type)}else this.removeFragment(s.body)}}},t.removeParts=function(e,t){var i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter((function(t){return t.fragment.sn>=e})))},t.fragBuffered=function(e,t){var i=bn(e),n=this.fragments[i];!n&&t&&(n=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)},t.getBufferedTimes=function(e,t,i,n){for(var r={time:[],partial:i},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a,u=0;u<n.length;u++){var c=n.start(u)-this.bufferPadding,d=n.end(u)+this.bufferPadding;if(l>=c&&o<=d){r.time.push({startPTS:Math.max(a,n.start(u)),endPTS:Math.min(s,n.end(u))});break}if(a<d&&s>c){var h=Math.max(a,n.start(u)),f=Math.min(s,n.end(u));f>h&&(r.partial=!0,r.time.push({startPTS:h,endPTS:f}))}else if(s<=c)break}return r},t.getPartialFragment=function(e){var t,i,n,r=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach((function(l){var u=o[l];u&&yn(u)&&(i=u.body.start-s,n=u.body.end+s,e>=i&&e<=n&&(t=Math.min(e-i,n-e),a<=t&&(r=u.body,a=t)))})),r},t.isEndListAppended=function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||yn(t))},t.getState=function(e){var t=bn(e),i=this.fragments[t];return i?i.buffered?yn(i)?vn.PARTIAL:vn.OK:vn.APPENDING:vn.NOT_LOADED},t.isTimeBuffered=function(e,t,i){for(var n,r,a=0;a<i.length;a++){if(n=i.start(a)-this.bufferPadding,r=i.end(a)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1},t.onFragLoaded=function(e,t){var i=t.frag,n=t.part;if("initSegment"!==i.sn&&!i.bitrateTest){var r=n?null:t,a=bn(i);this.fragments[a]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var i=this,n=t.frag,r=t.part,a=t.timeRanges;if("initSegment"!==n.sn){var s=n.type;if(r){var o=this.activePartLists[s];o||(this.activePartLists[s]=o=[]),o.push(r)}this.timeRanges=a,Object.keys(a).forEach((function(e){var t=a[e];i.detectEvictedFragments(e,t,s,r)}))}},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=bn(e);return!!this.fragments[t]},t.hasParts=function(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)},t.removeFragmentsInRange=function(e,t,i,n,r){var a=this;n&&!this.hasGaps||Object.keys(this.fragments).forEach((function(s){var o=a.fragments[s];if(o){var l=o.body;l.type!==i||n&&!l.gap||l.start<t&&l.end>e&&(o.buffered||r)&&a.removeFragment(l)}}))},t.removeFragment=function(e){var t=bn(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var i=this.activePartLists[e.type];if(i){var n=e.sn;this.activePartLists[e.type]=i.filter((function(e){return e.fragment.sn!==n}))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},e}();function yn(e){var t,i,n;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(i=e.range.audio)?void 0:i.partial)||(null==(n=e.range.audiovideo)?void 0:n.partial))}function bn(e){return e.type+"_"+e.level+"_"+e.sn}var Ln=Math.pow(2,17),Sn=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var i=this,r=e.url;if(!r)return Promise.reject(new xn({type:R.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(l,u){if(i.loader&&i.loader.destroy(),e.gap){if(e.tagList.some((function(e){return"GAP"===e[0]})))return void u(kn(e));e.gap=!1}var c=i.loader=e.loader=s?new s(a):new o(a),d=Tn(e),h=hi(a.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Ln};e.stats=c.stats,c.load(d,f,{onSuccess:function(t,n,r,a){i.resetLoader(e,c);var s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),l({frag:e,part:null,payload:s,networkDetails:a})},onError:function(t,a,s,o){i.resetLoader(e,c),u(new xn({type:R.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:n({url:r,data:void 0},t),error:new Error("HTTP Error "+t.code+" "+t.text),networkDetails:s,stats:o}))},onAbort:function(t,n,r){i.resetLoader(e,c),u(new xn({type:R.NETWORK_ERROR,details:w.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:function(t,n,r){i.resetLoader(e,c),u(new xn({type:R.NETWORK_ERROR,details:w.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+f.timeout+"ms"),networkDetails:r,stats:t}))},onProgress:function(i,n,r,a){t&&t({frag:e,part:null,payload:r,networkDetails:a})}})}))},t.loadPart=function(e,t,i){var r=this;this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(l,u){if(r.loader&&r.loader.destroy(),e.gap||t.gap)u(kn(e,t));else{var c=r.loader=e.loader=s?new s(a):new o(a),d=Tn(e,t),h=hi(a.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ln};t.stats=c.stats,c.load(d,f,{onSuccess:function(n,a,s,o){r.resetLoader(e,c),r.updateStatsFromPart(e,t);var u={frag:e,part:t,payload:n.data,networkDetails:o};i(u),l(u)},onError:function(i,a,s,o){r.resetLoader(e,c),u(new xn({type:R.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:n({url:d.url,data:void 0},i),error:new Error("HTTP Error "+i.code+" "+i.text),networkDetails:s,stats:o}))},onAbort:function(i,n,a){e.stats.aborted=t.stats.aborted,r.resetLoader(e,c),u(new xn({type:R.NETWORK_ERROR,details:w.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:a,stats:i}))},onTimeout:function(i,n,a){r.resetLoader(e,c),u(new xn({type:R.NETWORK_ERROR,details:w.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+f.timeout+"ms"),networkDetails:a,stats:i}))}})}}))},t.updateStatsFromPart=function(e,t){var i=e.stats,n=t.stats,r=n.total;if(i.loaded+=n.loaded,r){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(i.loaded/r),a),o=a-s,l=o*Math.round(i.loaded/s);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var u=i.loading,c=n.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function Tn(e,t){void 0===t&&(t=null);var i=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},r=i.byteRangeStartOffset,a=i.byteRangeEndOffset;if(S(r)&&S(a)){var s,o=r,l=a;if("initSegment"===e.sn&&"AES-128"===(null==(s=e.decryptdata)?void 0:s.method)){var u=a-r;u%16&&(l=a+(16-u%16)),0!==r&&(n.resetIV=!0,o=r-16)}n.rangeStart=o,n.rangeEnd=l}return n}function kn(e,t){var i=new Error("GAP "+(e.gap?"tag":"attribute")+" found"),n={type:R.MEDIA_ERROR,details:w.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new xn(n)}var xn=function(e){function t(t){var i;return i=e.call(this,t.error.message)||this,i.data=void 0,i.data=t,i}return c(t,e),t}(v(Error)),Rn=function(){function e(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var t=e.prototype;return t.abort=function(e){for(var t in this.keyUriToKeyInfo){var i=this.keyUriToKeyInfo[t].loader;if(i){var n;if(e&&e!==(null==(n=i.context)?void 0:n.frag.type))return;i.abort()}}},t.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},t.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},t.createKeyLoadError=function(e,t,i,n,r){return void 0===t&&(t=w.KEY_LOAD_ERROR),new xn({type:R.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:i,networkDetails:n})},t.loadClear=function(e,t){var i=this;if(this.emeController&&this.config.emeEnabled)for(var n=e.sn,r=e.cc,a=function(){var e=t[s];if(r<=e.cc&&("initSegment"===n||"initSegment"===e.sn||n<e.sn))return i.emeController.selectKeySystemFormat(e).then((function(t){e.setKeyFormat(t)})),1},s=0;s<t.length;s++)if(a())break},t.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(i){return t.loadInternal(e,i)})):this.loadInternal(e)},t.loadInternal=function(e,t){var i,n;t&&e.setKeyFormat(t);var r=e.decryptdata;if(!r){var a=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,w.KEY_LOAD_ERROR,a))}var s=r.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,w.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+s+'"')));var o,l=this.keyUriToKeyInfo[s];if(null!=(i=l)&&i.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(null!=(n=l)&&n.keyLoadPromise)switch(null==(o=l.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then((function(t){return r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:l}}))}switch(l=this.keyUriToKeyInfo[s]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,w.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+r.method+'"')))}},t.loadKeyEME=function(e,t){var i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(i);if(n)return(e.keyLoadPromise=n.then((function(t){return e.mediaKeySessionContext=t,i}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(i)},t.loadKeyHTTP=function(e,t){var i=this,r=this.config,a=r.loader,s=new a(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((function(a,o){var l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:function(e,t,n,r){var s=n.frag,l=n.keyInfo,u=n.url;if(!s.decryptdata||l!==i.keyUriToKeyInfo[u])return o(i.createKeyLoadError(s,w.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));l.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,l.loader=null,a({frag:s,keyInfo:l})},onError:function(e,r,a,s){i.resetLoader(r),o(i.createKeyLoadError(t,w.KEY_LOAD_ERROR,new Error("HTTP Error "+e.code+" loading key "+e.text),a,n({url:l.url,data:void 0},e)))},onTimeout:function(e,n,r){i.resetLoader(n),o(i.createKeyLoadError(t,w.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:function(e,n,r){i.resetLoader(n),o(i.createKeyLoadError(t,w.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};s.load(l,c,d)}))},t.resetLoader=function(e){var t=e.frag,i=e.keyInfo,n=e.url,r=i.loader;t.keyLoader===r&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[n],r&&r.destroy()},e}(),wn=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}(),En=function(e,t,i,n,r,a){void 0===n&&(n=0),void 0===r&&(r=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Zn(),this.buffering={audio:Zn(),video:Zn(),audiovideo:Zn()},this.level=e,this.sn=t,this.id=i,this.size=n,this.part=r,this.partial=a};function Zn(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Cn(e,t){for(var i=0,n=e.length;i<n;i++){var r;if((null==(r=e[i])?void 0:r.cc)===t)return e[i]}return null}function In(e,t,i){return!(!t||!(i.endCC>i.startCC||e&&e.cc<i.startCC))}function Mn(e,t){var i=e.fragments,n=t.fragments;if(n.length&&i.length){var r=Cn(i,n[0].cc);if(r&&(!r||r.startPTS))return r;X.log("No frag in previous level to align on")}else X.log("No fragments to align")}function Gn(e,t){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function Xn(e,t){for(var i=t.fragments,n=0,r=i.length;n<r;n++)Gn(i[n],e);t.fragmentHint&&Gn(t.fragmentHint,e),t.alignedSliding=!0}function _n(e,t,i){t&&(Pn(e,i,t),!i.alignedSliding&&t&&Dn(i,t),i.alignedSliding||!t||i.skippedSegments||ii(t,i))}function Pn(e,t,i){if(In(e,i,t)){var n=Mn(i,t);n&&S(n.start)&&(X.log("Adjusting PTS using last level due to CC increase within current level "+t.url),Xn(n.start,t))}}function Dn(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var i=e.fragments,n=t.fragments;if(i.length&&n.length){var r,a,s=Math.min(t.endCC,e.endCC);t.startCC<s&&e.startCC<s&&(r=Cn(n,s),a=Cn(i,s)),r&&a||(r=n[Math.floor(n.length/2)],a=Cn(i,r.cc)||i[Math.floor(i.length/2)]);var o=r.programDateTime,l=a.programDateTime;if(o&&l){var u=(l-o)/1e3-(a.start-r.start);Xn(u,e)}}}}var Wn=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}var t=e.prototype;return t.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),Vn=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}var t=e.prototype;return t.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();function Nn(e){var t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?j(e,0,t-i):e}var Fn=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),n=0;n<4;n++)i[n]=t.getUint32(4*n);return i},t.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],r=i[1],a=i[2],s=i[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=new Uint32Array(256),f=0,m=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^255&v^99,e[f]=v,t[v]=f;var g=h[f],y=h[g],b=h[y],L=257*h[v]^16843008*v;n[f]=L<<24|L>>>8,r[f]=L<<16|L>>>16,a[f]=L<<8|L>>>24,s[f]=L,L=16843009*b^65537*y^257*g^16843008*f,l[v]=L<<24|L>>>8,u[v]=L<<16|L>>>16,c[v]=L<<8|L>>>24,d[v]=L,f?(f=g^h[h[h[b^g]]],m^=h[h[m]]):f=m=1}},t.expandKey=function(e){var t=this.uint8ArrayToUint32Array_(e),i=!0,n=0;while(n<t.length&&i)i=t[n]===this.key[n],n++;if(!i){this.key=t;var r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var a,s,o,l,u=this.ksRows=4*(r+6+1),c=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),h=this.sBox,f=this.rcon,m=this.invSubMix,p=m[0],v=m[1],g=m[2],y=m[3];for(a=0;a<u;a++)a<r?o=c[a]=t[a]:(l=o,a%r===0?(l=l<<8|l>>>24,l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[a/r|0]<<24):r>6&&a%r===4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),c[a]=o=(c[a-r]^l)>>>0);for(s=0;s<u;s++)a=u-s,l=3&s?c[a]:c[a-4],d[s]=s<4||a<=4?l:p[h[l>>>24]]^v[h[l>>>16&255]]^g[h[l>>>8&255]]^y[h[255&l]],d[s]=d[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,i){var n,r,a,s,o,l,u,c,d,h,f,m,p,v,g=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,L=this.invSubMix,S=L[0],T=L[1],k=L[2],x=L[3],R=this.uint8ArrayToUint32Array_(i),w=R[0],E=R[1],Z=R[2],C=R[3],I=new Int32Array(e),M=new Int32Array(I.length),G=this.networkToHostOrderSwap;while(t<I.length){for(d=G(I[t]),h=G(I[t+1]),f=G(I[t+2]),m=G(I[t+3]),o=d^y[0],l=m^y[1],u=f^y[2],c=h^y[3],p=4,v=1;v<g;v++)n=S[o>>>24]^T[l>>16&255]^k[u>>8&255]^x[255&c]^y[p],r=S[l>>>24]^T[u>>16&255]^k[c>>8&255]^x[255&o]^y[p+1],a=S[u>>>24]^T[c>>16&255]^k[o>>8&255]^x[255&l]^y[p+2],s=S[c>>>24]^T[o>>16&255]^k[l>>8&255]^x[255&u]^y[p+3],o=n,l=r,u=a,c=s,p+=4;n=b[o>>>24]<<24^b[l>>16&255]<<16^b[u>>8&255]<<8^b[255&c]^y[p],r=b[l>>>24]<<24^b[u>>16&255]<<16^b[c>>8&255]<<8^b[255&o]^y[p+1],a=b[u>>>24]<<24^b[c>>16&255]<<16^b[o>>8&255]<<8^b[255&l]^y[p+2],s=b[c>>>24]<<24^b[o>>16&255]<<16^b[l>>8&255]<<8^b[255&u]^y[p+3],M[t]=G(n^w),M[t+1]=G(s^E),M[t+2]=G(a^Z),M[t+3]=G(r^C),w=d,E=h,Z=f,C=m,t+=4}return M.buffer},e}(),An=16,Yn=function(){function e(e,t){var i=void 0===t?{}:t,n=i.removePKCS7Padding,r=void 0===n||n;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=r,r)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(s){}this.useSoftware=!this.subtle}var t=e.prototype;return t.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},t.isSync=function(){return this.useSoftware},t.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Nn(i):i},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,i){var n=this;return this.useSoftware?new Promise((function(r,a){n.softwareDecrypt(new Uint8Array(e),t,i);var s=n.flush();s?r(s.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,i)},t.softwareDecrypt=function(e,t,i){var n=this.currentIV,r=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(e=Ve(a,e),this.remainderData=null);var s=this.getValidChunk(e);if(!s.length)return null;n&&(i=n);var o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new Fn),o.expandKey(t);var l=r;return this.currentResult=o.decrypt(s.buffer,0,i),this.currentIV=j(s,-16).buffer,l||null},t.webCryptoDecrypt=function(e,t,i){var n=this;if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i));this.key=t,this.fastAesKey=new Vn(this.subtle,t)}return this.fastAesKey.expandKey().then((function(t){if(!n.subtle)return Promise.reject(new Error("web crypto not initialized"));n.logOnce("WebCrypto AES decrypt");var r=new Wn(n.subtle,new Uint8Array(i));return r.decrypt(e.buffer,t)})).catch((function(r){return X.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+r.name+": "+r.message),n.onWebCryptoError(e,t,i)}))},t.onWebCryptoError=function(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);var n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},t.getValidChunk=function(e){var t=e,i=e.length-e.length%An;return i!==e.length&&(t=j(e,0,i),this.remainderData=j(e,i)),t},t.logOnce=function(e){this.logEnabled&&(X.log("[decrypter]: "+e),this.logEnabled=!1)},e}(),On={toString:function(e){for(var t="",i=e.length,n=0;n<i;n++)t+="["+e.start(n).toFixed(3)+"-"+e.end(n).toFixed(3)+"]";return t}},Hn={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Kn=function(e){function t(t,i,n,r,a){var s;return s=e.call(this)||this,s.hls=void 0,s.fragPrevious=null,s.fragCurrent=null,s.fragmentTracker=void 0,s.transmuxer=null,s._state=Hn.STOPPED,s.playlistType=void 0,s.media=null,s.mediaBuffer=null,s.config=void 0,s.bitrateTest=!1,s.lastCurrentTime=0,s.nextLoadPosition=0,s.startPosition=0,s.startTimeOffset=null,s.loadedmetadata=!1,s.retryDate=0,s.levels=null,s.fragmentLoader=void 0,s.keyLoader=void 0,s.levelLastLoaded=null,s.startFragRequested=!1,s.decrypter=void 0,s.initPTS=[],s.onvseeking=null,s.onvended=null,s.logPrefix="",s.log=void 0,s.warn=void 0,s.playlistType=a,s.logPrefix=r,s.log=X.log.bind(X,r+":"),s.warn=X.warn.bind(X,r+":"),s.hls=t,s.fragmentLoader=new Sn(t.config),s.keyLoader=n,s.fragmentTracker=i,s.config=t.config,s.decrypter=new Yn(t.config),t.on(x.MANIFEST_LOADED,s.onManifestLoaded,g(s)),s}c(t,e);var i=t.prototype;return i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(e){},i.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Hn.STOPPED},i._streamEnded=function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var i=t.partList;if(null!=i&&i.length){var n=i[i.length-1],r=Di.isBuffered(this.media,n.start+n.duration/2);return r}var a=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(a)},i.getLevelDetails=function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details},i.onMediaAttached=function(e,t){var i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===Hn.STOPPED&&this.startLoad(n.startPosition)},i.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,i=this.media,n=this.mediaBuffer,r=this.state,a=i?i.currentTime:0,s=Di.bufferInfo(n||i,a,e.maxBufferHole);if(this.log("media seeking to "+(S(a)?a.toFixed(3):a)+", state: "+r),this.state===Hn.ENDED)this.resetLoadingState();else if(t){var o=e.maxFragLookUpTolerance,l=t.start-o,u=t.start+t.duration+o;if(!s.len||u<s.start||l>s.end){var c=a>u;(a<l||c)&&(c&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||s.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onManifestLoaded=function(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]},i.onHandlerDestroying=function(){this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),e.prototype.onHandlerDestroying.call(this),this.hls=null},i.onHandlerDestroyed=function(){this.state=Hn.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},i.loadFragment=function(e,t,i){this._loadFragForPlayback(e,t,i)},i._loadFragForPlayback=function(e,t,i){var n=this,r=function(t){if(n.fragContextChanged(e))return n.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void n.fragmentTracker.removeFragment(e);e.stats.chunkCount++,n._handleFragmentLoadProgress(t)};this._doFragLoad(e,t,i,r).then((function(t){if(t){var i=n.state;n.fragContextChanged(e)?(i===Hn.FRAG_LOADING||!n.fragCurrent&&i===Hn.PARSING)&&(n.fragmentTracker.removeFragment(e),n.state=Hn.IDLE):("payload"in t&&(n.log("Loaded fragment "+e.sn+" of level "+e.level),n.hls.trigger(x.FRAG_LOADED,t)),n._handleFragmentLoadComplete(t))}})).catch((function(t){n.state!==Hn.STOPPED&&n.state!==Hn.ERROR&&(n.warn("Frag error: "+((null==t?void 0:t.message)||t)),n.resetFragmentLoading(e))}))},i.clearTrackerIfNeeded=function(e){var t,i=this.fragmentTracker,n=i.getState(e);if(n===vn.APPENDING){var r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),s=Math.max(e.duration,a?a.len:this.config.maxBufferLength),o=this.backtrackFragment,l=o?e.sn-o.sn:0;(1===l||this.reduceMaxBufferLength(s,e.duration))&&i.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===vn.PARTIAL&&i.removeFragment(e))},i.checkLiveUpdate=function(e){if(e.updated&&!e.live){var t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},i.flushMainBuffer=function(e,t,i){if(void 0===i&&(i=null),e-t){var n={startOffset:e,endOffset:t,type:i};this.hls.trigger(x.BUFFER_FLUSHING,n)}},i._loadInitSegment=function(e,t){var i=this;this._doFragLoad(e,t).then((function(t){if(!t||i.fragContextChanged(e)||!i.levels)throw new Error("init load aborted");return t})).then((function(t){var n=i.hls,r=t.payload,a=e.decryptdata;if(r&&r.byteLength>0&&null!=a&&a.key&&a.iv&&"AES-128"===a.method){var s=self.performance.now();return i.decrypter.decrypt(new Uint8Array(r),a.key.buffer,a.iv.buffer).catch((function(t){throw n.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((function(r){var a=self.performance.now();return n.trigger(x.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:s,tdecrypt:a}}),t.payload=r,i.completeInitSegmentLoad(t)}))}return i.completeInitSegmentLoad(t)})).catch((function(t){i.state!==Hn.STOPPED&&i.state!==Hn.ERROR&&(i.warn(t),i.resetFragmentLoading(e))}))},i.completeInitSegmentLoad=function(e){var t=this.levels;if(!t)throw new Error("init load aborted, missing levels");var i=e.frag.stats;this.state=Hn.IDLE,e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()},i.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.sn!==t.sn||e.level!==t.level},i.fragBufferedComplete=function(e,t){var i,n,r,a,s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+(this.playlistType===kt.MAIN?"level":"track")+" "+e.level+" (frag:["+(null!=(i=e.startPTS)?i:NaN).toFixed(3)+"-"+(null!=(n=e.endPTS)?n:NaN).toFixed(3)+"] > buffer:"+(s?On.toString(Di.getBuffered(s)):"(detached)")+")"),"initSegment"!==e.sn){var o;if(e.type!==kt.SUBTITLE){var l=e.elementaryStreams;if(!Object.keys(l).some((function(e){return!!l[e]})))return void(this.state=Hn.IDLE)}var u=null==(o=this.levels)?void 0:o[e.level];null!=u&&u.fragmentError&&(this.log("Resetting level fragment error count of "+u.fragmentError+" on frag buffered"),u.fragmentError=0)}this.state=Hn.IDLE,s&&(!this.loadedmetadata&&e.type==kt.MAIN&&s.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(a=this.fragPrevious)?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},i.seekToStartPos=function(){},i._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var i=e.frag,n=e.part,r=e.partsLoaded,a=!r||0===r.length||r.some((function(e){return!e})),s=new En(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(s)}},i._handleFragmentLoadProgress=function(e){},i._doFragLoad=function(e,t,i,n){var r,a=this;void 0===i&&(i=null);var s=null==t?void 0:t.details;if(!this.levels||!s)throw new Error("frag load aborted, missing level"+(s?"":" detail")+"s");var o=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(e,s.encryptedFragments):(this.log("Loading key for "+e.sn+" of ["+s.startSN+"-"+s.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=Hn.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then((function(e){if(!a.fragContextChanged(e.frag))return a.hls.trigger(x.KEY_LOADED,e),a.state===Hn.KEY_LOADING&&(a.state=Hn.IDLE),e})),this.hls.trigger(x.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var l=s.partList;if(l&&n){i>e.end&&s.fragmentHint&&(e=s.fragmentHint);var u=this.getNextPart(l,e,i);if(u>-1){var c,d=l[u];return this.log("Loading part sn: "+e.sn+" p: "+d.index+" cc: "+e.cc+" of playlist ["+s.startSN+"-"+s.endSN+"] parts [0-"+u+"-"+(l.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=d.start+d.duration,this.state=Hn.FRAG_LOADING,c=o?o.then((function(i){return!i||a.fragContextChanged(i.frag)?null:a.doFragPartsLoad(e,d,t,n)})).catch((function(e){return a.handleFragLoadError(e)})):this.doFragPartsLoad(e,d,t,n).catch((function(e){return a.handleFragLoadError(e)})),this.hls.trigger(x.FRAG_LOADING,{frag:e,part:d,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(l,i))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(s?"of ["+s.startSN+"-"+s.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),S(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Hn.FRAG_LOADING;var h,f=this.config.progressive;return h=f&&o?o.then((function(t){return!t||a.fragContextChanged(null==t?void 0:t.frag)?null:a.fragmentLoader.load(e,n)})).catch((function(e){return a.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,f?n:void 0),o]).then((function(e){var t=e[0];return!f&&t&&n&&n(t),t})).catch((function(e){return a.handleFragLoadError(e)})),this.hls.trigger(x.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h},i.doFragPartsLoad=function(e,t,i,n){var r=this;return new Promise((function(a,s){var o,l=[],u=null==(o=i.details)?void 0:o.partList,c=function t(o){r.fragmentLoader.loadPart(e,o,n).then((function(n){l[o.index]=n;var s=n.part;r.hls.trigger(x.FRAG_LOADED,n);var c=si(i,e.sn,o.index+1)||oi(u,e.sn,o.index+1);if(!c)return a({frag:e,part:s,partsLoaded:l});t(c)})).catch(s)};c(t)}))},i.handleFragLoadError=function(e){if("data"in e){var t=e.data;e.data&&t.details===w.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(x.ERROR,t)}else this.hls.trigger(x.ERROR,{type:R.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},i._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===Hn.PARSING){var i=t.frag,n=t.part,r=t.level,a=self.performance.now();i.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(i,n,r,e.partial)}else this.fragCurrent||this.state===Hn.STOPPED||this.state===Hn.ERROR||(this.state=Hn.IDLE)},i.getCurrentContext=function(e){var t=this.levels,i=this.fragCurrent,n=e.level,r=e.sn,a=e.part;if(null==t||!t[n])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+n+". The current chunk will not be buffered."),null;var s=t[n],o=a>-1?si(s,r,a):null,l=o?o.fragment:ai(s,r,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:o,level:s}):null},i.bufferFragmentData=function(e,t,i,n,r){var a;if(e&&this.state===Hn.PARSING){var s=e.data1,o=e.data2,l=s;if(s&&o&&(l=Ve(s,o)),null!=(a=l)&&a.length){var u={type:e.type,frag:t,part:i,chunkMeta:n,parent:t.type,data:l};if(this.hls.trigger(x.BUFFER_APPENDING,u),e.dropped&&e.independent&&!i){if(r)return;this.flushBufferGap(t)}}}},i.flushBufferGap=function(e){var t=this.media;if(t)if(Di.isBuffered(t,t.currentTime)){var i=t.currentTime,n=Di.bufferInfo(t,i,0),r=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),s=Math.max(Math.min(e.start-a,n.end-a),i+a);e.start-s>a&&this.flushMainBuffer(s,e.start)}else this.flushMainBuffer(0,e.start)},i.getFwdBufferInfo=function(e,t){var i=this.getLoadPosition();return S(i)?this.getFwdBufferInfoAtPos(e,i,t):null},i.getFwdBufferInfoAtPos=function(e,t,i){var n=this.config.maxBufferHole,r=Di.bufferInfo(e,t,n);if(0===r.len&&void 0!==r.nextStart){var a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&r.nextStart<a.end)return Di.bufferInfo(e,t,Math.max(r.nextStart,n))}return r},i.getMaxBufferLength=function(e){var t,i=this.config;return t=e?Math.max(8*i.maxBufferSize/e,i.maxBufferLength):i.maxBufferLength,Math.min(t,i.maxMaxBufferLength)},i.reduceMaxBufferLength=function(e,t){var i=this.config,n=Math.max(Math.min(e-t,i.maxBufferLength),t),r=Math.max(e-3*t,i.maxMaxBufferLength/2,n);return r>=n&&(i.maxMaxBufferLength=r,this.warn("Reduce max buffer length to "+r+"s"),!0)},i.getAppendedFrag=function(e,t){var i=this.fragmentTracker.getAppendedFrag(e,kt.MAIN);return i&&"fragment"in i?i.fragment:i},i.getNextFragment=function(e,t){var i=t.fragments,n=i.length;if(!n)return null;var r,a=this.config,s=i[0].start;if(t.live){var o=a.initialLiveManifestSize;if(n<o)return this.warn("Not enough fragments to start playback (have: "+n+", need: "+o+")"),null;(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<s)&&(r=this.getInitialLiveFragment(t,i),this.startPosition=this.nextLoadPosition=r?this.hls.liveSyncPosition||r.start:e)}else e<=s&&(r=i[0]);if(!r){var l=a.lowLatencyMode?t.partEnd:t.fragmentEnd;r=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(r)},i.isLoopLoading=function(e,t){var i=this.fragmentTracker.getState(e);return(i===vn.OK||i===vn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t},i.getNextFragmentLoopLoading=function(e,t,i,n,r){var a=e.gap,s=this.getNextFragment(this.nextLoadPosition,t);if(null===s)return s;if(e=s,a&&e&&!e.gap&&i.nextStart){var o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n);if(null!==o&&i.len+o.len>=r)return this.log('buffer full after gaps in "'+n+'" playlist starting at sn: '+e.sn),null}return e},i.mapToInitFragWhenRequired=function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment},i.getNextPart=function(e,t,i){for(var n=-1,r=!1,a=!0,s=0,o=e.length;s<o;s++){var l=e[s];if(a=a&&!l.independent,n>-1&&i<l.start)break;var u=l.loaded;u?n=-1:(r||l.independent||a)&&l.fragment===t&&(n=s),r=u}return n},i.loadedEndOfParts=function(e,t){var i=e[e.length-1];return i&&t>i.start&&i.loaded},i.getInitialLiveFragment=function(e,t){var i=this.fragPrevious,n=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),n=vi(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var r=i.sn+1;if(r>=e.startSN&&r<=e.endSN){var a=t[r-e.startSN];i.cc===a.cc&&(n=a,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))}n||(n=Si(t,i.cc),n&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn))}}else{var s=this.hls.liveSyncPosition;null!==s&&(n=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n},i.getFragmentAtPosition=function(e,t,i){var n,r=this.config,a=this.fragPrevious,s=i.fragments,o=i.endSN,l=i.fragmentHint,u=r.maxFragLookUpTolerance,c=i.partList,d=!!(r.lowLatencyMode&&null!=c&&c.length&&l);if(d&&l&&!this.bitrateTest&&(s=s.concat(l),o=l.sn),e<t){var h=e>t-u?0:u;n=gi(a,s,e,h)}else n=s[s.length-1];if(n){var f=n.sn-i.startSN,m=this.fragmentTracker.getState(n);if((m===vn.OK||m===vn.PARTIAL&&n.gap)&&(a=n),a&&n.sn===a.sn&&(!d||c[0].fragment.sn>n.sn)){var p=a&&n.level===a.level;if(p){var v=s[f+1];n=n.sn<o&&this.fragmentTracker.getState(v)!==vn.OK?v:null}}}return n},i.synchronizeToLiveEdge=function(e){var t=this.config,i=this.media;if(i){var n=this.hls.liveSyncPosition,r=i.currentTime,a=e.fragments[0].start,s=e.edge,o=r>=a-t.maxFragLookUpTolerance&&r<=s;if(null!==n&&i.duration>n&&(r<n||!o)){var l=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&i.readyState<4||r<s-l)&&(this.loadedmetadata||(this.nextLoadPosition=n),i.readyState&&(this.warn("Playback: "+r.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+n.toFixed(3)),i.currentTime=n))}}},i.alignPlaylists=function(e,t,i){var n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;var r=e.fragments[0].start,a=!t,s=e.alignedSliding&&S(r);if(a||!s&&!r){var o=this.fragPrevious;_n(o,i,e);var l=e.fragments[0].start;return this.log("Live playlist sliding: "+l.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(o?o.sn:"na")+" fragments: "+n),l}return r},i.waitForCdnTuneIn=function(e){var t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)},i.setStartPosition=function(e,t){var i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){var n=null!==this.startTimeOffset,r=n?this.startTimeOffset:e.startTimeOffset;null!==r&&S(r)?(i=t+r,r<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log("Start time offset "+r+" found in "+(n?"multivariant":"media")+" playlist, adjust startPosition to "+i),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},i.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},i.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},i.resetFragmentLoading=function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Hn.FRAG_LOADING_WAITING_RETRY)||(this.state=Hn.IDLE)},i.onFragmentOrKeyLoadError=function(e,t){if(t.chunkMeta&&!t.frag){var i=this.getCurrentContext(t.chunkMeta);i&&(t.frag=i.frag)}var n=t.frag;if(n&&n.type===e&&this.levels)if(this.fragContextChanged(n)){var r;this.warn("Frag load error must match current frag to retry "+n.url+" > "+(null==(r=this.fragCurrent)?void 0:r.url))}else{var a=t.details===w.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);var s=t.errorAction,o=s||{},l=o.action,u=o.retryCount,c=void 0===u?0:u,d=o.retryConfig;if(s&&l===Ti.RetryRequest&&d){this.resetStartWhenNotLoaded(this.levelLastLoaded);var h=di(d,c);this.warn("Fragment "+n.sn+" of "+e+" "+n.level+" errored with "+t.details+", retrying loading "+(c+1)+"/"+d.maxNumRetry+" in "+h+"ms"),s.resolved=!0,this.retryDate=self.performance.now()+h,this.state=Hn.FRAG_LOADING_WAITING_RETRY}else if(d&&s){if(this.resetFragmentErrors(e),!(c<d.maxNumRetry))return void X.warn(t.details+" reached or exceeded max retry ("+c+")");a||l===Ti.RemoveAlternatePermanently||(s.resolved=!0)}else(null==s?void 0:s.action)===Ti.SendAlternateToPenaltyBox?this.state=Hn.WAITING_LEVEL:this.state=Hn.ERROR;this.tickImmediate()}},i.reduceLengthAndFlushBuffer=function(e){if(this.state===Hn.PARSING||this.state===Hn.PARSED){var t=e.frag,i=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,i),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,(null==t?void 0:t.duration)||10);var a=!r;return a&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+i+" buffer"),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1},i.resetFragmentErrors=function(e){e===kt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Hn.STOPPED&&(this.state=Hn.IDLE)},i.afterBufferFlushed=function(e,t,i){if(e){var n=Di.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,i),this.state===Hn.ENDED&&this.resetLoadingState()}},i.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Hn.IDLE},i.resetStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},i.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of level "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},i.removeUnbufferedFrags=function(e){void 0===e&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},i.updateLevelTiming=function(e,t,i,n){var r,a=this,s=i.details;if(s){var o=Object.keys(e.elementaryStreams).reduce((function(t,r){var o=e.elementaryStreams[r];if(o){var l=o.endPTS-o.startPTS;if(l<=0)return a.warn("Could not parse fragment "+e.sn+" "+r+" duration reliably ("+l+")"),t||!1;var u=n?0:Qt(s,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return a.hls.trigger(x.LEVEL_PTS_UPDATED,{details:s,level:i,drift:u,type:r,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1);if(!o&&null===(null==(r=this.transmuxer)?void 0:r.error)){var l=new Error("Found no media in fragment "+e.sn+" of level "+e.level+" resetting transmuxer to fallback to playlist timing");if(0===i.fragmentError&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:"Found no media in msn "+e.sn+' of level "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Hn.PARSED,this.hls.trigger(x.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i.recoverWorkerError=function(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},o(t,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}]),t}(wn);function Un(){return self.SourceBuffer||self.WebKitSourceBuffer}function Bn(){var e=Be();if(!e)return!1;var t=Un();return!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove}function zn(){if(!Bn())return!1;var e=Be();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((function(t){return e.isTypeSupported($e(t,"video"))}))||["mp4a.40.2","fLaC"].some((function(t){return e.isTypeSupported($e(t,"audio"))})))}function jn(){var e,t=Un();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}function Jn(e,t){return void 0===e&&(e=""),void 0===t&&(t=9e4),{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}var Qn=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,i,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},t.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,i){},t.demux=function(e,t){this.cachedData&&(e=Ve(this.cachedData,e),this.cachedData=null);var i,n=$(e,0),r=n?n.length:0,a=this._audioTrack,s=this._id3Track,o=n?ie(n):void 0,l=e.length;(null===this.basePTS||0===this.frameIndex&&S(o))&&(this.basePTS=qn(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Gt.audioId3,duration:Number.POSITIVE_INFINITY});while(r<l){if(this.canParse(e,r)){var u=this.appendFrame(a,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,i=r):r=l}else te(e,r)?(n=$(e,r),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Gt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,i=r):r++;if(r===l&&i!==l){var c=j(e,i);this.cachedData?this.cachedData=Ve(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Jn(),id3Track:s,textTrack:Jn()}},t.demuxSampleAes=function(e,t,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Jn(),id3Track:this._id3Track,textTrack:Jn()}},t.destroy=function(){},e}(),qn=function(e,t,i){if(S(e))return 90*e;var n=i?9e4*i.baseTime/i.timescale:0;return 9e4*t+n};function $n(e,t,i,n){var r,a,s,o,l=navigator.userAgent.toLowerCase(),u=n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&t[i+2])>>>6);var d=(60&t[i+2])>>>2;if(!(d>c.length-1))return s=(1&t[i+2])<<2,s|=(192&t[i+3])>>>6,X.log("manifest codec:"+n+", ADTS type:"+r+", samplingIndex:"+d),/firefox/i.test(l)?d>=6?(r=5,o=new Array(4),a=d-3):(r=2,o=new Array(2),a=d):-1!==l.indexOf("android")?(r=2,o=new Array(2),a=d):(r=5,o=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&d>=6?a=d-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(d>=6&&1===s||/vivaldi/i.test(l))||!n&&1===s)&&(r=2,o=new Array(2)),a=d)),o[0]=r<<3,o[0]|=(14&d)>>1,o[1]|=(1&d)<<7,o[1]|=s<<3,5===r&&(o[1]|=(14&a)>>1,o[2]=(1&a)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[d],channelCount:s,codec:"mp4a.40."+r,manifestCodec:u};var h=new Error("invalid ADTS sampling index:"+d);e.emit(x.ERROR,x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message})}function er(e,t){return 255===e[t]&&240===(246&e[t+1])}function tr(e,t){return 1&e[t+1]?7:9}function ir(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function nr(e,t){return t+5<e.length}function rr(e,t){return t+1<e.length&&er(e,t)}function ar(e,t){return nr(e,t)&&er(e,t)&&ir(e,t)<=e.length-t}function sr(e,t){if(rr(e,t)){var i=tr(e,t);if(t+i>=e.length)return!1;var n=ir(e,t);if(n<=i)return!1;var r=t+n;return r===e.length||rr(e,r)}return!1}function or(e,t,i,n,r){if(!e.samplerate){var a=$n(t,i,n,r);if(!a)return;e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,X.log("parsed codec:"+e.codec+", rate:"+a.samplerate+", channels:"+a.channelCount)}}function lr(e){return 9216e4/e}function ur(e,t){var i=tr(e,t);if(t+i<=e.length){var n=ir(e,t)-i;if(n>0)return{headerLength:i,frameLength:n}}}function cr(e,t,i,n,r){var a,s=lr(e.samplerate),o=n+r*s,l=ur(t,i);if(l){var u=l.frameLength,c=l.headerLength,d=c+u,h=Math.max(0,i+d-t.length);h?(a=new Uint8Array(d-c),a.set(t.subarray(i+c,t.length),0)):a=t.subarray(i+c,i+d);var f={unit:a,pts:o};return h||e.samples.push(f),{sample:f,length:d,missing:h}}var m=t.length-i;a=new Uint8Array(m),a.set(t.subarray(i,t.length),0);var p={unit:a,pts:o};return{sample:p,length:m,missing:-1}}var dr=null,hr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],fr=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],mr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],pr=[0,1,1,4];function vr(e,t,i,n,r){if(!(i+24>t.length)){var a=gr(t,i);if(a&&i+a.frameLength<=t.length){var s=9e4*a.samplesPerFrame/a.sampleRate,o=n+r*s,l={unit:t.subarray(i,i+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(l),{sample:l,length:a.frameLength,missing:0}}}}function gr(e,t){var i=e[t+1]>>3&3,n=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==i&&0!==r&&15!==r&&3!==a){var s=e[t+2]>>1&1,o=e[t+3]>>6,l=3===i?3-n:3===n?3:4,u=1e3*hr[14*l+r-1],c=3===i?0:2===i?1:2,d=fr[3*c+a],h=3===o?1:2,f=mr[i][n],m=pr[n],p=8*f*m,v=Math.floor(f*u/d+s)*m;if(null===dr){var g=navigator.userAgent||"",y=g.match(/Chrome\/(\d+)/i);dr=y?parseInt(y[1]):0}var b=!!dr&&dr<=87;return b&&2===n&&u>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:h,frameLength:v,samplesPerFrame:p}}}function yr(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function br(e,t){return t+1<e.length&&yr(e,t)}function Lr(e,t){var i=4;return yr(e,t)&&i<=e.length-t}function Sr(e,t){if(t+1<e.length&&yr(e,t)){var i=4,n=gr(e,t),r=i;null!=n&&n.frameLength&&(r=n.frameLength);var a=t+r;return a===e.length||br(e,a)}return!1}var Tr=function(e){function t(t,i){var n;return n=e.call(this)||this,n.observer=void 0,n.config=void 0,n.observer=t,n.config=i,n}c(t,e);var i=t.prototype;return i.resetInitSegment=function(t,i,n,r){e.prototype.resetInitSegment.call(this,t,i,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;var t=$(e,0),i=(null==t?void 0:t.length)||0;if(Sr(e,i))return!1;for(var n=e.length;i<n;i++)if(sr(e,i))return X.log("ADTS sync word found !"),!0;return!1},i.canParse=function(e,t){return ar(e,t)},i.appendFrame=function(e,t,i){or(e,this.observer,t,i,e.manifestCodec);var n=cr(e,t,i,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n},t}(Qn),kr=/\/emsg[-/]ID3/i,xr=function(){function e(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(e,t,i,n){var r=this.videoTrack=Jn("video",1),a=this.audioTrack=Jn("audio",1),s=this.txtTrack=Jn("text",1);if(this.id3Track=Jn("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var o=we(e);if(o.video){var l=o.video,u=l.id,c=l.timescale,d=l.codec;r.id=u,r.timescale=s.timescale=c,r.codec=d}if(o.audio){var h=o.audio,f=h.id,m=h.timescale,p=h.codec;a.id=f,a.timescale=m,a.codec=p}s.id=ve.text,r.sampleDuration=0,r.duration=a.duration=n}},t.resetContiguity=function(){this.remainderData=null},e.probe=function(e){return ke(e)},t.demux=function(e,t){this.timeOffset=t;var i=e,n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Ve(this.remainderData,e));var a=We(i);this.remainderData=a.remainder,n.samples=a.valid||new Uint8Array}else n.samples=i;var s=this.extractID3Track(n,t);return r.samples=Ne(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}},t.flush=function(){var e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(t,this.timeOffset);return i.samples=Ne(e,t),{videoTrack:t,audioTrack:Jn(),id3Track:n,textTrack:Jn()}},t.extractID3Track=function(e,t){var i=this.id3Track;if(e.samples.length){var n=xe(e.samples,["emsg"]);n&&n.forEach((function(e){var n=He(e);if(kr.test(n.schemeIdUri)){var r=S(n.presentationTime)?n.presentationTime/n.timeScale:t+n.presentationTimeDelta/n.timeScale,a=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);var s=n.payload;i.samples.push({data:s,len:s.byteLength,dts:r,pts:r,type:Gt.emsg,duration:a})}}))}return i},t.demuxSampleAes=function(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}(),Rr=function(e,t){var i=0,n=5;t+=n;var r=new Uint32Array(1),a=new Uint32Array(1),s=new Uint8Array(1);while(n>0){s[0]=e[t];var o=Math.min(n,8),l=8-o;a[0]=4278190080>>>24+l<<l,r[0]=(s[0]&a[0])>>l,i=i?i<<o|r[0]:r[0],t+=1,n-=o}return i},wr=function(){function e(){this.VideoSample=null}var t=e.prototype;return t.createVideoSample=function(e,t,i,n){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:n,length:0}},t.getLastNalUnit=function(e){var t,i,n=this.VideoSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){var r=n.units;i=r[r.length-1]}return i},t.pushAccessUnit=function(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var i=t.samples,n=i.length;if(!n)return void t.dropped++;var r=i[n-1];e.pts=r.pts,e.dts=r.dts}t.samples.push(e)}e.debug.length&&X.log(e.pts+"/"+e.dts+":"+e.debug)},e}(),Er=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(e.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},t.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&X.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t,i=8,n=8,r=0;r<e;r++)0!==n&&(t=this.readEG(),n=(i+t+256)%256),i=0===n?i:n},t.readSPS=function(){var e,t,i,n=0,r=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);o();var p=o();if(l(5),d(3),o(),f(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){var v=u();if(3===v&&d(1),f(),f(),d(1),c())for(t=3!==v?8:12,i=0;i<t;i++)c()&&m(i<6?16:64)}f();var g=u();if(0===g)u();else if(1===g)for(d(1),h(),h(),e=u(),i=0;i<e;i++)h();f(),d(1);var y=u(),b=u(),L=l(1);0===L&&d(1),d(1),c()&&(n=u(),r=u(),a=u(),s=u());var S=[1,1];if(c()&&c()){var T=o();switch(T){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[o()<<8|o(),o()<<8|o()];break}}return{width:Math.ceil(16*(y+1)-2*n-2*r),height:(2-L)*(b+1)*16-(L?2:4)*(a+s),pixelRatio:S}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),Zr=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var i=t.prototype;return i.parseAVCPES=function(e,t,i,n,r){var a,s=this,o=this.parseAVCNALu(e,i.data),l=this.VideoSample,u=!1;i.data=null,l&&o.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"")),o.forEach((function(n){var o;switch(n.type){case 1:var c=!1;a=!0;var d,h=n.data;if(u&&h.length>4){var f=new Er(h).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(c=!0)}if(c)null!=(d=l)&&d.frame&&!l.key&&(s.pushAccessUnit(l,e),l=s.VideoSample=null);l||(l=s.VideoSample=s.createVideoSample(!0,i.pts,i.dts,"")),l.frame=!0,l.key=c;break;case 5:a=!0,null!=(o=l)&&o.frame&&!l.key&&(s.pushAccessUnit(l,e),l=s.VideoSample=null),l||(l=s.VideoSample=s.createVideoSample(!0,i.pts,i.dts,"")),l.key=!0,l.frame=!0;break;case 6:a=!0,Ye(n.data,1,i.pts,t.samples);break;case 7:var m,p;a=!0,u=!0;var v=n.data,g=new Er(v),y=g.readSPS();if(!e.sps||e.width!==y.width||e.height!==y.height||(null==(m=e.pixelRatio)?void 0:m[0])!==y.pixelRatio[0]||(null==(p=e.pixelRatio)?void 0:p[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[v],e.duration=r;for(var b=v.subarray(1,4),L="avc1.",S=0;S<3;S++){var T=b[S].toString(16);T.length<2&&(T="0"+T),L+=T}e.codec=L}break;case 8:a=!0,e.pps=[n.data];break;case 9:a=!0,e.audFound=!0,l&&s.pushAccessUnit(l,e),l=s.VideoSample=s.createVideoSample(!1,i.pts,i.dts,"");break;case 12:a=!0;break;default:a=!1,l&&(l.debug+="unknown NAL "+n.type+" ");break}if(l&&a){var k=l.units;k.push(n)}})),n&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)},i.parseAVCNALu=function(e,t){var i,n,r,a=t.byteLength,s=e.naluState||0,o=s,l=[],u=0,c=-1,d=0;-1===s&&(c=0,d=31&t[0],s=0,u=1);while(u<a)if(i=t[u++],s)if(1!==s)if(i)if(1===i){if(n=u-s-1,c>=0){var h={data:t.subarray(c,n),type:d};l.push(h)}else{var f=this.getLastNalUnit(e.samples);f&&(o&&u<=4-o&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-o)),n>0&&(f.data=Ve(f.data,t.subarray(0,n)),f.state=0))}u<a?(r=31&t[u],c=u,d=r,s=0):s=-1}else s=0;else s=3;else s=i?0:2;else s=i?0:1;if(c>=0&&s>=0){var m={data:t.subarray(c,a),type:d,state:s};l.push(m)}if(0===l.length){var p=this.getLastNalUnit(e.samples);p&&(p.data=Ve(p.data,t))}return e.naluState=s,l},t}(wr),Cr=function(){function e(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Yn(t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},t.decryptAacSample=function(e,t,i){var n=this,r=e[t].unit;if(!(r.length<=16)){var a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(s).then((function(a){var s=new Uint8Array(a);r.set(s,16),n.decrypter.isSync()||n.decryptAacSamples(e,t+1,i)}))}},t.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),n=0,r=32;r<e.length-16;r+=160,n+=16)i.set(e.subarray(r,r+16),n);return i},t.getAvcDecryptedUnit=function(e,t){for(var i=new Uint8Array(t),n=0,r=32;r<e.length-16;r+=160,n+=16)e.set(i.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,i,n,r){var a=this,s=Oe(r.data),o=this.getAvcEncryptedData(s);this.decryptBuffer(o.buffer).then((function(o){r.data=a.getAvcDecryptedUnit(s,o),a.decrypter.isSync()||a.decryptAvcSamples(e,t,i+1,n)}))},t.decryptAvcSamples=function(e,t,i,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length)return void n();for(var r=e[t].units;;i++){if(i>=r.length)break;var a=r[i];if(!(a.data.length<=48||1!==a.type&&5!==a.type)&&(this.decryptAvcSample(e,t,i,n,a),!this.decrypter.isSync()))return}}},e}(),Ir=188,Mr=function(){function e(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.videoParser=new Zr}e.probe=function(t){var i=e.syncOffset(t);return i>0&&X.warn("MPEG2-TS detected but first sync word found @ offset "+i),-1!==i},e.syncOffset=function(e){var t=e.length,i=Math.min(5*Ir,t-Ir)+1,n=0;while(n<i){for(var r=!1,a=-1,s=0,o=n;o<t;o+=Ir){if(71!==e[o]||t-o!==Ir&&71!==e[o+Ir]){if(s)return-1;break}if(s++,-1===a&&(a=o,0!==a&&(i=Math.min(a+99*Ir,e.length-Ir)+1)),r||(r=0===Gr(e,o)),r&&s>1&&(0===a&&s>2||o+Ir>i))return a}n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:ve[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,i,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",r),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=i,this.videoCodec=n,this._duration=r},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._videoTrack,i=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null},t.demux=function(t,i,n,r){var a;void 0===n&&(n=!1),void 0===r&&(r=!1),n||(this.sampleAes=null);var s=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack,c=s.pid,d=s.pesData,h=o.pid,f=l.pid,m=o.pesData,p=l.pesData,v=null,g=this.pmtParsed,y=this._pmtId,b=t.length;if(this.remainderData&&(t=Ve(this.remainderData,t),b=t.length,this.remainderData=null),b<Ir&&!r)return this.remainderData=t,{audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};var L=Math.max(0,e.syncOffset(t));b-=(b-L)%Ir,b<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,b,t.buffer.byteLength-b));for(var S=0,T=L;T<b;T+=Ir)if(71===t[T]){var k=!!(64&t[T+1]),x=Gr(t,T),R=(48&t[T+3])>>4,w=void 0;if(R>1){if(w=T+5+t[T+4],w===T+Ir)continue}else w=T+4;switch(x){case c:k&&(d&&(a=Wr(d))&&this.videoParser.parseAVCPES(s,u,a,!1,this._duration),d={data:[],size:0}),d&&(d.data.push(t.subarray(w,T+Ir)),d.size+=T+Ir-w);break;case h:if(k){if(m&&(a=Wr(m)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,a);break;case"mp3":this.parseMPEGPES(o,a);break}m={data:[],size:0}}m&&(m.data.push(t.subarray(w,T+Ir)),m.size+=T+Ir-w);break;case f:k&&(p&&(a=Wr(p))&&this.parseID3PES(l,a),p={data:[],size:0}),p&&(p.data.push(t.subarray(w,T+Ir)),p.size+=T+Ir-w);break;case 0:k&&(w+=t[w]+1),y=this._pmtId=Xr(t,w);break;case y:k&&(w+=t[w]+1);var E=_r(t,w,this.typeSupported,n,this.observer);c=E.videoPid,c>0&&(s.pid=c,s.segmentCodec=E.segmentVideoCodec),h=E.audioPid,h>0&&(o.pid=h,o.segmentCodec=E.segmentAudioCodec),f=E.id3Pid,f>0&&(l.pid=f),null===v||g||(X.warn("MPEG-TS PMT found at "+T+" after unknown PID '"+v+"'. Backtracking to sync byte @"+L+" to parse all TS packets."),v=null,T=L-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:v=x;break}}else S++;S>0&&Pr(this.observer,new Error("Found "+S+" TS packet/s that do not start with 0x47")),s.pesData=d,o.pesData=m,l.pesData=p;var Z={audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(Z),Z},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,i=e.audioTrack,n=e.videoTrack,r=e.id3Track,a=e.textTrack,s=n.pesData,o=i.pesData,l=r.pesData;if(s&&(t=Wr(s))?(this.videoParser.parseAVCPES(n,a,t,!0,this._duration),n.pesData=null):n.pesData=s,o&&(t=Wr(o))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,t);break;case"mp3":this.parseMPEGPES(i,t);break}i.pesData=null}else null!=o&&o.size&&X.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(t=Wr(l))?(this.parseID3PES(r,t),r.pesData=null):r.pesData=l},t.demuxSampleAes=function(e,t,i){var n=this.demux(e,i,!0,!this.config.progressive),r=this.sampleAes=new Cr(this.observer,this.config,t);return this.decrypt(n,r)},t.decrypt=function(e,t){return new Promise((function(i){var n=e.audioTrack,r=e.videoTrack;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,(function(){r.samples?t.decryptAvcSamples(r.samples,0,0,(function(){i(e)})):i(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(function(){i(e)}))}))},t.destroy=function(){this._duration=0},t.parseAACPES=function(e,t){var i,n,r,a=0,s=this.aacOverFlow,o=t.data;if(s){this.aacOverFlow=null;var l=s.missing,u=s.sample.unit.byteLength;if(-1===l)o=Ve(s.sample.unit,o);else{var c=u-l;s.sample.unit.set(o.subarray(0,l),c),e.samples.push(s.sample),a=s.missing}}for(i=a,n=o.length;i<n-1;i++)if(rr(o,i))break;if(i!==a){var d,h=i<n-1;if(d=h?"AAC PES did not start with ADTS header,offset:"+i:"No ADTS header found in AAC PES",Pr(this.observer,new Error(d),h),!h)return}if(or(e,this.observer,o,i,this.audioCodec),void 0!==t.pts)r=t.pts;else{if(!s)return void X.warn("[tsdemuxer]: AAC PES unknown PTS");var f=lr(e.samplerate);r=s.sample.pts+f}var m,p=0;while(i<n){if(m=cr(e,o,i,r,p),i+=m.length,m.missing){this.aacOverFlow=m;break}for(p++;i<n-1;i++)if(rr(o,i))break}},t.parseMPEGPES=function(e,t){var i=t.data,n=i.length,r=0,a=0,s=t.pts;if(void 0!==s)while(a<n)if(br(i,a)){var o=vr(e,i,a,s,r);if(!o)break;a+=o.length,r++}else a++;else X.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseAC3PES=function(e,t){},t.parseID3PES=function(e,t){if(void 0!==t.pts){var i=u({},t,{type:this._videoTrack?Gt.emsg:Gt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}else X.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function Gr(e,t){return((31&e[t+1])<<8)+e[t+2]}function Xr(e,t){return(31&e[t+10])<<8|e[t+11]}function _r(e,t,i,n,r){var a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=(15&e[t+1])<<8|e[t+2],o=t+3+s-4,l=(15&e[t+10])<<8|e[t+11];t+=12+l;while(t<o){var u=Gr(e,t),c=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!n){Dr("ADTS AAC");break}case 15:-1===a.audioPid&&(a.audioPid=u);break;case 21:-1===a.id3Pid&&(a.id3Pid=u);break;case 219:if(!n){Dr("H.264");break}case 27:-1===a.videoPid&&(a.videoPid=u,a.segmentVideoCodec="avc");break;case 3:case 4:i.mpeg||i.mp3?-1===a.audioPid&&(a.audioPid=u,a.segmentAudioCodec="mp3"):X.log("MPEG audio found, not supported in this browser");break;case 193:if(!n){Dr("AC-3");break}case 129:X.warn("AC-3 in M2TS support not included in build");break;case 6:if(-1===a.audioPid&&c>0){var d=t+5,h=c;while(h>2){var f=e[d];switch(f){case 106:X.warn("AC-3 in M2TS support not included in build");break}var m=e[d+1]+2;d+=m,h-=m}}break;case 194:case 135:return Pr(r,new Error("Unsupported EC-3 in M2TS found")),a;case 36:return Pr(r,new Error("Unsupported HEVC in M2TS found")),a}t+=c+5}return a}function Pr(e,t,i){X.warn("parsing error: "+t.message),e.emit(x.ERROR,x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,levelRetry:i,error:t,reason:t.message})}function Dr(e){X.log(e+" with AES-128-CBC encryption found in unencrypted stream")}function Wr(e){var t,i,n,r,a,s=0,o=e.data;if(!e||0===e.size)return null;while(o[0].length<19&&o.length>1)o[0]=Ve(o[0],o[1]),o.splice(1,1);t=o[0];var l=(t[0]<<16)+(t[1]<<8)+t[2];if(1===l){if(i=(t[4]<<8)+t[5],i&&i>e.size-6)return null;var u=t[7];192&u&&(r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&u?(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,r-a>54e5&&(X.warn(Math.round((r-a)/9e4)+"s delta between PTS and DTS, align them"),r=a)):a=r),n=t[8];var c=n+9;if(e.size<=c)return null;e.size-=c;for(var d=new Uint8Array(e.size),h=0,f=o.length;h<f;h++){t=o[h];var m=t.byteLength;if(c){if(c>m){c-=m;continue}t=t.subarray(c),m-=c,c=0}d.set(t,s),s+=m}return i&&(i-=n+3),{data:d,pts:r,dts:a,len:i}}return null}var Vr=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var i=t.prototype;return i.resetInitSegment=function(t,i,n,r){e.prototype.resetInitSegment.call(this,t,i,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;var t=$(e,0),i=(null==t?void 0:t.length)||0;if(t&&11===e[i]&&119===e[i+1]&&void 0!==ie(t)&&Rr(e,i)<=16)return!1;for(var n=e.length;i<n;i++)if(Sr(e,i))return X.log("MPEG Audio sync word found !"),!0;return!1},i.canParse=function(e,t){return Lr(e,t)},i.appendFrame=function(e,t,i){if(null!==this.basePTS)return vr(e,t,i,this.basePTS,this.frameIndex)},t}(Qn),Nr=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},e}(),Fr=Math.pow(2,32)-1,Ar=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:n};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,r))},e.box=function(e){for(var t=8,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=n.length,s=a;while(a--)t+=n[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(n[a],t),t+=n[a].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var n=Math.floor(i/(Fr+1)),r=Math.floor(i%(Fr+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,i))},e.moov=function(t){var i=t.length,n=[];while(i--)n[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function(t){var i=t.length,n=[];while(i--)n[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function(t,i){i*=t;var n=Math.floor(i/(Fr+1)),r=Math.floor(i%(Fr+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var i,n,r=t.samples||[],a=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)n=r[i].flags,a[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,n,r,a=[],s=[];for(i=0;i<t.sps.length;i++)n=t.sps[i],r=n.byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(n));for(i=0;i<t.pps.length;i++)n=t.pps[i],r=n.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.audioStsd=function(e){var t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])},e.mp4a=function(t){return e.box(e.types.mp4a,e.audioStsd(t),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){return e.box(e.types[".mp3"],e.audioStsd(t))},e.ac3=function(t){return e.box(e.types["ac-3"],e.audioStsd(t),e.box(e.types.dac3,t.config))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):"ac3"===t.segmentCodec?e.box(e.types.stsd,e.STSD,e.ac3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,n=t.duration*t.timescale,r=t.width,a=t.height,s=Math.floor(n/(Fr+1)),o=Math.floor(n%(Fr+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,i){var n=e.sdtp(t),r=t.id,a=Math.floor(i/(Fr+1)),s=Math.floor(i%(Fr+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var n,r,a,s,o,l,u=t.samples||[],c=u.length,d=12+16*c,h=new Uint8Array(d);for(i+=8+d,h.set(["video"===t.type?1:0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),n=0;n<c;n++)r=u[n],a=r.duration,s=r.size,o=r.flags,l=r.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*n);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var i=e.moov(t),n=Ve(e.FTYP,i);return n},e}();Ar.types=void 0,Ar.HDLR_TYPES=void 0,Ar.STTS=void 0,Ar.STSC=void 0,Ar.STCO=void 0,Ar.STSZ=void 0,Ar.VMHD=void 0,Ar.SMHD=void 0,Ar.STSD=void 0,Ar.FTYP=void 0,Ar.DINF=void 0;var Yr=9e4;function Or(e,t,i,n){void 0===i&&(i=1),void 0===n&&(n=!1);var r=e*t*i;return n?Math.round(r):r}function Hr(e,t){return void 0===t&&(t=!1),Or(e,1e3,1/Yr,t)}var Kr=1e4,Ur=1024,Br=1152,zr=1536,jr=null,Jr=null,Qr=function(){function e(e,t,i,n){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===jr){var r=navigator.userAgent||"",a=r.match(/Chrome\/(\d+)/i);jr=a?parseInt(a[1]):0}if(null===Jr){var s=navigator.userAgent.match(/Safari\/(\d+)/i);Jr=s?parseInt(s[1]):0}}var t=e.prototype;return t.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},t.resetTimeStamp=function(e){X.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){X.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){X.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},t.getVideoStartPts=function(e){var t=!1,i=e.reduce((function(e,i){var n=i.pts-e;return n<-4294967296?(t=!0,qr(e,i.pts)):n>0?e:i.pts}),e[0].pts);return t&&X.debug("PTS rollover detected"),i},t.remux=function(e,t,i,n,r,a,s,o){var l,u,c,d,h,f,m=r,p=r,v=e.pid>-1,g=t.pid>-1,y=t.samples.length,b=e.samples.length>0,L=s&&y>0||y>1,S=(!v||b)&&(!g||L)||this.ISGenerated||s;if(S){if(this.ISGenerated){var T,k,x,R,w=this.videoTrackConfig;!w||t.width===w.width&&t.height===w.height&&(null==(T=t.pixelRatio)?void 0:T[0])===(null==(k=w.pixelRatio)?void 0:k[0])&&(null==(x=t.pixelRatio)?void 0:x[1])===(null==(R=w.pixelRatio)?void 0:R[1])||this.resetInitSegment()}else c=this.generateIS(e,t,r,a);var E,Z=this.isVideoContiguous,C=-1;if(L&&(C=$r(t.samples),!Z&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,C>0){X.warn("[mp4-remuxer]: Dropped "+C+" out of "+y+" video samples due to a missing keyframe");var I=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(C),t.dropped+=C,p+=(t.samples[0].pts-I)/t.inputTimeScale,E=p}else-1===C&&(X.warn("[mp4-remuxer]: No keyframe found out of "+y+" video samples"),f=!1);if(this.ISGenerated){if(b&&L){var M=this.getVideoStartPts(t.samples),G=qr(e.samples[0].pts,M)-M,_=G/t.inputTimeScale;m+=Math.max(0,_),p+=Math.max(0,-_)}if(b){if(e.samplerate||(X.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,r,a)),u=this.remuxAudio(e,m,this.isAudioContiguous,a,g||L||o===kt.AUDIO?p:void 0),L){var P=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(X.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,r,a)),l=this.remuxVideo(t,p,Z,P)}}else L&&(l=this.remuxVideo(t,p,Z,0));l&&(l.firstKeyFrame=C,l.independent=-1!==C,l.firstKeyFramePTS=E)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(h=ea(i,r,this._initPTS,this._initDTS)),n.samples.length&&(d=ta(n,r,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:d,id3:h}},t.generateIS=function(e,t,i,n){var r,a,s,o=e.samples,l=t.samples,u=this.typeSupported,c={},d=this._initPTS,h=!d||n,f="audio/mp4";if(h&&(r=a=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(f="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}c.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&u.mpeg?new Uint8Array(0):Ar.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(s=e.inputTimeScale,d&&s===d.timescale?h=!1:r=a=o[0].pts-Math.round(s*i))}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Ar.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(s=t.inputTimeScale,d&&s===d.timescale)h=!1;else{var m=this.getVideoStartPts(l),p=Math.round(s*i);a=Math.min(a,qr(l[0].dts,m)-p),r=Math.min(r,m-p)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:r,timescale:s},this._initDTS={baseTime:a,timescale:s}):r=s=void 0,{tracks:c,initPTS:r,timescale:s}},t.remuxVideo=function(e,t,i,n){var r,a,s=e.inputTimeScale,o=e.samples,l=[],c=o.length,d=this._initPTS,h=this.nextAvcDts,f=8,m=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,g=!1;if(!i||null===h){var y=t*s,b=o[0].pts-qr(o[0].dts,o[0].pts);jr&&null!==h&&Math.abs(y-b-h)<15e3?i=!0:h=y-b}for(var L=d.baseTime*s/d.timescale,S=0;S<c;S++){var T=o[S];T.pts=qr(T.pts-L,h),T.dts=qr(T.dts-L,h),T.dts<o[S>0?S-1:S].dts&&(g=!0)}g&&o.sort((function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n})),r=o[0].dts,a=o[o.length-1].dts;var k=a-r,E=k?Math.round(k/(c-1)):m||e.inputTimeScale/30;if(i){var Z=r-h,C=Z>E,I=Z<-1;if((C||I)&&(C?X.warn("AVC: "+Hr(Z,!0)+" ms ("+Z+"dts) hole between fragments detected at "+t.toFixed(3)):X.warn("AVC: "+Hr(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected at "+t.toFixed(3)),!I||h>=o[0].pts||jr)){r=h;var M=o[0].pts-Z;if(C)o[0].dts=r,o[0].pts=M;else for(var G=0;G<o.length;G++){if(o[G].dts>M)break;o[G].dts-=Z,o[G].pts-=Z}X.log("Video: Initial PTS/DTS adjusted: "+Hr(M,!0)+"/"+Hr(r,!0)+", delta: "+Hr(Z,!0)+" ms")}}r=Math.max(0,r);for(var _=0,P=0,D=r,W=0;W<c;W++){for(var V=o[W],N=V.units,F=N.length,A=0,Y=0;Y<F;Y++)A+=N[Y].data.length;P+=A,_+=F,V.length=A,V.dts<D?(V.dts=D,D+=E/4|0||1):D=V.dts,p=Math.min(V.pts,p),v=Math.max(V.pts,v)}a=o[c-1].dts;var O,H=P+4*_+8;try{O=new Uint8Array(H)}catch(Te){return void this.observer.emit(x.ERROR,x.ERROR,{type:R.MUX_ERROR,details:w.REMUX_ALLOC_ERROR,fatal:!1,error:Te,bytes:H,reason:"fail allocating video mdat "+H})}var K=new DataView(O.buffer);K.setUint32(0,H),O.set(Ar.types.mdat,4);for(var U=!1,B=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY,Q=0;Q<c;Q++){for(var q=o[Q],$=q.units,ee=0,te=0,ie=$.length;te<ie;te++){var ne=$[te],re=ne.data,ae=ne.data.byteLength;K.setUint32(f,ae),f+=4,O.set(re,f),f+=ae,ee+=4+ae}var se=void 0;if(Q<c-1)m=o[Q+1].dts-q.dts,se=o[Q+1].pts-q.pts;else{var oe=this.config,le=Q>0?q.dts-o[Q-1].dts:E;if(se=Q>0?q.pts-o[Q-1].pts:E,oe.stretchShortVideoTrack&&null!==this.nextAudioPts){var ue=Math.floor(oe.maxBufferHole*s),ce=(n?p+n*s:this.nextAudioPts)-q.pts;ce>ue?(m=ce-le,m<0?m=le:U=!0,X.log("[mp4-remuxer]: It is approximately "+ce/90+" ms to the next segment; using duration "+m/90+" ms for the last video frame.")):m=le}else m=le}var de=Math.round(q.pts-q.dts);B=Math.min(B,m),j=Math.max(j,m),z=Math.min(z,se),J=Math.max(J,se),l.push(new ia(q.key,m,ee,de))}if(l.length)if(jr){if(jr<70){var he=l[0].flags;he.dependsOn=2,he.isNonSync=0}}else if(Jr&&J-z<j-B&&E/j<.025&&0===l[0].cts){X.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var fe=r,me=0,pe=l.length;me<pe;me++){var ve=fe+l[me].duration,ge=fe+l[me].cts;if(me<pe-1){var ye=ve+l[me+1].cts;l[me].duration=ye-ge}else l[me].duration=me?l[me-1].duration:E;l[me].cts=0,fe=ve}}m=U||!m?E:m,this.nextAvcDts=h=a+m,this.videoSampleDuration=m,this.isVideoContiguous=!0;var be=Ar.moof(e.sequenceNumber++,r,u({},e,{samples:l})),Le="video",Se={data1:be,data2:O,startPTS:p/s,endPTS:(v+m)/s,startDTS:r/s,endDTS:h/s,type:Le,hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Se},t.getSamplesPerFrame=function(e){switch(e.segmentCodec){case"mp3":return Br;case"ac3":return zr;default:return Ur}},t.remuxAudio=function(e,t,i,n,r){var a=e.inputTimeScale,s=e.samplerate?e.samplerate:a,o=a/s,l=this.getSamplesPerFrame(e),c=l*o,d=this._initPTS,h="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],m=void 0!==r,p=e.samples,v=h?0:8,g=this.nextAudioPts||-1,y=t*a,b=d.baseTime*a/d.timescale;if(this.isAudioContiguous=i=i||p.length&&g>0&&(n&&Math.abs(y-g)<9e3||Math.abs(qr(p[0].pts-b,y)-g)<20*c),p.forEach((function(e){e.pts=qr(e.pts-b,y)})),!i||g<0){if(p=p.filter((function(e){return e.pts>=0})),!p.length)return;g=0===r?0:n&&!m?Math.max(0,y):p[0].pts}if("aac"===e.segmentCodec)for(var L=this.config.maxAudioFramesDrift,S=0,T=g;S<p.length;S++){var k=p[S],E=k.pts,Z=E-T,C=Math.abs(1e3*Z/a);if(Z<=-L*c&&m)0===S&&(X.warn("Audio frame @ "+(E/a).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Z/a)+" ms."),this.nextAudioPts=g=T=E);else if(Z>=L*c&&C<Kr&&m){var I=Math.round(Z/c);T=E-I*c,T<0&&(I--,T+=c),0===S&&(this.nextAudioPts=g=T),X.warn("[mp4-remuxer]: Injecting "+I+" audio frame @ "+(T/a).toFixed(3)+"s due to "+Math.round(1e3*Z/a)+" ms gap.");for(var M=0;M<I;M++){var G=Math.max(T,0),_=Nr.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);_||(X.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),_=k.unit.subarray()),p.splice(S,0,{unit:_,pts:G}),T+=c,S++}}k.pts=T,T+=c}var P,D=null,W=null,V=0,N=p.length;while(N--)V+=p[N].unit.byteLength;for(var F=0,A=p.length;F<A;F++){var Y=p[F],O=Y.unit,H=Y.pts;if(null!==W){var K=f[F-1];K.duration=Math.round((H-W)/o)}else{if(i&&"aac"===e.segmentCodec&&(H=g),D=H,!(V>0))return;V+=v;try{P=new Uint8Array(V)}catch(te){return void this.observer.emit(x.ERROR,x.ERROR,{type:R.MUX_ERROR,details:w.REMUX_ALLOC_ERROR,fatal:!1,error:te,bytes:V,reason:"fail allocating audio mdat "+V})}if(!h){var U=new DataView(P.buffer);U.setUint32(0,V),P.set(Ar.types.mdat,4)}}P.set(O,v);var B=O.byteLength;v+=B,f.push(new ia(!0,l,B,0)),W=H}var z=f.length;if(z){var j=f[f.length-1];this.nextAudioPts=g=W+o*j.duration;var J=h?new Uint8Array(0):Ar.moof(e.sequenceNumber++,D/o,u({},e,{samples:f}));e.samples=[];var Q=D/a,q=g/a,$="audio",ee={data1:J,data2:P,startPTS:Q,endPTS:q,startDTS:Q,endDTS:q,type:$,hasAudio:!0,hasVideo:!1,nb:z};return this.isAudioContiguous=!0,ee}},t.remuxEmptyAudio=function(e,t,i,n){var r=e.inputTimeScale,a=e.samplerate?e.samplerate:r,s=r/a,o=this.nextAudioPts,l=this._initDTS,u=9e4*l.baseTime/l.timescale,c=(null!==o?o:n.startDTS*r)+u,d=n.endDTS*r+u,h=s*Ur,f=Math.ceil((d-c)/h),m=Nr.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(X.warn("[mp4-remuxer]: remux empty Audio"),m){for(var p=[],v=0;v<f;v++){var g=c+v*h;p.push({unit:m,pts:g,dts:g})}return e.samples=p,this.remuxAudio(e,t,i,!1)}X.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e}();function qr(e,t){var i;if(null===t)return e;i=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=i;return e}function $r(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}function ea(e,t,i,n){var r=e.samples.length;if(r){for(var a=e.inputTimeScale,s=0;s<r;s++){var o=e.samples[s];o.pts=qr(o.pts-i.baseTime*a/i.timescale,t*a)/a,o.dts=qr(o.dts-n.baseTime*a/n.timescale,t*a)/a}var l=e.samples;return e.samples=[],{samples:l}}}function ta(e,t,i){var n=e.samples.length;if(n){for(var r=e.inputTimeScale,a=0;a<n;a++){var s=e.samples[a];s.pts=qr(s.pts-i.baseTime*r/i.timescale,t*r)/r}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}}var ia=function(e,t,i,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=n,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}},na=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},t.resetNextTimestamp=function(){this.lastEndTime=null},t.resetInitSegment=function(e,t,i,n){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(Me(e,n)),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,i=this.videoCodec;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=we(e);n.audio&&(t=aa(n.audio,A.AUDIO)),n.video&&(i=aa(n.video,A.VIDEO));var r={};n.audio&&n.video?r.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:n.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?r.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:X.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r},t.remux=function(e,t,i,n,r,a){var s,o,l=this.initPTS,u=this.lastEndTime,c={audio:void 0,video:void 0,text:n,id3:i,initSegment:void 0};S(u)||(u=this.lastEndTime=r||0);var d=t.samples;if(null==d||!d.length)return c;var h={initPTS:void 0,timescale:1},f=this.initData;if(null!=(s=f)&&s.length||(this.generateInitSegment(d),f=this.initData),null==(o=f)||!o.length)return X.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var m=_e(d,f),p=Xe(f,d),v=null===p?r:p;(ra(l,v,r,m)||h.timescale!==l.timescale&&a)&&(h.initPTS=v-r,l&&1===l.timescale&&X.warn("Adjusting initPTS by "+(h.initPTS-l.baseTime)),this.initPTS=l={baseTime:h.initPTS,timescale:1});var g=e?v-l.baseTime/l.timescale:u,y=g+m;De(f,d,l.baseTime/l.timescale),m>0?this.lastEndTime=y:(X.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var b=!!f.audio,L=!!f.video,T="";b&&(T+="audio"),L&&(T+="video");var k={data1:d,startPTS:g,startDTS:g,endPTS:y,endDTS:y,type:T,hasAudio:b,hasVideo:L,nb:1,dropped:0};return c.audio="audio"===k.type?k:void 0,c.video="audio"!==k.type?k:void 0,c.initSegment=h,c.id3=ea(i,r,l,l),n.samples.length&&(c.text=ta(n,r,l)),c},e}();function ra(e,t,i,n){if(null===e)return!0;var r=Math.max(n,1),a=t-e.baseTime/e.timescale;return Math.abs(a-i)>r}function aa(e,t){var i=null==e?void 0:e.codec;if(i&&i.length>4)return i;if(t===A.AUDIO){if("ec-3"===i||"ac-3"===i||"alac"===i)return i;if("fLaC"===i||"Opus"===i){var n=!1;return at(i,n)}var r="mp4a.40.5";return X.info('Parsed audio codec "'+i+'" or audio object type not handled. Using "'+r+'"'),r}return X.warn('Unhandled video codec "'+i+'"'),"hvc1"===i||"hev1"===i?"hvc1.1.6.L120.90":"av01"===i?"av01.0.04M.08":"avc1.42e01e"}var sa,oa="undefined"!==typeof self?self:void 0;try{sa=self.performance.now.bind(self.performance)}catch(Pa){X.debug("Unable to use Performance API on this environment"),sa=null==oa?void 0:oa.Date.now}var la=[{demux:xr,remux:na},{demux:Mr,remux:Qr},{demux:Tr,remux:Qr},{demux:Vr,remux:Qr}],ua=function(){function e(e,t,i,n,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=n,this.id=r}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,i,n){var r=this,a=i.transmuxing;a.executeStart=sa();var s=new Uint8Array(e),o=this.currentTransmuxState,l=this.transmuxConfig;n&&(this.currentTransmuxState=n);var u=n||o,c=u.contiguous,d=u.discontinuity,h=u.trackSwitch,f=u.accurateTimeOffset,m=u.timeOffset,p=u.initSegmentChange,v=l.audioCodec,g=l.videoCodec,y=l.defaultInitPts,b=l.duration,L=l.initSegmentData,S=ca(s,t);if(S&&"AES-128"===S.method){var T=this.getDecrypter();if(!T.isSync())return this.decryptionPromise=T.webCryptoDecrypt(s,S.key.buffer,S.iv.buffer).then((function(e){var t=r.push(e,null,i);return r.decryptionPromise=null,t})),this.decryptionPromise;var k=T.softwareDecrypt(s,S.key.buffer,S.iv.buffer),E=i.part>-1;if(E&&(k=T.flush()),!k)return a.executeEnd=sa(),da(i);s=new Uint8Array(k)}var Z=this.needsProbing(d,h);if(Z){var C=this.configureTransmuxer(s);if(C)return X.warn("[transmuxer] "+C.message),this.observer.emit(x.ERROR,x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message}),a.executeEnd=sa(),da(i)}(d||h||p||Z)&&this.resetInitSegment(L,v,g,b,t),(d||p||Z)&&this.resetInitialTimestamp(y),c||this.resetContiguity();var I=this.transmux(s,S,m,f,i),M=this.currentTransmuxState;return M.contiguous=!0,M.discontinuity=!1,M.trackSwitch=!1,a.executeEnd=sa(),I},t.flush=function(e){var t=this,i=e.transmuxing;i.executeStart=sa();var n=this.decrypter,r=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then((function(){return t.flush(e)}));var s=[],o=r.timeOffset;if(n){var l=n.flush();l&&s.push(this.push(l,null,e))}var u=this.demuxer,c=this.remuxer;if(!u||!c)return i.executeEnd=sa(),[da(e)];var d=u.flush(o);return ha(d)?d.then((function(i){return t.flushRemux(s,i,e),s})):(this.flushRemux(s,d,e),s)},t.flushRemux=function(e,t,i){var n=t.audioTrack,r=t.videoTrack,a=t.id3Track,s=t.textTrack,o=this.currentTransmuxState,l=o.accurateTimeOffset,u=o.timeOffset;X.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var c=this.remuxer.remux(n,r,a,s,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=sa()},t.resetInitialTimestamp=function(e){var t=this.demuxer,i=this.remuxer;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,i,n,r){var a=this.demuxer,s=this.remuxer;a&&s&&(a.resetInitSegment(e,t,i,n),s.resetInitSegment(e,t,i,r))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,i,n,r){var a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,n,r):this.transmuxUnencrypted(e,i,n,r),a},t.transmuxUnencrypted=function(e,t,i,n){var r=this.demuxer.demux(e,t,!1,!this.config.progressive),a=r.audioTrack,s=r.videoTrack,o=r.id3Track,l=r.textTrack,u=this.remuxer.remux(a,s,o,l,t,i,!1,this.id);return{remuxResult:u,chunkMeta:n}},t.transmuxSampleAes=function(e,t,i,n,r){var a=this;return this.demuxer.demuxSampleAes(e,t,i).then((function(e){var t=a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,n,!1,a.id);return{remuxResult:t,chunkMeta:r}}))},t.configureTransmuxer=function(e){for(var t,i=this.config,n=this.observer,r=this.typeSupported,a=this.vendor,s=0,o=la.length;s<o;s++){var l;if(null!=(l=la[s].demux)&&l.probe(e)){t=la[s];break}}if(!t)return new Error("Failed to find demuxer by probing fragment data");var u=this.demuxer,c=this.remuxer,d=t.remux,h=t.demux;c&&c instanceof d||(this.remuxer=new d(n,i,r,a)),u&&u instanceof h||(this.demuxer=new h(n,i,r),this.probe=h.probe)},t.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new Yn(this.config)),e},e}();function ca(e,t){var i=null;return e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(i=t),i}var da=function(e){return{remuxResult:{},chunkMeta:e}};function ha(e){return"then"in e&&e.then instanceof Function}var fa=function(e,t,i,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=n,this.defaultInitPts=r||null},ma=function(e,t,i,n,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=a},pa={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function n(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,n,a,s){if("function"!==typeof n)throw new TypeError("The listener must be a function");var o=new r(n,a||e,s),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),o.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)t.call(e,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,a=n.length,s=new Array(a);r<a;r++)s[r]=n[r].fn;return s},o.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,r,a,s){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,a),!0;case 6:return c.fn.call(c.context,t,n,r,a,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,r);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,n,r){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o})(pa);var va=pa.exports,ga=y(va);function ya(e){var t=new ga,i=function(t,i){e.postMessage({event:t,data:i})};t.on(x.FRAG_DECRYPTED,i),t.on(x.ERROR,i);var n=function(){var e=function(e){var t=function(t){i("workerLog",{logType:e,message:t})};X[e]=t};for(var t in X)e(t)};e.addEventListener("message",(function(r){var a=r.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.transmuxer=new ua(t,a.typeSupported,s,"",a.id),G(s.debug,a.id),n(),i("init",null);break;case"configure":e.transmuxer.configure(a.config);break;case"demux":var o=e.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);ha(o)?(e.transmuxer.async=!0,o.then((function(t){ba(e,t)})).catch((function(e){i(x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker push error"})}))):(e.transmuxer.async=!1,ba(e,o));break;case"flush":var l=a.chunkMeta,u=e.transmuxer.flush(l),c=ha(u);c||e.transmuxer.async?(ha(u)||(u=Promise.resolve(u)),u.then((function(t){Sa(e,t,l)})).catch((function(e){i(x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker flush error"})}))):Sa(e,u,l);break}}))}function ba(e,t){if(Ta(t.remuxResult))return!1;var i=[],n=t.remuxResult,r=n.audio,a=n.video;return r&&La(i,r),a&&La(i,a),e.postMessage({event:"transmuxComplete",data:t},i),!0}function La(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function Sa(e,t,i){var n=t.reduce((function(t,i){return ba(e,i)||t}),!1);n||e.postMessage({event:"transmuxComplete",data:t[0]}),e.postMessage({event:"flush",data:i})}function Ta(e){return!e.audio&&!e.video&&!e.text&&!e.id3&&!e.initSegment}function ka(){return"function"===typeof t}function xa(){var e=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+t.toString()+")(true);"],{type:"text/javascript"}),i=self.URL.createObjectURL(e),n=new self.Worker(i);return{worker:n,objectURL:i}}function Ra(e){var t=new self.URL(e,self.location.href).href,i=new self.Worker(t);return{worker:i,scriptURL:t}}"undefined"!==typeof i&&i&&ya(self);var wa=function(){function e(e,t,i,n){var r=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var s=function(e,t){t=t||{},t.frag=r.frag,t.id=r.id,e===x.ERROR&&(r.error=t.error),r.hls.trigger(e,t)};this.observer=new ga,this.observer.on(x.FRAG_DECRYPTED,s),this.observer.on(x.ERROR,s);var o=Be(a.preferManagedMediaSource)||{isTypeSupported:function(){return!1}},l={mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:!1};if(this.useWorker&&"undefined"!==typeof Worker){var u=a.workerPath||ka();if(u){try{a.workerPath?(X.log("loading Web Worker "+a.workerPath+' for "'+t+'"'),this.workerContext=Ra(a.workerPath)):(X.log('injecting Web Worker for "'+t+'"'),this.workerContext=xa()),this.onwmsg=function(e){return r.onWorkerMessage(e)};var c=this.workerContext.worker;c.addEventListener("message",this.onwmsg),c.onerror=function(e){var i=new Error(e.message+"  ("+e.filename+":"+e.lineno+")");a.enableWorker=!1,X.warn('Error in "'+t+'" Web Worker, fallback to inline'),r.hls.trigger(x.ERROR,{type:R.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:i})},c.postMessage({cmd:"init",typeSupported:l,vendor:"",id:t,config:JSON.stringify(a)})}catch(Pa){X.warn('Error setting up "'+t+'" Web Worker, fallback to inline',Pa),this.resetWorker(),this.error=null,this.transmuxer=new ua(this.observer,l,a,"",t)}return}}this.transmuxer=new ua(this.observer,l,a,"",t)}var t=e.prototype;return t.resetWorker=function(){if(this.workerContext){var e=this.workerContext,t=e.worker,i=e.objectURL;i&&self.URL.revokeObjectURL(i),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}},t.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},t.push=function(e,t,i,n,r,a,s,o,l,u){var c,d,h=this;l.transmuxing.start=self.performance.now();var f=this.transmuxer,m=a?a.start:r.start,p=r.decryptdata,v=this.frag,g=!(v&&r.cc===v.cc),y=!(v&&l.level===v.level),b=v?l.sn-v.sn:-1,L=this.part?l.part-this.part.index:-1,S=0===b&&l.id>1&&l.id===(null==v?void 0:v.stats.chunkCount),T=!y&&(1===b||0===b&&(1===L||S&&L<=0)),k=self.performance.now();(y||b||0===r.stats.parsing.start)&&(r.stats.parsing.start=k),!a||!L&&T||(a.stats.parsing.start=k);var x=!(v&&(null==(c=r.initSegment)?void 0:c.url)===(null==(d=v.initSegment)?void 0:d.url)),R=new ma(g,T,o,y,m,x);if(!T||g||x){X.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+g+"\n        trackSwitch: "+y+"\n        contiguous: "+T+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+m+"\n        initSegmentChange: "+x);var w=new fa(i,n,t,s,u);this.configureTransmuxer(w)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:R},e instanceof ArrayBuffer?[e]:[]);else if(f){var E=f.push(e,p,l,R);ha(E)?(f.async=!0,E.then((function(e){h.handleTransmuxComplete(e)})).catch((function(e){h.transmuxerError(e,l,"transmuxer-interface push error")}))):(f.async=!1,this.handleTransmuxComplete(E))}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(i){var n=i.flush(e),r=ha(n);r||i.async?(ha(n)||(n=Promise.resolve(n)),n.then((function(i){t.handleFlushResult(i,e)})).catch((function(i){t.transmuxerError(i,e,"transmuxer-interface flush error")}))):this.handleFlushResult(n,e)}},t.transmuxerError=function(e,t,i){this.hls&&(this.error=e,this.hls.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:i}))},t.handleFlushResult=function(e,t){var i=this;e.forEach((function(e){i.handleTransmuxComplete(e)})),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data;if(null!=t&&t.event){var i=this.hls;if(this.hls)switch(t.event){case"init":var n,r=null==(n=this.workerContext)?void 0:n.objectURL;r&&self.URL.revokeObjectURL(r);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":X[t.data.logType]&&X[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data);break}}else X.warn("worker message received with no "+(t?"event name":"data"))},t.configureTransmuxer=function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}(),Ea=250,Za=2,Ca=.1,Ia=.05,Ma=function(){function e(e,t,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n}var t=e.prototype;return t.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},t.poll=function(e,t){var i=this.config,n=this.media,r=this.stalled;if(null!==n){var a=n.currentTime,s=n.seeking,o=this.seeking&&!s,l=!this.seeking&&s;if(this.seeking=s,a===e)if(l||o)this.stalled=null;else if(n.paused&&!s||n.ended||0===n.playbackRate||!Di.getBuffered(n).length)this.nudgeRetry=0;else{var u=Di.bufferInfo(n,a,0),c=u.nextStart||0;if(s){var d=u.len>Za,h=!c||t&&t.start<=a||c-a>Za&&!this.fragmentTracker.getPartialFragment(a);if(d||h)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var f,m=u.len>0;if(!m&&!c)return;var p=Math.max(c,u.start||0)-a,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,g=null==v||null==(f=v.details)?void 0:f.live,y=g?2*v.details.targetduration:Za,b=this.fragmentTracker.getPartialFragment(a);if(p>0&&(p<=y||b))return void(n.paused||this._trySkipBufferHole(b))}var L=self.performance.now();if(null!==r){var S=L-r;if(s||!(S>=Ea)||(this._reportStall(u),this.media)){var T=Di.bufferInfo(n,a,i.maxBufferHole);this._tryFixBufferStall(T,S)}}else this.stalled=L}else if(this.moved=!0,s||(this.nudgeRetry=0),null!==r){if(this.stallReported){var k=self.performance.now()-r;X.warn("playback not stuck anymore @"+a+", after "+Math.round(k)+"ms"),this.stallReported=!1}this.stalled=null}}},t._tryFixBufferStall=function(e,t){var i=this.config,n=this.fragmentTracker,r=this.media;if(null!==r){var a=r.currentTime,s=n.getPartialFragment(a);if(s){var o=this._trySkipBufferHole(s);if(o||!this.media)return}(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-a<i.maxBufferHole)&&t>1e3*i.highBufferWatchdogPeriod&&(X.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},t._reportStall=function(e){var t=this.hls,i=this.media,n=this.stallReported;if(!n&&i){this.stallReported=!0;var r=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")");X.warn(r.message),t.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len})}},t._trySkipBufferHole=function(e){var t=this.config,i=this.hls,n=this.media;if(null===n)return 0;var r=n.currentTime,a=Di.bufferInfo(n,r,0),s=r<a.start?a.start:a.nextStart;if(s){var o=a.len<=t.maxBufferHole,l=a.len>0&&a.len<1&&n.readyState<3,u=s-r;if(u>0&&(o||l)){if(u>t.maxBufferHole){var c=this.fragmentTracker,d=!1;if(0===r){var h=c.getAppendedFrag(0,kt.MAIN);h&&s<h.end&&(d=!0)}if(!d){var f=e||c.getAppendedFrag(r,kt.MAIN);if(f){var m=!1,p=f.end;while(p<s){var v=c.getPartialFragment(p);if(!v){m=!0;break}p+=v.duration}if(m)return 0}}}var g=Math.max(s+Ia,r+Ca);if(X.warn("skipping hole, adjusting currentTime from "+r+" to "+g),this.moved=!0,this.stalled=null,n.currentTime=g,e&&!e.gap){var y=new Error("fragment loaded with buffer holes, seeking from "+r+" to "+g);i.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:e})}return g}}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,n=this.nudgeRetry;if(null!==i){var r=i.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var a=r+(n+1)*e.nudgeOffset,s=new Error("Nudging 'currentTime' from "+r+" to "+a);X.warn(s.message),i.currentTime=a,t.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.BUFFER_NUDGE_ON_STALL,error:s,fatal:!1})}else{var o=new Error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges");X.error(o.message),t.trigger(x.ERROR,{type:R.MEDIA_ERROR,details:w.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}},e}(),Ga=100,Xa=function(e){function t(t,i,n){var r;return r=e.call(this,t,i,n,"[stream-controller]",kt.MAIN)||this,r.audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}c(t,e);var i=t.prototype;return i._registerListeners=function(){var e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(x.ERROR,this.onError,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(x.ERROR,this.onError,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),e.prototype.onHandlerDestroying.call(this)},i.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(Ga),this.level=-1,!this.startFragRequested){var n=i.startLevel;-1===n&&(i.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=i.firstAutoLevel),i.nextLoadLevel=n,this.level=i.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=Hn.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Hn.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case Hn.WAITING_LEVEL:var e=this.levels,t=this.level,i=null==e?void 0:e[t],n=null==i?void 0:i.details;if(n&&(!n.live||this.levelLastLoaded===i)){if(this.waitForCdnTuneIn(n))break;this.state=Hn.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=Hn.IDLE;break}break;case Hn.FRAG_LOADING_WAITING_RETRY:var r,a=self.performance.now(),s=this.retryDate;if(!s||a>=s||null!=(r=this.media)&&r.seeking){var o=this.levels,l=this.level,u=null==o?void 0:o[l];this.resetStartWhenNotLoaded(u||null),this.state=Hn.IDLE}break}this.state===Hn.IDLE&&this.doTickIdle(),this.onTickEnd()},i.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,i=this.levels,n=this.media;if(null!==t&&(n||!this.startFragRequested&&e.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)){var r=e.nextLoadLevel;if(null!=i&&i[r]){var a=i[r],s=this.getMainFwdBufferInfo();if(null!==s){var o=this.getLevelDetails();if(o&&this._streamEnded(s,o)){var l={};return this.altAudio&&(l.type="video"),this.hls.trigger(x.BUFFER_EOS,l),void(this.state=Hn.ENDED)}e.loadLevel!==r&&-1===e.manualLevel&&this.log("Adapting to level "+r+" from level "+this.level),this.level=e.nextLoadLevel=r;var u=a.details;if(!u||this.state===Hn.WAITING_LEVEL||u.live&&this.levelLastLoaded!==a)return this.level=r,void(this.state=Hn.WAITING_LEVEL);var c=s.len,d=this.getMaxBufferLength(a.maxBitrate);if(!(c>=d)){this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);var h=this.backtrackFragment?this.backtrackFragment.start:s.end,f=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==vn.OK){var m,p=(null!=(m=this.backtrackFragment)?m:f).sn,v=p-u.startSN,g=u.fragments[v-1];g&&f.cc===g.cc&&(f=g,this.fragmentTracker.removeFragment(g))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){var y=f.gap;if(!y){var b=this.audioOnly&&!this.altAudio?A.AUDIO:A.VIDEO,L=(b===A.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;L&&this.afterBufferFlushed(L,b,kt.MAIN)}f=this.getNextFragmentLoopLoading(f,u,s,kt.MAIN,d)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,h))}}}}},i.loadFragment=function(t,i,n){var r=this.fragmentTracker.getState(t);this.fragCurrent=t,r===vn.NOT_LOADED||r===vn.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t,i):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,i)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,i,n)):this.clearTrackerIfNeeded(t)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,kt.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var i,n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);var r=this.getLevelDetails();if(null!=r&&r.live){var a=this.getMainFwdBufferInfo();if(!a||a.len<2*r.targetduration)return}if(!t.paused&&e){var s=this.hls.nextLoadLevel,o=e[s],l=this.fragLastKbps;i=l&&this.fragCurrent?this.fragCurrent.duration*o.maxBitrate/(1e3*l)+1:0}else i=0;var u=this.getBufferedFrag(t.currentTime+i);if(u){var c=this.followingBufferedFrag(u);if(c){this.abortCurrentFrag();var d=c.maxStartPTS?c.maxStartPTS:c.start,h=c.duration,f=Math.max(u.end,d+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Hn.KEY_LOADING:case Hn.FRAG_LOADING:case Hn.FRAG_LOADING_WAITING_RETRY:case Hn.PARSING:case Hn.PARSED:this.state=Hn.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(t,i){e.prototype.flushMainBuffer.call(this,t,i,this.altAudio?"video":null)},i.onMediaAttached=function(t,i){e.prototype.onMediaAttached.call(this,t,i);var n=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new Ma(this.config,n,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;S(t)&&this.log("Media seeked to "+t.toFixed(3));var i=this.getMainFwdBufferInfo();null!==i&&0!==i.len?this.tick():this.warn('Main forward buffer length on "seeked" event '+(i?i.len:"empty")+")")},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1},i.onManifestParsed=function(e,t){var i=!1,n=!1;t.levels.forEach((function(e){var t=e.audioCodec;t&&(i=i||-1!==t.indexOf("mp4a.40.2"),n=n||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=i&&n&&!jn(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},i.onLevelLoading=function(e,t){var i=this.levels;if(i&&this.state===Hn.IDLE){var n=i[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(n.details))&&(this.state=Hn.WAITING_LEVEL)}},i.onLevelLoaded=function(e,t){var i,n=this.levels,r=t.level,a=t.details,s=a.totalduration;if(n){this.log("Level "+r+" loaded ["+a.startSN+","+a.endSN+"]"+(a.lastPartSn?"[part-"+a.lastPartSn+"-"+a.lastPartIndex+"]":"")+", cc ["+a.startCC+", "+a.endCC+"] duration:"+s);var o=n[r],l=this.fragCurrent;!l||this.state!==Hn.FRAG_LOADING&&this.state!==Hn.FRAG_LOADING_WAITING_RETRY||l.level!==t.level&&l.loader&&this.abortCurrentFrag();var u=0;if(a.live||null!=(i=o.details)&&i.live){var c;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,o.details,null==(c=this.levelLastLoaded)?void 0:c.details)}if(o.details=a,this.levelLastLoaded=o,this.hls.trigger(x.LEVEL_UPDATED,{details:a,level:r}),this.state===Hn.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=Hn.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}else this.warn("Levels were reset while loading level "+r)},i._handleFragmentLoadProgress=function(e){var t,i=e.frag,n=e.part,r=e.payload,a=this.levels;if(a){var s=a[i.level],o=s.details;if(!o)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var l=s.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=i.initSegment)?void 0:t.data,d=this._getAudioCodec(s),h=this.transmuxer=this.transmuxer||new wa(this.hls,kt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=n?n.index:-1,m=-1!==f,p=new En(i.level,i.sn,i.stats.chunkCount,r.byteLength,f,m),v=this.initPTS[i.cc];h.push(r,c,d,l,i,n,o.totalduration,u,p,v)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},i.onAudioTrackSwitching=function(e,t){var i=this.altAudio,n=!!t.url;if(!n){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r&&(this.log("Switching to main audio track, cancel main fragment load"),r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var a=this.hls;i&&(a.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),a.trigger(x.AUDIO_TRACK_SWITCHED,t)}},i.onAudioTrackSwitched=function(e,t){var i=t.id,n=!!this.hls.audioTracks[i].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},i.onBufferCreated=function(e,t){var i,n,r=t.tracks,a=!1;for(var s in r){var o=r[s];if("main"===o.id){if(n=s,i=o,"video"===s){var l=r[s];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&i?(this.log("Alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(e,t){var i=t.frag,n=t.part;if(!i||i.type===kt.MAIN){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Hn.PARSED&&(this.state=Hn.IDLE));var r=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}},i.onError=function(e,t){var i;if(t.fatal)this.state=Hn.ERROR;else switch(t.details){case w.FRAG_GAP:case w.FRAG_PARSING_ERROR:case w.FRAG_DECRYPT_ERROR:case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(kt.MAIN,t);break;case w.LEVEL_LOAD_ERROR:case w.LEVEL_LOAD_TIMEOUT:case w.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Hn.WAITING_LEVEL||(null==(i=t.context)?void 0:i.type)!==Tt.LEVEL||(this.state=Hn.IDLE);break;case w.BUFFER_APPEND_ERROR:case w.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===w.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case w.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},i.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!Di.getBuffered(e).length){var i=this.state!==Hn.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,i)}this.lastCurrentTime=e.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=Hn.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(e,t){var i=t.type;if(i!==A.AUDIO||this.audioOnly&&!this.altAudio){var n=(i===A.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,i,kt.MAIN),this.tick()}},i.onLevelsUpdated=function(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking)return void this.log("could not seek to "+i+", already seeking at "+t);var n=Di.getBuffered(e),r=n.length?n.start(0):0,a=r-i;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+a+" to match buffer start"),i+=a,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+t),e.currentTime=i}}},i._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},i._loadBitrateTestFrag=function(e,t){var i=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(n){var r=i.hls;if(n&&!i.fragContextChanged(e)){t.fragmentError=0,i.state=Hn.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(x.FRAG_LOADED,n),e.bitrateTest=!1}}))},i._handleTransmuxComplete=function(e){var t,i="main",n=this.hls,r=e.remuxResult,a=e.chunkMeta,s=this.getCurrentContext(a);if(s){var o=s.frag,l=s.part,u=s.level,c=r.video,d=r.text,h=r.id3,f=r.initSegment,m=u.details,p=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Hn.PARSING,f){if(null!=f&&f.tracks){var v=o.initSegment||o;this._bufferInitSegment(u,f.tracks,v,a),n.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:i,tracks:f.tracks})}var g=f.initPTS,y=f.timescale;S(g)&&(this.initPTS[o.cc]={baseTime:g,timescale:y},n.trigger(x.INIT_PTS_FOUND,{frag:o,id:i,initPTS:g,timescale:y}))}if(c&&m&&"initSegment"!==o.sn){var b=m.fragments[o.sn-1-m.startSN],L=o.sn===m.startSN,T=!b||o.cc>b.cc;if(!1!==r.independent){var k=c.startPTS,R=c.endPTS,w=c.startDTS,E=c.endDTS;if(l)l.elementaryStreams[c.type]={startPTS:k,endPTS:R,startDTS:w,endDTS:E};else if(c.firstKeyFrame&&c.independent&&1===a.id&&!T&&(this.couldBacktrack=!0),c.dropped&&c.independent){var Z=this.getMainFwdBufferInfo(),C=(Z?Z.end:this.getLoadPosition())+this.config.maxBufferHole,I=c.firstKeyFramePTS?c.firstKeyFramePTS:k;if(!L&&C<I-this.config.maxBufferHole&&!T)return void this.backtrack(o);T&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,R,o.start,E,!0)}else L&&k>Za&&(o.gap=!0);o.setElementaryStreamInfo(c.type,k,R,w,E),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,a,L||T)}else{if(!L&&!T)return void this.backtrack(o);o.gap=!0}}if(p){var M=p.startPTS,G=p.endPTS,X=p.startDTS,_=p.endDTS;l&&(l.elementaryStreams[A.AUDIO]={startPTS:M,endPTS:G,startDTS:X,endDTS:_}),o.setElementaryStreamInfo(A.AUDIO,M,G,X,_),this.bufferFragmentData(p,o,l,a)}if(m&&null!=h&&null!=(t=h.samples)&&t.length){var P={id:i,frag:o,details:m,samples:h.samples};n.trigger(x.FRAG_PARSING_METADATA,P)}if(m&&d){var D={id:i,frag:o,details:m,samples:d.samples};n.trigger(x.FRAG_PARSING_USERDATA,D)}}}else this.resetWhenMissingContext(a)},i._bufferInitSegment=function(e,t,i,n){var r=this;if(this.state===Hn.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var a=t.audio,s=t.video,o=t.audiovideo;if(a){var l=e.audioCodec,u=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");var c=a.metadata;c&&"channelCount"in c&&1!==(c.channelCount||1)&&-1===u.indexOf("firefox")&&(l="mp4a.40.5")}l&&-1!==l.indexOf("mp4a.40.5")&&-1!==u.indexOf("android")&&"audio/mpeg"!==a.container&&(l="mp4a.40.2",this.log("Android: force audio codec to "+l)),e.audioCodec&&e.audioCodec!==l&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+l+'"'),a.levelCodec=l,a.id="main",this.log("Init audio buffer, container:"+a.container+", codecs[selected/level/parsed]=["+(l||"")+"/"+(e.audioCodec||"")+"/"+a.codec+"]")}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log("Init video buffer, container:"+s.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+s.codec+"]")),o&&this.log("Init audiovideo buffer, container:"+o.container+", codecs[level/parsed]=["+e.codecs+"/"+o.codec+"]"),this.hls.trigger(x.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var a=t[e],s=a.initSegment;null!=s&&s.byteLength&&r.hls.trigger(x.BUFFER_APPENDING,{type:e,data:s,frag:i,part:null,chunkMeta:n,parent:i.type})})),this.tickImmediate()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,kt.MAIN)},i.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Hn.IDLE},i.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var i=e.currentTime;if(Di.isBuffered(e,i)?t=this.getAppendedFrag(i):Di.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;var n=this.fragPlaying,r=t.level;n&&t.sn===n.sn&&n.level===r||(this.fragPlaying=t,this.hls.trigger(x.FRAG_CHANGED,{frag:t}),n&&n.level===r||this.hls.trigger(x.LEVEL_SWITCHED,{level:r}))}}},o(t,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,i=this.currentFrag;if(i&&S(t)&&S(i.programDateTime)){var n=i.programDateTime+1e3*(t-i.start);return new Date(n)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(Kn),_a=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new ga,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,G(t.debug||!1,"Hls instance");var i=this.config=dn(e.DefaultConfig,t);this.userConfig=t,i.progressive&&fn(i);var n=i.abrController,r=i.bufferController,a=i.capLevelController,s=i.errorController,o=i.fpsController,l=new s(this),u=this.abrController=new n(this),c=this.bufferController=new r(this),d=this.capLevelController=new a(this),h=new o(this),f=new wt(this),m=new Nt(this),p=i.contentSteeringController,v=p?new p(this):null,g=this.levelController=new mn(this,v),y=new gn(this),b=new Rn(this.config),L=this.streamController=new Xa(this,y,b);d.setStreamController(L),h.setStreamController(L);var S=[f,g,L];v&&S.splice(1,0,v),this.networkControllers=S;var T=[u,c,d,h,m,y];this.audioTrackController=this.createController(i.audioTrackController,S);var k=i.audioStreamController;k&&S.push(new k(this,y,b)),this.subtitleTrackController=this.createController(i.subtitleTrackController,S);var R=i.subtitleStreamController;R&&S.push(new R(this,y,b)),this.createController(i.timelineController,T),b.emeController=this.emeController=this.createController(i.emeController,T),this.cmcdController=this.createController(i.cmcdController,T),this.latencyController=this.createController(Ft,T),this.coreComponents=T,S.push(l);var w=l.onErrorOut;"function"===typeof w&&this.on(x.ERROR,w,l)}e.isMSESupported=function(){return Bn()},e.isSupported=function(){return zn()},e.getMediaSource=function(){return Be()};var t=e.prototype;return t.createController=function(e,t){if(e){var i=new e(this);return t&&t.push(i),i}return null},t.on=function(e,t,i){void 0===i&&(i=this),this._emitter.on(e,t,i)},t.once=function(e,t,i){void 0===i&&(i=this),this._emitter.once(e,t,i)},t.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},t.off=function(e,t,i,n){void 0===i&&(i=this),this._emitter.off(e,t,i,n)},t.listeners=function(e){return this._emitter.listeners(e)},t.emit=function(e,t,i){return this._emitter.emit(e,t,i)},t.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(X.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;var i=e===x.ERROR;this.trigger(x.ERROR,{type:R.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1},t.listenerCount=function(e){return this._emitter.listenerCount(e)},t.destroy=function(){X.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},t.attachMedia=function(e){X.log("attachMedia"),this._media=e,this.trigger(x.MEDIA_ATTACHING,{media:e})},t.detachMedia=function(){X.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function(e){this.stopLoad();var t=this.media,i=this.url,n=this.url=L.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,X.log("loadSource:"+n),t&&i&&(i!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(x.MANIFEST_LOADING,{url:e})},t.startLoad=function(e){void 0===e&&(e=-1),X.log("startLoad("+e+")"),this.started=!0,this.networkControllers.forEach((function(t){t.startLoad(e)}))},t.stopLoad=function(){X.log("stopLoad"),this.started=!1,this.networkControllers.forEach((function(e){e.stopLoad()}))},t.resumeBuffering=function(){this.started&&this.networkControllers.forEach((function(e){"fragmentLoader"in e&&e.startLoad(-1)}))},t.pauseBuffering=function(){this.networkControllers.forEach((function(e){"fragmentLoader"in e&&e.stopLoad()}))},t.swapAudioCodec=function(){X.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function(){X.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},t.removeLevel=function(e){this.levelController.removeLevel(e)},t.setAudioOption=function(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)},t.setSubtitleOption=function(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null},o(e,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){X.log("set currentLevel:"+e),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){X.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){X.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){X.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){var e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e},set:function(e){X.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(X.log("set autoLevelCapping:"+e),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN},set:function(e){this.abrController.resetEstimator(e)}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){Yt(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var i=e.length,n=0;n<i;n++)if(e[n].maxBitrate>=t)return n;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,i=this.autoLevelCapping,n=this.maxHdcpLevel;if(e=-1===i&&null!=t&&t.length?t.length-1:i,n)for(var r=e;r--;){var a=t[r].attrs["HDCP-LEVEL"];if(a&&a<=n)return r}return e}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(e){this.abrController.nextAutoLevel=e}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"allAudioTracks",get:function(){var e=this.audioTrackController;return e?e.allAudioTracks:[]}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"allSubtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.5.13"}},{key:"Events",get:function(){return x}},{key:"ErrorTypes",get:function(){return R}},{key:"ErrorDetails",get:function(){return w}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:un},set:function(t){e.defaultConfig=t}}]),e}();return _a.defaultConfig=void 0,_a}))})(!1)},"5a34":function(e,t,i){var n=i("da84"),r=i("44e7"),a=n.TypeError;e.exports=function(e){if(r(e))throw a("The method doesn't accept regular expressions");return e}},"6bd7":function(e,t,i){"use strict";var n=i("9f55"),r=a(n);function a(e){return e&&e.__esModule?e:{default:e}}e.exports=r.default},"7f62":function(e,t,i){},8248:function(e,t,i){"use strict";i.r(t);var n={};i.r(n),i.d(n,"ABORT",(function(){return Se})),i.d(n,"AFTER_DEFINITION_CHANGE",(function(){return Ye})),i.d(n,"AUTOPLAY_PREVENTED",(function(){return Ze})),i.d(n,"AUTOPLAY_STARTED",(function(){return Ee})),i.d(n,"BEFORE_DEFINITION_CHANGE",(function(){return Ae})),i.d(n,"BUFFER_CHANGE",(function(){return Te})),i.d(n,"CANPLAY",(function(){return ue})),i.d(n,"CANPLAY_THROUGH",(function(){return ce})),i.d(n,"COMPLETE",(function(){return Ce})),i.d(n,"CSS_FULLSCREEN_CHANGE",(function(){return Ve})),i.d(n,"DEFINITION_CHANGE",(function(){return Fe})),i.d(n,"DESTROY",(function(){return Me})),i.d(n,"DOWNLOAD_SPEED_CHANGE",(function(){return Xe})),i.d(n,"DURATION_CHANGE",(function(){return de})),i.d(n,"EMPTIED",(function(){return ye})),i.d(n,"ENDED",(function(){return ie})),i.d(n,"ENTER_PLAYER",(function(){return Pe})),i.d(n,"ERROR",(function(){return re})),i.d(n,"FPS_STUCK",(function(){return at})),i.d(n,"FULLSCREEN_CHANGE",(function(){return We})),i.d(n,"LEAVE_PLAYER",(function(){return _e})),i.d(n,"LOADED_DATA",(function(){return fe})),i.d(n,"LOADED_METADATA",(function(){return me})),i.d(n,"LOADING",(function(){return De})),i.d(n,"LOAD_START",(function(){return ge})),i.d(n,"MINI_STATE_CHANGE",(function(){return Ne})),i.d(n,"PAUSE",(function(){return ne})),i.d(n,"PIP_CHANGE",(function(){return Ue})),i.d(n,"PLAY",(function(){return ee})),i.d(n,"PLAYER_BLUR",(function(){return xe})),i.d(n,"PLAYER_FOCUS",(function(){return ke})),i.d(n,"PLAYING",(function(){return te})),i.d(n,"PLAYNEXT",(function(){return je})),i.d(n,"PROGRESS",(function(){return ve})),i.d(n,"RATE_CHANGE",(function(){return pe})),i.d(n,"READY",(function(){return Re})),i.d(n,"REPLAY",(function(){return Ie})),i.d(n,"RESET",(function(){return $e})),i.d(n,"RETRY",(function(){return He})),i.d(n,"ROTATE",(function(){return Be})),i.d(n,"SCREEN_SHOT",(function(){return ze})),i.d(n,"SEEKED",(function(){return se})),i.d(n,"SEEKING",(function(){return ae})),i.d(n,"SEI_PARSED",(function(){return Oe})),i.d(n,"SHORTCUT",(function(){return Je})),i.d(n,"SOURCE_ERROR",(function(){return et})),i.d(n,"SOURCE_SUCCESS",(function(){return tt})),i.d(n,"STALLED",(function(){return be})),i.d(n,"STATS_EVENTS",(function(){return rt})),i.d(n,"SUSPEND",(function(){return Le})),i.d(n,"SWITCH_SUBTITLE",(function(){return it})),i.d(n,"TIME_UPDATE",(function(){return oe})),i.d(n,"URL_CHANGE",(function(){return Ge})),i.d(n,"URL_NULL",(function(){return we})),i.d(n,"USER_ACTION",(function(){return qe})),i.d(n,"VIDEO_EVENTS",(function(){return nt})),i.d(n,"VIDEO_RESIZE",(function(){return Ke})),i.d(n,"VOLUME_CHANGE",(function(){return he})),i.d(n,"WAITING",(function(){return le})),i.d(n,"XGLOG",(function(){return Qe}));var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"home scrollbar"},[i("van-nav-bar",{attrs:{title:e.detailData.videoTitle,"left-text":"","left-arrow":"",fixed:"","safe-area-inset-top":"",placeholder:""},on:{"click-left":e.onClickLeft},scopedSlots:e._u([{key:"right",fn:function(){return["0"===e.identity||"1"===e.identity?i("div",{staticStyle:{"margin-top":"5px"}},[e.detailData.show?i("van-icon",{staticStyle:{"margin-right":"10px"},attrs:{name:"eye",size:"18"},on:{click:e.hideResData}}):i("van-icon",{staticStyle:{"margin-right":"10px"},attrs:{name:"closed-eye",size:"18"},on:{click:e.show}}),e.detailData.ishot?i("van-icon",{staticStyle:{"margin-right":"10px"},attrs:{name:"ascending",size:"18"},on:{click:e.canceltopResData}}):i("van-icon",{staticStyle:{"margin-right":"10px"},attrs:{name:"descending",size:"18"},on:{click:e.topResData}})],1):e._e(),"2"===e.identity&&e.detailData.author.objectId===e.UserId?i("div",{staticStyle:{"margin-top":"5px"}},[e.detailData.show?i("van-icon",{staticStyle:{"margin-right":"10px"},attrs:{name:"eye",size:"18"},on:{click:e.hideResData}}):i("van-icon",{staticStyle:{"margin-right":"10px"},attrs:{name:"closed-eye",size:"18"},on:{click:e.show}})],1):e._e(),e.checkactions?i("van-popover",{attrs:{trigger:"click",actions:e.actions,placement:"left-start"},on:{select:e.onSelect},scopedSlots:e._u([{key:"reference",fn:function(){return[i("van-icon",{staticStyle:{"margin-top":"5px"},attrs:{name:"ellipsis",size:"18"}})]},proxy:!0}],null,!1,328765880),model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}}):e._e()]},proxy:!0}])}),i("div",{staticStyle:{height:"calc(100% - 46px)"}},[e.isloading||e.isError?i("div",{staticClass:"center-layout"},[e.isloading?i("van-loading",{staticClass:"center",attrs:{color:"#cccccc"}}):e._e(),e.isError?i("van-empty",{attrs:{image:"network",description:""}},[i("van-button",{staticClass:"bottom-button",attrs:{round:"",color:"#f38aa7"},on:{click:e.getResData}},[e._v("")])],1):e._e()],1):i("div",{staticClass:"content"},[i("div",{attrs:{id:"mse"}}),i("div",{staticClass:"content-1",domProps:{innerHTML:e._s(e.detailData.videoContent)},on:{click:e.openImage}})])]),i("van-overlay",{attrs:{show:e.showoverlay}},[i("div",{staticClass:"wrapper",on:{click:function(e){e.stopPropagation()}}},[e.showloading?i("van-loading",{attrs:{color:"#ff8000",vertical:""}},[e._v("")]):e._e()],1)]),i("van-share-sheet",{attrs:{title:"",options:e.options},on:{select:e.onShareSelect},model:{value:e.showShare,callback:function(t){e.showShare=t},expression:"showShare"}})],1)},a=[],s=i("1da1"),o=(i("96cf"),i("caad"),i("2532"),i("e9c4"),i("d3b7"),i("ac1f"),i("5319"),i("28a2"));function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){m(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,M(n.key),n)}}function f(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t,i){return t=M(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function p(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function S(e){var t=y();return function(){var i,n=v(e);if(t){var r=v(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return L(this,i)}}function T(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=v(e),null===e)break;return e}function k(){return k="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=T(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},k.apply(this,arguments)}function x(e){return R(e)||w(e)||E(e)||C()}function R(e){if(Array.isArray(e))return Z(e)}function w(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function E(e,t){if(e){if("string"===typeof e)return Z(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function C(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function M(e){var t=I(e,"string");return"symbol"===typeof t?t:String(t)}var G=i("ba10"),X=i.n(G),_="undefined"!==typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,P={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},D="%c[xgplayer]",W={config:{debug:_?3:0},logInfo:function(e){for(var t,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];this.config.debug>=3&&(t=console).log.apply(t,[D,P.info,e].concat(n))},logWarn:function(e){for(var t,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];this.config.debug>=1&&(t=console).warn.apply(t,[D,P.warn,e].concat(n))},logError:function(e){var t;if(!(this.config.debug<1)){for(var i=this.config.debug>=2?"trace":"error",n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=console)[i].apply(t,[D,P.error,e].concat(r))}}};function V(e){e.logInfo=W.logInfo.bind(e),e.logWarn=W.logWarn.bind(e),e.logError=W.logError.bind(e)}var N=function(){function e(t){d(this,e),this.bufferedList=t}return f(e,[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}]),e}(),F={};function A(e,t){for(var i=0,n=t.length;i<n;i++)if(e.indexOf(t[i])>-1)return!0;return!1}function Y(e){var t=c(e);return null!==e&&("object"===t||"function"===t)}function O(e,t,i){var n,r,a,s,o,l,u=0,c=!1,d=!1,h=!0,f=!t&&0!==t&&"function"===typeof window.requestAnimationFrame;if("function"!==typeof e)throw new TypeError("Expected a function");function m(t){var i=n,a=r;return n=r=void 0,u=t,s=e.apply(a,i),s}function p(e,t){return f?(window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function v(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}function g(e){return u=e,o=p(L,t),c?m(e):s}function y(e){var i=e-l,n=e-u,r=t-i;return d?Math.min(r,a-n):r}function b(e){var i=e-l,n=e-u;return void 0===l||i>=t||i<0||d&&n>=a}function L(){var e=Date.now();if(b(e))return S(e);o=p(L,y(e))}function S(e){return o=void 0,h&&n?m(e):(n=r=void 0,s)}function T(){void 0!==o&&v(o),u=0,n=l=r=o=void 0}function k(){return void 0===o?s:S(Date.now())}function x(){return void 0!==o}function R(){for(var e=Date.now(),i=b(e),a=arguments.length,u=new Array(a),c=0;c<a;c++)u[c]=arguments[c];if(n=u,r=this,l=e,i){if(void 0===o)return g(l);if(d)return o=p(L,t),m(l)}return void 0===o&&(o=p(L,t)),s}return t=+t||0,Y(i)&&(c=!!i.leading,d="maxWait"in i,a=d?Math.max(+i.maxWait||0,t):a,h="trailing"in i?!!i.trailing:h),R.cancel=T,R.flush=k,R.pending=x,R}function H(e,t,i){var n=!0,r=!0;if("function"!==typeof e)throw new TypeError("Expected a function");return Y(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),O(e,t,{leading:n,trailing:r,maxWait:t})}function K(){var e=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return"zh-cn"===e&&(e="zh"),e}function U(e,t,i){if(e){var n=e.getAttribute(i);return!(!n||n!==t||"VIDEO"!==e.tagName&&"AUDIO"!==e.tagName)}}F.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=document.createElement(e);return r.className=n,r.innerHTML=t,Object.keys(i).forEach((function(t){var n=t,a=i[t];"video"===e||"audio"===e||"live-video"===e?a&&r.setAttribute(n,a):r.setAttribute(n,a)})),r},F.createDomFromHtml=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var n=document.createElement("div");n.innerHTML=e;var r=n.children;return n=null,r.length>0?(r=r[0],i&&F.addClass(r,i),t&&Object.keys(t).forEach((function(e){r.setAttribute(e,t[e])})),r):null}catch(a){return W.logError("util.createDomFromHtml",a),null}},F.hasClass=function(e,t){if(!e||!t)return!1;try{return Array.prototype.some.call(e.classList,(function(e){return e===t}))}catch(n){var i=e.className&&"object"===c(e.className)?e.getAttribute("class"):e.className;return i&&!!i.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}},F.addClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)}))}catch(i){F.hasClass(e,t)||(e.className&&"object"===c(e.className)?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t)}},F.removeClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.remove(t)}))}catch(i){F.hasClass(e,t)&&t.split(/\s+/g).forEach((function(t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===c(e.className)?e.setAttribute("class",e.getAttribute("class").replace(i," ")):e.className=e.className.replace(i," ")}))}},F.toggleClass=function(e,t){e&&t.split(/\s+/g).forEach((function(t){F.hasClass(e,t)?F.removeClass(e,t):F.addClass(e,t)}))},F.classNames=function(){for(var e=arguments,t=[],i=function(i){"String"===F.typeOf(e[i])?t.push(e[i]):"Object"===F.typeOf(e[i])&&Object.keys(e[i]).map((function(n){e[i][n]&&t.push(n)}))},n=0;n<arguments.length;n++)i(n);return t.join(" ")},F.findDom=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,i=arguments.length>1?arguments[1]:void 0;try{e=t.querySelector(i)}catch(n){W.logError("util.findDom",n),0===i.indexOf("#")&&(e=t.getElementById(i.slice(1)))}return e},F.getCss=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},F.padStart=function(e,t,i){var n=String(i),r=t>>0,a=Math.ceil(r/n.length),s=[],o=String(e);while(a--)s.push(n);return s.join("").substring(0,r-o.length)+o},F.format=function(e){if(window.isNaN(e))return"";e=Math.round(e);var t=F.padStart(Math.floor(e/3600),2,0),i=F.padStart(Math.floor((e-3600*t)/60),2,0),n=F.padStart(Math.floor(e-3600*t-60*i),2,0);return("00"===t?[i,n]:[t,i,n]).join(":")},F.event=function(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},F.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},F.deepCopy=function(e,t){if("Object"===F.typeOf(t)&&"Object"===F.typeOf(e))return Object.keys(t).forEach((function(i){"Object"!==F.typeOf(t[i])||t[i]instanceof Node?"Array"===F.typeOf(t[i])?e[i]="Array"===F.typeOf(e[i])?e[i].concat(t[i]):t[i]:e[i]=t[i]:void 0===e[i]||void 0===e[i]?e[i]=t[i]:F.deepCopy(e[i],t[i])})),e},F.deepMerge=function(e,t){return Object.keys(t).map((function(i){var n;"Array"===F.typeOf(t[i])&&"Array"===F.typeOf(e[i])?"Array"===F.typeOf(e[i])&&(n=e[i]).push.apply(n,x(t[i])):F.typeOf(e[i])!==F.typeOf(t[i])||null===e[i]||"Object"!==F.typeOf(e[i])||t[i]instanceof window.Node?null!==t[i]&&(e[i]=t[i]):F.deepMerge(e[i],t[i])})),e},F.getBgImage=function(e){var t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";var i=document.createElement("a");return i.href=t.replace(/url\("|"\)/g,""),i.href},F.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},F.setInterval=function(e,t,i,n){e._interval[t]||(e._interval[t]=window.setInterval(i.bind(e),n))},F.clearInterval=function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},F.setTimeout=function(e,t,i){e._timers||(e._timers=[]);var n=setTimeout((function(){t(),F.clearTimeout(e,n)}),i);return e._timers.push(n),n},F.clearTimeout=function(e,t){var i=e._timers;if("Array"===F.typeOf(i)){for(var n=0;n<i.length;n++)if(i[n]===t){i.splice(n,1),clearTimeout(t);break}}else clearTimeout(t)},F.clearAllTimers=function(e){var t=e._timers;"Array"===F.typeOf(t)&&(t.map((function(e){clearTimeout(e)})),e._timerIds=[])},F.createImgBtn=function(e,t,i,n){var r,a,s,o=F.createDom("xg-".concat(e),"",{},"xgplayer-".concat(e,"-img"));(o.style.backgroundImage='url("'.concat(t,'")'),i&&n)&&(["px","rem","em","pt","dp","vw","vh","vm","%"].every((function(e){return!(i.indexOf(e)>-1&&n.indexOf(e)>-1)||(r=parseFloat(i.slice(0,i.indexOf(e)).trim()),a=parseFloat(n.slice(0,n.indexOf(e)).trim()),s=e,!1)})),o.style.width="".concat(r).concat(s),o.style.height="".concat(a).concat(s),o.style.backgroundSize="".concat(r).concat(s," ").concat(a).concat(s),o.style.margin="start"===e?"-".concat(a/2).concat(s," auto auto -").concat(r/2).concat(s):"auto 5px auto 5px");return o},F.Hex2RGBA=function(e,t){var i=[];if(/^\#[0-9A-F]{3}$/i.test(e)){var n="#";e.replace(/[0-9A-F]/gi,(function(e){n+=e+e})),e=n}return/^#[0-9A-F]{6}$/i.test(e)?(e.replace(/[0-9A-F]{2}/gi,(function(e){i.push(parseInt(e,16))})),"rgba(".concat(i.join(","),", ").concat(t,")")):"rgba(255, 255, 255, 0.1)"},F.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},F.checkIsFunction=function(e){return e&&"function"===typeof e},F.checkIsObject=function(e){return null!==e&&"object"===c(e)},F.hide=function(e){e.style.display="none"},F.show=function(e,t){e.style.display=t||"block"},F.isUndefined=function(e){if("undefined"===typeof e||null===e)return!0},F.isNotNull=function(e){return!(void 0===e||null===e)},F.setStyleFromCsstext=function(e,t){if(t)if("String"===F.typeOf(t)){var i=t.replace(/\s+/g,"").split(";");i.map((function(t){if(t){var i=t.split(":");i.length>1&&(e.style[i[0]]=i[1])}}))}else Object.keys(t).map((function(i){e.style[i]=t[i]}))},F.filterStyleFromText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],i=e.style.cssText;if(!i)return{};var n=i.replace(/\s+/g,"").split(";"),r={},a={};return n.map((function(e){if(e){var i=e.split(":");i.length>1&&(A(i[0],t)?r[i[0]]=i[1]:a[i[0]]=i[1])}})),e.setAttribute("style",""),Object.keys(a).map((function(t){e.style[t]=a[t]})),r},F.getStyleFromCsstext=function(e){var t=e.style.cssText;if(!t)return{};var i=t.replace(/\s+/g,"").split(";"),n={};return i.map((function(e){if(e){var t=e.split(":");t.length>1&&(n[t[0]]=t[1])}})),n},F.preloadImg=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){var n=new window.Image;n.onload=function(e){n=null,t&&t(e)},n.onerror=function(e){n=null,i&&i(e)},n.src=e}},F.stopPropagation=function(e){e&&e.stopPropagation()},F.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},F.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},F.checkTouchSupport=function(){return"ontouchstart"in window},F.getBuffered2=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=[],n=0;n<e.length;n++)i.push({start:e.start(n)<.5?0:e.start(n),end:e.end(n)});i.sort((function(e,t){var i=e.start-t.start;return i||t.end-e.end}));var r=[];if(t)for(var a=0;a<i.length;a++){var s=r.length;if(s){var o=r[s-1].end;i[a].start-o<t?i[a].end>o&&(r[s-1].end=i[a].end):r.push(i[a])}else r.push(i[a])}else r=i;return new N(r)},F.getEventPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.touches&&e.touches.length>0&&(e=e.touches[0]),{x:e.x/t,y:e.y/t,clientX:e.clientX/t,clientY:e.clientY/t,offsetX:e.offsetX/t,offsetY:e.offsetY/t,pageX:e.pageX/t,pageY:e.pageY/t}},F.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t(e)},F.getHostFromUrl=function(e){if("String"!==F.typeOf(e))return"";var t=e.split("/"),i="";return t.length>3&&t[2]&&(i=t[2]),i},F.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;t&&t(e)},F.isMSE=function(e){return e.media&&(e=e.media),!!(e&&e instanceof HTMLMediaElement)&&(/^blob/.test(e.currentSrc)||/^blob/.test(e.src))},F.isBlob=function(e){return"string"===typeof e&&/^blob/.test(e)},F.generateSessionId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(new Date).getTime();try{e=parseInt(e)}catch(n){e=0}t+=e,window.performance&&"function"===typeof window.performance.now&&(t+=parseInt(window.performance.now()));var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)}));return i},F.createEvent=function(e){var t;return"function"===typeof window.Event?t=new Event(e):(t=document.createEvent("Event"),t.initEvent(e,!0,!0)),t},F.adjustTimeByDuration=function(e,t,i){return t&&e&&(e>t||i&&e<t)?t:e},F.createPositionBar=function(e,t){var i=F.createDom("xg-bar","",{"data-index":-1},e);return t.appendChild(i),i},F.getTransformStyle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,scale:1,rotate:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i={scale:"".concat(e.scale||1),translate:"".concat(e.x||0,"%, ").concat(e.y||0,"%"),rotate:"".concat(e.rotate||0,"deg")},n=Object.keys(i);return n.forEach((function(e){var n=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),r="".concat(e,"(").concat(i[e],")");n.test(t)?(n.lastIndex=-1,t=t.replace(n,r)):t+="".concat(r," ")})),t},F.convertDeg=function(e){return Math.abs(e)<=1?360*e:e%360},F.getIndexByTime=function(e,t){var i=t.length,n=-1;if(i<1)return n;if(e<=t[0].end||i<2)n=0;else if(e>t[i-1].end)n=i-1;else for(var r=1;r<i;r++)if(e>t[r-1].end&&e<=t[r].end){n=r;break}return n},F.getOffsetCurrentTime=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=-1;if(n=i>=0&&i<t.length?i:F.getIndexByTime(e,t),n<0)return-1;var r=t.length,a=t[n],s=a.start,o=a.end,l=a.cTime,u=a.offset;return e<s?l:e>=s&&e<=o?e-u:e>o&&n>=r-1?o:-1},F.getCurrentTimeByOffset=function(e,t){var i=-1;if(!t||t.length<0)return e;for(var n=0;n<t.length;n++)if(e<=t[n].duration){i=n;break}if(-1!==i){var r=t[i].start;return i-1<0?r+e:r+(e-t[i-1].duration)}return e};var B={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},z=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],j={get device(){var e=j.os;return e.isPc?"pc":"mobile"},get browser(){if("undefined"===typeof navigator)return"";var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(i){return t[i].test(e)})))[0]},get os(){if("undefined"===typeof navigator)return{};var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,s=a||n&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!s,l=!o&&!n&&!i&&!s;return{isTablet:s,isPhone:o,isIpad:a,isIos:o||a,isAndroid:n,isPc:l,isSymbian:i,isWindowsPhone:t,isFireFox:r}},get osVersion(){if("undefined"===typeof navigator)return 0;var e=navigator.userAgent,t="";t=/(?:iPhone)|(?:iPad|PlayBook)/.test(e)?B.ios:B.android;var i=t?t.exec(e):[];if(i&&i.length>=3){var n=i[2].split(".");return n.length>0?parseInt(n[0]):0}return 0},get isWeixin(){if("undefined"===typeof navigator)return!1;var e=/(micromessenger)\/([\d.]+)/,t=e.exec(navigator.userAgent.toLocaleLowerCase());return!!t},isSupportMP4:function(){var e={isSupport:!1,mime:""};if("undefined"===typeof document)return e;if(this.supportResult)return this.supportResult;var t=document.createElement("video");return"function"===typeof t.canPlayType&&z.map((function(i){"probably"===t.canPlayType('video/mp4; codecs="'.concat(i,'"'))&&(e.isSupport=!0,e.mime+="||".concat(i))})),this.supportResult=e,t=null,e},isMSESupport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if("undefined"===typeof MediaSource||!MediaSource)return!1;try{return MediaSource.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}},isHevcSupported:function(){return!("undefined"===typeof MediaSource||!MediaSource.isTypeSupported)&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))},probeConfigSupported:function(e){var t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||"undefined"===typeof navigator)return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);var i=e.video||{},n=e.audio||{};try{var r=MediaSource.isTypeSupported(i.contentType),a=MediaSource.isTypeSupported(n.contentType);return Promise.resolve({supported:r&&a,smooth:!1,powerEfficient:!1})}catch(s){return Promise.resolve(t)}}},J="3.0.19",Q={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},q={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},$=f((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};d(this,e);var n=t&&t.i18n?t.i18n.ERROR_TYPES:null;if(t.media){var r=i.mediaError?i.mediaError:t.media.error||{},a=t.duration,s=t.currentTime,o=t.ended,l=t.src,u=t.currentSrc,c=t.media,h=c.readyState,f=c.networkState,m=i.errorCode||r.code;q[m]&&(m=q[m]);var p={playerVersion:J,currentTime:s,duration:a,ended:o,readyState:h,networkState:f,src:l||u,errorType:i.errorType,errorCode:m,message:i.errorMessage||r.message,mediaError:r,originError:i.originError?i.originError.stack:"",host:F.getHostFromUrl(l||u)};return i.ext&&Object.keys(i.ext).map((function(e){p[e]=i.ext[e]})),p}if(arguments.length>1){for(var v={playerVersion:J,domain:document.domain},g=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],y=0;y<arguments.length;y++)v[g[y]]=arguments[y];return v.ex=n?(n[arguments[0]]||{}).msg:"",v}})),ee="play",te="playing",ie="ended",ne="pause",re="error",ae="seeking",se="seeked",oe="timeupdate",le="waiting",ue="canplay",ce="canplaythrough",de="durationchange",he="volumechange",fe="loadeddata",me="loadedmetadata",pe="ratechange",ve="progress",ge="loadstart",ye="emptied",be="stalled",Le="suspend",Se="abort",Te="bufferedChange",ke="focus",xe="blur",Re="ready",we="urlNull",Ee="autoplay_started",Ze="autoplay_was_prevented",Ce="complete",Ie="replay",Me="destroy",Ge="urlchange",Xe="download_speed_change",_e="leaveplayer",Pe="enterplayer",De="loading",We="fullscreen_change",Ve="cssFullscreen_change",Ne="mini_state_change",Fe="definition_change",Ae="before_definition_change",Ye="after_definition_change",Oe="SEI_PARSED",He="retry",Ke="video_resize",Ue="pip_change",Be="rotate",ze="screenShot",je="playnext",Je="shortcut",Qe="xglog",qe="user_action",$e="reset",et="source_error",tt="source_success",it="switch_subtitle",nt=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],rt={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},at="fps_stuck";function st(e,t){this&&this.emit&&("error"===e?this.errorHandler(e,t.error):this.emit(e,t))}function ot(e,t){return function(i,n){var r={player:t,eventName:e,originalEvent:i,detail:i.detail||{},timeStamp:i.timeStamp,currentTime:t.currentTime,duration:t.duration,paused:t.paused,ended:t.ended,isInternalOp:!!t._internalOp[i.type],muted:t.muted,volume:t.volume,host:F.getHostFromUrl(t.currentSrc),vtype:t.vtype};if(t.removeInnerOP(i.type),"timeupdate"===e&&(t._currentTime=t.media&&t.media.currentTime),"ratechange"===e){var a=t.media?t.media.playbackRate:0;if(a&&t._rate===a)return;t._rate=t.media&&t.media.playbackRate}if("durationchange"===e&&(t._duration=t.media.duration),"volumechange"===e&&(r.isMutedChange=t._lastMuted!==t.muted,t._lastMuted=t.muted),"error"===e&&(r.error=n||t.video.error),t.mediaEventMiddleware[e]){var s=st.bind(t,e,r);try{t.mediaEventMiddleware[e].call(t,r,s)}catch(o){throw st.call(t,e,r),o}}else st.call(t,e,r)}}var lt=function(e){p(i,e);var t=S(i);function i(e){var n;d(this,i),n=t.call(this,e),n._hasStart=!1,n._currentTime=0,n._duration=0,n._internalOp={},n._lastMuted=!1,n.vtype="MP4",n._rate=-1,n.mediaConfig=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:0|e.tabindex,mediaType:e.mediaType||"video","data-index":-1},e.videoConfig,e.videoAttributes);var r=e["x5-video-player-type"]||e.x5VideoPlayerType;return j.isWeixin&&j.os.isAndroid&&r&&(n.mediaConfig["x5-video-player-type"]=r,delete n.mediaConfig.playsinline,delete n.mediaConfig["webkit-playsinline"],delete n.mediaConfig["x5-playsinline"]),e.loop&&(n.mediaConfig.loop="loop"),e.autoplayMuted&&!Object.prototype.hasOwnProperty.call(n.mediaConfig,"muted")&&(n.mediaConfig.muted=!0),n.media=F.createDom(n.mediaConfig.mediaType,"",n.mediaConfig,""),e.defaultPlaybackRate&&(n.media.defaultPlaybackRate=n.media.playbackRate=e.defaultPlaybackRate),"Number"===F.typeOf(e.volume)&&(n.volume=e.volume),e.autoplayMuted&&(n.media.muted=!0,n._lastMuted=!0),e.autoplay&&(n.media.autoplay=!0),n._interval={},n.mediaEventMiddleware={},n.attachVideoEvents(),n}return f(i,[{key:"setEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(i){t.mediaEventMiddleware[i]=e[i]}))}},{key:"removeEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(e){delete t.mediaEventMiddleware[e]}))}},{key:"attachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers||(this._evHandlers=nt.map((function(t){var i="on".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));return"function"===typeof e[i]&&e.on(t,e[i]),m({},t,ot(t,e))}))),this._evHandlers.forEach((function(e){var i=Object.keys(e)[0];t.addEventListener(i,e[i],!1)}))}},{key:"detachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers.forEach((function(e){var i=Object.keys(e)[0];t.removeEventListener(i,e[i],!1)})),this._evHandlers.forEach((function(t){var i=Object.keys(t)[0],n="on".concat(i.charAt(0).toUpperCase()).concat(i.slice(1));"function"===typeof e[n]&&e.off(i,e[n])})),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,t){var i=this;e.removeAttribute("src"),e.load(),t.forEach((function(e,t){i.media.appendChild(F.createDom("source","",{src:"".concat(e.src),type:"".concat(e.type||""),"data-index":t+1}))}));var n=e.children;if(n){this._videoSourceCount=n.length,this._videoSourceIndex=n.length,this._vLoadeddata=function(e){i.emit(tt,{src:e.target.currentSrc,host:F.getHostFromUrl(e.target.currentSrc)})};for(var r=null,a=0;a<this._evHandlers.length;a++)if("error"===Object.keys(this._evHandlers[a])[0]){r=this._evHandlers[a];break}!this._sourceError&&(this._sourceError=function(e){var t=parseInt(e.target.getAttribute("data-index"),10);if(i._videoSourceIndex--,0===i._videoSourceIndex||t>=i._videoSourceCount){var n={code:4,message:"sources_load_error"};r?r.error(e,n):i.errorHandler("error",n)}var a=Q[4];i.emit(et,new $(i,{errorType:a,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:e.target.src}))});for(var s=0;s<n.length;s++)n[s].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var t=e.children;if(t&&0!==t.length&&this._sourceError){for(var i=0;i<t.length;i++)t[i].removeEventListener("error",this._sourceError);while(t.length>0)e.removeChild(t[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.media&&(this.media.error||t)){var i=this.media.error||t,n=i.code?Q[i.code]:"other",r=i.message;this.media.currentSrc||(r="empty_src",i={code:6,message:r}),this.emit(e,new $(this,{errorType:n,errorCode:i.code,errorMessage:i.message||"",mediaError:i}))}}},{key:"destroy",value:function(){for(var e in this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null,this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return!!this.media&&this.media.canPlayType(e)}},{key:"getBufferedRange",value:function(e){var t=[0,0];if(!this.media)return t;e||(e=this.media.buffered);var i=this.media.currentTime;if(e)for(var n=0,r=e.length;n<r;n++)if(t[0]=e.start(n),t[1]=e.end(n),t[0]<=i&&i<=t[1])break;return t[0]-i<=0&&i-t[1]<=0?t:[0,0]}},{key:"autoplay",get:function(){return!!this.media&&this.media.autoplay},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?F.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var t=this.media.buffered;if(!t||0===t.length)return e;for(var i=0;i<t.length;i++)if((t.start(i)<=this.currentTime||t.start(i)<.1)&&t.end(i)>=this.currentTime)return{start:t.start(i),end:t.end(i)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?void 0!==this.media.currentTime?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return!!this.media&&this.media.defaultMuted},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return!!this.media&&this.media.ended}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var t=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return t[this.media.error.code-1]}},{key:"loop",get:function(){return!!this.media&&this.media.loop},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return!!this.media&&this.media.muted},set:function(e){this.media&&this.media.muted!==e&&(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return!this.media||this.media.paused}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){this.media&&e!==1/0&&(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return!!this.media&&this.media.preload},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return!!this.media&&this.media.seekable}},{key:"seeking",get:function(){return!!this.media&&this.media.seeking}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){this.media&&(this.emit(Ge,e),this.emit(le),this._currentTime=0,this._duration=0,F.isMSE(this.media)?this.onWaiting():(this._detachSourceEvents(this.media),"Array"===F.typeOf(e)?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()))}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e!==1/0&&this.media&&(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];(n=k(v(i.prototype),"emit",this)).call.apply(n,[this,e,t].concat(a))}},{key:"on",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];(n=k(v(i.prototype),"on",this)).call.apply(n,[this,e,t].concat(a))}},{key:"once",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];(n=k(v(i.prototype),"once",this)).call.apply(n,[this,e,t].concat(a))}},{key:"off",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];(n=k(v(i.prototype),"off",this)).call.apply(n,[this,e,t].concat(a))}},{key:"offAll",value:function(){k(v(i.prototype),"removeAllListeners",this).call(this)}}]),i}(X.a),ut=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};d(this,e),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=t}return f(e,[{key:"openDB",value:function(e){var t=this,i=this,n=this.myDB.version||1,r=i.indexedDB.open(i.myDB.name,n);r.onerror=function(e){},r.onsuccess=function(n){t.myDB.db=n.target.result,e.call(i)},r.onupgradeneeded=function(e){var t=e.target.result;e.target.transaction,t.objectStoreNames.contains(i.myDB.ojstore.name)||t.createObjectStore(i.myDB.ojstore.name,{keyPath:i.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var e=this;e.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(e,t){for(var i,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),r=0;r<t.length;r++)i=n.add(t[r]),i.onerror=function(){},i.onsuccess=function(){}}},{key:"putData",value:function(e,t){for(var i,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),r=0;r<t.length;r++)i=n.put(t[r]),i.onerror=function(){},i.onsuccess=function(){}}},{key:"getDataByKey",value:function(e,t,i){var n=this,r=this.myDB.db.transaction(e,"readwrite").objectStore(e),a=r.get(t);a.onerror=function(){i.call(n,null)},a.onsuccess=function(e){var t=e.target.result;i.call(n,t)}}},{key:"deleteData",value:function(e,t){var i=this.myDB.db.transaction(e,"readwrite").objectStore(e);i.delete(t)}},{key:"clearData",value:function(e){var t=this.myDB.db.transaction(e,"readwrite").objectStore(e);t.clear()}}]),e}(),ct=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],dt=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],ht=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],ft="data-xgplayerid";function mt(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];var s=t.call.apply(t,[e].concat(r));i&&"function"===typeof i&&(s&&s.then?s.then((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i.call.apply(i,[e].concat(n))})):i.call.apply(i,[e].concat(r)))}function pt(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[e]&&(this.__hooks[e]=null),function(){var n=arguments,r=this;if(i.pre)try{var a;(a=i.pre).call.apply(a,[this].concat(Array.prototype.slice.call(arguments)))}catch(l){throw l.message="[pluginName: ".concat(this.pluginName,":").concat(e,":pre error] >> ").concat(l.message),l}if(this.__hooks&&this.__hooks[e])try{var s,o=(s=this.__hooks[e]).call.apply(s,[this,this].concat(Array.prototype.slice.call(arguments)));o?o.then?o.then((function(e){!1!==e&&mt.apply(void 0,[r,t,i.next].concat(x(n)))})).catch((function(e){throw e})):mt.apply(void 0,[this,t,i.next].concat(Array.prototype.slice.call(arguments))):void 0===o&&mt.apply(void 0,[this,t,i.next].concat(Array.prototype.slice.call(arguments)))}catch(l){throw l.message="[pluginName: ".concat(this.pluginName,":").concat(e,"] >> ").concat(l.message),l}else mt.apply(void 0,[this,t,i.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function vt(e,t){var i=this.__hooks;if(i)return i.hasOwnProperty(e)?(i&&(i[e]=t),!0):(console.warn("has no supported hook which name [".concat(e,"]")),!1)}function gt(e,t){var i=this.__hooks;i&&delete i[e]}function yt(e){if(this.plugins&&this.plugins[e.toLowerCase()]){for(var t=this.plugins[e.toLowerCase()],i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.useHooks&&t.useHooks.apply(t,n)}}function bt(e){if(this.plugins&&this.plugins[e.toLowerCase()]){var t=this.plugins[e.toLowerCase()];if(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.removeHooks&&t.removeHooks.apply(t,n)}}}function Lt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.__hooks={},t&&t.map((function(t){e.__hooks[t]=null})),Object.defineProperty(e,"hooks",{get:function(){return e.__hooks&&Object.keys(e.__hooks).map((function(t){if(e.__hooks[t])return t}))}})}function St(e){e.__hooks=null}function Tt(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];if(!e.__hooks||!e.__hooks[t])return i.call.apply(i,[e,e].concat(r));var s,o=(s=e.__hooks[t]).call.apply(s,[e,e].concat(r));if(o&&o.then)o.then((function(t){return!1===t?null:i.call.apply(i,[e,e].concat(r))})).catch((function(e){console.warn("[runHooks]".concat(t," reject"),e.message)}));else if(!1!==o)return i.call.apply(i,[e,e].concat(r))}function kt(e,t){W.logError("[".concat(e,"] event or callback cant be undefined or null when call ").concat(t))}var xt=function(){function e(t){d(this,e),F.checkIsFunction(this.beforeCreate)&&this.beforeCreate(t),Lt(this),this.__args=t,this.__events={},this.__onceEvents={},this.config=t.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(t)}return f(e,[{key:"beforeCreate",value:function(e){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(e){this.player=e.player,this.playerConfig=e.player&&e.player.config,this.pluginName=e.pluginName?e.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=e.player&&e.player.logger}},{key:"updateLang",value:function(e){e||(e=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var e=F.checkTouchSupport()?"touch":"mouse";return!this.playerConfig||"touch"!==this.playerConfig.domEventType&&"mouse"!==this.playerConfig.domEventType||(e=this.playerConfig.domEventType),e}},{key:"on",value:function(e,t){var i=this;e&&t&&this.player?"string"===typeof e?(this.__events[e]=t,this.player.on(e,t)):Array.isArray(e)&&e.forEach((function(e){i.__events[e]=t,i.player.on(e,t)})):kt(this.pluginName,"plugin.on(event, callback)")}},{key:"once",value:function(e,t){var i=this;e&&t&&this.player?"string"===typeof e?(this.__onceEvents[e]=t,this.player.once(e,t)):Array.isArray(e)&&e.forEach((function(n){i.__onceEvents[n]=t,i.player.once(e,t)})):kt(this.pluginName,"plugin.once(event, callback)")}},{key:"off",value:function(e,t){var i=this;e&&t&&this.player?"string"===typeof e?(delete this.__events[e],this.player.off(e,t)):Array.isArray(e)&&e.forEach((function(n){delete i.__events[e],i.player.off(n,t)})):kt(this.pluginName,"plugin.off(event, callback)")}},{key:"offAll",value:function(){var e=this;["__events","__onceEvents"].forEach((function(t){Object.keys(e[t]).forEach((function(i){e[t][i]&&e.off(i,e[t][i]),i&&delete e[t][i]}))})),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(e){var t;if(this.player){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];(t=this.player).emit.apply(t,[e].concat(n))}}},{key:"emitUserAction",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.player){var n=u(u({},i),{},{pluginName:this.pluginName});this.player.emitUserAction(e,t,n)}}},{key:"hook",value:function(e,t){return pt.call.apply(pt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return vt.call.apply(vt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return gt.call.apply(gt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.player)return i&&(t.pluginName=i),this.player.registerPlugin({plugin:e,options:t})}},{key:"getPlugin",value:function(e){return this.player?this.player.getPlugin(e):null}},{key:"__destroy",value:function(){var e=this,t=this.player,i=this.pluginName;this.offAll(),F.clearAllTimers(this),F.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((function(t){e[t]=null})),t.unRegisterPlugin(i),St(this)}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&Object.defineProperty(e,i,t[i])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),e}(),Rt=i("8c50"),wt=i.n(Rt),Et={CONTROLS:"controls",ROOT:"root"},Zt={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},Ct={ICON_DISABLE:"xg-icon-disable",ICON_HIDE:"xg-icon-hide"};function It(e){return!!e&&(e.indexOf&&/^(?:http|data:|\/)/.test(e))}function Mt(e,t){return"object"===c(e)&&e.class&&"string"===typeof e.class?"".concat(t," ").concat(e.class):t}function Gt(e,t){return"object"===c(e)&&e.attr&&"object"===c(e.attr)&&Object.keys(e.attr).map((function(i){t[i]=e.attr[i]})),t}function Xt(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=null;if(e instanceof window.Element)return F.addClass(e,i),Object.keys(n).map((function(t){e.setAttribute(t,n[t])})),e;if(It(e)||It(e.url))return n.src=It(e)?e:e.url||"",a=F.createDom(e.tag||"img","",n,"xg-img ".concat(i)),a;if("function"===typeof e)try{return a=e(),a instanceof window.Element?(F.addClass(a,i),Object.keys(n).map((function(e){a.setAttribute(e,n[e])})),a):(W.logWarn("warn>>icons.".concat(t," in config of plugin named [").concat(r,"] is a function mast return an Element Object")),null)}catch(s){return W.logError("Plugin named [".concat(r,"]:createIcon"),s),null}return"string"===typeof e?F.createDomFromHtml(e,n,i):(W.logWarn("warn>>icons.".concat(t," in config of plugin named [").concat(r,"] is invalid")),null)}function _t(e,t){var i=t.config.icons||t.playerConfig.icons;Object.keys(e).map((function(n){var r=e[n],a=r&&r.class?r.class:"",s=r&&r.attr?r.attr:{},o=null;i&&i[n]&&(a=Mt(i[n],a),s=Gt(i[n],s),o=Xt(i[n],n,a,s,t.pluginName)),!o&&r&&(o=Xt(r.icon?r.icon:r,s,a,{},t.pluginName)),t.icons[n]=o}))}function Pt(e,t){Object.keys(e).map((function(i){Object.defineProperty(t.langText,i,{get:function(){var n=t.lang,r=t.i18n;return r[i]?r[i]:e[i]&&e[i][n]||""}})}))}var Dt=function(e){p(i,e);var t=S(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return d(this,i),e=t.call(this,n),e.__delegates=[],e}return f(i,[{key:"__init",value:function(e){if(k(v(i.prototype),"__init",this).call(this,e),e.root){var t=e.root,n=null;this.icons={},this.root=null,this.parent=null;var r=this.registerIcons()||{};_t(r,this),this.langText={};var a=this.registerLanguageTexts()||{};Pt(a,this);var s="";try{s=this.render()}catch(u){throw W.logError("Plugin:".concat(this.pluginName,":render"),u),new Error("Plugin:".concat(this.pluginName,":render:").concat(u.message))}if(s)n=i.insert(s,t,e.index),n.setAttribute("data-index",e.index);else{if(!e.tag)return;n=F.createDom(e.tag,"",e.attr,e.name),n.setAttribute("data-index",e.index),t.appendChild(n)}this.root=n,this.parent=t;var o=this.config.attr||{},l=this.config.style||{};this.setAttr(o),this.setStyle(l),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var t=this.children();t&&"object"===c(t)&&Object.keys(t).length>0&&Object.keys(t).map((function(i){var n,r,a=i,s=t[a],o={root:e.root};"function"===typeof s?(n=e.config[a]||{},r=s):"object"===c(s)&&"function"===typeof s.plugin&&(n=s.options?F.deepCopy(e.config[a]||{},s.options):e.config[a]||{},r=s.plugin),o.config=n,void 0!==n.index&&(o.index=n.index),n.root&&(o.root=n.root),e.registerPlugin(r,o,a)}))}}},{key:"updateLang",value:function(e){function t(e,i){for(var n=0;n<e.children.length;n++)e.children[n].children.length>0?t(e.children[n],i):i(e.children[n])}e||(e=this.lang);var i=this.root,n=this.i18n,r=this.langText;i&&t(i,(function(t){var i=t.getAttribute&&t.getAttribute("lang-key");if(i){var a=n[i.toUpperCase()]||r[i];a&&(t.innerHTML="function"===typeof a?a(e):a)}}))}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.i18n||{},n=this.langText;e.setAttribute&&e.setAttribute("lang-key",t);var r=i[t]||n[t]||"";r&&(e.innerHTML=r)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,F.addClass(this.find(".xgplayer-icon"),Ct.ICON_DISABLE)}},{key:"enable",value:function(){this.config.disable=!1,F.removeClass(this.find(".xgplayer-icon"),Ct.ICON_DISABLE)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.root=t.root||this.root;var r=k(v(i.prototype),"registerPlugin",this).call(this,e,t,n);return this._children.push(r),r}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,t,n){var r=this;if(arguments.length<3&&"function"===typeof t)Array.isArray(e)?e.forEach((function(e){r.bindEL(e,t)})):this.bindEL(e,t);else{var a=i.delegate.call(this,this.root,e,t,n);this.__delegates=this.__delegates.concat(a)}}},{key:"unbind",value:function(e,t){var i=this;if(arguments.length<3&&"function"===typeof t)Array.isArray(e)?e.forEach((function(e){i.unbindEL(e,t)})):this.unbindEL(e,t);else for(var n="".concat(e,"_").concat(t),r=0;r<this.__delegates.length;r++)if(this.__delegates[r].key===n){this.__delegates[r].destroy(),this.__delegates.splice(r,1);break}}},{key:"setStyle",value:function(e,t){var i=this;if(this.root)return"String"===F.typeOf(e)?this.root.style[e]=t:void("Object"===F.typeOf(e)&&Object.keys(e).map((function(t){i.root.style[t]=e[t]})))}},{key:"setAttr",value:function(e,t){var i=this;if(this.root)return"String"===F.typeOf(e)?this.root.setAttribute(e,t):void("Object"===F.typeOf(e)&&Object.keys(e).map((function(t){i.root.setAttribute(t,e[t])})))}},{key:"setHtml",value:function(e,t){this.root&&(this.root.innerHTML=e,"function"===typeof t&&t())}},{key:"bindEL",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"===typeof t&&this.root.addEventListener(e,t,i)}},{key:"unbindEL",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"===typeof t&&this.root.removeEventListener(e,t,i)}},{key:"show",value:function(e){if(this.root){this.root.style.display=void 0!==e?e:"block";var t=window.getComputedStyle(this.root,null),i=t.getPropertyValue("display");return"none"===i?this.root.style.display="block":void 0}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,t){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!t||!(t instanceof window.Element))return null;try{return"string"===typeof e?this.find(e).appendChild(t):e.appendChild(t)}catch(i){return W.logError("Plugin:appendChild",i),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,t=this.player;this.__delegates.map((function(e){e.destroy()})),this.__delegates=[],this._children instanceof Array&&(this._children.map((function(e){t.unRegisterPlugin(e.pluginName)})),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),k(v(i.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map((function(t){e[t]=null}))}}],[{key:"insert",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.children.length,r=Number(i),a=e instanceof window.Node;if(n){for(var s=0,o=null,l="";s<n;s++){o=t.children[s];var u=Number(o.getAttribute("data-index"));if(u>=r){l="beforebegin";break}u<r&&(l="afterend")}return a?"afterend"===l?t.appendChild(e):t.insertBefore(e,o):o.insertAdjacentHTML(l,e),"afterend"===l?t.children[t.children.length-1]:t.children[s]}return a?t.appendChild(e):t.insertAdjacentHTML("beforeend",e),t.children[t.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=[];if(e instanceof window.Node&&"function"===typeof n)if(Array.isArray(i))i.forEach((function(i){var s=wt()(e,t,i,n,r);s.key="".concat(t,"_").concat(i),a.push(s)}));else{var s=wt()(e,t,i,n,r);s.key="".concat(t,"_").concat(i),a.push(s)}return a}},{key:"ROOT_TYPES",get:function(){return Et}},{key:"POSITIONS",get:function(){return Zt}}]),i}(xt),Wt=function(){function e(){var t=this;if(d(this,e),m(this,"__trigger",(function(e){var i=(new Date).getTime();t.timeStamp=i;for(var n=0;n<e.length;n++)t.__runHandler(e[n].target)})),this.__handlers=[],this.timeStamp=0,this.observer=null,window.ResizeObserver)try{this.observer=new window.ResizeObserver(H(this.__trigger,100,{trailing:!0})),this.timeStamp=(new Date).getTime()}catch(i){console.error(i)}}return f(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var i=e.getAttribute(ft),n=this.__handlers,r=-1,a=0;a<n.length;a++)n[a]&&e===n[a].target&&(r=a);r>-1?this.__handlers[r].handler=t:this.__handlers.push({target:e,handler:t,playerId:i})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(i,n){e===i.target&&(t=n)}));try{this.observer&&this.observer.unobserve(e)}catch(i){}this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,i=0;i<t.length;i++)if(t[i]&&e===t[i].target){try{t[i].handler(e)}catch(n){console.error(n)}return!0}return!1}}]),e}(),Vt=null;function Nt(e,t){return Vt||(Vt=new Wt),Vt.addObserver(e,t),Vt}function Ft(e,t){Vt.unObserver(e,t)}var At={pluginGroup:{},init:function(e){var t=e._pluginInfoId;t||(t=(new Date).getTime(),e._pluginInfoId=t),!e.config.closeResizeObserver&&Nt(e.root,(function(){e.resize()})),this.pluginGroup[t]={_originalOptions:e.config||{},_plugins:{}}},formatPluginInfo:function(e,t){var i=null,n=null;return e.plugin&&"function"===typeof e.plugin?(i=e.plugin,n=e.options):(i=e,n={}),t&&(n.config=t||{}),{PLUFGIN:i,options:n}},checkPluginIfExits:function(e,t){for(var i=0;i<t.length;i++)if(e.toLowerCase()===t[i].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(e,t){for(var i=Object.keys(t),n=null,r=0;r<i.length;r++)if(e.toLowerCase()===i[r].toLowerCase()){n=t[i[r]];break}return"Object"===F.typeOf(n)?{root:n.root,position:n.position}:{}},lazyRegister:function(e,t){var i=this,n=t.timeout||1500;return Promise.race([t.loader().then((function(t){var n;n=t&&t.__esModule?t.default:t,i.register(e,n,t.options)})),new Promise((function(e,t){setTimeout((function(){t(new Error("timeout"))}),n)}))])},register:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&t&&"function"===typeof t&&void 0!==t.prototype){var n=e._pluginInfoId;if(n&&this.pluginGroup[n]){this.pluginGroup[n]._plugins||(this.pluginGroup[n]._plugins={});var r=this.pluginGroup[n]._plugins,a=this.pluginGroup[n]._originalOptions;i.player=e;var s=i.pluginName||t.pluginName;if(!s)throw new Error("The property pluginName is necessary");if(!t.isSupported||t.isSupported(e.config.mediaType,e.config.codecType)){i.config||(i.config={});for(var o=Object.keys(a),l=0;l<o.length;l++)if(s.toLowerCase()===o[l].toLowerCase()){var u=a[o[l]];"Object"===F.typeOf(u)?i.config=Object.assign({},i.config,a[o[l]]):"Boolean"===F.typeOf(u)&&(i.config.disable=!u);break}t.defaultConfig&&Object.keys(t.defaultConfig).forEach((function(e){"undefined"===typeof i.config[e]&&(i.config[e]=t.defaultConfig[e])})),i.root?"string"===typeof i.root&&(i.root=e[i.root]):i.root=e.root,i.index=i.config.index||0;try{r[s.toLowerCase()]&&(this.unRegister(n,s.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(s,"] exist, destroy the old instance")));var c=new t(i);return r[s.toLowerCase()]=c,r[s.toLowerCase()].func=t,c&&"function"===typeof c.afterCreate&&c.afterCreate(),c}catch(d){throw console.error(d),d}}else console.warn("not supported plugin [".concat(s,"]"))}}},unRegister:function(e,t){e._pluginInfoId&&(e=e._pluginInfoId),t=t.toLowerCase();try{var i=this.pluginGroup[e]._plugins[t];i&&(i.pluginName&&i.__destroy(),delete this.pluginGroup[e]._plugins[t])}catch(n){console.error("[unRegister:".concat(t,"] cgid:[").concat(e,"] error"),n)}},deletePlugin:function(e,t){var i=e._pluginInfoId;i&&this.pluginGroup[i]&&this.pluginGroup[i]._plugins&&delete this.pluginGroup[i]._plugins[t]},getPlugins:function(e){var t=e._pluginInfoId;return t&&this.pluginGroup[t]?this.pluginGroup[t]._plugins:{}},findPlugin:function(e,t){var i=e._pluginInfoId;if(!i||!this.pluginGroup[i])return null;var n=t.toLowerCase();return this.pluginGroup[i]._plugins[n]},beforeInit:function(e){var t=this;function i(e){return e&&e.then?e:new Promise((function(e){e()}))}return new Promise((function(n){var r;if(t.pluginGroup)return r=e._loadingPlugins&&e._loadingPlugins.length?Promise.all(e._loadingPlugins):Promise.resolve(),r.then((function(){var r=e._pluginInfoId;if(t.pluginGroup[r]){var a=t.pluginGroup[r]._plugins,s=[];Object.keys(a).forEach((function(e){if(a[e]&&a[e].beforePlayerInit)try{var t=a[e].beforePlayerInit();s.push(i(t))}catch(n){throw s.push(i(null)),n}})),Promise.all([].concat(s)).then((function(){n()})).catch((function(e){console.error(e),n()}))}else n()}))}))},afterInit:function(e){var t=e._pluginInfoId;if(t&&this.pluginGroup[t]){var i=this.pluginGroup[t]._plugins;Object.keys(i).forEach((function(e){i[e]&&i[e].afterPlayerInit&&i[e].afterPlayerInit()}))}},setLang:function(e,t){var i=t._pluginInfoId;if(i&&this.pluginGroup[i]){var n=this.pluginGroup[i]._plugins;Object.keys(n).forEach((function(t){if(n[t].updateLang)n[t].updateLang(e);else try{n[t].lang=e}catch(i){console.warn("".concat(t," setLang"))}}))}},reRender:function(e){var t=this,i=e._pluginInfoId;if(i&&this.pluginGroup[i]){var n=[],r=this.pluginGroup[i]._plugins;Object.keys(r).forEach((function(e){"controls"!==e&&r[e]&&(n.push({plugin:r[e].func,options:r[e].__args}),t.unRegister(i,e))})),n.forEach((function(i){t.register(e,i.plugin,i.options)}))}},onPluginsReady:function(e){var t=e._pluginInfoId;if(t&&this.pluginGroup[t]){var i=this.pluginGroup[t]._plugins||{};Object.keys(i).forEach((function(e){i[e].onPluginsReady&&"function"===typeof i[e].onPluginsReady&&i[e].onPluginsReady()}))}},destroy:function(e){var t=e._pluginInfoId;if(this.pluginGroup[t]){Ft(e.root);for(var i=this.pluginGroup[t]._plugins,n=0,r=Object.keys(i);n<r.length;n++){var a=r[n];this.unRegister(t,a)}delete this.pluginGroup[t],delete e._pluginInfoId}}},Yt={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function Ot(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:K(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var Ht=function(e,t){var i,n,r;r=t.preset&&t.options?new t.preset(t.options,e.config):new t({},e.config);var a=r,s=a.plugins,o=void 0===s?[]:s,l=a.ignores,u=void 0===l?[]:l,c=a.icons,d=void 0===c?{}:c,h=a.i18n,f=void 0===h?[]:h;e.config.plugins||(e.config.plugins=[]),e.config.ignores||(e.config.ignores=[]),(i=e.config.plugins).push.apply(i,x(o)),(n=e.config.ignores).push.apply(n,x(u)),Object.keys(d).map((function(t){e.config.icons[t]||(e.config.icons[t]=d[t])}));var m=e.config.i18n||[];f.push.apply(f,x(m)),e.config.i18n=f},Kt=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onMouseEnter",(function(t){var i=b(e),n=i.player,r=i.playerConfig;r.closeControlsBlur&&n.focus({autoHide:!1})})),m(b(e),"onMouseLeave",(function(t){var i=b(e),n=i.player;n.focus()})),e}return f(i,[{key:"beforeCreate",value:function(e){e.config.mode||"mobile"!==j.device||(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,t=this.config,i=t.disable,n=t.height,r=t.mode;if(!i){"flex"===r&&this.player.addClass(Yt.FLEX_CONTROLS);var a={height:"".concat(n,"px")};Object.keys(a).map((function(t){e.root.style[t]=a[t]})),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(Ne,(function(t){t?F.addClass(e.root,"mini-controls"):F.removeClass(e.root,"mini-controls")}));var s=this.playerConfig.isMobileSimulateMode;"mobile"!==j.device&&"mobile"!==s&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&F.addClass(this.root,Yt.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){F.removeClass(this.root,Yt.CONTROLS_AUTOHIDE)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(this.root){var r=e.defaultConfig||{};if(!t.root){var a=t.position?t.position:t.config&&t.config.position?t.config.position:r.position;switch(a){case Zt.CONTROLS_LEFT:t.root=this.left;break;case Zt.CONTROLS_RIGHT:t.root=this.right;break;case Zt.CONTROLS_CENTER:t.root=this.center;break;case Zt.CONTROLS:t.root=this.root;break;default:t.root=this.left}return k(v(i.prototype),"registerPlugin",this).call(this,e,t,n)}}}},{key:"destroy",value:function(){"mobile"!==j.device&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,t=e.mode,i=e.autoHide,n=e.initShow,r=e.disable;if(!r){var a=F.classNames({"xgplayer-controls":!0},{"flex-controls":"flex"===t},{"bottom-controls":"bottom"===t},m({},Yt.CONTROLS_AUTOHIDE,i),{"xgplayer-controls-initshow":n||!i});return'<xg-controls class="'.concat(a,'" unselectable="on">\n    <xg-inner-controls class="xg-inner-controls xg-pos">\n      <xg-left-grid class="xg-left-grid">\n      </xg-left-grid>\n      <xg-center-grid class="xg-center-grid"></xg-center-grid>\n      <xg-right-grid class="xg-right-grid">\n      </xg-right-grid>\n    </xg-inner-controls>\n    </xg-controls>')}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),i}(Dt),Ut={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},Bt={lang:{},langKeys:[],textKeys:[]};function zt(e,t){return Object.keys(t).forEach((function(i){var n,r=F.typeOf(t[i]),a=F.typeOf(e[i]);"Array"===r?("Array"!==a&&(e[i]=[]),(n=e[i]).push.apply(n,x(t[i]))):"Object"===r?("Object"!==a&&(e[i]={}),zt(e[i],t[i])):e[i]=t[i]})),e}function jt(){Object.keys(Bt.lang.en).map((function(e){Bt.textKeys[e]=e}))}function Jt(e,t){var i=[];if(t||(t=Bt),t.lang){i="Array"!==F.typeOf(e)?Object.keys(e).map((function(t){var i="zh"===t?"zh-cn":t;return{LANG:i,TEXT:e[t]}})):e;var n=t,r=n.lang;i.map((function(e){"zh"===e.LANG&&(e.LANG="zh-cn"),r[e.LANG]?zt(r[e.LANG]||{},e.TEXT||{}):Qt(e,t)})),jt()}}function Qt(e,t){var i=e.LANG;if(t||(t=Bt),t.lang){var n=e.TEXT||{};"zh"===i&&(i="zh-cn"),t.lang[i]?zt(t.lang[i],n):(t.langKeys.push(i),t.lang[i]=n),jt()}}function qt(e){var t,i={lang:{},langKeys:[],textKeys:{},pId:e};return zt(i.lang,Bt.lang),(t=i.langKeys).push.apply(t,x(Bt.langKeys)),zt(i.textKeys,Bt.textKeys),i}Qt(Ut);var $t={get textKeys(){return Bt.textKeys},get langKeys(){return Bt.langKeys},get lang(){var e={};return Bt.langKeys.map((function(t){e[t]=Bt.lang[t]})),Bt.lang["zh-cn"]&&(e.zh=Bt.lang["zh-cn"]||{}),e},extend:Jt,use:Qt,init:qt},ei={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},ti=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],ii={},ni=null,ri=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"add",value:function(e){e&&(ii[e.playerId]=e,1===Object.keys(ii).length&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete ii[e.playerId])}},{key:"_iterate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var i in ii)if(Object.prototype.hasOwnProperty.call(ii,i)){var n=ii[i];if(t){if(e(n))break}else e(n)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var t=null;return this._iterate((function(i){var n=e(i);return n&&(t=i),n}),!0),t}},{key:"findAll",value:function(e){var t=[];return this._iterate((function(i){e(i)&&t.push(i)})),t}},{key:"setActive",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(ii[e])return t?this.forEach((function(t){e===t.playerId?(t.isUserActive=!0,t.isInstNext=!1):t.isUserActive=!1})):ii[e].isUserActive=t,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(ii),t=0;t<e.length;t++){var i=ii[e[t]];if(i&&i.isUserActive)return e[t]}return null}},{key:"setNext",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(ii[e])return t?this.forEach((function(t){e===t.playerId?(t.isUserActive=!1,t.isInstNext=!0):t.isInstNext=!1})):ii[e].isInstNext=t,e}}],[{key:"getInstance",value:function(){return ni||(ni=new i),ni}}]),i}(G["EventEmitter"]);function ai(e){for(var t=Object.keys(ii),i=0;i<t.length;i++){var n=ii[t[i]];if(n.root===e)return n}return null}var si=["play","pause","replay","retry"],oi=0,li=0,ui=null,ci=function(e){p(i,e);var t=S(i);function i(e){var n;d(this,i);var r=F.deepMerge(Ot(),e);n=t.call(this,r),m(b(n),"canPlayFunc",(function(){if(n.config){var e=n.config,t=e.autoplay,i=e.defaultPlaybackRate;W.logInfo("player","canPlayFunc, startTime",n.__startTime),n._seekToStartTime(),n.playbackRate=i,(t||n._useAutoplay)&&n.mediaPlay(),n.off(ue,n.canPlayFunc),n.removeClass(Yt.ENTER)}})),m(b(n),"onFullscreenChange",(function(e,t){var i=function(){F.setTimeout(b(n),(function(){n.resize()}),100)},r=F.getFullScreenEl();n._fullActionFrom?n._fullActionFrom="":n.emit(qe,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:n.currentTime,duration:n.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var a=U(r,n.playerId,ft);if(t||r&&(r===n._fullscreenEl||a))i(),!n.config.closeFocusVideoFocus&&n.media.focus(),n.fullscreen=!0,n.changeFullStyle(n.root,r,Yt.FULLSCREEN),n.emit(We,!0,n._fullScreenOffset),n.cssfullscreen&&n.exitCssFullscreen();else if(n.fullscreen){i();var s=b(n),o=s._fullScreenOffset,l=s.config;if(l.needFullscreenScroll?(window.scrollTo(o.left,o.top),F.setTimeout(b(n),(function(){n.fullscreen=!1,n._fullScreenOffset=null}),100)):(!n.config.closeFocusVideoFocus&&n.media.focus(),n.fullscreen=!1,n._fullScreenOffset=null),n.cssfullscreen)n.removeClass(Yt.FULLSCREEN);else{var u=n._fullscreenEl;u||!n.root.contains(e.target)&&e.target!==n.root||(u=e.target),n.recoverFullStyle(n.root,u,Yt.FULLSCREEN)}n._fullscreenEl=null,n.emit(We,!1)}})),m(b(n),"_onWebkitbeginfullscreen",(function(e){n._fullscreenEl=n.media,n.onFullscreenChange(e,!0)})),m(b(n),"_onWebkitendfullscreen",(function(e){n.onFullscreenChange(e,!1)})),Lt(b(n),si),n.config=r,n._pluginInfoId=F.generateSessionId(),V(b(n));var a=n.constructor.defaultPreset;if(n.config.presets.length){var s=n.config.presets.indexOf("default");s>=0&&a&&(n.config.presets[s]=a)}else a&&n.config.presets.push(a);n.userTimer=null,n.waitTimer=null,n.handleSource=!0,n._state=ei.INITIAL,n.isError=!1,n._hasStart=!1,n.isSeeking=!1,n.isCanplay=!1,n._useAutoplay=!1,n.__startTime=-1,n.rotateDeg=0,n.isActive=!1,n.fullscreen=!1,n.cssfullscreen=!1,n.isRotateFullscreen=!1,n._fullscreenEl=null,n.timeSegments=[],n._cssfullscreenEl=null,n.curDefinition=null,n._orgCss="",n._fullScreenOffset=null,n._videoHeight=0,n._videoWidth=0,n.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},n.sizeInfo={width:0,height:0,left:0,top:0},n._accPlayed={t:0,acc:0,loopAcc:0},n._offsetInfo={currentTime:-1,duration:0},n.innerContainer=null,n.controls=null,n.topBar=null,n.root=null,n.__i18n=$t.init(n._pluginInfoId),j.os.isAndroid&&j.osVersion>0&&j.osVersion<6&&(n.config.autoplay=!1),n.database=new ut,n.isUserActive=!1,n._onceSeekCanplay=null,n._isPauseBeforeSeek=0,n.innerStates={isActiveLocked:!1},n.instManager=ui;var o=n._initDOM();if(!o)return console.error(new Error("can't find the dom which id is ".concat(n.config.id," or this.config.el does not exist"))),L(n);var l=n.config,u=l.definition,c=void 0===u?{}:u,h=l.url;if(!h&&c.list&&c.list.length>0){var f=c.list.find((function(e){return e.definition&&e.definition===c.defaultDefinition}));f||(c.defaultDefinition=c.list[0].definition,f=c.list[0]),n.config.url=f.url,n.curDefinition=f}return n._bindEvents(),n._registerPresets(),n._registerPlugins(),At.onPluginsReady(b(n)),n.getInitDefinition(),n.setState(ei.READY),F.setTimeout(b(n),(function(){n.emit(Re)}),0),n.onReady&&n.onReady(),(n.config.videoInit||n.config.autoplay)&&(!n.hasStart||n.state<ei.ATTACHED)&&n.start(),n}return f(i,[{key:"_initDOM",value:function(){var e,t=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var i=this.config.el;if(!i||1!==i.nodeType)return this.emit(re,new $("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1;this.root=i}var n=ai(this.root);n&&(W.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),n.destroy()),this.root.setAttribute(ft,this.playerId),null===(e=ui)||void 0===e||e.add(this),At.init(this),this._initBaseDoms();var r=this.constructor.XgVideoProxy;if(r&&this.mediaConfig.mediaType===r.mediaType){var a=this.innerContainer||this.root;this.detachVideoEvents(this.media);var s=new r(a,this.config,this.mediaConfig);this.attachVideoEvents(s),this.media=s}if(this.media.setAttribute(ft,this.playerId),this.config.controls){var o=this.config.controls.root||null,l=At.register(this,Kt,{root:o});this.controls=l}var u="mobile"===this.config.isMobileSimulateMode?"mobile":j.device;if(this.addClass("".concat(Yt.DEFAULT," ").concat(Yt.INACTIVE," xgplayer-").concat(u," ").concat(this.config.controls?"":Yt.NO_CONTROLS)),this.config.autoplay?this.addClass(Yt.ENTER):this.addClass(Yt.NO_START),this.config.fluid){var c=this.config,d=c.width,h=c.height;"number"===typeof d&&"number"===typeof h||(d=600,h=337.5);var f={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(100*h/d,"%")};Object.keys(f).forEach((function(e){t.root.style[e]=f[e]}))}else["width","height"].forEach((function(e){t.config[e]&&("number"!==typeof t.config[e]?t.root.style[e]=t.config[e]:t.root.style[e]="".concat(t.config[e],"px"))}));var m=this.root.getBoundingClientRect(),p=m.width,v=m.height,g=m.left,y=m.top;return this.sizeInfo.width=p,this.sizeInfo.height=v,this.sizeInfo.left=g,this.sizeInfo.top=y,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=F.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach((function(t){e.on(t,e["on"+t.charAt(0).toUpperCase()+t.slice(1)])})),ct.forEach((function(t){document&&document.addEventListener(t,e.onFullscreenChange)})),j.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(fe,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(ee,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),ct.forEach((function(t){document.removeEventListener(t,e.onFullscreenChange)})),this.playFunc&&this.off(ee,this.playFunc),this.off(ue,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(F.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(e){var t=this;if(this.media&&(e&&""!==e&&("Array"!==F.typeOf(e)||0!==e.length)||(e="",this.emit(we),W.logWarn("config.url is null, please get url and run player._startInit(url)"),!this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),"Array"===F.typeOf(e)&&e.length>0?this._attachSourceEvents(this.media,e):this.media.src&&this.media.src===e?e||this.media.removeAttribute("src"):this.media.src=e),"Number"===F.typeOf(this.config.volume)&&(this.volume=this.config.volume);var i=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!i.contains(this.media)&&i.insertBefore(this.media,i.firstChild);var n=this.media.readyState;W.logInfo("_startInit readyState",n),this.config.autoplay&&(!F.isMSE(this.media)&&this.load(),(j.os.isIpad||j.os.isPhone)&&this.mediaPlay());var r=this.config.startTime;this.__startTime=r>0?r:-1,this.config.startTime=0,n>=2&&this.duration>0?this.canPlayFunc():this.on(ue,this.canPlayFunc),(!this.hasStart||this.state<ei.ATTACHED)&&At.afterInit(this),this.hasStart=!0,this.setState(ei.ATTACHED),F.setTimeout(this,(function(){t.emit(Ce)}),0)}}},{key:"_registerPlugins",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._loadingPlugins=[];var i=this.config.ignores||[],n=this.config.plugins||[],r=this.config.i18n||[];t&&$t.extend(r,this.__i18n);var a=i.join("||").toLowerCase().split("||"),s=this.plugins;n.forEach((function(i){try{var n=i.plugin?i.plugin.pluginName:i.pluginName;if(n&&a.indexOf(n.toLowerCase())>-1)return null;if(!t&&s[n.toLowerCase()])return;if(i.lazy&&i.loader){var r=At.lazyRegister(e,i);return void(i.forceBeforeInit&&(r.then((function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(r),1)})).catch((function(t){W.logError("_registerPlugins:loadingPlugin",t),e._loadingPlugins.splice(e._loadingPlugins.indexOf(r),1)})),e._loadingPlugins.push(r)))}return e.registerPlugin(i)}catch(o){W.logError("_registerPlugins:",o)}}))}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach((function(t){Ht(e,t)}))}},{key:"_getRootByPosition",value:function(e){var t=null;switch(e){case Zt.ROOT_RIGHT:this.rightBar||(this.rightBar=F.createPositionBar("xg-right-bar",this.root)),t=this.rightBar;break;case Zt.ROOT_LEFT:this.leftBar||(this.leftBar=F.createPositionBar("xg-left-bar",this.root)),t=this.leftBar;break;case Zt.ROOT_TOP:this.topBar||(this.topBar=F.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&F.addClass(this.topBar,Yt.TOP_BAR_AUTOHIDE)),t=this.topBar;break;default:t=this.innerContainer||this.root;break}return t}},{key:"registerPlugin",value:function(e,t){var i=At.formatPluginInfo(e,t),n=i.PLUFGIN,r=i.options,a=this.config.plugins,s=At.checkPluginIfExits(n.pluginName,a);!s&&a.push(n);var o=At.getRootByConfig(n.pluginName,this.config);o.root&&(r.root=o.root),o.position&&(r.position=o.position);var l=r.position?r.position:r.config&&r.config.position||n.defaultConfig&&n.defaultConfig.position;return!r.root&&"string"===typeof l&&l.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(n,r,n.pluginName):(r.root||(r.root=this._getRootByPosition(l)),At.register(this,n,r))}},{key:"deregister",value:function(e){"string"===typeof e?At.unRegister(this,e):e instanceof xt&&At.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.deregister(e),t&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var t;if("string"===typeof e?t=e:e instanceof xt&&(t=e.pluginName),t)for(var i=this.config.plugins.length-1;i>-1;i--){var n=this.config.plugins[i];if(n.pluginName.toLowerCase()===t.toLowerCase()){this.config.plugins.splice(i,1);break}}}},{key:"plugins",get:function(){return At.getPlugins(this)}},{key:"getPlugin",value:function(e){var t=At.findPlugin(this,e);return t&&t.pluginName?t:null}},{key:"addClass",value:function(e){this.root&&(F.hasClass(this.root,e)||F.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&F.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return F.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,t){this.root&&this.root.setAttribute(e,t)}},{key:"removeAttribute",value:function(e,t){this.root&&this.root.removeAttribute(e,t)}},{key:"start",value:function(e){var t=this;if(!(this.state>ei.ATTACHING))return e||this.config.url||this.getInitDefinition(),this.hasStart=!0,this.setState(ei.ATTACHING),this._registerPlugins(!1),At.beforeInit(this).then((function(){if(t.config){e||(e=t.url||t.config.url);var i=t._preProcessUrl(e),n=t._startInit(i.url);return n}})).catch((function(e){throw e.fileName="player",e.lineNumber="236",W.logError("start:beforeInit:",e),e}))}},{key:"switchURL",value:function(e,t){var i=this,n=e;"Object"===F.typeOf(e)&&(n=e.url),n=this._preProcessUrl(n).url;var r=this.currentTime;this.__startTime=r;var a=this.paused&&!this.isError;return this.src=n,new Promise((function(e,t){var r=function(e){i.off("timeupdate",s),i.off("canplay",s),t(e)},s=function(){i._seekToStartTime(),a&&i.pause(),i.off("error",r),e(!0)};i.once("error",r),n?(j.os.isAndroid?i.once("timeupdate",s):i.once("canplay",s),i.play()):i.errorHandler("error",{code:6,message:"empty_src"})}))}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<ei.ATTACHED)return this.removeClass(Yt.NO_START),this.addClass(Yt.ENTER),this.start(),void(this._useAutoplay=!0);this.state<ei.RUNNING&&(this.removeClass(Yt.NO_START),!this.isCanplay&&this.addClass(Yt.ENTER));var t=k(v(i.prototype),"play",this).call(this);return void 0!==t&&t&&t.then?t.then((function(){e.removeClass(Yt.NOT_ALLOW_AUTOPLAY),e.addClass(Yt.PLAYING),e.state<ei.RUNNING&&(W.logInfo(">>>>playPromise.then"),e.setState(ei.RUNNING),e.emit(Ee))})).catch((function(t){if(W.logWarn(">>>>playPromise.catch",t.name),e.media&&e.media.error)return e.onError(),void e.removeClass(Yt.ENTER);"NotAllowedError"===t.name&&(e._errorTimer=F.setTimeout(e,(function(){e._errorTimer=null,e.emit(Ze),e.addClass(Yt.NOT_ALLOW_AUTOPLAY),e.removeClass(Yt.ENTER),e.pause(),e.setState(ei.NOTALLOW)}),0))})):(W.logWarn("video.play not return promise"),this.state<ei.RUNNING&&(this.setState(ei.RUNNING),this.removeClass(Yt.NOT_ALLOW_AUTOPLAY),this.removeClass(Yt.NO_START),this.removeClass(Yt.ENTER),this.addClass(Yt.PLAYING),this.emit(Ee))),t}},{key:"mediaPause",value:function(){k(v(i.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){k(v(i.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(Yt.PAUSED),Tt(this,"play",(function(){return e.mediaPlay()}))}},{key:"pause",value:function(){var e=this;Tt(this,"pause",(function(){k(v(i.prototype),"pause",e).call(e)}))}},{key:"seek",value:function(e,t){var i=this;if(this.media&&!Number.isNaN(Number(e))&&this.hasStart){var n=this.config,r=n.isSeekedPlay,a=n.seekedStatus,s=t||(r?"play":a);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(se,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(i.removeClass(Yt.ENTER),i.isSeeking=!1,s){case"play":i.play();break;case"pause":i.pause();break;default:i._isPauseBeforeSeek>1||i.paused?i.pause():i.play()}i._isPauseBeforeSeek=0,i._onceSeekCanplay=null},this.once(se,this._onceSeekCanplay),this.state<ei.RUNNING?(this.removeClass(Yt.NO_START),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,t=this.config,i=t.definition,n=t.url;!n&&i&&i.list&&i.list.length>0&&i.defaultDefinition&&i.list.map((function(t){t.definition===i.defaultDefinition&&(e.config.url=t.url,e.curDefinition=t)}))}},{key:"changeDefinition",value:function(e,t){var i=this,n=this.config.definition;if(Array.isArray(null===n||void 0===n?void 0:n.list)&&n.list.forEach((function(t){(null===e||void 0===e?void 0:e.definition)===t.definition&&(i.curDefinition=t)})),null!==e&&void 0!==e&&e.bitrate&&"number"!==typeof e.bitrate&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(Fe,{from:t,to:e}),this.hasStart){var r=this.switchURL(e.url,u({seamless:!1!==n.seamless&&"undefined"!==typeof MediaSource&&"function"===typeof MediaSource.isTypeSupported},e));r&&r.then?r.then((function(){i.emit(Ye,{from:t,to:e})})):this.emit(Ye,{from:t,to:e})}else this.config.url=e.url}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(fe,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,t=Yt.NOT_ALLOW_AUTOPLAY,i=Yt.PLAYING,n=Yt.NO_START,r=Yt.PAUSED,a=Yt.REPLAY,s=Yt.ENTER,o=Yt.ENDED,l=Yt.ERROR,u=Yt.LOADING,c=[t,i,n,r,a,s,o,l,u];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,c.forEach((function(t){e.removeClass(t)})),this.addClass(Yt.NO_START),this.emit($e)}},{key:"reset",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0;this.resetState();var n=this.plugins;if(n&&(t.map((function(t){e.deregister(t)})),i)){var r=Ot();Object.keys(this.config).keys((function(t){"undefined"===e.config[t]||"plugins"!==t&&"presets"!==t&&"el"!==t&&"id"!==t||(e.config[t]=r[t])}))}}},{key:"destroy",value:function(){var e,t=this,n=this.innerContainer,r=this.root,a=this.media;if(r&&a){if(this.hasStart=!1,this._useAutoplay=!1,r.removeAttribute(ft),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),F.clearAllTimers(this),this.emit(Me),null===(e=ui)||void 0===e||e.remove(this),At.destroy(this),St(this),k(v(i.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),n)for(var s=n.children,o=0;o<s.length;o++)n.removeChild(s[o]);!n&&a instanceof window.Node&&r.contains(a)&&r.removeChild(a),["topBar","leftBar","rightBar","innerContainer"].map((function(e){t[e]&&r.removeChild(t[e]),t[e]=null}));var l=r.className.split(" ");l.length>0?r.className=l.filter((function(e){return e.indexOf("xgplayer")<0})).join(" "):r.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach((function(e){t[e]=!1}))}}},{key:"replay",value:function(){var e=this;this.removeClass(Yt.ENDED),this.currentTime=0,this.isSeeking=!1,Tt(this,"replay",(function(){e.once(se,(function(){var t=e.mediaPlay();t&&t.catch&&t.catch((function(e){console.log(e)}))})),e.emit(Ie),e.onPlay()}))}},{key:"retry",value:function(){var e=this;this.removeClass(Yt.ERROR),this.addClass(Yt.LOADING),Tt(this,"retry",(function(){var t=e.currentTime,i=e.config.url,n=F.isMSE(e.media)?{url:i}:e._preProcessUrl(i);e.src=n.url,!e.config.isLive&&(e.currentTime=t),e.once(ue,(function(){e.mediaPlay()}))}))}},{key:"changeFullStyle",value:function(e,t,i,n){e&&(n||(n=Yt.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=F.filterStyleFromText(e)),F.addClass(e,i),t&&t!==e&&!this._orgPCss&&(this._orgPCss=F.filterStyleFromText(t),F.addClass(t,n),t.setAttribute(ft,this.playerId)))}},{key:"recoverFullStyle",value:function(e,t,i,n){n||(n=Yt.PARENT_FULLSCREEN),this._orgCss&&(F.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),F.removeClass(e,i),t&&t!==e&&this._orgPCss&&(F.setStyleFromCsstext(t,this._orgPCss),this._orgPCss="",F.removeClass(t,n),t.removeAttribute(ft))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget,t=this.root,i=this.media;"video"!==e&&"media"!==e||(e=this[e]),e||(e=t),this._fullScreenOffset={top:F.scrollTop(),left:F.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var n=F.getFullScreenEl();if(n===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var r=0;r<dt.length;r++){var a=dt[r];if(e[a]){var s="webkitRequestFullscreen"===a?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[a]();return s&&s.then?s:Promise.resolve()}}return i.fullscreenEnabled||i.webkitSupportsFullscreen?(i.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(o){return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),this._fullscreenEl||F.getFullScreenEl()){this.root;var t=this.media;this._fullActionFrom="exit";try{for(var i=0;i<ht.length;i++){var n=ht[i];if(document[n]){var r=document[n]();return r&&r.then?r:Promise.resolve()}}return t&&t.webkitSupportsFullscreen?(t.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(a){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var t=e?"".concat(Yt.INNER_FULLSCREEN," ").concat(Yt.CSS_FULLSCREEN):Yt.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,t);var i=this.config.fullscreen,n=void 0===i?{}:i,r=!0===n.useCssFullscreen||"function"===typeof n.useCssFullscreen&&n.useCssFullscreen();r&&(this.fullscreen=!0,this.emit(We,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(Ve,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(Yt.INNER_FULLSCREEN," ").concat(Yt.CSS_FULLSCREEN):Yt.CSS_FULLSCREEN;if(this.fullscreen){var t=this.config.fullscreen,i=void 0===t?{}:t,n=!0===i.useCssFullscreen||"function"===typeof i.useCssFullscreen&&i.useCssFullscreen();n?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(We,!1)):this.removeClass(e)}else this.recoverFullStyle(this.root,this._cssfullscreenEl,e);this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(Ve,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var t=e?"".concat(Yt.INNER_FULLSCREEN," ").concat(Yt.ROTATE_FULLSCREEN):Yt.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,t,Yt.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(We,!0)}},{key:"exitRotateFullscreen",value:function(e){var t=this._fullscreenEl!==this.root?"".concat(Yt.INNER_FULLSCREEN," ").concat(Yt.ROTATE_FULLSCREEN):Yt.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,t,Yt.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(We,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){90===window.orientation||-90===window.orientation?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};this.isActive?this.onFocus(e):this.emit(ke,u({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ignorePaused:!1};this.isActive?(this._clearUserTimer(),this.emit(xe,u({paused:this.paused,ended:this.ended},e))):this.onBlur(e)}},{key:"onFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!0,delay:3e3},i=this.innerStates;if(this.isActive=!0,this.removeClass(Yt.INACTIVE),this._clearUserTimer(),void 0!==t.isLock&&(i.isActiveLocked=t.isLock),!1===t.autoHide||!0===t.isLock||i.isActiveLocked)this._clearUserTimer();else{var n=t&&t.delay?t.delay:this.config.inactive;this.userTimer=F.setTimeout(this,(function(){e.userTimer=null,e.blur()}),n)}}},{key:"onBlur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ignorePaused,i=void 0!==t&&t;if(!this.innerStates.isActiveLocked){var n=this.config.closePauseVideoFocus;this.isActive=!1,(i||n||!this.paused&&!this.ended)&&this.addClass(Yt.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(Yt.ENTER),this.removeClass(Yt.ERROR),this.removeClass(Yt.LOADING),this.isCanplay=!0,this.waitTimer&&F.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){var e=this;this.isError=!1,this.isSeeking=!1,this.__startTime>0&&(this.duration>0?this._seekToStartTime():this.once(de,(function(){e._seekToStartTime()})))}},{key:"onLoadstart",value:function(){this.removeClass(Yt.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===ei.ENDED&&this.setState(ei.RUNNING),this.removeClass(Yt.PAUSED),this.ended&&this.removeClass(Yt.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(Yt.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(Yt.ENDED),this.setState(ei.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(Yt.NOT_ALLOW_AUTOPLAY),this.removeClass(Yt.NO_START),this.removeClass(Yt.ENTER),this.removeClass(Yt.LOADING),this.addClass(Yt.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(Yt.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&F.clearTimeout(this,this.waitTimer),this.removeClass(Yt.LOADING),this.removeClass(Yt.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&F.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=F.setTimeout(this,(function(){e.addClass(Yt.LOADING),e.emit(De),F.clearTimeout(e,e.waitTimer),e.waitTimer=null}),this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var t=Yt.NO_START,i=Yt.PAUSED,n=Yt.ENDED,r=Yt.ERROR,a=Yt.REPLAY,s=Yt.LOADING,o=[t,i,n,r,a,s];o.forEach((function(t){e.removeClass(t)})),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(Yt.LOADING))&&this.media.readyState>2&&(this.removeClass(Yt.LOADING),F.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state===ei.NOTALLOW&&this.duration&&(this.setState(ei.RUNNING),this.emit(Ee)),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onVolumechange",value:function(){"Number"===F.typeOf(this.config.volume)&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,t,i){if(this.media&&t&&e){var n="String"===F.typeOf(e)?e:e.type||"";i.props&&"Array"!==F.typeOf(i.props)&&(i.props=[i.props]),this.emit(qe,u({eventType:n,action:t,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},i))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var t=(new Date).getTime()-this._accPlayed.t;this._accPlayed.acc+=t,this._accPlayed.t=0,("ended"===e||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{startDiff:0,endDiff:0},i=t||{},n=i.startDiff,r=void 0===n?0:n,a=i.endDiff,s=void 0===a?0:a,o=this.media.buffered;if(!o||0===o.length||!this.duration)return!0;for(var l=e||this.media.currentTime||.2,u=o.length,c=0;c<u;c++)if(o.start(c)+r<=l&&o.end(c)-s>l)return!0;return!1}},{key:"resizePosition",value:function(){var e=this.videoPos,t=e.vy,i=e.vx,n=e.h,r=e.w,a=this.videoPos.rotate;if(!(a<0&&n<0&&r<0)){var s=this.videoPos._pi;if(!s&&this.media.videoHeight&&(s=this.media.videoWidth/this.media.videoHeight*100),s){this.videoPos.pi=s,a=a<0?0:a;var o={rotate:a},l=0,u=0,c=1,d=Math.abs(a/90),h=this.root,f=this.innerContainer,m=h.offsetWidth,p=f?f.offsetHeight:h.offsetHeight,v=p,g=m;if(d%2===0)c=n>0?100/n:r>0?100/r:1,o.scale=c,l=t>0?(100-n)/2-t:0,o.y=2===d?0-l:l,u=i>0?(100-r)/2-i:0,o.x=2===d?0-u:u,this.media.style.width="".concat(g,"px"),this.media.style.height="".concat(v,"px");else if(d%2===1){g=p,v=m;var y=p-m;u=-y/2/g*100,o.x=3===d?u+t/2:u-t/2,l=y/2/v*100,o.y=3===d?l+i/2:l-i/2,o.scale=c,this.media.style.width="".concat(g,"px"),this.media.style.height="".concat(v,"px")}var b=F.getTransformStyle(o,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=b,this.media.style.webkitTransform=b}}}},{key:"position",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{h:0,y:0,x:0,w:0};if(this.media&&e&&e.h){var t=this.videoPos;t.h=100*e.h||0,t.w=100*e.w||0,t.vx=100*e.x||0,t.vy=100*e.y||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map((function(i){if("plugins"!==i){t.config[i]=e[i];var n=t.plugins[i.toLowerCase()];n&&"Function"===F.typeOf(n.setConfig)&&n.setConfig(e[i])}}))}},{key:"playNext",value:function(e){var t=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,Tt(this,"playnext",(function(){t.start(),t.emit(je,e)}))}},{key:"resize",value:function(){var e=this;if(this.media){var t=this.root.getBoundingClientRect();this.sizeInfo.width=t.width,this.sizeInfo.height=t.height,this.sizeInfo.left=t.left,this.sizeInfo.top=t.top;var i=this.media,n=i.videoWidth,r=i.videoHeight,a=this.config,s=a.fitVideoSize,o=a.videoFillMode;if("fill"!==o&&"cover"!==o&&"contain"!==o||this.setAttribute("data-xgfill",o),r&&n){this._videoHeight=r,this._videoWidth=n;var l=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,u=t.width,c=t.height-l,d=parseInt(n/r*1e3,10),h=parseInt(u/c*1e3,10),f=u,m=c,p={};"auto"===s&&h>d||"fixWidth"===s?(m=u/d*1e3,this.config.fluid?p.paddingTop="".concat(100*m/f,"%"):p.height="".concat(m+l,"px")):("auto"===s&&h<d||"fixHeight"===s)&&(f=d*c/1e3,p.width="".concat(f,"px")),this.fullscreen||this.cssfullscreen||Object.keys(p).forEach((function(t){e.root.style[t]=p[t]})),("fillHeight"===o&&h<d||"fillWidth"===o&&h>d)&&this.setAttribute("data-xgfill","cover");var v={videoScale:d,vWidth:f,vHeight:m,cWidth:f,cHeight:m+l};this.resizePosition(),this.emit(Ke,v)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.media.updateObjectPosition?this.media.updateObjectPosition(e,t):this.media.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%")}},{key:"setState",value:function(e){W.logInfo("setState","state from:".concat(ti[this.state]," to:").concat(ti[e])),this._state=e}},{key:"_preProcessUrl",value:function(e,t){var i=this.config,n=i.preProcessUrl,r=i.preProcessUrlOptions,a=Object.assign({},r,t);return F.isBlob(e)||"function"!==typeof n?{url:e}:n(e,a)}},{key:"_seekToStartTime",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1)}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){"boolean"===typeof e&&(this._hasStart=e,!1===e&&this.setState(ei.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===ei.RUNNING||this._state===ei.ENDED},set:function(e){e?this.setState(ei.RUNNING):this._state>=ei.RUNNING&&this.setState(ei.ATTACHED)}},{key:"definitionList",get:function(){return this.config&&this.config.definition&&this.config.definition.list||[]},set:function(e){var t=this,i=this.config.definition,n=null,r=null;i.list=e,this.emit("resourceReady",e),e.forEach((function(e){var a;(null===(a=t.curDefinition)||void 0===a?void 0:a.definition)===e.definition&&(n=e),i.defaultDefinition===e.definition&&(r=e)})),!r&&e.length>0&&(r=e[0]),n?this.changeDefinition(n):r&&this.changeDefinition(r)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var t=this.media.getVideoPlaybackQuality();return e.dropped=t.droppedVideoFrames||0,e.total=t.totalVideoFrames||0,e.corrupted=t.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var t=$t.langKeys.filter((function(t){return t===e}));0!==t.length||"zh"===e?(this.config.lang=e,At.setLang(e,this)):console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat($t.langKeys.join(),"] "))}},{key:"i18n",get:function(){var e=this.config.lang;return"zh"===e&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return J}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return k(v(i.prototype),"readyState",this)}},{key:"error",get:function(){var e=k(v(i.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return k(v(i.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return!(null===this._fullScreenOffset)}},{key:"cumulateTime",get:function(){var e=this._accPlayed,t=e.acc,i=e.t;return i?(new Date).getTime()-i+t:t}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){e=F.convertDeg(e),e%90===0&&e!==this.videoPos.rotate&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return li},set:function(e){li=e}},{key:"realTimeSpeed",get:function(){return oi},set:function(e){oi=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,t){return pt.call.apply(pt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){return vt.call.apply(vt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){return gt.call.apply(gt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];return yt.call.apply(yt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];return bt.call.apply(bt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,t){var i;"boolean"===typeof t&&t!==this.muted&&(this.addInnerOP("volumechange"),F.typeOf(t)===Boolean&&(this.muted=t)),null===(i=ui)||void 0===i||i.setActive(this.playerId,e)}}],[{key:"debugger",get:function(){return W.config.debug},set:function(e){W.config.debug=e}},{key:"instManager",get:function(){return ui},set:function(e){ui=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return null===(e=ui)||void 0===e?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,t){var i;null===(i=ui)||void 0===i||i.setActive(e,t)}},{key:"isHevcSupported",value:function(){return j.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return j.probeConfigSupported(e)}},{key:"install",value:function(e,t){i.plugins||(i.plugins={}),i.plugins[e]||(i.plugins[e]=t)}},{key:"use",value:function(e,t){i.plugins||(i.plugins={}),i.plugins[e]=t}}]),i}(lt);function di(){return(new Date).getTime()}m(ci,"defaultPreset",null),m(ci,"XgVideoProxy",null),ci.instManager=ri.getInstance();var hi={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"},fi=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"_onTimeupdate",(function(){e._state.isTimeUpdate=!0,e._state.autoplayStart&&(W.logInfo("[xgLogger]".concat(e.player.playerId," _onTimeupdate")),e._sendFF("onTimeupdate"))})),m(b(e),"_onAutoplayStart",(function(){W.logInfo("[xgLogger]".concat(e.player.playerId," _onAutoplayStart")),e._state.autoplayStart=!0,e.vt&&e._sendFF("onAutoplayStart")})),m(b(e),"_onReset",(function(){e._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},e.vt=0,e.pt=0,e.fvt=0,e.newPointTime=di(),e.loadedCostTime=0,e.startCostTime=0,e._isSeeking=!1,e.seekingStart=0,e.waitingStart=0,e.fixedWaitingStart=0,e._isWaiting=!1,e._waitTimer&&F.clearTimeout(b(e),e._waitTimer),e._waittTimer&&F.clearTimeout(b(e),e._waittTimer),e._waitTimer=null,e._waittTimer=null,e._waitType=0})),m(b(e),"_onSeeking",(function(){e.seekingStart||(e.suspendWaitingStatus("seek"),e.seekingStart=di(),e.emitLog(hi.SEEK_START,{start:di()}))})),m(b(e),"_onSeeked",(function(){e.suspendSeekingStatus("seeked")})),m(b(e),"_onWaitingLoadStart",(function(){e._isWaiting||e.vt||(e._isWaiting=!0,e.waitingStart=di(),e.fixedWaitingStart=di(),e._waitType=1,e.emitLog(hi.WAIT_START,{fixedStart:e.fixedWaitingStart,start:e.waitingStart,type:1,endType:"loadstart"}))})),m(b(e),"_onWaiting",(function(){!e._isWaiting&&e.vt&&(e._isWaiting=!0,e.vt?e.seekingStart?e._waitType=2:e._waitType=0:e._waitType=1,e.fixedWaitingStart=di(),e._waitTimer=F.setTimeout(b(e),(function(){e._isWaiting&&(e.waitingStart=di(),F.clearTimeout(b(e),e._waitTimer),e._waitTimer=null,e._startWaitTimeout(),e.emitLog(hi.WAIT_START,{fixedStart:e.fixedWaitingStart,start:e.waitingStart,type:e._waitType,endType:2===e._waitType?"seek":"playing"}))}),200))})),m(b(e),"_onError",(function(){e.suspendSeekingStatus("error"),e.suspendWaitingStatus("error")})),m(b(e),"_onPlaying",(function(){e._isWaiting&&e.suspendWaitingStatus("playing")})),e}return f(i,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=di(),this.loadedCostTime=0,this.startCostTime=0,this.on(ge,(function(){var t=e._state,i=t.autoplayStart,n=t.isFFSend;e.startCostTime=di()-e.newPointTime,W.logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(i," isFFSend:").concat(n," startCostTime:").concat(e.startCostTime," newPointTime").concat(e.newPointTime)),n||(!t.isLs&&e.emitLog(hi.LOAD_START,{}),t.isLs=!0,t.isTimeUpdate=!1,t.isFFLoading=!0,e.pt=di(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())})),this.on(fe,(function(){e.vt=di(),e.fvt=e.vt-e.pt,e.loadedCostTime=e.vt-e.newPointTime;var t=e._state,i=t.isTimeUpdate,n=t.isFFSend,r=t.autoplayStart;W.logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate," loadedCostTime:").concat(e.loadedCostTime)),(i||r)&&e._sendFF("loadedData"),n||e.emitLog(hi.LOADED_DATA,{}),e.suspendWaitingStatus("loadeddata")})),this.on(ae,this._onSeeking),this.on(se,this._onSeeked),this.on(Me,(function(){e.endState("destroy")})),this.on(Ge,(function(){e.endState("urlChange"),W.logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._state.isFFSend&&e._onReset()})),this.on([te,ue],this._onPlaying),this.on(le,this._onWaiting),this.on(re,this._onError),this.on($e,(function(){W.logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()}))}},{key:"_initOnceEvents",value:function(){this.off(Ee,this._onAutoplayStart),this.off(oe,this._onTimeupdate),this.once(Ee,this._onAutoplayStart),this.once(oe,this._onTimeupdate)}},{key:"_sendFF",value:function(e){this.s=di();var t=this._state,i=t.isFFLoading,n=t.isFFSend;W.logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(e," fvt:").concat(this.fvt," isFFLoading:").concat(i," !isFFSend:").concat(!n)),this.vt>0&&i&&!n&&(W.logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(hi.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&F.clearTimeout(this,this._waittTimer),this._waittTimer=F.setTimeout(this,(function(){e.suspendWaitingStatus("timeout"),F.clearTimeout(e,e._waittTimer),e._waittTimer=null}),this.config.waitTimeout)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var t=di(),i=t-this.seekingStart;this.seekingStart=0,this.emitLog(hi.SEEK_END,{end:t,costTime:i,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(F.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(F.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,this.waitingStart){var t=di(),i=t-this.waitingStart,n=t-this.fixedWaitingStart,r=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(hi.WAIT_END,{fixedCostTime:n>r?r:n,costTime:i>r?r:i,type:"loadeddata"===e?1:this._waitType,endType:2===this._waitType?"seek":e})}}},{key:"emitLog",value:function(e,t){var i=this.player;this.emit(Qe,u({t:di(),host:F.getHostFromUrl(i.currentSrc),vtype:i.vtype,eventType:e,currentTime:this.player.currentTime,readyState:i.video.readyState,networkState:i.video.networkState},t))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),i}(Dt);function mi(){return(new DOMParser).parseFromString('<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">\n  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var pi=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"registerIcons",value:function(){return{replay:mi}}},{key:"afterCreate",value:function(){var e=this;Dt.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",(function(){e.player.replay()}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(ie,(function(){if(e.playerConfig.loop||F.addClass(e.player.root,"replay"),!e.config.disable){e.show();var t=e.root.querySelector("path");if(t){var i=window.getComputedStyle(t).getPropertyValue("transform");if("string"===typeof i&&i.indexOf("none")>-1)return null;t.setAttribute("transform",i)}}})),this.on(ee,(function(){e.hide()}))}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),F.removeClass(this.player.root,"replay")}},{key:"show",value:function(e){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return'<xg-replay class="xgplayer-replay">\n      <xg-replay-txt class="xgplayer-replay-txt" lang-key="'.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,"</xg-replay-txt>\n    </xg-replay>")}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),i}(Dt),vi=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){F.addClass(this.root,"hide")}},{key:"show",value:function(e){F.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){"string"===typeof e.player.config.poster&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(ie,(function(){e.isEndedShow&&F.removeClass(e.root,"hide")})),this.config.hideCanplay?(this.once(oe,(function(){e.onTimeUpdate()})),this.on(Ge,(function(){F.removeClass(e.root,"hide"),F.addClass(e.root,"xg-showplay"),e.once(oe,(function(){e.onTimeUpdate()}))}))):this.on(ee,(function(){F.addClass(e.root,"hide")}))}},{key:"setConfig",value:function(e){var t=this;Object.keys(e).forEach((function(i){t.config[i]=e[i]}));var i=this.config.poster;this.update(i)}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?F.removeClass(this.root,"xg-showplay"):this.once(oe,(function(){e.onTimeUpdate()}))}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"getBgSize",value:function(e){var t="";switch(e){case"cover":t="cover";break;case"contain":t="contain";break;case"fixHeight":t="auto 100%";break;default:t=""}return t?"background-size: ".concat(t,";"):""}},{key:"render",value:function(){var e=this.config,t=e.poster,i=e.hideCanplay,n=e.fillMode,r=e.notHidden,a=this.getBgSize(n),s=t?"background-image:url(".concat(t,");").concat(a):a,o=r?"xg-not-hidden":i?"xg-showplay":"";return'<xg-poster class="xgplayer-poster '.concat(o,'" style="').concat(s,'">\n    </xg-poster>')}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}}]),i}(Dt);function gi(){return(new DOMParser).parseFromString('<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n',"image/svg+xml").firstChild}function yi(){return(new DOMParser).parseFromString('<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n',"image/svg+xml").firstChild}var bi={};function Li(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{start:null,end:null};return bi[e]&&window.clearTimeout(bi[e].id),bi[e]={},i.start&&i.start(),bi[e].id=window.setTimeout((function(){i.end&&i.end(),window.clearTimeout(bi[e].id),delete bi[e]}),t),bi[e].id}function Si(e){e?window.clearTimeout(e):Object.keys(bi).map((function(e){window.clearTimeout(bi[e].id),delete bi[e]}))}var Ti=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),m(b(n),"onPlayerReset",(function(){n.autoPlayStart=!1;var e="auto"===n.config.mode?"auto-hide":"hide";n.setAttr("data-state","play"),F.removeClass(n.root,e),n.show()})),m(b(n),"onAutoplayStart",(function(){if(!n.autoPlayStart){var e="auto"===n.config.mode?"auto-hide":"hide";F.addClass(n.root,e),n.autoPlayStart=!0,n.onPlayPause("play")}})),n.autoPlayStart=!1,n}return f(i,[{key:"afterCreate",value:function(){var e=this,t=this.player,i=this.playerConfig;this.initIcons(),this.once(Re,(function(){i&&(i.lang&&"en"===i.lang?F.addClass(t.root,"lang-is-en"):"jp"===i.lang&&F.addClass(t.root,"lang-is-jp"))})),this.on(Ee,this.onAutoplayStart),i.autoplay||this.show(),this.on(Ze,(function(){var t="auto"===e.config.mode?"auto-hide":"hide";e.setAttr("data-state","play"),F.removeClass(e.root,t),e.show()})),this.on(ee,(function(){e.onPlayPause("play")})),this.on(ne,(function(){e.onPlayPause("pause")})),this.on($e,(function(){e.onPlayerReset()})),this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(t){t.cancelable&&t.preventDefault(),t.stopPropagation();var i=e.player.paused;e.emitUserAction(t,"switch_play_pause",{props:"paused",from:i,to:!i})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:gi,class:"xg-icon-play"},startPause:{icon:yi,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){F.addClass(this.root,"hide")}},{key:"show",value:function(e){F.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){F.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){F.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var t=this;this._animateId=Li("pauseplay",400,{start:function(){F.addClass(t.root,"interact"),t.show(),t.switchStatus(!0)},end:function(){F.removeClass(t.root,"interact"),!e&&t.hide(),t._animateId=null}})}},{key:"endAnimate",value:function(){F.removeClass(this.root,"interact"),Si(this._animateId),this._animateId=null}},{key:"switchPausePlay",value:function(e){var t=this.player;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),!(t.state<ei.READY)){var i=this.player.paused;i||t.state!==ei.RUNNING?t.play():t.pause()}}},{key:"onPlayPause",value:function(e){var t=this.config,i=this.player;if(i&&!(i.state<ei.RUNNING)&&this.autoPlayStart){if("show"===t.mode)return this.switchStatus(),void this.show();if("auto"!==t.mode){if(t.isShowPause&&i.paused&&!i.ended||t.isShowEnd&&i.ended)return this.switchStatus(),this.show(),void this.endAnimate();if(t.disableAnimate)return this.switchStatus(),void this.hide();if("play"===e)this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||i.ended)return;this.animate()}}else this.switchStatus()}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),Si(this._animateId)}},{key:"render",value:function(){var e=this.playerConfig.autoplay?"auto"===this.config.mode?"auto-hide":"hide":"";return'\n    <xg-start class="xgplayer-start '.concat(e,'">\n    <xg-start-inner></xg-start-inner>\n    </xg-start>')}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),i}(Dt),ki=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"render",value:function(){var e=this.config.innerHtml,t=F.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)t.appendChild(e);else if(e&&"string"===typeof e)t.innerHTML=e;else{for(var i="",n=1;n<=12;n++)i+='<div class="xgplayer-enter-bar'.concat(n,'"></div>');t.innerHTML='<div class="xgplayer-enter-spinner">'.concat(i,"</div>")}return t}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),i}(Dt);function xi(e,t,i){try{return' <div class="xg-tips '.concat(i?"hide":" ",'" lang-key="').concat(e.i18nKeys[t],'">\n    ').concat(e.i18n[t],"\n    </div>")}catch(n){return'<div class="xg-tips hide"></div>'}}var Ri=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return'\n      <xg-icon class="xgplayer-miniicon">\n      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</span></div>\n      </xg-icon>")}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:10}}}]),i}(Dt);function wi(e){var t=parseFloat(e),i=-1===e.indexOf("%")&&!Number.isNaN(t);return i&&t}var Ei=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],Zi=Ei.length;function Ci(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<Zi;t++){var i=Ei[t];e[i]=0}return e}function Ii(e){var t=window.getComputedStyle(e);return t}function Mi(e){if("string"===typeof e&&(e=document.querySelector(e)),e&&"object"===c(e)&&e.nodeType){var t=Ii(e);if("none"===t.display)return Ci();var i={};i.width=e.offsetWidth,i.height=e.offsetHeight;for(var n=i.isBorderBox="border-box"===t.boxSizing,r=0;r<Zi;r++){var a=Ei[r],s=t[a],o=parseFloat(s);i[a]=Number.isNaN(o)?0:o}var l=i.paddingLeft+i.paddingRight,u=i.paddingTop+i.paddingBottom,d=i.marginLeft+i.marginRight,h=i.marginTop+i.marginBottom,f=i.borderLeftWidth+i.borderRightWidth,m=i.borderTopWidth+i.borderBottomWidth,p=n,v=wi(t.width);!1!==v&&(i.width=v+(p?0:l+f));var g=wi(t.height);return!1!==g&&(i.height=g+(p?0:u+m)),i.innerWidth=i.width-(l+f),i.innerHeight=i.height-(u+m),i.outerWidth=i.width+d,i.outerHeight=i.height+h,i}}function Gi(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.identifier===t)return n}}var Xi={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},_i={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},Pi=function(e){p(i,e);var t=S(i);function i(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(this,i),n=t.call(this),n.isEnabled=!0,n.isDragging=!1,n.isDown=!1,n.position={},n.downPoint={},n.dragPoint={x:0,y:0},n.startPos={x:0,y:0},n._root=e instanceof Element?e:document.querySelector(e),n._handlerDom=r.handle instanceof Element?r.handle:document.querySelector(r.handle),n._root&&n._handlerDom?(n._bindStartEvent(),n):L(n)}return f(i,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),_i[this._startKey].map((function(t){e["on".concat(t)]=e["on".concat(t)].bind(e)}))}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var t=this;if(e){var i=_i[this._startKey];i.map((function(e){window.addEventListener(e,t["on".concat(e)])})),this._boundPointerEvents=i}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map((function(t){window.removeEventListener(t,e["on".concat(t)])})),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame((function(){e.animate()})))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var t=e.changedTouches[0];this.dragStart(e,t),this.touchIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var t=Gi(e.changedTouches,this.touchIdentifier);t&&this.dragMove(e,t)}},{key:"ontouchend",value:function(e){var t=Gi(e.changedTouches,this.touchIdentifier);t&&this.dragEnd(e,t),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var t=Gi(e.changedTouches,this.touchIdentifier);t&&this.dragCancel(e,t)}},{key:"dragStart",value:function(e,t){if(this._root&&!this.isDown&&this.isEnabled){this.downPoint=t,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var i=Mi(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-i.height,this.startPos.maxX=window.innerWidth-i.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,t){this.isDragging=!0,this.animate(),this.emit(Xi.START,this.startPos)}},{key:"dragEnd",value:function(e,t){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(Xi.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,t){var i={x:t.pageX-this.downPoint.pageX,y:t.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(i)&&this.dragRealStart(e,t),i}},{key:"dragMove",value:function(e,t){if(e=e||window.event,this.isDown){var i=this.startPos,n=i.x,r=i.y,a=this._dragPointerMove(e,t),s=a.x,o=a.y;s=this.checkContain("x",s,n),o=this.checkContain("y",o,r),this.position.x=n+s,this.position.y=r+o,this.dragPoint.x=s,this.dragPoint.y=o,this.emit(Xi.MOVE,this.position)}}},{key:"dragCancel",value:function(e,t){this.dragEnd(e,t)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,t,i){return t+i<0?0-i:"x"===e&&t+i>this.startPos.maxX?this.startPos.maxX-i:"y"===e&&t+i>this.startPos.maxY?this.startPos.maxY-i:t}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),t=this._getPositionCoord(e.left,"width"),i=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(t)?0:t,this.position.y=Number.isNaN(i)?0:i,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var t=e.transform;if(0===t.indexOf("matrix")){var i=t.split(","),n=0===t.indexOf("matrix3d")?12:4,r=parseInt(i[n],10),a=parseInt(i[n+1],10);this.position.x+=r,this.position.y+=a}}},{key:"_getPositionCoord",value:function(e,t){if(-1!==e.indexOf("%")){var i=Mi(this._root.parentNode);return i?parseFloat(e)/100*i[t]:0}return parseInt(e,10)}}]),i}(X.a),Di=function(e){p(i,e);var t=S(i);function i(e){var n;d(this,i),n=t.call(this,e),m(b(n),"onCancelClick",(function(e){n.exitMini(),n.isClose=!0})),m(b(n),"onCenterClick",(function(e){var t=b(n),i=t.player;i.paused?i.play():i.pause()})),m(b(n),"onScroll",(function(e){if(!(!window.scrollY&&0!==window.scrollY||Math.abs(window.scrollY-n.pos.scrollY)<50)){var t=parseInt(F.getCss(n.player.root,"height"));t+=n.config.scrollTop,n.pos.scrollY=window.scrollY,window.scrollY>t+5?!n.isMini&&!n.isClose&&n.getMini():window.scrollY<=t&&(n.isMini&&n.exitMini(),n.isClose=!1)}})),n.isMini=!1,n.isClose=!1;var r=b(n),a=r.config;return n.pos={left:a.left<0?window.innerWidth-a.width-20:a.left,top:a.top<0?window.innerHeight-a.height-20:a.top,height:n.config.height,width:n.config.width,scrollY:window.scrollY||0},n.lastStyle=null,n}return f(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.mini&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(ne,(function(){e.setAttr("data-state","pause")})),this.on(ee,(function(){e.setAttr("data-state","play")}))}},{key:"onPluginsReady",value:function(){var e=this,t=this.player,i=this.config;if(!i.disable){if(this.config.isShowIcon){var n={config:{onClick:function(){e.getMini()}}};t.controls.registerPlugin(Ri,n,Ri.pluginName)}var r=F.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",r,this.onCancelClick),this.bind(".play-icon",r,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new Pi(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:gi,class:"xg-icon-play"},pause:{icon:yi,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var t=this.player,i=this.playerConfig,n=this.config.target||this.player.root;this.lastStyle={},F.addClass(t.root,"xgplayer-mini"),["width","height","top","left"].map((function(t){e.lastStyle[t]=n.style[t],n.style[t]="".concat(e.pos[t],"px")})),i.fluid&&(n.style["padding-top"]=""),this.emit(Ne,!0),t.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var t=this.player,i=this.playerConfig,n=this.config.target||this.player.root;F.removeClass(t.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map((function(t){n.style[t]=e.lastStyle[t]})),this.lastStyle=null,i.fluid&&(t.root.style.width="100%",t.root.style.height="0",t.root.style["padding-top"]="".concat(100*i.height/i.width,"%")),this.emit(Ne,!1),this.isMini=t.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=F.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return'\n      <xg-mini-layer class="xg-mini-layer">\n      <xg-mini-header class="xgplayer-mini-header">\n      '.concat(xi(this,"MINI_DRAG",this.playerConfig.isHideTips),'\n      </xg-mini-header>\n      <div class="mini-cancel-btn">\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>\n        </svg>\n      </div>\n      <div class="play-icon">\n      </div>\n      </xg-mini-layer>')}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),i}(Dt),Wi={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},Vi=["videoClick","videoDbClick"],Ni=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onMouseMove",(function(t){var i=b(e),n=i.player,r=i.playerConfig;n.isActive||(n.focus({autoHide:!r.closeDelayBlur}),!r.closeFocusVideoFocus&&n.media.focus())})),m(b(e),"onMouseEnter",(function(t){var i=b(e),n=i.playerConfig,r=i.player;!n.closeFocusVideoFocus&&r.media.focus(),n.closeDelayBlur?r.focus({autoHide:!1}):r.focus(),e.emit(Pe)})),m(b(e),"onMouseLeave",(function(t){var i=e.playerConfig,n=i.closePlayerBlur,r=i.leavePlayerTime,a=i.closeDelayBlur;n||a||(r?e.player.focus({autoHide:!0,delay:r}):e.player.blur({ignorePaused:!0})),e.emit(_e)})),m(b(e),"onVideoClick",(function(t){var i=b(e),n=i.player,r=i.playerConfig;t.target&&r.closeVideoClick||t.target!==n.root&&t.target!==n.media&&t.target!==n.innerContainer&&t.target!==n.media.__canvas||(t.preventDefault(),r.closeVideoStopPropagation||t.stopPropagation(),e._clickCount++,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),e.clickTimer=setTimeout((function(){e._clickCount&&(e._clickCount--,Tt(b(e),Vi[0],(function(t,i){e.switchPlayPause(i.e)}),{e:t,paused:n.paused}),clearTimeout(e.clickTimer),e.clickTimer=null)}),300))})),m(b(e),"onVideoDblClick",(function(t){var i=b(e),n=i.player,r=i.playerConfig;r.closeVideoDblclick||!t.target||t.target!==n.media&&t.target!==n.media.__canvas||(!r.closeVideoClick&&e._clickCount<2?e._clickCount=0:(e._clickCount=0,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),t.preventDefault(),t.stopPropagation(),Tt(b(e),Vi[1],(function(t,i){e.emitUserAction(i.e,"switch_fullscreen",{props:"fullscreen",from:n.fullscreen,to:!n.fullscreen}),n.fullscreen?n.exitFullscreen():n.getFullscreen()}),{e:t,fullscreen:n.fullscreen})))})),e}return f(i,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,Vi.map((function(t){e.__hooks[t]=null}));var t=this.playerConfig.isMobileSimulateMode;"mobile"===t||"mobile"===j.device&&!j.os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var e=this,t=this.player,i=t.media,n=t.root,r=this.playerConfig.enableContextmenu;n&&n.addEventListener("click",this.onVideoClick,!1),n&&n.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(Wi).map((function(t){n.addEventListener(t,e[Wi[t]],!1)})),!r&&i&&i.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var t=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:t.paused,to:!t.paused}),t.ended?t.duration!==1/0&&t.duration>0&&t.replay():t.paused?t.play():t.pause()}},{key:"onContextmenu",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,t=this.player,i=t.video,n=t.root;this.clickTimer&&clearTimeout(this.clickTimer),n.removeEventListener("click",this.onVideoClick,!1),n.removeEventListener("dblclick",this.onVideoDblClick,!1),i.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(Wi).map((function(t){n.removeEventListener(t,e[Wi[t]],!1)}))}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),i}(xt),Fi={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},Ai={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Yi={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function Oi(e){return e&&e.length>0?e[e.length-1]:null}function Hi(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var Ki=function(){function e(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eventType:"touch"};d(this,e),m(this,"onTouchStart",(function(e){var t=i._pos,n=i.root,r=Oi(e.touches);t.x=r?parseInt(r.pageX,10):e.pageX,t.y=r?parseInt(r.pageX,10):e.pageX,t.start=!0,i.__setPress(e),n.addEventListener(i.events.end,i.onTouchEnd),n.addEventListener(i.events.cancel,i.onTouchCancel),n.addEventListener(i.events.move,i.onTouchMove),i.trigger(Fi.TOUCH_START,e)})),m(this,"onTouchCancel",(function(e){i.onTouchEnd(e)})),m(this,"onTouchEnd",(function(e){var t=i._pos,n=i.root;i.__clearPress(),n.removeEventListener(i.events.cancel,i.onTouchCancel),n.removeEventListener(i.events.end,i.onTouchEnd),n.removeEventListener(i.events.move,i.onTouchMove),e.moving=t.moving,e.press=t.press,t.press&&i.trigger(Fi.PRESS_END,e),i.trigger(Fi.TOUCH_END,e),!t.press&&!t.moving&&i.__setDb(e),t.press=!1,t.start=!1,t.moving=!1})),m(this,"onTouchMove",(function(e){var t=i._pos,n=i.config,r=Oi(e.touches),a=r?parseInt(r.pageX,10):e.pageX,s=r?parseInt(r.pageY,10):e.pageX,o=a-t.x,l=s-t.y;Math.abs(l)<n.miniStep&&Math.abs(o)<n.miniStep||(i.__clearPress(),t.press&&i.trigger(Fi.PRESS_END,e),t.press=!1,t.moving=!0,i.trigger(Fi.TOUCH_MOVE,e))})),this._pos={moving:!1,start:!1,x:0,y:0},this.config=Hi(),Object.keys(n).map((function(e){i.config[e]=n[e]})),this.root=t,this.events="mouse"===n.eventType?Yi:Ai,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return f(e,[{key:"_initEvent",value:function(){this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(e){var t=this,i=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout((function(){t.trigger(Fi.PRESS,e),t._pos.press=!0,t.__clearPress()}),i.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(e){var t=this,i=this.config;if(this.dbIntrvalId)return this.__clearDb(),void this.trigger(Fi.DOUBlE_CLICK,e);this.dbIntrvalId=setTimeout((function(){t.__clearDb(),t._pos.start||t._pos.press||t._pos.moving||t.trigger(Fi.CLICK,e)}),i.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(e,t){this.__handlers[e]||(this.__handlers[e]=[]),this.__handlers[e].push(t)}},{key:"off",value:function(e,t){if(this.__handlers[e]){for(var i=this.__handlers[e],n=-1,r=0;r<i.length;r++)if(i[r]===t){n=r;break}n>=0&&this.__handlers[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.__handlers[e]&&this.__handlers[e].map((function(i){try{i(t)}catch(n){console.error("trigger>>:".concat(e),n)}}))}},{key:"destroy",value:function(){var e=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).forEach((function(i){e.root.removeEventListener(i,e[t[i]])}))}}]),e}();function Ui(){return(new DOMParser).parseFromString('<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"\n  xmlns:xlink="http://www.w3.org/1999/xlink">\n  <path opacity="0.54"\n    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"\n    fill="white" />\n  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}var Bi={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},zi=["videoClick","videoDbClick"],ji=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),m(b(n),"onTouchStart",(function(e){var t=b(n),i=t.player,r=t.config,a=t.pos,s=t.playerConfig,o=n.getTouche(e);if(o&&!r.disableGesture&&n.duration>0&&!i.ended){a.isStart=!0,n.timer&&clearTimeout(n.timer),F.checkIsFunction(s.disableSwipeHandler)&&s.disableSwipeHandler(),n.find(".xg-dur").innerHTML=F.format(n.duration);var l=n.root.getBoundingClientRect();90===i.rotateDeg?(a.top=l.left,a.left=l.top,a.width=l.height,a.height=l.width):(a.top=l.top,a.left=l.left,a.width=l.width,a.height=l.height);var u=parseInt(o.pageX-a.left,10),c=parseInt(o.pageY-a.top,10);a.x=90===i.rotateDeg?c:u,a.y=90===i.rotateDeg?u:c,a.scopeL=r.scopeL*a.width,a.scopeR=(1-r.scopeR)*a.width,a.scopeM1=a.width*(1-r.scopeM)/2,a.scopeM2=a.width-a.scopeM1}})),m(b(n),"onTouchMove",(function(e){var t=n.getTouche(e),i=b(n),r=i.pos,a=i.config,s=i.player;if(t&&!a.disableGesture&&n.duration&&r.isStart){var o=a.miniMoveStep,l=a.hideControlsActive,u=parseInt(t.pageX-r.left,10),c=parseInt(t.pageY-r.top,10),d=90===s.rotateDeg?c:u,h=90===s.rotateDeg?u:c;if(Math.abs(d-r.x)>o||Math.abs(h-r.y)>o){var f=d-r.x,m=h-r.y,p=r.scope;if(-1===p&&(p=n.checkScope(d,h,f,m,r),0===p&&(l?s.blur():s.focus({autoHide:!1}),!r.time&&(r.time=parseInt(1e3*s.currentTime,10)+1e3*n.timeOffset)),r.scope=p),-1===p||p>0&&!a.gestureY||0===p&&!a.gestureX)return;n.executeMove(f,m,p,r.width,r.height),r.x=d,r.y=h}}})),m(b(n),"onTouchEnd",(function(e){var t=b(n),i=t.player,r=t.pos,a=t.playerConfig;if(setTimeout((function(){i.getPlugin("progress")&&i.getPlugin("progress").resetSeekState()}),10),r.isStart){r.scope>-1&&e.cancelable&&e.preventDefault();var s=n.config,o=s.disableGesture,l=s.gestureX;!o&&l?n.endLastMove(r.scope):r.time=0,r.scope=-1,n.resetPos(),F.checkIsFunction(a.enableSwipeHandler)&&a.enableSwipeHandler(),n.changeAction(Bi.AUTO)}})),m(b(n),"onRootTouchMove",(function(e){!n.config.disableGesture&&n.config.gestureX&&n.checkIsRootTarget(e)&&(e.stopPropagation(),n.pos.isStart?n.onTouchMove(e):n.onTouchStart(e))})),m(b(n),"onRootTouchEnd",(function(e){n.pos.scope>-1&&n.onTouchEnd(e)})),n.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},n.timer=null,n}return f(i,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:Ui,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this;zi.map((function(t){e.__hooks[t]=null}));var t=this.playerConfig,i=this.config,n=this.player;!0===t.closeVideoDblclick&&(i.closedbClick=!0),this.resetPos(),F.isUndefined(t.disableGesture)||(i.disableGesture=!!t.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=F.createDom("xg-mask","",{},"xgmask"),n.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var r="mouse"===this.domEventType?"mouse":"touch";this.touch=new Ki(this.root,{eventType:r,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",(function(e){e.preventDefault()})),n.root.addEventListener("touchmove",this.onRootTouchMove,!0),n.root.addEventListener("touchend",this.onRootTouchEnd,!0),n.root.addEventListener("touchcancel",this.onRootTouchEnd,!0);var a=this.player.controls;a&&a.center&&(a.center.addEventListener("touchmove",this.onRootTouchMove,!0),a.center.addEventListener("touchend",this.onRootTouchEnd,!0),a.center.addEventListener("touchcancel",this.onRootTouchEnd,!0)),this.on(de,(function(){var t=e.player,i=e.config;1e3*t.duration<i.moveDuration&&(i.moveDuration=1e3*t.duration)})),this.on([ue,ie],(function(){var t=e.pos,i=t.time,n=t.isStart;!n&&i>0&&(e.pos.time=0)}));var s={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(s).map((function(t){e.touch.on(t,(function(i){e[s[t]](i)}))})),!i.disableActive){var o=n.plugins.progress;o&&(o.addCallBack("dragmove",(function(t){e.activeSeekNote(t.currentTime,t.forward)})),["dragend","click"].forEach((function(t){o.addCallBack(t,(function(){e.changeAction(Bi.AUTO)}))})))}}},{key:"registerThumbnail",value:function(){var e=this.player,t=e.plugins.thumbnail;if(t&&t.usable){this.thumbnail=t.createThumbnail(null,"mobile-thumbnail");var i=this.find(".time-preview");i.insertBefore(this.thumbnail,i.children[0])}}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},t=e.commonStyle,i=t.playedColor,n=t.progressColor,r=t.timePreviewStyle,a=t.curTimeColor,s=t.durationColor;if(i&&(this.find(".xg-curbar").style.backgroundColor=i),n&&(this.find(".xg-bar").style.backgroundColor=n),r){var o=this.find(".time-preview");Object.keys(r).forEach((function(e){o.style[e]=r[e]}))}var l=a||i,u=s;l&&(this.find(".xg-cur").style.color=l),u&&(this.find(".xg-dur").style.color=u),this.config.disableTimeProgress&&F.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map((function(t){e.pos[t]=0}))):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var t=this.player,i=this.root;i.setAttribute("data-xg-action",e);var n=t.plugins.start;n&&n.recover()}},{key:"getTouche",value:function(e){this.player.rotateDeg;var t=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return{pageX:t.pageX,pageY:t.pageY}}},{key:"checkScope",value:function(e,t,i,n,r){var a=r.width,s=-1;if(e<0||e>a)return s;var o=0===n?Math.abs(i):Math.abs(i/n);return Math.abs(i)>0&&o>=1.73&&e>r.scopeM1&&e<r.scopeM2?s=0:(0===Math.abs(i)||o<=.57)&&(s=e<r.scopeL?1:e>r.scopeR?2:3),s}},{key:"executeMove",value:function(e,t,i,n,r){switch(i){case 0:this.updateTime(e/n*this.config.scopeM);break;case 1:this.updateBrightness(t/r);break;case 2:j.os.isIos||this.updateVolume(t/r);break}}},{key:"endLastMove",value:function(e){var t=this,i=this.pos,n=this.player,r=this.config,a=(i.time-this.timeOffset)/1e3;switch(e){case 0:n.seek(Number(a).toFixed(1)),r.hideControlsEnd?n.blur():n.focus(),this.timer=setTimeout((function(){t.pos.time=0}),500);break}this.changeAction(Bi.AUTO)}},{key:"checkIsRootTarget",value:function(e){var t=this.player.plugins||{};return(!t.progress||!t.progress.root.contains(e.target))&&(t.start&&t.start.root.contains(e.target)||t.controls&&t.controls.root.contains(e.target))}},{key:"sendUseAction",value:function(e){var t=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t,to:!t})}},{key:"clickHandler",value:function(e){var t=this.player,i=this.config,n=this.playerConfig;t.state<ei.RUNNING?n.closeVideoClick||(this.sendUseAction(F.createEvent("click")),t.play()):!i.closedbClick||n.closeVideoClick?t.isActive?t.blur():t.focus():n.closeVideoClick||((t.isActive||i.focusVideoClick)&&(this.sendUseAction(F.createEvent("click")),this.switchPlayPause()),t.focus())}},{key:"dbClickHandler",value:function(e){var t=this.config,i=this.player;!t.closedbClick&&i.state>=ei.RUNNING&&(this.sendUseAction(F.createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(e){var t=this,i=this.player;Tt(this,zi[0],(function(e,i){t.clickHandler(i.e)}),{e:e,paused:i.paused})}},{key:"onDbClick",value:function(e){var t=this,i=this.player;Tt(this,zi[1],(function(e,i){t.dbClickHandler(i.e)}),{e:e,paused:i.paused})}},{key:"onPress",value:function(e){var t=this.pos,i=this.config,n=this.player;i.disablePress||(t.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:n.playbackRate,to:i.pressRate}),n.playbackRate=i.pressRate,this.changeAction(Bi.PLAYBACK))}},{key:"onPressEnd",value:function(e){var t=this.pos,i=this.config,n=this.player;i.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:n.playbackRate,to:t.rate}),n.playbackRate=t.rate,t.rate=1,this.changeAction(Bi.AUTO))}},{key:"updateTime",value:function(e){var t=this.player,i=this.config,n=this.player.duration;e=Number(e.toFixed(4));var r=parseInt(e*i.moveDuration,10)+this.timeOffset;r+=this.pos.time,r=r<0?0:r>1e3*n?1e3*n-200:r,t.getPlugin("time")&&t.getPlugin("time").updateTime(r/1e3),t.getPlugin("progress")&&t.getPlugin("progress").updatePercent(r/1e3/this.duration,!0),this.activeSeekNote(r/1e3,e>0),i.isTouchingSeek&&t.seek(Number((r-this.timeOffset)/1e3).toFixed(1)),this.pos.time=r}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var t=this.player,i=this.pos;if(e=parseInt(100*e,10),i.volume+=e,!(Math.abs(i.volume)<10)){var n=parseInt(10*t.volume,10)-parseInt(i.volume/10,10);n=n>10?10:n<1?0:n,t.volume=n/10,i.volume=0}}},{key:"updateBrightness",value:function(e){var t=this.pos,i=this.config,n=this.xgMask;if(i.darkness){this.player.rotateDeg&&(e=-e);var r=t.light+.8*e;r=r>i.maxDarkness?i.maxDarkness:r<0?0:r,n&&(n.style.backgroundColor="rgba(0,0,0,".concat(r,")")),t.light=r}}},{key:"activeSeekNote",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.player,n=this.config,r=!(this.duration!==1/0&&this.duration>0);if(e&&"number"===typeof e&&!r&&!n.disableActive){e<0?e=0:e>i.duration&&(e=i.duration-.2),this.changeAction(Bi.SEEKING);var a=i.plugins.start;a&&a.focusHide(),this.find(".xg-dur").innerHTML=F.format(this.duration),this.find(".xg-cur").innerHTML=F.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),t?F.removeClass(this.find(".xg-seek-show"),"xg-back"):F.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var t=this.player,i=t.plugins.thumbnail;i&&i.usable&&this.thumbnail&&i.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<ei.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!1}},{key:"enableGesture",value:function(){this.config.disableGesture=!0}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0),e.root.removeEventListener("touchcancel",this.onRootTouchEnd,!0);var t=this.player.controls;t&&t.center&&(t.center.removeEventListener("touchmove",this.onRootTouchMove,!0),t.center.removeEventListener("touchend",this.onRootTouchEnd,!0),t.center.removeEventListener("touchcancel",this.onRootTouchEnd,!0))}},{key:"render",value:function(){var e="normal"!==this.config.gradient?"gradient ".concat(this.config.gradient):"gradient";return'\n     <xg-trigger class="trigger">\n     <div class="'.concat(e,'"></div>\n        <div class="time-preview">\n            <div class="xg-seek-show ').concat(this.config.disableSeekIcon?" hide-seek-icon":"",'">\n              <i class="xg-seek-icon"></i>\n              <span class="xg-cur">00:00</span>\n              <span class="xg-separator">/</span>\n              <span class="xg-dur">00:00</span>\n            </div>\n              <div class="xg-bar xg-timebar">\n                <div class="xg-curbar"></div>\n              </div>\n        </div>\n        <div class="xg-playbackrate xg-top-note">\n            <span><i>').concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,"</span>\n        </div>\n     </xg-trigger>\n    ")}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:36e4,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),i}(Dt);function Ji(e){e.preventDefault(),e.returnValue=!1}function Qi(e){var t=e.tagName;return!("INPUT"!==t&&"TEXTAREA"!==t&&!e.isContentEditable)}var qi=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onBodyKeyDown",(function(t){if(e.player){var i=t||window.event,n=i.keyCode,r=b(e),a=r._keyState,s=r.player,o=e.config,l=o.disable,u=o.disableBodyTrigger,c=o.isIgnoreUserActive;l||u||!s.isUserActive&&!c||Qi(i.target)||!e.checkIsVisible()||i.metaKey||i.altKey||i.ctrlKey?a.isBodyKeyDown=!1:(t.repeat||a.isKeyDown||((i.target===document.body||e.config.isGlobalTrigger&&!Qi(i.target))&&e.checkCode(n,!0)&&(a.isBodyKeyDown=!0),document.addEventListener("keyup",e.onBodyKeyUp)),a.isBodyKeyDown&&e.handleKeyDown(i))}})),m(b(e),"onBodyKeyUp",(function(t){e.player&&(document.removeEventListener("keyup",e.onBodyKeyUp),e.handleKeyUp(t))})),m(b(e),"onKeydown",(function(t){if(e.player){var i=t||window.event,n=b(e),r=n._keyState;if(!i.repeat){if(e.config.disable||e.config.disableRootTrigger||i.metaKey||i.altKey||i.ctrlKey)return;!i||37!==i.keyCode&&!e.checkCode(i.keyCode)||i.target!==e.player.root&&i.target!==e.player.video&&i.target!==e.player.controls.el||(r.isKeyDown=!0),e.player.root.addEventListener("keyup",e.onKeyup)}r.isKeyDown&&e.handleKeyDown(i)}})),m(b(e),"onKeyup",(function(t){e.player&&(e.player.root.removeEventListener("keyup",e.onKeyup),e.handleKeyUp(t))})),e}return f(i,[{key:"mergekeyCodeMap",value:function(){var e=this,t=this.config.keyCodeMap;t&&Object.keys(t).map((function(i){e.keyCodeMap[i]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map((function(n){t[i][n]&&(e.keyCodeMap[i][n]=t[i][n])})):e.keyCodeMap[i]=t[i]}))}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e="function"===typeof this.config.seekStep?this.config.seekStep(this.player):this.config.seekStep;e&&"number"===typeof e&&(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"setConfig",value:function(e){var t=this;Object.keys(e).forEach((function(i){t.config[i]=e[i]}))}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),t=e.height,i=e.top,n=e.bottom,r=window.innerHeight;return!(i<0&&i<0-.9*t||n>0&&n-r>.9*t)}},{key:"checkCode",value:function(e,t){var i=this,n=!1;return Object.keys(this.keyCodeMap).map((function(r){i.keyCodeMap[r]&&e===i.keyCodeMap[r].keyCode&&!i.keyCodeMap[r].disable&&(n=!t||t&&!i.keyCodeMap[r].noBodyTarget)})),n}},{key:"downVolume",value:function(e){var t=this.player;if(!(t.volume<=0)){var i=parseFloat((t.volume-.1).toFixed(1)),n={volume:{from:t.volume,to:i}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=i>=0?i:0}}},{key:"upVolume",value:function(e){var t=this.player;if(!(t.volume>=1)){var i=parseFloat((t.volume+.1).toFixed(1)),n={volume:{from:t.volume,to:i}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=i<=1?i:1}}},{key:"seek",value:function(e){var t=this.player,i=t.currentTime,n=t.offsetCurrentTime,r=t.duration,a=t.offsetDuration,s=t.timeSegments,o=n>-1?n:i,l=a||r,u=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;o+u<=l?o+=u:o=l;var c=F.getCurrentTimeByOffset(o,s),d={currentTime:{from:i,to:c}};this.emitUserAction(e,"seek",{props:d}),this.player.currentTime=c}},{key:"seekBack",value:function(e){var t=this.player,i=t.currentTime,n=t.offsetCurrentTime,r=t.timeSegments,a=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,s=n>-1?n:i,o=s-a;o<0&&(o=0),o=F.getCurrentTimeByOffset(o,r);var l={currentTime:{from:i,to:o}};this.emitUserAction(e,"seek",{props:l}),this.player.currentTime=o}},{key:"changePlaybackRate",value:function(e){var t=this._keyState,i=this.config,n=this.player;0===t.playbackRate&&(t.playbackRate=n.playbackRate,n.playbackRate=i.playbackRate)}},{key:"playPause",value:function(e){var t=this.player;t&&(this.emitUserAction(e,"switch_play_pause"),t.paused?t.play():t.pause())}},{key:"exitFullscreen",value:function(e){var t=this.player,i=t.fullscreen,n=t.cssfullscreen;i&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:i,to:!i}),t.exitFullscreen()),n&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:n,to:!n}),t.exitCssFullscreen())}},{key:"handleKeyDown",value:function(e){var t=this._keyState;if(e.repeat){t.isPress=!0;var i=Date.now();if(i-t.tt<200)return;t.tt=i}this.handleKeyCode(e.keyCode,e,t.isPress)}},{key:"handleKeyUp",value:function(e){var t=this._keyState;t.playbackRate>0&&(this.player.playbackRate=t.playbackRate,t.playbackRate=0),t.isKeyDown=!1,t.isPress=!1,t.tt=0}},{key:"handleKeyCode",value:function(e,t,i){for(var n=Object.keys(this.keyCodeMap),r=0;r<n.length;r++){var a=this.keyCodeMap[n[r]],s=a.action,o=a.keyCode,l=a.disable,c=a.pressAction,d=a.disablePress;if(o===e){if(!l&&(!i||!d)){var h=i&&c||s;"function"===typeof h?s(t,this.player,i):"string"===typeof h&&"function"===typeof this[h]&&this[h](t,this.player,i),this.emit(Je,u({key:n[r],target:t.target,isPress:i},this.keyCodeMap[n[r]]))}Ji(t),t.stopPropagation();break}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}}]),i}(xt);function $i(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">\n  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>\n</svg>\n',"image/svg+xml").firstChild}var en=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"registerIcons",value:function(){return{loadingIcon:$i}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return'\n    <xg-loading class="xgplayer-loading">\n      <xg-loading-inner></xg-loading-inner>\n    </xg-loading>'}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:Zt.ROOT}}}]),i}(Dt),tn=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],nn=function(){function e(t){d(this,e),this.fragments=t.fragments||[],0===this.fragments.length&&this.fragments.push({percent:1}),this._callBack=t.actionCallback,this.fragConfig={fragFocusClass:t.fragFocusClass||"inner-focus-point",fragAutoFocus:!!t.fragAutoFocus,fragClass:t.fragClass||""},this.style=t.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return f(e,[{key:"updateDuration",value:function(e){var t=this;this.duration=e;var i=0,n=this.fragments;this.fragments=n.map((function(e){return e.start=parseInt(i,10),e.end=parseInt(i+e.percent*t.duration,10),e.duration=parseInt(e.percent*t.duration,10),i+=e.percent*t.duration,e}))}},{key:"updateProgress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},i=this.progressList,n=this.fragments;if(!(i.length<1)){var r=t.newIndex,a=t.curIndex,s=t.millisecond;r!==a&&i.map((function(t,i){i<r?t[e].style.width="100%":i>r&&(t[e].style.width=0)}));var o=n[r],l=0===s?0:(s-o.start)/o.duration;i[r][e].style.width=l<0?0:"".concat(100*l,"%")}}},{key:"updateFocus",value:function(e){if(this.fragConfig.fragAutoFocus&&!(this.fragments.length<2))if(e){var t=this.findIndex(1e3*e.currentTime,this.focusIndex);if(t>=0&&t!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(t);var i={index:t,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=t,this._callBack&&this._callBack(i)}}else if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var n={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(n),this.focusIndex=-1}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(1e3*t,10)!==this.duration){if(!t&&0!==t)return;this.updateDuration(parseInt(1e3*t,10))}var i=this.playedIndex,n=this.cachedIndex;if("Undefined"!==F.typeOf(e.played)){var r=this.findIndex(1e3*e.played,i);if(r<0)return;this.updateProgress("played",{newIndex:r,curIndex:i,millisecond:parseInt(1e3*e.played,10)}),this.playedIndex=r}if("Undefined"!==F.typeOf(e.cached)){var a=this.findIndex(1e3*e.cached,n);if(a<0)return;this.updateProgress("cached",{newIndex:a,curIndex:n,millisecond:parseInt(1e3*e.cached,10)}),this.cachedIndex=a}}},{key:"findIndex",value:function(e,t){var i=this.fragments;if(!i||0===i.length)return-1;if(1===i.length)return 0;if(t>-1&&t<i.length&&e>i[t].start&&e<i[t].end)return t;if(e>i[i.length-1].start)return i.length-1;for(var n=0;n<i.length;n++)if(e>i[n].start&&e<=i[n].end){t=n;break}return t}},{key:"findHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)if(F.hasClass(e[t],this.fragConfig.fragFocusClass))return{dom:e[t],pos:e[t].getBoundingClientRect()}}},{key:"findFragment",value:function(e){var t=this.root.children;return e<0||e>=t.length?null:{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)F.removeClass(e[t],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(e){var t=this.root.children;if(e<t.length)return F.addClass(t[e],this.fragConfig.fragFocusClass),{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(e){var t=this;if(Object.keys(this.fragConfig).forEach((function(i){void 0!==e[i]&&(t.fragConfig[i]=e[i])})),e.fragments){if(this.fragments=0===e.fragments.length?[{percent:1}]:e.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root){var i=this.root.children;while(i.length>0)this.root.removeChild(i[0])}this.render()}}},{key:"render",value:function(){var e=this,t=this.style.progressColor;if(this.root||(this.root=F.createDom("xg-inners","",{},"progress-list")),this.fragments){var i=this.fragConfig,n=i.fragClass,r=i.fragFocusClass;this.progressList=this.fragments.map((function(i){var a=F.createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(i.percent):"flex: ".concat(i.percent)},"".concat(i.isFocus?r:""," xgplayer-progress-inner ").concat(n));return e.root.appendChild(a),tn.forEach((function(t){a.appendChild(F.createDom(t.tag,"",{style:t.styleKey?"background: ".concat(e.style[t.styleKey],"; width:0;"):"width:0;"},t.className))})),{cached:a.children[0],played:a.children[1]}}))}return this.root}}]),e}(),rn={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},an=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),m(b(n),"onMoveOnly",(function(e,t){var i=b(n),r=i.pos,a=i.config,s=i.player,o=t;if(e){F.event(e);var l=F.getEventPos(e,s.zoom),u=90===s.rotateDeg?l.clientY:l.clientX;if(r.moving&&Math.abs(r.x-u)<a.miniMoveStep)return;r.moving=!0,r.x=u,o=n.computeTime(e,u)}n.triggerCallbacks("dragmove",o,e),n._updateInnerFocus(o)})),m(b(n),"onBodyClick",(function(e){n.pos.isLocked&&(n.pos.isLocked=!1,e.preventDefault(),e.stopPropagation())})),m(b(n),"_mouseDownHandler",(function(e,t){n._state.time=t.currentTime,n.updateWidth(t.currentTime,t.seekTime,t.percent,0),n._updateInnerFocus(t)})),m(b(n),"_mouseUpHandler",(function(e,t){var i=b(n),r=i.pos;r.moving&&n.updateWidth(t.currentTime,t.seekTime,t.percent,2)})),m(b(n),"_mouseMoveHandler",(function(e,t){var i=b(n),r=i._state,a=i.pos,s=i.config,o=i.player;r.time<t.currentTime?t.forward=!0:t.forward=!1,r.time=t.currentTime,a.isDown&&!a.moving&&(a.moving=!0,s.isPauseMoving&&o.pause(),n.triggerCallbacks("dragstart",t,e),n.emitUserAction("drag","dragstart",t)),n.updateWidth(t.currentTime,t.seekTime,t.percent,1),n.triggerCallbacks("dragmove",t,e),n._updateInnerFocus(t)})),m(b(n),"onMouseDown",(function(e){var t=b(n),i=t._state,r=t.player,a=t.pos,s=t.config,o=t.playerConfig,l=F.getEventPos(e,r.zoom),u=90===r.rotateDeg?l.clientY:l.clientX;if(!(r.isMini||s.closeMoveSeek||!o.allowSeekAfterEnded&&r.ended)){if(r.duration||r.isPlaying){e.stopPropagation(),n.focus(),F.checkIsFunction(o.disableSwipeHandler)&&o.disableSwipeHandler(),F.checkIsFunction(s.onMoveStart)&&s.onMoveStart(),F.event(e),a.x=u,a.isDown=!0,a.moving=!1,i.prePlayTime=r.currentTime,r.focus({autoHide:!1}),n.isProgressMoving=!0,F.addClass(n.progressBtn,"active");var c=n.computeTime(e,u);c.prePlayTime=i.prePlayTime,n._mouseDownHandlerHook(e,c);var d=e.type;return"touchstart"===d?(n.root.addEventListener("touchmove",n.onMouseMove),n.root.addEventListener("touchend",n.onMouseUp),n.root.addEventListener("touchcancel",n.onMouseUp)):(n.unbind("mousemove",n.onMoveOnly),document.addEventListener("mousemove",n.onMouseMove,!1),document.addEventListener("mouseup",n.onMouseUp,!1)),!0}r.play()}})),m(b(n),"onMouseUp",(function(e){var t=b(n),i=t.player,r=t.config,a=t.pos,s=t.playerConfig,o=t._state;e.stopPropagation(),e.preventDefault(),F.checkIsFunction(s.enableSwipeHandler)&&s.enableSwipeHandler(),F.checkIsFunction(r.onMoveEnd)&&r.onMoveEnd(),F.event(e),F.removeClass(n.progressBtn,"active");var l=n.computeTime(e,a.x);l.prePlayTime=o.prePlayTime,a.moving?(n.triggerCallbacks("dragend",l,e),n.emitUserAction("drag","dragend",l)):(n.triggerCallbacks("click",l,e),n.emitUserAction("click","click",l)),n._mouseUpHandlerHook(e,l),a.moving=!1,a.isDown=!1,a.x=0,a.y=0,a.isLocked=!0,o.prePlayTime=0,o.time=0;var u=e.type;"touchend"===u||"touchcancel"===u?(n.root.removeEventListener("touchmove",n.onMouseMove),n.root.removeEventListener("touchend",n.onMouseUp),n.root.removeEventListener("touchcancel",n.onMouseUp),n.blur()):(document.removeEventListener("mousemove",n.onMouseMove,!1),document.removeEventListener("mouseup",n.onMouseUp,!1),a.isEnter?"mobile"!==s.isMobileSimulateMode&&n.bind("mousemove",n.onMoveOnly):n.onMouseLeave(e)),F.setTimeout(b(n),(function(){n.resetSeekState()}),1),i.focus()})),m(b(n),"onMouseMove",(function(e){var t=b(n),i=t._state,r=t.pos,a=t.player,s=t.config;F.checkTouchSupport()&&e.preventDefault(),F.event(e);var o=F.getEventPos(e,a.zoom),l=90===a.rotateDeg?o.clientY:o.clientX,u=Math.abs(r.x-l);if(!(r.moving&&u<s.miniMoveStep||!r.moving&&u<s.miniStartStep)){r.x=l;var c=n.computeTime(e,l);c.prePlayTime=i.prePlayTime,n._mouseMoveHandlerHook(e,c)}})),m(b(n),"onMouseOut",(function(e){n.triggerCallbacks("mouseout",null,e)})),m(b(n),"onMouseOver",(function(e){n.triggerCallbacks("mouseover",null,e)})),m(b(n),"onMouseEnter",(function(e){var t=b(n),i=t.player,r=t.pos;if(!(r.isDown||r.isEnter||i.isMini||!i.config.allowSeekAfterEnded&&i.ended)){r.isEnter=!0,n.bind("mousemove",n.onMoveOnly),n.bind("mouseleave",n.onMouseLeave),F.event(e);var a=F.getEventPos(e,i.zoom),s=90===i.rotateDeg?a.clientY:a.clientX,o=n.computeTime(e,s);n.triggerCallbacks("mouseenter",o,e),n.focus()}})),m(b(n),"onMouseLeave",(function(e){n.triggerCallbacks("mouseleave",null,e),n.unlock(),n._updateInnerFocus(null)})),m(b(n),"onVideoResize",(function(){var e=n.pos,t=e.x,i=e.isDown,r=e.isEnter;if(r&&!i){var a=n.computeTime(null,t);n.onMoveOnly(null,a)}})),n.useable=!1,n.isProgressMoving=!1,n.__dragCallBacks=[],n._state={now:-1,direc:0,time:0,prePlayTime:-1},n._disableBlur=!1,n}return f(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"currentTime",get:function(){var e=this.player,t=e.offsetCurrentTime,i=e.currentTime;return t>=0?t:i+this.timeOffset}},{key:"changeState",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.useable=e}},{key:"show",value:function(e){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t&&0!==t.length||(t=[{percent:1}]);var n=u(u({fragments:t},i),{},{actionCallback:function(t){e.emitUserAction("fragment_focus","fragment_focus",t)}});this.innerList?this.innerList.reset(n):(this.innerList=new nn(n),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map((function(t){e[t]=e.innerList[t].bind(e.innerList)})))}},{key:"_updateInnerFocus",value:function(e){this.innerList&&this.innerList.updateFocus(e)}},{key:"afterCreate",value:function(){var e=this;if(!this.config.disable&&!this.playerConfig.isLive){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var t=this.config,i=t.fragFocusClass,n=t.fragAutoFocus,r=t.fragClass;this._initInner(this.config.fragments,{fragFocusClass:i,fragAutoFocus:n,fragClass:r,style:this.playerConfig.commonStyle||{}}),"mobile"===j.device&&(this.config.isDragingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.on(de,(function(){e.onMouseLeave()})),this.on(oe,(function(){e.onTimeupdate()})),this.on(se,(function(){e.onTimeupdate(),e.onCacheUpdate()})),this.on(ve,(function(){e.onCacheUpdate()})),this.on(ie,(function(){e.onCacheUpdate(!0),e.onTimeupdate(!0),e._state.now=0})),this.on(ye,(function(){e.onReset()})),this.on(Ke,(function(){e.onVideoResize()})),this.bindDomEvents(),this.initCustomStyle()}}},{key:"setConfig",value:function(e){var t=this,i=null;Object.keys(e).forEach((function(n){t.config[n]=e[n],"fragments"===n&&(i=e[n])})),i&&this._initInner(i,e)}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},t=e.commonStyle,i=t.sliderBtnStyle,n=this.progressBtn;i&&("string"===typeof i?n.style.boxShadow=i:"object"===c(i)&&Object.keys(i).map((function(e){n.style[e]=i[e]})))}},{key:"triggerCallbacks",value:function(e,t,i){this.__dragCallBacks.length>0&&this.__dragCallBacks.map((function(n){if(n&&n.handler&&n.type===e)try{n.handler(t,i)}catch(r){console.error("[XGPLAYER][triggerCallbacks] ".concat(n," error"),r)}}))}},{key:"addCallBack",value:function(e,t){t&&"function"===typeof t&&this.__dragCallBacks.push({type:e,handler:t})}},{key:"removeCallBack",value:function(e,t){var i=this.__dragCallBacks,n=-1;i.map((function(i,r){i&&i.type===e&&i.handler===t&&(n=r)})),n>-1&&i.splice(n,1)}},{key:"unlock",value:function(){var e=this.player,t=this.pos;t.isEnter=!1,t.isLocked=!1,e.isMini||(this.unbind("mousemove",this.onMoveOnly),t.isDown?this.unbind("mouseleave",this.onMouseLeave):this.blur())}},{key:"bindDomEvents",value:function(){var e=this.player.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),"touch"!==this.domEventType&&"compatible"!==this.domEventType||this.root.addEventListener("touchstart",this.onMouseDown),"mouse"!==this.domEventType&&"compatible"!==this.domEventType||(this.bind("mousedown",this.onMouseDown),"mobile"!==e.isMobileSimulateMode&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),F.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),F.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,t,i,n){var r=this.config,a=this.player;if(!r.isCloseClickSeek||0!==n){var s=t=t>=a.duration?a.duration-r.endedDiff:Number(t).toFixed(1);this.updatePercent(i),this.updateTime(e),(1!==n||r.isDragingSeek&&"audio"!==a.config.mediaType)&&(this._state.now=s,this._state.direc=s>a.currentTime?0:1,a.seek(s))}}},{key:"computeTime",value:function(e,t){var i,n,r=this.player,a=this.root.getBoundingClientRect(),s=a.width,o=a.height,l=a.top,u=a.left,c=t;90===r.rotateDeg?(i=o,n=l):(i=s,n=u);var d=c-n;d=d>i?i:d<0?0:d;var h=d/i;h=h<0?0:h>1?1:h;var f=parseInt(h*this.offsetDuration*1e3,10)/1e3,m=F.getCurrentTimeByOffset(f,r.timeSegments);return{percent:h,currentTime:f,seekTime:m,offset:d,width:i,left:n,e:e}}},{key:"updateTime",value:function(e){var t=this.player,i=this.duration;e>i?e=i:e<0&&(e=0);var n=t.plugins.time;n&&n.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,t){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(100*e,"%"),this.innerList.update({played:e*this.offsetDuration},this.offsetDuration);var i=this.player.plugins.miniprogress;i&&i.update({played:e*this.offsetDuration},this.offsetDuration)}}},{key:"onTimeupdate",value:function(e){var t=this.player,i=this._state,n=this.offsetDuration;if(!(t.isSeeking&&t.media.seeking||this.isProgressMoving)&&t.hasStart){if(i.now>-1){var r=parseInt(1e3*i.now,10)-parseInt(1e3*t.currentTime,10);if(0===i.direc&&r>300||1===i.direc&&r>-300)return void(i.now=-1);i.now=-1}var a=this.currentTime;a=F.adjustTimeByDuration(a,n,e),this.innerList.update({played:a},n),this.progressBtn.style.left="".concat(a/n*100,"%")}}},{key:"onCacheUpdate",value:function(e){var t=this.player,i=this.duration;if(t){var n=t.bufferedPoint.end;n=F.adjustTimeByDuration(n,i,e),this.innerList.update({cached:n},i)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}},{key:"destroy",value:function(){var e=this.player;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var t=this.domEventType;"touch"!==t&&"compatible"!==t||(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp)),"mouse"!==t&&"compatible"!==t||(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!this.config.disable&&!this.playerConfig.isLive){var e=this.player.controls?this.player.controls.config.mode:"",t="bottom"===e?"xgplayer-progress-bottom":"";return'\n    <xg-progress class="xgplayer-progress '.concat(t,'">\n      <xg-outer class="xgplayer-progress-outer">\n        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n      </xg-outer>\n    </xg-progress>\n    ')}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:rn.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return rn}}]),i}(Dt),sn=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"_onMouseenter",(function(t){e.emit("icon_mouseenter",{pluginName:e.pluginName})})),m(b(e),"_onMouseLeave",(function(t){e.emit("icon_mouseleave",{pluginName:e.pluginName})})),e}return f(i,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave),this.config.disable&&this.disable()}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),i}(Dt),on=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"afterCreate",value:function(){var e=this;k(v(i.prototype),"afterCreate",this).call(this);var t=this.player,n=this.config;n.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.on([ne,re,ye],(function(){e.animate(t.paused)})),this.on(ee,(function(){e.animate(t.paused)})),this.animate(!0))}},{key:"registerIcons",value:function(){return{play:{icon:gi,class:"xg-icon-play"},pause:{icon:yi,class:"xg-icon-pause"}}}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player;return this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t.paused,to:!t.paused}),t.ended?t.replay():t.paused?(t.play(),this.animate(!1)):(t.pause(),this.animate(!0)),!1}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){if(this.player){var t=this.i18nKeys,i=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),i&&this.changeLangTextKey(i,t.PLAY_TIPS)):(this.setAttr("data-state","play"),i&&this.changeLangTextKey(i,t.PAUSE_TIPS))}}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-play">\n    <div class="xgplayer-icon">\n    </div>\n    '.concat(xi(this,"PLAY_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_LEFT,index:0,disable:!1}}}]),i}(sn);function ln(){return(new DOMParser).parseFromString('<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>\n    </g>\n</svg>',"image/svg+xml").firstChild}var un=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(t){t.preventDefault(),t.stopPropagation(),e.config.onClick(t)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:ln,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){F.addClass(this.root,"show")}},{key:"hide",value:function(){F.removeClass(this.root,"show")}},{key:"render",value:function(){return'<xg-icon class="xgplayer-back">\n    </xg-icon>'}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:Zt.ROOT_TOP,index:0}}}]),i}(Dt);function cn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>\n</svg>\n',"image/svg+xml").firstChild}function dn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>\n</svg>\n',"image/svg+xml").firstChild}var hn=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"_onOrientationChange",(function(t){e.player.fullscreen&&e.config.rotateFullscreen&&(90===window.orientation||-90===window.orientation?e.player.setRotateDeg(0):e.player.setRotateDeg(90))})),e}return f(i,[{key:"afterCreate",value:function(){var e=this;k(v(i.prototype),"afterCreate",this).call(this);var t=this.config,n=this.playerConfig;if(!t.disable){t.target&&(this.playerConfig.fullscreenTarget=this.config.target);var r=F.getFullScreenEl();n.fullscreenTarget===r&&this.player.getFullscreen().catch((function(e){})),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(t){var i=e.player.fullscreen;e.emitUserAction(t,"switch_fullscreen",{prop:"fullscreen",from:i,to:!i})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(We,(function(t){var i=e.find(".xg-tips");i&&e.changeLangTextKey(i,t?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(t)})),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:un,options:{config:{onClick:function(t){e.handleFullscreen(t)}}}})),"mobile"===j.device&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:cn,class:"xg-get-fullscreen"},exitFullscreen:{icon:dn,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon","mobile"===j.device?"touchend":"click",this.handleFullscreen),"mobile"===j.device&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.player,i=this.config,n=!0===i.useCssFullscreen||"function"===typeof i.useCssFullscreen&&i.useCssFullscreen();n?(t.fullscreen?t.exitCssFullscreen():t.getCssFullscreen(),this.animate(t.fullscreen)):i.rotateFullscreen?(t.fullscreen?t.exitRotateFullscreen():t.getRotateFullscreen(),this.animate(t.fullscreen)):i.switchCallback&&"function"===typeof i.switchCallback?i.switchCallback(t.fullscreen):t.fullscreen?(t.exitFullscreen(),i.useScreenOrientation&&this.unlockScreen()):(t.getFullscreen().catch((function(e){})),i.useScreenOrientation&&t.aspectRatio>1&&this.lockScreen(i.lockOrientationType))}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return'<xg-icon class="xgplayer-fullscreen">\n    <div class="xgplayer-icon">\n    </div>\n    '.concat(xi(this,e,this.playerConfig.isHideTips),"\n    </xg-icon>")}}},{key:"lockScreen",value:function(e){try{screen.orientation.lock(e).catch((function(e){}))}catch(t){}}},{key:"unlockScreen",value:function(){try{screen.orientation.unlock().catch((function(e){}))}catch(e){}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),i}(sn),fn=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),n.isActiving=!1,n}return f(i,[{key:"duration",get:function(){var e=this.player,t=e.offsetDuration,i=e.duration;return this.playerConfig.customDuration||t||i}},{key:"currentTime",get:function(){var e=this.player,t=e.offsetCurrentTime,i=e.currentTime;return t>=0?t:i}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this,t=this.player.controls.config.mode;this.mode="flex"===t?"flex":"normal",this.config.disable||("flex"===this.mode&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.on([de,se,oe],(function(t){"durationchange"===t.eventName&&(e.isActiving=!1),e.onTimeUpdate()})),this.on(ie,(function(){e.onTimeUpdate(!0)})),this.on(ye,(function(){e.onReset()})))}},{key:"show",value:function(e){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="block"),void(this.centerDurDom&&(this.centerDurDom.style.display="block"));this.root.style.display="block"}},{key:"hide",value:function(){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="none"),void(this.centerDurDom&&(this.centerDurDom.style.display="none"));this.root.style.display="none"}},{key:"onTimeUpdate",value:function(e){var t=this.player,i=this.config,n=this.duration;if(!i.disable&&!this.isActiving&&t.hasStart){var r=this.currentTime+this.timeOffset;r=F.adjustTimeByDuration(r,n,e),"flex"===this.mode?(this.centerCurDom.innerHTML=this.minWidthTime(F.format(r)),n!==1/0&&n>0&&(this.centerDurDom.innerHTML=F.format(n))):(this.timeDom.innerHTML=this.minWidthTime(F.format(r)),n!==1/0&&n>0&&(this.durationDom.innerHTML=F.format(n)))}}},{key:"onReset",value:function(){"flex"===this.mode?(this.centerCurDom.innerHTML=this.minWidthTime(F.format(0)),this.centerDurDom.innerHTML=F.format(0)):(this.timeDom.innerHTML=this.minWidthTime(F.format(0)),this.durationDom.innerHTML=F.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(e.controls&&e.controls.center){var t=e.controls.center;this.centerCurDom=F.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=F.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),t.children.length>0?t.insertBefore(this.centerCurDom,t.children[0]):t.appendChild(this.centerCurDom),t.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;this.duration===1/0||this.playerConfig.isLive?(F.hide(this.durationDom),F.hide(this.timeDom),F.hide(this.find(".time-separator")),F.show(this.find(".time-live-tag"))):F.hide(this.find(".time-live-tag")),e.hide?this.hide():this.show()}},{key:"changeLiveState",value:function(e){e?(F.hide(this.durationDom),F.hide(this.timeDom),F.hide(this.find(".time-separator")),F.show(this.find(".time-live-tag"))):(F.hide(this.find(".time-live-tag")),F.show(this.find(".time-separator")),F.show(this.durationDom),F.show(this.timeDom))}},{key:"updateTime",value:function(e){this.isActiving=!0,!e&&0!==e||e>this.duration||("flex"!==this.mode?this.timeDom.innerHTML=this.minWidthTime(F.format(e)):this.centerCurDom.innerHTML=this.minWidthTime(F.format(e)))}},{key:"minWidthTime",value:function(e){return e.split(":").map((function(e){return'<span class="time-min-width">'.concat(e,"</span>")})).join(":")}},{key:"resetActive",value:function(){var e=this,t=this.player,i=function(){e.isActiving=!1};this.off(se,i),t.isSeeking&&t.media.seeking?this.once(se,i):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-time">\n    <span class="time-current">00:00</span>\n    <span class="time-separator">/</span>\n    <span class="time-duration">00:00</span>\n    <span class="time-live-tag">'.concat(this.i18n.LIVE_TIP,"</span>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_LEFT,index:2,disable:!1}}}]),i}(Dt),mn=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"_onDurationChange",(function(){e.updateSegments();var t=e.player,i=t.currentTime,n=t.timeSegments;if(e._checkIfEnabled(n)){var r=F.getIndexByTime(i,n),a=F.getOffsetCurrentTime(i,n,r);e.player.offsetCurrentTime=a,e.changeIndex(r,n)}})),m(b(e),"_onLoadedData",(function(){var t=e.player.timeSegments;if(e._checkIfEnabled(t)){var i=F.getOffsetCurrentTime(0,t);e.player.offsetCurrentTime=i,e.changeIndex(0,t),e.curPos.start>0&&(e.player.currentTime=e.curPos.start)}})),m(b(e),"_onTimeupdate",(function(){var t=e.player,i=t.currentTime,n=t.timeSegments;if(e._checkIfEnabled(n)){var r=n.length;e.lastCurrentTime=i;var a=F.getIndexByTime(i,n);a!==e.curIndex&&e.changeIndex(a,n);var s=F.getOffsetCurrentTime(i,n,a);if(e.player.offsetCurrentTime=s,e.curPos){var o=e.curPos,l=o.start,u=o.end;i<l?e.player.currentTime=l:i>u&&a>=r-1&&e.player.pause()}}})),m(b(e),"_onSeeking",(function(){var t=e.player,i=t.currentTime,n=t.timeSegments;if(e._checkIfEnabled(n))if(i<n[0].start)e.player.currentTime=n[0].start;else if(i>n[n.length-1].end)e.player.currentTime=n[n.length-1].end;else{var r=F.getIndexByTime(i,n);if(r>=0){var a=e.getSeekTime(i,e.lastCurrentTime,r,n);a>=0&&(e.player.currentTime=a)}}})),m(b(e),"_onPlay",(function(){var t=e.player,i=t.currentTime,n=t.timeSegments;e._checkIfEnabled(n)&&i>=n[n.length-1].end&&(e.player.currentTime=n[0].start)})),e}return f(i,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(de,this._onDurationChange),this.on(fe,this._onLoadedData),this.on(oe,this._onTimeupdate),this.on(ae,this._onSeeking),this.on(ee,this._onPlay)}},{key:"setConfig",value:function(e){var t=this;if(e){var i=Object.keys(e);i.length<1||(i.forEach((function(i){t.config[i]=e[i]})),this.updateSegments())}}},{key:"updateSegments",value:function(){var e=this.config,t=e.disable,i=e.segments,n=this.player;if(t||!i||0===i.length)n.timeSegments=[],n.offsetDuration=0,n.offsetCurrentTime=-1;else{var r=this.formatTimeSegments(i,n.duration);n.timeSegments=r,n.offsetDuration=r.length>0?r[r.length-1].duration:0}}},{key:"formatTimeSegments",value:function(e,t){var i=[];return e?(e.sort((function(e,t){return e.start-t.start})),e.forEach((function(e,n){var r={};if(r.start=e.start<0?0:e.start,r.end=t>0&&e.end>t?t:e.end,!(t>0&&r.start>t)){i.push(r);var a=r.end-r.start;if(0===n)r.offset=e.start,r.cTime=0,r.segDuration=a,r.duration=a;else{var s=i[n-1];r.offset=s.offset+(r.start-s.end),r.cTime=s.duration+s.cTime,r.segDuration=a,r.duration=s.duration+a}}})),i):[]}},{key:"getSeekTime",value:function(e,t,i,n){var r=-1,a=n[i],s=a.start,o=a.end;if(e>=s&&e<=o)return r;var l=e-t;if(l<0&&e<s){var u=t>s?t-s:0;return r=i-1>=0?n[i-1].end+l+u:0,r}return-1}},{key:"_checkIfEnabled",value:function(e){return!(!e||e.length<1)}},{key:"changeIndex",value:function(e,t){this.curIndex=e,e>=0&&t.length>0?this.curPos=t[e]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),i}(xt);function pn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function vn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function gn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>\n</svg>\n',"image/svg+xml").firstChild}var yn=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onBarMousedown",(function(t){var i=b(e),n=i.player,r=e.find(".xgplayer-bar");F.event(t);var a=r.getBoundingClientRect(),s=F.getEventPos(t,n.zoom),o=a.height-(s.clientY-a.top);if(s.h=o,s.barH=a.height,e.pos=s,!(o<-2))return e.updateVolumePos(o,t),document.addEventListener("mouseup",e.onBarMouseUp),e._d.isStart=!0,!1})),m(b(e),"onBarMouseMove",(function(t){var i=b(e),n=i._d;if(n.isStart){var r=b(e),a=r.pos,s=r.player;t.preventDefault(),t.stopPropagation(),F.event(t);var o=F.getEventPos(t,s.zoom);n.isMoving=!0;var l=a.h-o.clientY+a.clientY;l>a.barH||e.updateVolumePos(l,t)}})),m(b(e),"onBarMouseUp",(function(t){F.event(t),document.removeEventListener("mouseup",e.onBarMouseUp);var i=b(e),n=i._d;n.isStart=!1,n.isMoving=!1})),m(b(e),"onMouseenter",(function(t){e._d.isActive=!0,e.focus(),e.emit("icon_mouseenter",{pluginName:e.pluginName})})),m(b(e),"onMouseleave",(function(t){e._d.isActive=!1,e.unFocus(100,!1,t),e.emit("icon_mouseleave",{pluginName:e.pluginName})})),m(b(e),"onVolumeChange",(function(t){if(e.player){var i=e.player,n=i.muted,r=i.volume;e._d.isMoving||(e.find(".xgplayer-drag").style.height=n||0===r?"4px":"".concat(100*r,"%"),e.config.showValueLabel&&e.updateVolumeValue()),e.animate(n,r)}})),e}return f(i,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:vn,class:"xg-volume-small"},volumeLarge:{icon:pn,class:"xg-volume"},volumeMuted:{icon:gn,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var t=this.playerConfig,i=t.commonStyle,n=t.volume;i.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=i.volumeColor),this.changeMutedHandler=this.hook("mutedChange",(function(t){e.changeMuted(t)}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),"mobile"!==j.device&&"mobile"!==this.playerConfig.isMobileSimulateMode&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(he,this.onVolumeChange),this.once(fe,this.onVolumeChange),"Number"!==F.typeOf(n)&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,t){var i=this.player,n=this.find(".xgplayer-drag"),r=this.find(".xgplayer-bar");if(r&&n){var a=parseInt(e/r.getBoundingClientRect().height*1e3,10);n.style.height="".concat(e,"px");var s=Math.max(Math.min(a/1e3,1),0),o={volume:{from:i.volume,to:s}};i.muted&&(o.muted={from:!0,to:!1}),this.emitUserAction(t,"change_volume",{muted:i.muted,volume:i.volume,props:o}),i.volume=Math.max(Math.min(a/1e3,1),0),i.muted&&(i.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,t=e.volume,i=e.muted,n=this.find(".xgplayer-value-label"),r=Math.max(Math.min(t,1),0);n.innerText=i?0:Math.round(100*r)}},{key:"focus",value:function(){var e=this.player;e.focus({autoHide:!1}),this._timerId&&(F.clearTimeout(this,this._timerId),this._timerId=null),F.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this._d,a=this.player;r.isActive||(this._timerId&&(F.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=F.setTimeout(this,(function(){r.isActive||(i?a.blur():a.focus(),F.removeClass(e.root,"slide-show"),r.isStart&&e.onBarMouseUp(n)),e._timerId=null}),t))}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var t=this.player,i=this._d;i.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:t.muted,volume:t.volume,props:{muted:{from:t.muted,to:!t.muted}}}),t.volume>0&&(t.muted=!t.muted),t.volume<.01&&(t.volume=this.config.miniVolume)}},{key:"animate",value:function(e,t){e||0===t?this.setAttr("data-state","mute"):t<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(F.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon","mobile"===j.device?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,t=this.config.showValueLabel;return'\n    <xg-icon class="xgplayer-volume" data-state="normal">\n      <div class="xgplayer-icon">\n      </div>\n      <xg-slider class="xgplayer-slider">\n        '.concat(t?'<div class="xgplayer-value-label">'.concat(100*e,"</div>"):"",'\n        <div class="xgplayer-bar">\n          <xg-drag class="xgplayer-drag" style="height: ').concat(100*e,'%"></xg-drag>\n        </div>\n      </xg-slider>\n    </xg-icon>')}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),i}(Dt);function bn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">\n  <g clip-path="url(#clip0)">\n    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>\n    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>\n  </g>\n  <defs>\n    <clipPath id="clip0">\n      <rect width="40" height="40" fill="white"/>\n    </clipPath>\n  </defs>\n</svg>\n',"image/svg+xml").firstChild}var Ln=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),n.rotateDeg=n.config.rotateDeg||0,n}return f(i,[{key:"afterCreate",value:function(){var e=this;if(!this.config.disable){k(v(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(Ke,(function(){e.rotateDeg&&e.config.innerRotate&&F.setTimeout(e,(function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)}),100)}));var t=this.player.root;this.rootWidth=t.style.width||t.offsetWidth||t.clientWidth,this.rootHeight=t.style.height||t.offsetHeight||t.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,t){if(e||(e=0),t)this.player.videoRotateDeg=e;else{var i=this.player,n=this.rootWidth,r=this.rootHeight,a=i.root,s=i.innerContainer,o=i.media,l=a.offsetWidth,u=s&&t?s.offsetHeight:a.offsetHeight,c=n,d=r,h=0,f=0;.75!==e&&.25!==e||(c="".concat(u,"px"),d="".concat(l,"px"),h=-(u-l)/2,f=-(l-u)/2);var m="translate(".concat(h,"px,").concat(f,"px) rotate(").concat(e,"turn)"),p={transformOrigin:"center center",transform:m,webKitTransform:m,height:d,width:c},v=t?o:a,g=t?i.getPlugin("poster"):null;Object.keys(p).map((function(e){v.style[e]=p[e],g&&g.root&&(g.root.style[e]=p[e])}))}}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.player;this.rotateDeg||(this.rotateDeg=0);var r=e?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*r*i)%1,this.updateRotateDeg(this.rotateDeg,t),n.emit(Be,360*this.rotateDeg)}},{key:"registerIcons",value:function(){return{rotate:bn}}},{key:"render",value:function(){if(!this.config.disable)return'\n    <xg-icon class="xgplayer-rotate">\n      <div class="xgplayer-icon">\n      </div>\n      '.concat(xi(this,"ROTATE_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),i}(sn);function Sn(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}function Tn(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}var kn={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},xn=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"switchPIP",(function(t){if(!e.isPIPAvailable())return!1;t.stopPropagation&&t.stopPropagation(),e.isPip?(e.exitPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!0,to:!1}),e.setAttr("data-state","normal")):4===e.player.media.readyState&&(e.requestPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!1,to:!0}),e.setAttr("data-state","pip"))})),e}return f(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.pip&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(k(v(i.prototype),"afterCreate",this).call(this),this.pMode=kn.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(Ce,(function(){e.config.showIcon&&(F.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))})))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:Sn,class:"xg-get-pip"},pipIconExit:{icon:Tn,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,t=this.player;this.leavePIPCallback=function(){var i=t.paused;F.setTimeout(e,(function(){!i&&t.mediaPlay()}),0),!i&&t.mediaPlay(),e.setAttr("data-state","normal"),e.pipWindow=null,t.emit(Ue,!1)},this.enterPIPCallback=function(i){t.emit(Ue,!0),null!==i&&void 0!==i&&i.pictureInPictureWindow&&(e.pipWindow=i.pictureInPictureWindow),e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(i){var n=t.media.webkitPresentationMode;e.pMode===kn.FULLSCREEN&&n!==kn.FULLSCREEN&&t.onFullscreenChange(null,!1),e.pMode=n,n===kn.PIP?e.enterPIPCallback(i):n===kn.INLINE&&e.leavePIPCallback(i)},t.media&&(t.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),t.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(t.media)&&t.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"copyStyleIntoPiPWindow",value:function(e){var t=x(document.styleSheets).map((function(t){try{return x(t.cssRules).map((function(e){return e.cssText})).join("")}catch(n){var i=document.createElement("link");i.rel="stylesheet",i.type=t.type,i.media=t.media,i.href=t.href,e.document.head.appendChild(i)}return""})).filter(Boolean).join("\n"),i=document.createElement("style");i.textContent=t,e.document.head.appendChild(i)}},{key:"requestPIP",value:function(){var e=this,t=this.player,n=this.playerConfig,r=this.config;if(this.isPIPAvailable()&&!this.isPip)try{var a=n.poster;if(a&&(t.media.poster="String"===F.typeOf(a)?a:a.poster),r.preferDocument&&this.isDocPIPAvailable()){var s={};if(r.width&&r.height)s.width=r.width,s.height=r.height;else{var o=t.root.getBoundingClientRect();s.width=o.width,s.height=o.height}documentPictureInPicture.requestWindow(s).then((function(i){var n=r.docPiPNode,a=r.docPiPStyle;e.enterPIPCallback();var s=n||t.root,o=s.parentElement,l=s.previousSibling,u=s.nextSibling;e.copyStyleIntoPiPWindow(i);var c=document.createElement("style");if(c.append("body{padding:0; margin:0;}"),a){var d="";"string"===typeof a?d=a:"function"===typeof a&&(d=a.call(r)),d&&c.append(d)}else s===t.root&&c.append("\n              .xgplayer{width: 100%!important; height: 100%!important;}\n            ");i.document.head.append(c),i.document.body.append(s),i.addEventListener("pagehide",(function(t){o&&(u?o.insertBefore(s,u):l?o.insertBefore(s,l.nextSibling):o.appendChild(s)),e.leavePIPCallback()}),{once:!0})}))}else i.checkWebkitSetPresentationMode(t.media)?t.media.webkitSetPresentationMode("picture-in-picture"):t.media.requestPictureInPicture();return!0}catch(l){return console.error("requestPiP",l),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{var t;if(this.isPIPAvailable()&&this.isPip)this.isDocPIPAvailable()&&null!==(t=documentPictureInPicture)&&void 0!==t&&t.window?documentPictureInPicture.window.close():i.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture();return!0}catch(n){return console.error("exitPIP",n),!1}}},{key:"isPip",get:function(){var e,t=this.player;return!(!this.isDocPIPAvailable()||null===(e=documentPictureInPicture)||void 0===e||!e.window)||document.pictureInPictureElement&&document.pictureInPictureElement===t.media||t.media.webkitPresentationMode===kn.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.media,t="Boolean"!==F.typeOf(document.pictureInPictureEnabled)||document.pictureInPictureEnabled;return t&&("Boolean"===F.typeOf(e.disablePictureInPicture)&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&"Function"===F.typeOf(e.webkitSetPresentationMode))||this.isDocPIPAvailable()}},{key:"isDocPIPAvailable",value:function(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this);var e=this.player;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(this.config.showIcon&&this.isPIPAvailable())return'<xg-icon class="xgplayer-pip">\n      <div class="xgplayer-icon xg-icon-disable">\n      </div>\n      '.concat(xi(this,"PIP",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}},{key:"checkWebkitSetPresentationMode",value:function(e){return"function"===typeof e.webkitSetPresentationMode}}]),i}(sn);function Rn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">\n  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>\n</svg>\n',"image/svg+xml").firstChild}var wn=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),m(b(n),"playNext",(function(e){var t=b(n),i=t.player;e.preventDefault(),e.stopPropagation(),n.idx+1<n.config.urlList.length?(n.idx++,n.nextHandler(n.config.urlList[n.idx],n.idx),i.emit(je,n.idx+1)):(n.nextHandler(),i.emit(je))})),n.idx=-1,n}return f(i,[{key:"afterCreate",value:function(){this.config.urlList&&0!==this.config.urlList.length&&(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Rn}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e="mobile"===j.device?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var t=this.player;e&&(t.pause(),t.currentTime=0,t.switchURL?t.switchURL(e):t.src=e,t.config.url=e,t.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(this.config.urlList&&0!==this.config.urlList.length)return'\n     <xg-icon class="xgplayer-playnext">\n      <div class="xgplayer-icon">\n      </div>\n      '.concat(xi(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),"\n     </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),i}(Dt),En=i("aeb1"),Zn=i.n(En);function Cn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">\n      <g id="Group-2">\n        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">\n          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>\n          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>\n          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>\n          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n',"image/svg+xml").firstChild}var In=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),m(b(n),"download",(function(e){if(!n.isLock){n.emitUserAction(e,"download");var t=n.playerConfig.url,i="";"String"===F.typeOf(t)?i=t:"Array"===F.typeOf(t)&&t.length>0&&(i=t[0].src);var r=n.getAbsoluteURL(i);Zn()(r),n.isLock=!0,n.timer=window.setTimeout((function(){n.isLock=!1,window.clearTimeout(n.timer),n.timer=null}),300)}})),n.timer=null,n.isLock=!1,n}return f(i,[{key:"afterCreate",value:function(){k(v(i.prototype),"afterCreate",this).call(this),this.config.disable||(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:Cn}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var t=document.createElement("div");t.innerHTML='<a href="'.concat(e,'">x</a>'),e=t.firstChild.href}return e}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-download">\n   <div class="xgplayer-icon">\n   </div>\n   '.concat(xi(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:3,disable:!0}}}]),i}(sn),Mn=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.screenShot&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){k(v(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(t){e.fitVideo&&(e.width=t.vWidth,e.height=t.vHeight)},this.once(Ke,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,t){var i,n=document.createElement("a");n.href=e,n.download=t;try{"undefined"!==typeof MouseEvent?i=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null))}catch(r){console.error("MouseEvent unsupported",r)}i&&n.dispatchEvent(i)}},{key:"createCanvas",value:function(e,t){var i=document.createElement("canvas"),n=i.getContext("2d");this.canvasCtx=n,this.canvas=i,i.width=e||this.config.width,i.height=t||this.config.height,n.imageSmoothingEnabled=!0,n.imageSmoothingEnabled&&(n.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var t=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");var i=this.config;this.shot(i.width,i.height).then((function(e){t.emit(ze,e),i.saveImg&&t.saveScreenShot(e,i.name+i.format)}))}},{key:"shot",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quality:.92,type:"image/png"},r=this.config,a=this.player,s=n.quality||r.quality,o=n.type||r.type;return new Promise((function(n,l){var u,c=null;if(a.media.canvas)c=a.media.canvas;else{i.canvas?(i.canvas.width=e||r.width,i.canvas.height=t||r.height):i.createCanvas(e,t),c=i.canvas,u=i.canvasCtx;var d,h,f,m,p=a.media.videoWidth/a.media.videoHeight,v=c.width/c.height,g=0,y=0,b=a.media.videoWidth,L=a.media.videoHeight;p>v?(f=c.width,m=c.width/p,d=0,h=Math.round((c.height-m)/2)):p===v?(f=c.width,m=c.height,d=0,h=0):p<v&&(f=c.height*p,m=c.height,d=Math.round((c.width-f)/2),h=0),u.drawImage(a.media,g,y,b,L,d,h,f,m)}var S=c.toDataURL(o,s).replace(o,"image/octet-stream");S=S.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),n(S)}))}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(Ke,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",t="SCREENSHOT";return'\n      <xg-icon class="xgplayer-shot">\n      <div class="'.concat(e,'">\n      ').concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[t],'">').concat(this.i18n[t],"</span>"),"\n      </div>\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),i}(sn),Gn=function(){function e(t){d(this,e),this.config=t.config,this.parent=t.root,this.root=F.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),t.root.appendChild(this.root);var i=this.config.maxHeight;i&&this.setStyle({maxHeight:i}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var n="touch"===this.config.domEventType?"touchend":"click";this._delegates=Dt.delegate.call(this,this.root,"li",n,this.onItemClick)}return f(e,[{key:"renderItemList",value:function(e){var t=this,i=this.config,n=this.root;e?i.data=e:e=i.data,i.style&&Object.keys(i.style).map((function(e){n.style[e]=i[e]})),e.length>0&&(this.attrKeys=Object.keys(e[0])),this.root.innerHTML="",e.map((function(e,i){var n=e.selected?"option-item selected":"option-item";e["data-index"]=i,t.root.appendChild(F.createDom("li","<span>".concat(e.showText,"</span>"),e,n))}))}},{key:"onItemClick",value:function(e){e.delegateTarget||(e.delegateTarget=e.target);var t=e.delegateTarget;if(t&&F.hasClass(t,"selected"))return!1;var i="function"===typeof this.config.onItemClick?this.config.onItemClick:null,n=this.root.querySelector(".selected");F.addClass(t,"selected"),n&&F.removeClass(n,"selected"),i(e,{from:n?this.getAttrObj(n,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(e,t){if(!e||!t)return{};var i={};t.map((function(t){i[t]=e.getAttribute(t)}));var n=e.getAttribute("data-index");return n&&(i.index=Number(n)),i}},{key:"show",value:function(){F.removeClass(this.root,"hide"),F.addClass(this.root,"active")}},{key:"hide",value:function(){F.removeClass(this.root,"active"),F.addClass(this.root,"hide")}},{key:"setStyle",value:function(e){var t=this;Object.keys(e).forEach((function(i){t.root.style[i]=e[i]}))}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map((function(e){e.destroy&&e.destroy()})),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),e}(),Xn={SIDE:"side",MIDDLE:"middle",DEFAULT:"default"},_n={CLICK:"click",HOVER:"hover"};function Pn(e,t){return e===Xn.SIDE?t===Zt.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var Dn="mobile"===j.device,Wn=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),m(b(n),"onEnter",(function(e){e.stopPropagation(),n.emit("icon_mouseenter",{pluginName:n.pluginName}),n.switchActiveState(e)})),m(b(n),"switchActiveState",(function(e){e.stopPropagation();var t=n.config.toggleMode;t===_n.CLICK?n.toggle(!n.isActive):n.toggle(!0)})),m(b(n),"onLeave",(function(e){e.stopPropagation(),n.emit("icon_mouseleave",{pluginName:n.pluginName}),n.config.listType!==Xn.SIDE&&n.isActive&&n.toggle(!1)})),m(b(n),"onListEnter",(function(e){n.enterType=2})),m(b(n),"onListLeave",(function(e){n.enterType=0,n.isActive&&n.toggle(!1)})),n.isIcons=!1,n.isActive=!1,n.curValue=null,n.curIndex=0,n}return f(i,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,t=this.config;this.initIcons(),Dn=Dn||"touch"===this.domEventType,Dn&&"mobile"===j.device&&t.listType===Xn.DEFAULT&&(t.listType=Xn.SIDE),t.hidePortrait&&F.addClass(this.root,"portrait"),this.on([Ke,We],(function(){e._resizeList()})),this.once(ue,(function(){t.list&&t.list.length>0&&(e.renderItemList(t.list),e.show())})),Dn&&this.on(ke,(function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)})),Dn?(t.toggleMode=_n.CLICK,this.activeEvent="touchend"):this.activeEvent=t.toggleMode===_n.CLICK?"click":"mouseenter",t.toggleMode===_n.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,t=this.icons,i=Object.keys(t),n=!1;i.length>0&&(i.forEach((function(i){e.appendChild(".xgplayer-icon",t[i]),!n&&(n=t[i])})),this.isIcons=n),n||(this.appendChild(".xgplayer-icon",F.createDom("span","",{},"icon-text")),F.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||F.addClass(this.root,"show")}},{key:"hide",value:function(){F.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,t,i){if(void 0===e)return"";var n=this.config.list;!i&&(i=this.player.lang),t=!t||F.isUndefined(e[t])?"text":t,"number"===typeof e&&(e=n[e]);try{return"object"===c(e[t])?e[t][i]||e[t].en:e[t]}catch(r){return console.warn(r),""}}},{key:"toggle",value:function(e){if(e!==this.isActive&&!this.config.disable){var t=this.player.controls,i=this.config.listType;e?(i===Xn.SIDE?t.blur():t.focus(),this.optionsList&&this.optionsList.show()):(i===Xn.SIDE?t.focus():t.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,t){e.stopPropagation();var i=this.config,n=i.listType,r=i.list;this.curIndex=t.to.index,this.curItem=r[this.curIndex],this.changeCurrentText();var a=this.config.isItemClickHide;(a||Dn||n===Xn.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,t=this.curIndex<e.length?this.curIndex:0,i=e[t];i&&(this.find(".icon-text").innerHTML=this.getTextByLang(i,"iconText"))}}},{key:"renderItemList",value:function(e,t){var i=this,n=this.config,r=this.optionsList,a=this.player;if("number"===typeof t&&(this.curIndex=t,this.curItem=n.list[t]),r)return r.renderItemList(e),void this.changeCurrentText();var s={config:{data:e||[],className:Pn(n.listType,n.position),onItemClick:function(e,t){i.onItemClick(e,t)},domEventType:Dn?"touch":"mouse"},root:n.listType===Xn.SIDE?a.innerContainer||a.root:this.root};if(this.config.isShowIcon){var o=this.player.root.getBoundingClientRect(),l=o.height,u=n.listType===Xn.MIDDLE?l-50:l;u&&n.heightLimit&&(s.config.maxHeight="".concat(u,"px")),this.optionsList=new Gn(s),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),t=e.height,i=this.config.listType===Xn.MIDDLE?t-50:t;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(i,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===_n.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",'">\n    <div class="xgplayer-icon">\n    </div>\n   </xg-icon>')}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:_n.HOVER,heightLimit:!0}}}]),i}(Dt),Vn=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),n.curTime=0,n.isPaused=!0,n}return f(i,[{key:"beforeCreate",value:function(e){var t=e.config.list;Array.isArray(t)&&t.length>0&&(e.config.list=t.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})))}},{key:"afterCreate",value:function(){var e=this;k(v(i.prototype),"afterCreate",this).call(this),this.on("resourceReady",(function(t){e.changeDefinitionList(t)})),this.on(Fe,(function(t){e.renderItemList(e.config.list,t.to)})),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||F.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,t=e.list,i=e.defaultDefinition;if(t.length>0){var n=null;t.map((function(e){e.definition===i&&(n=e)})),n||(n=t[0]),this.changeDefinition(n)}}},{key:"renderItemList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.list||[],n=arguments.length>1?arguments[1]:void 0,r=n&&n.definition?n.definition:this.config.defaultDefinition;n&&t.forEach((function(e){e.selected=!1}));var a=0,s=t.map((function(t,i){var n=u(u({},t),{},{showText:e.getTextByLang(t)||t.definition,selected:!1});return(t.selected||t.definition&&t.definition==r)&&(n.selected=!0,a=i),n}));k(v(i.prototype),"renderItemList",this).call(this,s,a)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,t){this.player.changeDefinition(e,t)}},{key:"onItemClick",value:function(e,t){var n=this.player.definitionList;k(v(i.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:t.from,to:t.to});for(var r=0;r<n.length;r++)t.to&&n[r].definition===t.to.definition&&(t.to.url=n[r].url),t.from&&n[r].definition===t.from.definition&&(t.from.url=n[r].url);this.player.changeDefinition(t.to,t.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return u(u({},Wn.defaultConfig),{},{position:Zt.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),i}(Wn),Nn=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),n.curRate=1,n}return f(i,[{key:"beforeCreate",value:function(e){var t=e.player.config.playbackRate,i=t?Array.isArray(t)?t:e.config.list:[];Array.isArray(i)&&(e.config.list=i.map((function(e){return"number"===typeof e?e={rate:e,text:"".concat(e,"x")}:!e.text&&e.rate&&(e.text="".concat(e.rate,"x")),e})))}},{key:"afterCreate",value:function(){var e=this;k(v(i.prototype),"afterCreate",this).call(this),this.on(pe,(function(){e.curValue!==e.player.playbackRate&&e.renderItemList()})),this.renderItemList()}},{key:"show",value:function(e){this.config.list&&0!==this.config.list.length&&k(v(i.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,t){k(v(i.prototype),"onItemClick",this).call(this,e,t);var n=e.delegateTarget,r=Number(n.getAttribute("rate"));if(!r||r===this.curValue)return!1;var a={playbackRate:{from:this.player.playbackRate,to:r}};this.emitUserAction(e,"change_rate",{props:a}),this.curValue=r,this.player.playbackRate=r}},{key:"renderItemList",value:function(){var e=this,t=this.player.playbackRate||1;this.curValue=t;var n=-1,r=this.config.list.map((function(i,r){var a={rate:i.rate};return a.rate===t&&(a.selected=!0,n=r),a.showText=e.getTextByLang(i),a}));k(v(i.prototype),"renderItemList",this).call(this,r,n)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,t=this.curIndex<e.length?this.curIndex:0,i=e[t],n="";n=!i||this.curIndex<0?"".concat(this.player.playbackRate,"x"):this.getTextByLang(i,"iconText"),this.find(".icon-text").innerHTML=n}}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return u(u({},Wn.defaultConfig),{},{position:Zt.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),i}(Wn);function Fn(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" class=\'path_full\' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}function An(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Yn=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.cssFullscreen&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;k(v(i.prototype),"afterCreate",this).call(this),this.config.disable||(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(Ve,(function(t){e.animate(t)})),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e.cssFullscreen),t.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:t}),t?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var t=this.i18nKeys,i=this.find(".xg-tips");i&&this.changeLangTextKey(i,e?t.EXITCSSFULLSCREEN_TIPS:t.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:Fn,class:"xg-get-cssfull"},exitCssFullscreen:{icon:An,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){k(v(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return"<xg-icon class='xgplayer-cssfullscreen'>\n    <div class=\"xgplayer-icon\">\n    </div>\n    ".concat(xi(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:Zt.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),i}(sn),On=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(re,(function(t){e.onError(t)}))}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.player,i=e.errorType,n=t.errorNote?this.i18n[t.errorNote]:"";if(!n)switch(i){case"decoder":n=this.i18n.MEDIA_ERR_DECODE;break;case"network":n=this.i18n.MEDIA_ERR_NETWORK;break;default:n=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=n,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return'<xg-error class="xgplayer-error">\n      <div class="xgplayer-errornote">\n       <span class="xgplayer-error-text"></span>\n       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>\n      </div>\n    </xg-error>'}}],[{key:"pluginName",get:function(){return"error"}}]),i}(Dt),Hn=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],(function(t){(e.config.onClick||e.customOnClick)&&(t.preventDefault(),t.stopPropagation(),e.customOnClick?e.customOnClick(t):e.config.onClick(t))})),this.player.showPrompt=function(){e.showPrompt.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var t=this;Object.keys(e).map((function(i){t.root.style[i]=e[i]}))}},{key:"showPrompt",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){this.customOnClick=n;var r=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),F.addClass(this.root,"show"),"arrow"===i.mode&&F.addClass(this.root,"arrow"),this.find(".xgplayer-prompt-detail").innerHTML="string"===typeof e?e:"".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),i.style&&this.setStyle(i.style);var a="boolean"===typeof i.autoHide?i.autoHide:this.config.autoHide;if(a){var s=i.interval||r;this.intervalId=setTimeout((function(){t.hide()}),s)}}}},{key:"hide",value:function(){F.removeClass(this.root,"show"),F.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(Yt.CONTROLS_FOLLOW,'">\n    <span class="xgplayer-prompt-detail"></span>\n    </xg-prompt>')}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),i}(Dt),Kn={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function Un(e){Object.keys(Kn).map((function(t){void 0===e[t]&&(e[t]=Kn[t])}))}var Bn={_updateDotDom:function(e,t){if(t){var i=this.calcuPosition(e.time,e.duration),n=e.style||{};n.left="".concat(i.left,"%"),n.width="".concat(i.width,"%"),t.setAttribute("data-text",e.text),t.setAttribute("data-time",e.time),i.isMini?F.addClass(t,"mini"):F.removeClass(t,"mini"),Object.keys(n).map((function(e){t.style[e]=n[e]}))}},initDots:function(){var e=this;this._ispots.map((function(t){e.createDot(t,!1)})),this.ispotsInit=!0},createDot:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.player.plugins.progress;if(i&&(t&&(Un(e),this._ispots.push(e)),this.ispotsInit||!t)){var n=this.calcuPosition(e.time,e.duration),r=e.style||{};r.left="".concat(n.left,"%"),r.width="".concat(n.width,"%");var a="xgspot_".concat(e.id," xgplayer-spot");n.isMini&&(a+=" mini");var s=e.template?'<div class="xgplayer-spot-pop">'.concat(e.template,"</div>"):"",o=F.createDom("xg-spot",s,{"data-text":e.text,"data-time":e.time,"data-id":e.id},a);Object.keys(r).map((function(e){o.style[e]=r[e]})),i.outer&&i.outer.appendChild(o),this.positionDot(o,e.id)}},findDot:function(e){if(this.player.plugins.progress){var t=this._ispots.filter((function(t,i){return t.id===e}));return t.length>0?t[0]:null}},updateDot:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.player.plugins.progress;if(i){var n=this.findDot(e.id);if(n&&Object.keys(e).map((function(t){n[t]=e[t]})),this.ispotsInit){var r=i.find('xg-spot[data-id="'.concat(e.id,'"]'));r&&(this._updateDotDom(e,r),t&&this.showDot(e.id))}}},deleteDot:function(e){var t=this._ispots,i=this.player.plugins.progress;if(i){for(var n=[],r=0;r<t.length;r++)t[r].id===e&&n.push(r);for(var a=n.length,s=a-1;s>=0;s--)if(t.splice(n[s],1),this.ispotsInit){var o=i.find('xg-spot[data-id="'.concat(e,'"]'));o&&o.parentElement.removeChild(o)}}},deleteAllDots:function(){var e=this.player.plugins.progress;if(e)if(this.ispotsInit){for(var t=e.root.getElementsByTagName("xg-spot"),i=t.length-1;i>=0;i--)e.outer.removeChild(t[i]);this._ispots=[]}else this._ispots=[]},updateAllDots:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this.player.plugins.progress;if(i)if(this.ispotsInit){this._ispots=[];var n=i.root.getElementsByTagName("xg-spot"),r=n.length;if(r>t.length)for(var a=r-1;a>t.length-1;a--)i.outer.removeChild(n[a]);t.forEach((function(t,i){i<r?(n[i].setAttribute("data-id","".concat(t.id)),e._ispots.push(t),e.updateDot(t)):e.createDot(t)}))}else this._ispots=t},positionDots:function(){var e=this,t=this._ispots,i=this.playerSize,n=this.player.sizeInfo,r=this.player.plugins.progress;r&&n.width!==i.width&&(i.width=n.width,i.left=n.left,t.forEach((function(t){var i=r.find('xg-spot[data-id="'.concat(t.id,'"]'));i&&e.positionDot(i,t.id)})))},positionDot:function(e,t){var i=F.findDom(e,".xgplayer-spot-pop");if(i){var n=this.playerSize,r=e.getBoundingClientRect(),a=i.getBoundingClientRect(),s=r.left-n.left,o=n.width-s-r.width/2;if(s<a.width/2||n.width<a.width){var l=a.width/2-s;i.style.left="".concat(l,"px")}else if(o<a.width/2){var u=o-a.width/2+r.width/2;i.style.left="".concat(u,"px")}else i.style.left="50%"}},updateDuration:function(){var e=this,t=this.player.plugins.progress;if(t){var i=this._ispots;i.forEach((function(i){var n=t.find('xg-spot[data-id="'.concat(i.id,'"]'));e._updateDotDom(i,n)}))}},getAllDotsDom:function(){var e=this.player.plugins.progress;if(!e)return[];var t=e.root.getElementsByTagName("xg-spot");return t},getDotDom:function(e){var t=this.player.plugins.progress;if(t)return t.find('xg-spot[data-id="'.concat(e,'"]'))}};function zn(e){var t=e.config,i=e.player;Object.keys(Bn).map((function(t){e[t]=Bn[t].bind(e)}));var n=i.config.progressDot||t.ispots||[];e._ispots=n.map((function(e){return Un(e),e})),e.ispotsInit=!1,e.playerSize={left:i.sizeInfo.left,width:i.sizeInfo.width},e.on(de,(function(){e.ispotsInit?e.updateDuration():e.initDots()})),e.on(Ke,(function(){e.positionDots()}))}var jn={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},Jn=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),m(b(n),"onMousemove",(function(e){n.config.disable||(F.hasClass(e.target,"xg-spot-content")&&n.config.isHideThumbnailHover?n.player.plugins.progress.onMouseLeave(e):(n._state.f||F.hasClass(e.target,"xg-spot-content"))&&(F.event(e),e.stopPropagation()))})),m(b(n),"onMousedown",(function(e){n.config.disable||(n._state.f||F.hasClass(e.target,"xg-spot-content"))&&(F.event(e),e.stopPropagation())})),m(b(n),"onMouseup",(function(e){if(n.isDrag){var t=n.player.plugins.progress;t&&t.pos&&(t.onMouseUp(e),!t.pos.isEnter&&t.onMouseLeave(e))}})),m(b(n),"onDotMouseLeave",(function(e){if(!n.config.disable){n._curDot.removeEventListener("mouseleave",n.onDotMouseLeave),n.blurDot(e.target),n._curDot=null;var t=n.player.plugins.progress;t&&t.enableBlur(),n.show()}})),m(b(n),"onProgressMouseOver",(function(e,t){if(!n.config.disable&&F.hasClass(t.target,"xgplayer-spot")&&!n._curDot){n._curDot=t.target,n.focusDot(t.target),n._curDot.children.length>0&&n.hide();var i=n.player.plugins.progress;i&&i.disableBlur(),n._curDot.addEventListener("mouseleave",n.onDotMouseLeave)}})),n._ispots=[],n.videoPreview=null,n.videothumbnail=null,n.thumbnail=null,n.timeStr="",n._state={now:0,f:!1},n}return f(i,[{key:"beforeCreate",value:function(e){var t=e.player.plugins.progress;t&&(e.root=t.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",(function(t,i){i.seekTime&&e.player.seek(i.seekTime)})),this.transformTimeHook=this.hook("transformTime",(function(t){e.setTimeContent(F.format(t))})),zn(this),this.on(de,(function(){e.show()})),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map((function(i){t.config[i]=e[i]}))}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,t=this.player.plugins.progress;if(t&&(Object.keys(jn).map((function(i){e[jn[i]]=e[jn[i]].bind(e),t.addCallBack(i,e[jn[i]])})),"mobile"!==j.device)){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var i=this.hook("previewClick",(function(){}));this.handlerPreviewClick=function(t){t.stopPropagation(),i(parseInt(1e3*e._state.now,10)/1e3,t)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,t){!this.config.disable&&this.player.duration&&this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){!this.config.disable&&this.player.duration&&(this.isDrag=!0,this.videoPreview&&F.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){!this.config.disable&&this.player.duration&&(this.isDrag=!1,this.videoPreview&&F.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,t){this.config.disable||F.hasClass(t.target,"xgplayer-spot")&&(t.stopPropagation(),t.preventDefault(),["time","id","text"].map((function(i){e[i]=t.target.getAttribute("data-".concat(i))})),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(t,e))}},{key:"updateLinePos",value:function(e,t){var i=this.root,n=this.previewLine,r=this.player,a=this.config,s=r.controls.mode,o="flex"===s,l=i.getBoundingClientRect().width;if(l||!this._hasThumnail){l=this._hasThumnail&&l<a.width?a.width:l;var u,c=e-l/2;c<0&&!o?(c=0,u=e-l/2):c>t-l&&!o?(u=c-(t-l),c=t-l):u=0,void 0!==u&&(n.style.transform="translateX(".concat(u.toFixed(2),"px)")),i.style.transform="translateX(".concat(c.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var t=this.timeText,i=this.timePoint;t.innerHTML=e,!this.thumbnail&&(i.innerHTML=e)}},{key:"updatePosition",value:function(e,t,i,n){var r=this.root,a=this.config,s=this._state;if(r){s.now=i,this.transformTimeHook(i);var o=this.timeStr;n&&n.target&&F.hasClass(n.target,"xgplayer-spot")?(this.showTips(n.target.getAttribute("data-text"),!1,o),this.focusDot(n.target),s.f=!0,a.isFocusDots&&s.f&&(s.now=parseInt(n.target.getAttribute("data-time"),10))):a.defaultText?(s.f=!1,this.showTips(a.defaultText,!0,o)):(s.f=!1,this.hideTips("")),this.updateTimeText(o),this.updateThumbnails(s.now),this.updateLinePos(e,t)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var t=this.player,i=this.videoPreview,n=this.config,r=t.plugins.thumbnail;if(r&&r.usable){this.thumbnail&&r.update(this.thumbnail,e,n.width,n.height);var a=i&&i.getBoundingClientRect();this.videothumbnail&&r.update(this.videothumbnail,e,a.width,a.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("mobile"!==j.device){var t=this.player,i=this.config,n=t.getPlugin("thumbnail");if(n&&n.setConfig(e),n&&n.usable&&i.isShowThumbnail){F.removeClass(this.root,"short-line no-thumbnail"),"short"===i.mode&&F.addClass(this.root,"short-line"),this._hasThumnail=!0;var r=this.find(".xg-spot-thumbnail");this.thumbnail=n.createThumbnail(r,"progress-thumbnail"),i.isShowCoverPreview&&(this.videoPreview=F.createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=n.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}else F.addClass(this.root,"short-line no-thumbnail")}}},{key:"calcuPosition",value:function(e,t){var i=this.player.plugins.progress,n=this.player,r=i.root.getBoundingClientRect().width,a=n.duration/r*6;return e+t>n.duration&&(t=n.duration-e),n.duration,n.duration,{left:e/n.duration*100,width:t/n.duration*100,isMini:t<a}}},{key:"showDot",value:function(e){var t=this.findDot(e);if(t){var i=this.root.getBoundingClientRect(),n=i.width,r=t.time/this.player.duration*n;this.updatePosition(r,n,t.time)}}},{key:"focusDot",value:function(e,t){e&&(t||(t=e.getAttribute("data-id")),F.addClass(e,"active"),this._activeDotId=t)}},{key:"blurDot",value:function(e){if(!e){var t=this._activeDotId;e=this.getDotDom(t)}e&&(F.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";F.addClass(this.root,"no-timepoint"),e&&(F.addClass(this.find(".xg-spot-content"),"show-text"),t&&"production"===this.config.mode?(F.addClass(this.root,"product"),this.tipText.textContent=e):(F.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(i," ").concat(e)))}},{key:"hideTips",value:function(){F.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",F.removeClass(this.find(".xg-spot-content"),"show-text"),F.removeClass(this.root,"product")}},{key:"hide",value:function(){F.addClass(this.root,"hide")}},{key:"show",value:function(e){F.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,t=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(t.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,t=this.player.plugins.progress;t&&Object.keys(jn).map((function(i){t.removeCallBack(i,e[jn[i]])})),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return"mobile"===j.device||"mobile"===this.playerConfig.isMobileSimulateMode?"":'<div class="xg-spot-info hide '.concat("short"===this.config.mode?"short-line":"",'">\n      <div class="xg-spot-content">\n        <div class="xg-spot-thumbnail">\n          <span class="xg-spot-time"></span>\n        </div>\n        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>\n      </div>\n      <div class="xgplayer-progress-point">00:00</div>\n      <div class="xg-spot-ext-text"></div>\n      <div class="xg-spot-line"></div>\n    </div>')}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),i}(Dt),Qn=function(e){p(i,e);var t=S(i);function i(e){var n;return d(this,i),n=t.call(this,e),n.ratio=1,n.interval=null,n._preloadMark={},n}return f(i,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([de],(function(){var t=e.config,i=t.pic_num,n=t.interval;e.usable&&(e.interval=n>0?n:Math.round(1e3*e.player.duration/i)/1e3)}))}},{key:"setConfig",value:function(e){var t=this;if(e){var i=Object.keys(e);i.length<1||(i.forEach((function(i){t.config[i]=e[i]})),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var e=this.config,t=e.urls,i=e.pic_num;return t&&t.length>0&&i>0}},{key:"initThumbnail",value:function(){var e=this.config,t=e.width,i=e.height,n=e.pic_num,r=e.interval;this.ratio=t/i*100,this.interval=r||Math.round(this.player.duration/n),this._preloadMark={}}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var t=this;if(!this._preloadMark[e]){var i=this.config.urls,n=i.length,r=[];e>0&&r.push(e-1),r.push(e),e>0&&e<n-1&&r.push(e+1),r.map((function(e){!t._preloadMark[e]&&e>=0&&e<n&&(t._preloadMark[e]=1,F.preloadImg(i[e],(function(){t._preloadMark[e]=2})))}))}}},{key:"getPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.config,r=n.pic_num,a=n.row,s=n.col,o=n.width,l=n.height;this.interval=Math.round(this.player.duration/r);var u=Math.ceil(e/this.interval);u=u>r?r:u;var c=u<a*s?0:Math.ceil(u/(a*s))-1,d=u-c*(s*a),h=d>0?Math.ceil(d/s)-1:0,f=d>0?d-h*s-1:0,m=0,p=0;if(t&&i){var v=t/i;v<o/l?(p=i,m=p*(o/l)):(m=t,p=m/(o/l))}else i?t||(p=i||l,m=p*(o/l)):(m=t||o,p=m/(o/l));var g=this.getUrlByIndex(c);return{urlIndex:c,rowIndex:h,colIndex:f,url:g,height:p,width:m,style:{backgroundImage:"url(".concat(g,")"),backgroundSize:"".concat(m*s,"px auto"),backgroundPosition:"-".concat(f*m,"px -").concat(h*p,"px"),width:"".concat(m,"px"),height:"".concat(p,"px")}}}},{key:"update",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=this.config,s=a.pic_num,o=a.urls;if(!(s<=0)&&o&&0!==o.length){var l=this.getPosition(t,i,n);this.preload(l.urlIndex),Object.keys(l.style).map((function(t){e.style[t]=l.style[t]})),Object.keys(r).map((function(t){e.style[t]=r[t]}))}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,t){var i=F.createDom("xg-thumbnail","",{},"thumbnail ".concat(t));return e&&e.appendChild(i),i}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),i}(Dt);function qn(e){return e?"background:".concat(e,";"):""}var $n=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onTimeupdate",(function(){var t=e.player.ended,i=b(e),n=i.offsetDuration,r=e.currentTime;r=F.adjustTimeByDuration(r,n,t),e.update({played:r},n)})),e}return f(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"currentTime",get:function(){var e=this.player,t=e.offsetCurrentTime,i=e.currentTime;return t>=0?t:i}},{key:"afterCreate",value:function(){var e=this;this.root&&(this.on(oe,this.onTimeupdate),this.on(ye,(function(){e.reset()})))}},{key:"reset",value:function(){this.update({played:0,cached:0},0)}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;t&&this.root&&(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/t*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/t*100,"%")))}},{key:"render",value:function(){var e=this.playerConfig,t=e.commonStyle,i=e.miniprogress;if(i){var n=this.config,r=n.mode,a=n.height,s={cached:qn(t.cachedColor),played:qn(t.playedColor),progress:qn(t.progressColor),height:a>0&&2!==a?"height: ".concat(a,"px;"):""},o="show"===r?"xg-mini-progress-show":"";return'<xg-mini-progress class="xg-mini-progress '.concat(o,'" style="').concat(s.progress," ").concat(s.height,'">\n    <xg-mini-progress-cache class="xg-mini-progress-cache" style="').concat(s.cached,'"></xg-mini-progress-cache>\n    <xg-mini-progress-played class="xg-mini-progress-played" style="').concat(s.played,'"></xg-mini-progress-played>\n    </xg-mini-progress>')}}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{mode:"auto",height:2}}}]),i}(Dt),er={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function tr(){try{return parseInt(window.performance.now(),10)}catch(e){return(new Date).getTime()}}function ir(){try{var e=document.createElement("canvas").getContext;return!!e}catch(t){return!1}}var nr=null,rr=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onLoadedData",(function(t){e.player&&(e._frameCount=e.config.startFrameCount,e.stop(),e.renderOnTimeupdate(t),e.off(oe,e.renderOnTimeupdate),e.on(oe,e.renderOnTimeupdate))})),m(b(e),"onVisibilitychange",(function(t){"visible"===document.visibilityState?e._checkIfCanStart()&&e.start():"hidden"===document.visibilityState&&e.stop()})),m(b(e),"renderOnTimeupdate",(function(t){if(e._frameCount>0)e.renderOnce(),e._frameCount--;else{e._isLoaded=!0,e.off(oe,e.renderOnTimeupdate);var i=e.config.startInterval;!e.player.paused&&e._checkIfCanStart()&&e.start(0,i)}})),m(b(e),"start",(function(t,i){var n=e.player.video,r=tr(),a=e.checkVideoIsSupport(n);a&&e.canvasCtx&&(i||(i=e.interval),e.stop(),n.videoWidth&&n.videoHeight&&(e.videoPI=n.videoHeight>0?parseInt(n.videoWidth/n.videoHeight*100,10):0,(e.config.mode===er.REAL_TIME||r-e.preTime>=i)&&(n&&n.videoWidth&&e.update(a,e.videoPI),e.preTime=r)),e.frameId="timer"===e._loopType?F.setTimeout(b(e),e.start,i):F.requestAnimationFrame(e.start))})),m(b(e),"stop",(function(){e.frameId&&("timer"===e._loopType?F.clearTimeout(b(e),e.frameId):F.cancelAnimationFrame(e.frameId),e.frameId=null)})),e}return f(i,[{key:"afterCreate",value:function(){var e=this;!0===this.playerConfig.dynamicBg&&(this.config.disable=!1),i.isSupport||(this.config.disable=!0);var t=this.config,n=t.disable,r=t.mode,a=t.frameRate;n||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/a,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==er.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(Ce,(function(){e.player&&(e.init(),e.renderByPoster(),e.player.paused||e.start())})),r!==er.POSTER&&(r!==er.FIRST_FRAME&&(this.on(ye,(function(){e.stop()})),this.on(ee,(function(){var t=e.config.startInterval;e._checkIfCanStart()&&e.start(0,t)})),this.on(ne,(function(){e.stop()}))),this.on(fe,this.onLoadedData),this.on(ge,(function(){e._isLoaded=!1,e.stop()})),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(e){var t=this;Object.keys(e).forEach((function(i){"root"===i&&e[i]!==t.config[i]?t.reRender(e[i]):"frameRate"===i?t.interval=parseInt(1e3/e[i],10):"disable"===i&&e[i]&&t.stop(),t.config[i]=e[i]}))}},{key:"init",value:function(e){var t=this.player,n=this.config;this.canvasFilter=i.supportCanvasFilter();try{var r=e||n.root;r||(r=n.isInnerRender&&t.innerContainer||t.root),r.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(n.index,'"><canvas>\n        </canvas><xgmask></xgmask></div>')),this.root=r.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=n.filter,this.canvas.style.webkitFilter=n.filter),this.mask=this.find("xgmask"),n.addMask&&(this.mask.style.background=n.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(a){W.logError("plugin:DynamicBg",a)}}},{key:"reRender",value:function(e){var t=this.config.disable;if(t||this.root){this.stop();var i=this.root?this.root.parentElement:null;if(i!==e&&i.removeChild(this.root),e){this.init(e),this.renderOnce();var n=this.config.startInterval;this._checkIfCanStart()&&this.start(0,n)}else this.root=null}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var t=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(t&&("safari"!==j.browser||!F.isMSE(t)))return t;var i=t?t.tagName.toLowerCase():"";return"canvas"===i||"img"===i?t:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var t="String"===F.typeOf(e)?e:"String"===F.typeOf(e.poster)?e.poster:null;this.updateImg(t)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==er.FIRST_FRAME&&e!==er.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(e.videoWidth&&e.videoHeight){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var t=this.checkVideoIsSupport(e);t&&this.update(t,this.videoPI)}}},{key:"updateImg",value:function(e){var t=this;if(e){var i=this.canvas.getBoundingClientRect(),n=i.width,r=i.height,a=new window.Image;a.onload=function(){if(t.canvas&&!t.frameId&&!t.isStart){t.canvas.height=r,t.canvas.width=n;var e=parseInt(n/r*100,10);t.update(a,e),a=null}},a.src=e}}},{key:"update",value:function(e,t){if(this.canvas&&this.canvasCtx&&t)try{var i=this._pos,n=this.config,r=this.canvas.getBoundingClientRect(),a=r.width,s=r.height;if(a!==i.width||s!==i.height||i.pi!==t){var o=parseInt(a/s*100,10);i.pi=t,i.width!==a&&(i.width=this.canvas.width=a),i.height!==s&&(i.height=this.canvas.height=s);var l=s,u=a;o<t?u=parseInt(s*t/100,10):o>t&&(l=parseInt(100*a/t,10)),i.rwidth=u*n.multiple,i.rheight=l*n.multiple,i.x=(a-i.rwidth)/2,i.y=(s-i.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=n.filter),this.canvasCtx.drawImage(e,i.x,i.y,i.rwidth,i.rheight)}catch(c){W.logError("plugin:DynamicBg",c)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return"boolean"===typeof nr||(nr=ir()),nr}},{key:"supportCanvasFilter",value:function(){return!("safari"===j.browser||"firefox"===j.browser)}}]),i}(Dt),ar={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:""},mse:{code:2,msg:""},parse:{code:3,msg:""},format:{code:4,msg:""},decoder:{code:5,msg:""},runtime:{code:6,msg:""},timeout:{code:7,msg:""},other:{code:8,msg:""}},HAVE_NOTHING:"/",HAVE_METADATA:"/",HAVE_CURRENT_DATA:"/",HAVE_FUTURE_DATA:"",HAVE_ENOUGH_DATA:"",NETWORK_EMPTY:"/",NETWORK_IDLE:"/",NETWORK_LOADING:"",NETWORK_NO_SOURCE:"/",MEDIA_ERR_ABORTED:"",MEDIA_ERR_NETWORK:"",MEDIA_ERR_DECODE:"",MEDIA_ERR_SRC_NOT_SUPPORTED:"/",REPLAY:"",ERROR:"",PLAY_TIPS:"",PAUSE_TIPS:"",PLAYNEXT_TIPS:"",DOWNLOAD_TIPS:"",ROTATE_TIPS:"",RELOAD_TIPS:"",FULLSCREEN_TIPS:"",EXITFULLSCREEN_TIPS:"",CSSFULLSCREEN_TIPS:"",EXITCSSFULLSCREEN_TIPS:"",TEXTTRACK:"",PIP:"",SCREENSHOT:"",LIVE:"",OFF:"",OPEN:"",MINI_DRAG:"",MINISCREEN:"",REFRESH_TIPS:"",REFRESH:"",FORWARD:"",LIVE_TIP:""}},sr="info",or=rt,lr=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"_recordUserActions",(function(t){var i=e._getTime(),n=Object.assign({},t,{msg:t.msg||t.action});e._stats[sr].push(u(u({type:"userAction"},i),{},{payload:n}))})),m(b(e),"_onReset",(function(){e.reset()})),m(b(e),"_recordInfo",(function(t){e.info(t)})),m(b(e),"_downloadStats",(function(){var t=e.getStats(),i=new Blob([JSON.stringify(t)],{type:"application/json"}),n=window.URL.createObjectURL(i),r=document.createElement("a");r.style.display="none",r.href=n,r.download="player.txt",r.disabled=!1,r.click()})),e}return f(i,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:(new Date).toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(qe,this._recordUserActions),this.on(or.STATS_INFO,this._recordInfo),this.on(or.STATS_DOWNLOAD,this._downloadStats),this.on(or.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var t=this._getTime();this._stats[sr].push(u(u({},t),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var t=Date.now(),i=t-e.startMs,n=u({cat:"function",dur:i,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(n)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(e={},m(e,sr,[]),m(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player,t=e.media,i=[],n=0;n<t.buffered.length;n++)i.push({start:t.buffered.start(n),end:t.buffered.end(n)});var r={currentTime:t.currentTime,readyState:t.readyState,buffered:i,paused:t.paused,ended:t.ended};return this._stats.media=r,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){var e=this._stats[sr],t=e.map((function(e){var t=e.payload.data,i="";try{t instanceof Error?i=t.msg:void 0!==t&&(i=JSON.stringify(t))}catch(n){console.log("err",n)}return"[".concat(e.timeFormat,"] : ").concat(e.payload.msg," ").concat(i," ")}));return t}},{key:"_getProfile",value:function(){var e={traceEvents:[]},t=this._stats[sr];return t.forEach((function(t){t.payload.profile&&e.traceEvents.push(t.payload)})),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),i}(xt),ur=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onGapJump",(function(){var t=b(e),n=t.player,r=t.config;if(n.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(n.media.seeking){if(!e.seekingEventReceived)return}else e.seekingEventReceived=!1;if(!n.media.paused||0===n.media.currentTime||!e.hasPlayed){var a=n.media.buffered,s=r.smallGapLimit||.5,o=r.gapDetectionThreshold||.3,l=n.media.currentTime,u=e._getIndex(a,l,o);if(null!==u&&0!==u){console.log("GapJump  bufferRange ",a.start(u),a.end(u));var c=a.start(u)+.1,d=n.media.duration;if(!(c>d)){var h=c-l,f=h<=s;h<i.BROWSER_GAP_TOLERANCE||f&&(!1!==r.useGapJump&&(n.media.currentTime=e.isSafari?c+.1:c),e.player&&e.player.emit("detectGap"),console.log("gapJump gapIndex",u," isGapSamll:",f," currentTime:",n.media.currentTime," jumpSize:",l-n.media.currentTime),.08!==c&&n&&n.emit("log",{type:"oneevent",end_type:"gap",vid:n.config.vid,ext:{video_postion:Math.floor(1e3*c)}}))}}}}})),e}return f(i,[{key:"afterCreate",value:function(){var e=this,t=this.config.useGapJump;!1!==t&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(le,this.onGapJump),this.on(ee,(function(){e.hasPlayed=!0})),this.on(ae,(function(){e.seekingEventReceived=!0})))}},{key:"_getIndex",value:function(e,t,i){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var n=this._getBuffered(e),r=null,a=0;a<n.length;a++){var s=n[a];if(s.start>t&&(0===a||n[a-1].end-t<=i)){r=a;break}}return r}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),i}(Dt);ur.BROWSER_GAP_TOLERANCE=.001;var cr=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"onWaiting",(function(){var t=b(e),i=t.config;e.jumpCnt>i.jumpCntMax||e.timer||!1===i.useWaitingTimeoutJump||(e.timer=setTimeout(e.onJump,1e3*i.waitingTime))})),m(b(e),"onJump",(function(){var t=b(e),i=t.player,n=t.config;if(clearTimeout(e.timer),e.timer=null,!(e.jumpCnt>n.jumpCntMax||!1===n.useWaitingTimeoutJump)&&(!i.media.paused||0===i.media.currentTime||!e.hasPlayed)){e.jumpSize=n.jumpSize*(e.jumpCnt+1),e.jumpCnt===n.jumpSize&&e.jumpSize<6&&(e.jumpSize=6);var r=i.currentTime+e.jumpSize,a=i.media.duration;r>a||(e.jumpCnt++,i.currentTime=r)}})),e}return f(i,[{key:"afterCreate",value:function(){var e=this,t=this.config,i=t.useWaitingTimeoutJump,n=t.jumpSize;!1!==i&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=n,this.on(le,this.onWaiting),this.on([te,ue],(function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize})),this.on(ee,(function(){e.hasPlayed=!0})))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),i}(Dt),dr="cdn",hr=["cdn"],fr=function(e){p(i,e);var t=S(i);function i(){var e;d(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),m(b(e),"getSpeed",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr;if(!e.speedListCache||!e.speedListCache[t])return 0;if(e.speedListCache[t].length<=0)return 0;var i=0;return e.speedListCache[t].map((function(e){i+=e})),Math.floor(i/e.speedListCache[t].length)})),m(b(e),"startTimer",(function(){F.isMSE(e.player.video)||(e.initSpeedList(),e.cnt=0,e.timer=setTimeout(e.testSpeed,e.config.testTimeStep))})),m(b(e),"initSpeedList",(function(){e.speedListCache={},hr.forEach((function(t){e.speedListCache[t]=[]}))})),m(b(e),"_onRealSpeedChange",(function(t){t.speed&&e.appendList(t.speed,t.type||dr)})),m(b(e),"testSpeed",(function(){if(clearTimeout(e.timer),e.timer=null,e.player&&e.config.openSpeed){var t=e.config,i=t.url,n=t.loadSize,r=t.testCnt,a=t.testTimeStep,s=i+(i.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(e.cnt>=r)){e.cnt++;try{var o=(new Date).getTime(),l=null,u=new XMLHttpRequest;e.xhr=u,u.open("GET",s);var c={},d=Math.floor(10*Math.random());c.Range="bytes="+d+"-"+(n+d),c&&Object.keys(c).forEach((function(e){u.setRequestHeader(e,c[e])})),u.onreadystatechange=function(){if(4===u.readyState){e.xhr=null,l=(new Date).getTime();var t=u.getResponseHeader("Content-Length")/1024*8,i=Math.round(1e3*t/(l-o));e.appendList(i),e.timer=setTimeout(e.testSpeed,a)}},u.send()}catch(h){console.error(h)}}}})),m(b(e),"appendList",(function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dr;if(e.speedListCache&&e.speedListCache[i]){var n=e.config.saveSpeedMax;e.speedListCache[i].length>=n&&e.speedListCache[i].shift(),e.speedListCache[i].push(t);var r=b(e),a=r.player;a&&(i===dr?a.realTimeSpeed=t:a[e.getSpeedName("realTime",i)]=t),e.updateSpeed(i)}})),m(b(e),"updateSpeed",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr,i=e.getSpeed(t),n=b(e),r=n.player;if(r)if(t===dr)r.avgSpeed&&i===r.avgSpeed||(r.avgSpeed=i,r.emit(Xe,{speed:i,realTimeSpeed:r.realTimeSpeed}));else{var a=e.getSpeedName("avg",t);r[a]&&i===r[a]||(r[a]=i,r.emit(Xe,{speed:i,realTimeSpeed:r.realTimeSpeed}))}})),e}return f(i,[{key:"afterCreate",value:function(){var e=this.config,t=e.openSpeed,i=e.addSpeedTypeList;(null===i||void 0===i?void 0:i.length)>0&&hr.push.apply(hr,x(i)),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,t&&this.on([fe,Ie],this.startTimer)}},{key:"getSpeedName",value:function(e,t){return e+"Speed"+t.toUpperCase()}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer)return clearTimeout(this.timer),void(this.timer=null);if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){var e=this;this.off("real_time_speed",this._onRealSpeedChange),this.off([fe,Ie],this.startTimer),hr.forEach((function(t){e.speedListCache&&e.speedListCache[t]&&(e.speedListCache[t]=[])})),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&4!==this.xhr.readyState&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:204800,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}}]),i}(Dt),mr=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"afterCreate",value:function(){var e=this,t=this.player,i=this.config,n=t.media||t.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!i.disabled){var r=n.getVideoPlaybackQuality;r&&(this.on(ee,(function(){e._startTick()})),this.on(ne,(function(){e._stopTick()})),this.on(ie,(function(){e._stopTick()})),this.on(ye,(function(){e._stopTick()})))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout((function(){e._checkDecodeFPS(),e._startTick()}),this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(e,t){for(var i=!1,n=[],r=0;r<t.length;r++){var a=t.start(r),s=t.end(r);if(n.push({start:a,end:s}),a<=e&&e<=s-1){i=!0;break}}return{enoughBuffer:i,buffers:n}}},{key:"_checkStuck",value:function(e,t,i,n){var r=this.player.media||this.player.video,a=document.hidden,s=r.paused,o=r.readyState,l=r.currentTime,u=r.buffered;if(!(a||s||o<4)){var c=this._checkBuffer(l,u),d=c.enoughBuffer,h=c.buffers;d&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:l,buffers:h,curDecodedFrames:e,totalVideoFrames:t,droppedVideoFrames:i,checkInterval:n}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(at,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var e=this.player.media||this.player.video;if(e){var t=e.getVideoPlaybackQuality(),i=t.totalVideoFrames,n=t.droppedVideoFrames,r=performance.now();if(i&&this._lastCheckPoint){var a=i-this._lastDecodedFrames,s=r-this._lastCheckPoint;this._checkStuck(a,i,n,s)}this._lastDecodedFrames=i,this._lastCheckPoint=r}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),i}(Dt);$t.use(ar);var pr=f((function e(t,i){var n,r,a;d(this,e);var s=i&&"mobile"===i.isMobileSimulateMode,o=i.isLive,l=o?[]:[mn,an,$n,Jn,fn],u=[].concat(l,[on,hn,Ln,wn,Vn,Nn,In,Mn,yn,xn]),c=[pi,vi,Ti,en,ki,On,Hn,Qn,Di];this.plugins=[lr,fi].concat(x(u),c,[ur,cr]);var h=s?"mobile":j.device;switch(h){case"pc":(n=this.plugins).push.apply(n,[qi,Ni,Yn,fr,mr]);break;case"mobile":(r=this.plugins).push.apply(r,[ji]);break;default:(a=this.plugins).push.apply(a,[qi,Ni,Yn])}(j.os.isIpad||"pc"===h)&&this.plugins.push(rr),j.os.isIpad&&this.plugins.push(Ni),this.ignores=[],this.i18n=[]})),vr=function(e){p(i,e);var t=S(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i)}(ci);function gr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Zr(n.key),n)}}function br(e,t,i){return t&&yr(e.prototype,t),i&&yr(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lr(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tr(e,t)}function Sr(e){return Sr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sr(e)}function Tr(e,t){return Tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tr(e,t)}function kr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function xr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rr(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return xr(e)}function wr(e){var t=kr();return function(){var i,n=Sr(e);if(t){var r=Sr(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Rr(this,i)}}function Er(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Zr(e){var t=Er(e,"string");return"symbol"===typeof t?t:String(t)}m(vr,"defaultPreset",pr),m(vr,"Util",F),m(vr,"Sniffer",j),m(vr,"Errors",$),m(vr,"Events",n),m(vr,"Plugin",Dt),m(vr,"BasePlugin",xt),m(vr,"I18N",$t),m(vr,"STATE_CLASS",Yt),m(vr,"InstManager",ri);var Cr=i("4472"),Ir=i.n(Cr),Mr={getBrowserVersion:function(){var e=navigator.userAgent;if(e.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(e.indexOf("Firefox")>-1){var t=e.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Firefox "+t}if(e.indexOf("Edge")>-1){var i=e.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Edge "+i}if(e.indexOf("rv:11")>-1)return"IE 11";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1){if(e.indexOf("Opera")>-1){var n=e.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+n}if(e.indexOf("OPR")>-1){var r=e.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+r}}else{if(e.indexOf("Chrome")>-1){var a=e.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Chrome "+a}if(e.indexOf("Safari")>-1){var s=e.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Safari "+s}if(!(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1))return"Unknown";if(e.indexOf("MSIE")>-1){var o=e.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+o}if(e.indexOf("Trident")>-1){var l=e.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0],u=parseInt(l)+4;return"IE "+u}}}},Gr=function(e){Lr(i,e);var t=wr(i);function i(e){var n;return gr(this,i),n=t.call(this,e),n.browser=Mr.getBrowserVersion(),n.hls=null,n.hlsOpts={},n.player.handleSource=!1,n}return br(i,[{key:"afterCreate",value:function(){var e=this,t=this.config.hlsOpts;this.hlsOpts=t,this.on(n.URL_CHANGE,(function(t){/^blob/.test(t)||(e.playerConfig.url=t,e.register(t))}));try{xt.defineGetterOrSetter(this.player,{url:{get:function(){try{return e.player.video.src}catch(t){return null}},configurable:!0}})}catch(i){}}},{key:"beforePlayerInit",value:function(){this.register(this.player.config.url)}},{key:"destroy",value:function(){this.hls&&this.hls.destroy();var e=this.player;xt.defineGetterOrSetter(e,{url:{get:function(){try{return e.__url}catch(t){return null}},configurable:!0}})}},{key:"register",value:function(e){var t=this,i=this.player;this.hls&&this.hls.destroy(),this.hls=new Ir.a(this.hlsOpts),this.hls.once(Ir.a.Events.MEDIA_ATTACHED,(function(){t.hls.loadSource(e)})),this.hls.on(Ir.a.Events.ERROR,(function(e,n){var r;if(i.emit("HLS_ERROR",{errorType:n.type,errorDetails:n.details,errorFatal:n.fatal}),n.fatal)switch(n.type){case Ir.a.ErrorTypes.NETWORK_ERROR:404!==(null===n||void 0===n||null===(r=n.networkDetails)||void 0===r?void 0:r.status)&&t.hls.startLoad();break;case Ir.a.ErrorTypes.MEDIA_ERROR:t.hls.recoverMediaError();break;default:i.emit("error",n)}})),this.hls.attachMedia(this.player.media||this.player.video),this._statistics()}},{key:"_statistics",value:function(){var e={speed:0,playerType:"HlsPlayer"},t={videoDataRate:0,audioDataRate:0},i=this.player,n=this.hls;n.on(Ir.a.Events.FRAG_LOAD_PROGRESS,(function(t,i){e.speed=i.stats.loaded/1e3})),n.on(Ir.a.Events.FRAG_PARSING_DATA,(function(e,i){"video"===i.type&&(t.fps=parseInt(i.nb/(i.endPTS-i.startPTS)))})),n.on(Ir.a.Events.FRAG_PARSING_INIT_SEGMENT,(function(e,n){if(t.hasAudio=!(!n.tracks||!n.tracks.audio),t.hasVideo=!(!n.tracks||!n.tracks.audio),t.hasAudio){var r=n.tracks.audio;t.audioChannelCount=r.metadata&&r.metadata.channelCount?r.metadata.channelCount:0,t.audioCodec=r.codec}if(t.hasVideo){var a=n.tracks.video;t.videoCodec=a.codec,t.width=a.metadata&&a.metadata.width?a.metadata.width:0,t.height=a.metadata&&a.metadata.height?a.metadata.height:0}t.duration=n.frag&&n.frag.duration?n.frag.duration:0,t.level=n.frag&&n.frag.levels?n.frag.levels:0,(t.videoCodec||t.audioCodec)&&(t.mimeType='video/hls; codecs="'.concat(t.videoCodec,";").concat(t.audioCodec,'"')),i.mediainfo=t,i.emit("media_info",t)})),this._statisticsTimmer=setInterval((function(){i.emit("statistics_info",e),e.speed=0}),1e3)}}],[{key:"pluginName",get:function(){return"HlsJsPlugin"}},{key:"defaultConfig",get:function(){return{hlsOpts:{}}}},{key:"isSupported",get:function(){return Ir.a.isSupported}}]),i}(xt);function Xr(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function _r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Xr(Object(i),!0).forEach((function(t){Ar(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Xr(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Pr(){Pr=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(Z){l=function(e,t,i){return e[t]=i}}function u(e,t,i,r){var a=t&&t.prototype instanceof h?t:h,s=Object.create(a.prototype),o=new R(r||[]);return n(s,"_invoke",{value:S(e,i,o)}),s}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(Z){return{type:"throw",arg:Z}}}e.wrap=u;var d={};function h(){}function f(){}function m(){}var p={};l(p,a,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(w([])));g&&g!==t&&i.call(g,a)&&(p=g);var y=m.prototype=h.prototype=Object.create(p);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(n,a,s,o){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==typeof d&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,o)}))}o(l.arg)}var a;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){r(e,i,t,n)}))}return a=a?a.then(n,n):n()}})}function S(e,t,i){var n="suspendedStart";return function(r,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw a;return E()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var o=T(s,i);if(o){if(o===d)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=c(e,t,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}function T(e,t){var i=t.method,n=e.iterator[i];if(void 0===n)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=m,n(y,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:f,configurable:!0}),f.displayName=l(m,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(L.prototype),l(L.prototype,s,(function(){return this})),e.AsyncIterator=L,e.async=function(t,i,n,r,a){void 0===a&&(a=Promise);var s=new L(u(t,i,n,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),l(y,o,"Generator"),l(y,a,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return s.type="throw",s.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var o=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(o&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),x(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;x(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:w(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function Dr(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(u){return void i(u)}o.done?t(l):Promise.resolve(l).then(n,r)}function Wr(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function s(e){Dr(a,n,r,s,o,"next",e)}function o(e){Dr(a,n,r,s,o,"throw",e)}s(void 0)}))}}function Vr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Jr(n.key),n)}}function Fr(e,t,i){return t&&Nr(e.prototype,t),i&&Nr(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ar(e,t,i){return t=Jr(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Yr(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Hr(e,t)}function Or(e){return Or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Or(e)}function Hr(e,t){return Hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Hr(e,t)}function Kr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Ur(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Br(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ur(e)}function zr(e){var t=Kr();return function(){var i,n=Or(e);if(t){var r=Or(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Br(this,i)}}function jr(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Jr(e){var t=jr(e,"string");return"symbol"===typeof t?t:String(t)}var Qr=i("6bd7"),qr=i.n(Qr);function $r(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,a,s,o=[],l=!0,u=!1;try{if(a=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=a.call(i)).done)&&(o.push(n.value),o.length!==t);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(u)throw r}}return o}}function ea(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ta(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pa(n.key),n)}}function ia(e,t,i){return t&&ta(e.prototype,t),i&&ta(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function na(e,t,i){return t=pa(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ra(e,t){return oa(e)||$r(e,t)||ua(e,t)||ha()}function aa(e){return sa(e)||la(e)||ua(e)||da()}function sa(e){if(Array.isArray(e))return ca(e)}function oa(e){if(Array.isArray(e))return e}function la(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ua(e,t){if(e){if("string"===typeof e)return ca(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ca(e,t):void 0}}function ca(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function da(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ha(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fa(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=ua(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function ma(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function pa(e){var t=ma(e,"string");return"symbol"===typeof t?t:String(t)}var va={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},ga={AV1:"av1",AVC:"avc",HEVC:"hevc"},ya={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},ba=function(){function e(){ea(this,e),na(this,"id",1),na(this,"type",va.VIDEO),na(this,"codecType",ga.AVC),na(this,"pid",-1),na(this,"hvcC",void 0),na(this,"codec",""),na(this,"timescale",0),na(this,"formatTimescale",0),na(this,"sequenceNumber",0),na(this,"baseMediaDecodeTime",0),na(this,"baseDts",0),na(this,"duration",0),na(this,"warnings",[]),na(this,"samples",[]),na(this,"pps",[]),na(this,"sps",[]),na(this,"vps",[]),na(this,"fpsNum",0),na(this,"fpsDen",0),na(this,"sarRatio",[]),na(this,"width",0),na(this,"height",0),na(this,"nalUnitSize",4),na(this,"present",!1),na(this,"isVideoEncryption",!1),na(this,"isAudioEncryption",!1),na(this,"isVideo",!0),na(this,"kid",null),na(this,"pssh",null),na(this,"ext",void 0)}return ia(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}},{key:"exist",value:function(){return!!/av01/.test(this.codec)||!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),e}(),La=function(){function e(){ea(this,e),na(this,"id",2),na(this,"type",va.AUDIO),na(this,"codecType",ya.AAC),na(this,"pid",-1),na(this,"codec",""),na(this,"sequenceNumber",0),na(this,"sampleDuration",0),na(this,"timescale",0),na(this,"formatTimescale",0),na(this,"baseMediaDecodeTime",0),na(this,"duration",0),na(this,"warnings",[]),na(this,"samples",[]),na(this,"baseDts",0),na(this,"sampleSize",16),na(this,"sampleRate",0),na(this,"channelCount",0),na(this,"objectType",0),na(this,"sampleRateIndex",0),na(this,"config",[]),na(this,"present",!1),na(this,"isVideoEncryption",!1),na(this,"isAudioEncryption",!1),na(this,"kid",null),na(this,"ext",void 0)}return ia(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===ya.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}}]),e}(),Sa=function(){function e(t,i,n){ea(this,e),na(this,"flag",{}),na(this,"keyframe",!1),na(this,"gopId",0),na(this,"duration",0),na(this,"size",0),na(this,"units",[]),na(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=i,n&&(this.units=n)}return ia(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),Ta=ia((function e(t,i,n,r){ea(this,e),na(this,"duration",1024),na(this,"flag",{dependsOn:2,isNonSyncSample:0}),na(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=i,this.size=i.byteLength,this.sampleOffset=r,n&&(this.duration=n)})),ka=function(){function e(){ea(this,e),na(this,"id",3),na(this,"type",va.METADATA),na(this,"timescale",0),na(this,"flvScriptSamples",[]),na(this,"seiSamples",[])}return ia(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}();function xa(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),r=0;return t.forEach((function(e){n.set(e,r),r+=e.byteLength})),n}var Ra=Math.pow(2,32);function wa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function Ea(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}function Za(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function Ca(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Za(e,t)*Ra+Za(e,t+4)}function Ia(e){for(var t,i="avc1.",n=0;n<3;n++)t=e[n].toString(16),t.length<2&&(t="0".concat(t)),i+=t;return i}function Ma(e){var t="";if(e.forEach((function(e){t+=Xa(e)})),t.length<=32)for(var i=32-t.length,n=0;n<i;n++)t+="0";return t}function Ga(e){if(!Array.isArray(e)){for(var t=[],i="",n=0;n<e.length;n++)n%2&&(i=e[n-1]+e[n],t.push(parseInt(i,16)),i="");return t}return e.map((function(e){return parseInt(e,16)}))}function Xa(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()}function _a(e,t){return Number(e+"."+t)}function Pa(e){if(e.length<5)return 0;var t=Math.hypot(e[0],e[3]),i=Math.hypot(e[1],e[4]);return 0===t||0===i?0:180*Math.atan2(e[1]/i,e[0]/t)/Math.PI}var Da="undefined"!==typeof window,Wa=Da&&navigator.userAgent.toLocaleLowerCase(),Va=(Da&&/^((?!chrome|android).)*safari/.test(Wa),Da&&Wa.includes("firefox")),Na=Da&&Wa.includes("android"),Fa=function(){function e(){ea(this,e)}return ia(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,i){var n=t.length,r=0;while(r+2<n){if(255===t[r]&&240===(246&t[r+1]))break;r++}if(!(r>=n)){var a=r,s=[],o=(60&t[r+2])>>>2,l=e.FREQ[o];if(!l)throw new Error("Invalid sampling index: ".concat(o));var u,c,d=1+((192&t[r+2])>>>6),h=(1&t[r+2])<<2|(192&t[r+3])>>>6,f=e._getConfig(o,h,d),m=f.config,p=f.codec,v=0,g=e.getFrameDuration(l);while(r+7<n)if(255===t[r]&&240===(246&t[r+1])){if(c=(3&t[r+3])<<11|t[r+4]<<3|(224&t[r+5])>>5,!c||n-r<c)break;u=2*(1&~t[r+1]),s.push({pts:i+v*g,data:t.subarray(r+7+u,r+c)}),v++,r+=c}else r++;return{skip:a,remaining:r>=n?void 0:t.subarray(r),frames:s,samplingFrequencyIndex:o,sampleRate:l,objectType:d,channelCount:h,codec:p,config:m,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var i=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,r=(120&t[1])>>>3,a=e.FREQ[n];if(a){var s=e._getConfig(n,r,i),o=s.config,l=s.codec;return{samplingFrequencyIndex:n,sampleRate:a,objectType:i,channelCount:r,config:o,codec:l,originCodec:"mp4a.40.".concat(i)}}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,i){var n,r,a=[];return Va?e>=6?(n=5,r=e-3):(n=2,r=e):Na?(n=2,r=e):(n=2===i||5===i?i:5,r=e,e>=6?r=e-3:1===t&&(n=2,r=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&r)>>1,a[2]=(1&r)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),e}();na(Fa,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var Aa=function(){function e(t,i,n){ea(this,e),this.dv=new DataView(t),this.start=this.offset=i||this.dv.byteOffset,this.end=n?this.start+n:this.start+this.dv.byteLength}return ia(e,[{key:"buffer",get:function(){return this.dv.buffer}},{key:"unreadLength",get:function(){return Math.max(this.end-this.offset,0)}},{key:"size",get:function(){return this.end-this.start}},{key:"readFloat",value:function(e){var t=0;switch(e){case 4:t=this.dv.getFloat32(this.offset);break;case 8:t=this.dv.getFloat64(this.offset);break;default:throw new Error("read ".concat(e,"-byte float is not supported"))}return this.offset+=e,t}},{key:"back",value:function(e){this.offset-=e}},{key:"skip",value:function(e){this.offset+=e}},{key:"readInt",value:function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getInt8(t);case 2:return this.dv.getInt16(t);case 4:return this.dv.getInt32(t);default:throw new Error("read ".concat(e,"-byte integers is not supported"))}}},{key:"read",value:function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getUint8(t);case 2:return this.dv.getUint16(t);case 3:return(this.dv.getUint16(t)<<8)+this.dv.getUint8(t+2);case 4:return this.dv.getUint32(t);default:return this.back(e-4),this.read(e-4)+this.dv.getUint32(t)*Math.pow(256,e-4)}}},{key:"write",value:function(e,t){var i=this.offset;switch(this.offset+=e,e){case 1:return this.dv.setUint8(i,t);case 2:return this.dv.setUint16(i,t);case 3:return this.dv.setUint8(i,t>>>16),this.dv.setUint16(i+1,65535&t);case 4:return this.dv.setUint32(i,t);default:throw new Error("write ".concat(e,"-byte integers is not supported"))}}},{key:"readToBuffer",value:function(e){var t;return t=this.offset||e?this.dv.buffer.slice(this.offset,e?this.offset+e:this.end):this.dv.buffer,this.offset+=t.byteLength,t}},{key:"readToUint8",value:function(e){var t=new Uint8Array(this.dv.buffer,this.offset,e||this.unreadLength);return this.offset+=t.byteLength,t}},{key:"readString",value:function(e){for(var t=0,i="";t<e;t++)i+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return i}}],[{key:"fromUint8",value:function(t){return new e(t.buffer,t.byteOffset,t.byteLength)}},{key:"concatUint8s",value:function(e){var t=new Uint8Array(e.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return e.forEach((function(e){t.set(e,i),i+=e.byteLength})),t}},{key:"concatUint8",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.concatUint8s(t)}}]),e}(),Ya=function(){function e(t,i){ea(this,e),this.offset=0,this.val=t,this.size=i}return ia(e,[{key:"skip",value:function(e){this.offset+=e}},{key:"read",value:function(e){var t=this.size-this.offset-e;if(t>=0){var i=0,n=0;if(this.offset+=e,this.size>31){for(;n<e;n++)i+=Math.pow(2,n);return this.val/Math.pow(2,t)&i}for(;n<e;n++)i+=1<<n;return this.val>>>t&i}throw new Error("the number of the read operation exceeds the total length limit of bits")}}],[{key:"fromByte",value:function(t,i){return new e(t.read(i),i<<3)}}]),e}(),Oa=function(){function e(){ea(this,e)}return ia(e,null,[{key:"findBox",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if(!t)return r;var a=0,s="",o=0;while(t.length>7){if(a=Za(t),s=String.fromCharCode.apply(null,t.subarray(4,8)),o=8,1===a?(a=Ca(t,8),o+=8):a||(a=t.length),!i[0]||s===i[0]){var l=t.subarray(0,a);if(!(i.length<2))return e.findBox(l.subarray(o),i.slice(1),n+o);r.push({start:n,size:a,headerSize:o,type:s,data:l})}n+=a,t=t.subarray(a)}return r}},{key:"tfhd",value:function(e){return Ba(e,!0,(function(e,t){e.trackId=Za(t);var i=4,n=1&e.flags,r=2&e.flags,a=8&e.flags,s=16&e.flags,o=32&e.flags;n&&(i+=4,e.baseDataOffset=Za(t,i),i+=4),r&&(e.sampleDescriptionIndex=Za(t,i),i+=4),a&&(e.defaultSampleDuration=Za(t,i),i+=4),s&&(e.defaultSampleSize=Za(t,i),i+=4),o&&(e.defaultSampleFlags=Za(t,i))}))}},{key:"sidx",value:function(e){return Ba(e,!0,(function(e,t){var i=0;e.reference_ID=Za(t,i),i+=4,e.timescale=Za(t,i),i+=4,0===e.version?(e.earliest_presentation_time=Za(t,i),i+=4,e.first_offset=Za(t,i),i+=4):(e.earliest_presentation_time=Ca(t,i),i+=8,e.first_offset=Ca(t,i),i+=8),i+=2,e.references=[];var n=wa(t,i);i+=2;for(var r=0;r<n;r++){var a={};e.references.push(a);var s=Za(t,i);i+=4,a.reference_type=s>>31&1,a.referenced_size=2147483647&s,a.subsegment_duration=Za(t,i),i+=4,s=Za(t,i),i+=4,a.starts_with_SAP=s>>31&1,a.SAP_type=s>>28&7,a.SAP_delta_time=268435455&s}}))}},{key:"moov",value:function(t){return Ba(t,!1,(function(t,i,n){t.mvhd=e.mvhd(e.findBox(i,["mvhd"],n)[0]),t.trak=e.findBox(i,["trak"],n).map((function(t){return e.trak(t)})),t.pssh=e.pssh(e.findBox(i,["pssh"],n)[0])}))}},{key:"mvhd",value:function(e){return Ba(e,!0,(function(e,t){var i=0;1===e.version?(e.timescale=Za(t,16),e.duration=Ca(t,20),i+=28):(e.timescale=Za(t,8),e.duration=Za(t,12),i+=16),e.nextTrackId=Za(t,i+76)}))}},{key:"trak",value:function(t){return Ba(t,!1,(function(t,i,n){t.tkhd=e.tkhd(e.findBox(i,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(i,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return Ba(e,!0,(function(e,t){var i=Aa.fromUint8(t);1===e.version?(i.read(8),i.read(8),e.trackId=i.read(4),i.read(4),e.duration=i.read(8)):(i.read(4),i.read(4),e.trackId=i.read(4),i.read(4),e.duration=i.read(4)),i.skip(16),e.matrix=[];for(var n=0;n<36;n++)e.matrix.push(i.read(1));i.back(36);for(var r,a=[],s=0;s<3;s++)a.push(_a(i.readInt(2),i.readInt(2))),a.push(_a(i.readInt(2),i.readInt(2))),r=i.readInt(4),a.push(_a(r>>30,1073741823&r));e.rotation=Pa(a),e.width=i.read(4),e.height=i.read(4)}))}},{key:"mdia",value:function(t){return Ba(t,!1,(function(t,i,n){t.mdhd=e.mdhd(e.findBox(i,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(i,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(i,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return Ba(e,!0,(function(e,t){var i=0;1===e.version?(e.timescale=Za(t,16),e.duration=Ca(t,20),i+=28):(e.timescale=Za(t,8),e.duration=Za(t,12),i+=16);var n=wa(t,i);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return Ba(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return Ba(t,!1,(function(t,i,n){t.vmhd=e.vmhd(e.findBox(i,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(i,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(i,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return Ba(e,!0,(function(e,t){e.graphicsmode=wa(t),e.opcolor=[wa(t,2),wa(t,4),wa(t,6)]}))}},{key:"smhd",value:function(e){return Ba(e,!0,(function(e,t){e.balance=wa(t)}))}},{key:"stbl",value:function(t){return Ba(t,!1,(function(t,i,n){var r,a,s;t.stsd=e.stsd(e.findBox(i,["stsd"],n)[0]),t.stts=e.stts(e.findBox(i,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(i,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(i,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(i,["stsz"],n)[0]),t.stco=e.stco(e.findBox(i,["stco"],n)[0]),t.stco||(t.co64=e.co64(e.findBox(i,["co64"],n)[0]),t.stco=t.co64);var o=null===(r=t.stsd.entries[0])||void 0===r||null===(a=r.sinf)||void 0===a||null===(s=a.schi)||void 0===s?void 0:s.tenc.default_IV_size;t.stss=e.stss(e.findBox(i,["stss"],n)[0]),t.senc=e.senc(e.findBox(i,["senc"],n)[0],o)}))}},{key:"senc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return Ba(e,!0,(function(e,i){var n=0,r=Za(i,n);n+=4,e.samples=[];for(var a=0;a<r;a++){for(var s={InitializationVector:[]},o=0;o<t;o++)s.InitializationVector[o]=i[n+o];if(n+=t,2&e.flags){s.subsamples=[];var l=wa(i,n);n+=2;for(var u=0;u<l;u++){var c={};c.BytesOfClearData=wa(i,n),n+=2,c.BytesOfProtectedData=Za(i,n),n+=4,s.subsamples.push(c)}}e.samples.push(s)}}))}},{key:"pssh",value:function(e){return Ba(e,!0,(function(e,t){for(var i=[],n=[],r=0,a=0;a<16;a++)n.push(ja(t[r+a]));if(r+=16,e.version>0){var s=Za(t,r);r+=4;for(var o=0;o<(""+s).length;o++)for(var l=0;l<16;l++){var u=t[r];r+=1,i.push(ja(u))}}var c=Za(t,r);e.data_size=c,r+=4,e.kid=i,e.system_id=n,e.buffer=t}))}},{key:"stsd",value:function(t){return Ba(t,!0,(function(t,i,n){t.entryCount=Za(i),t.entries=e.findBox(i.subarray(4),[],n+4).map((function(t){switch(t.type){case"av01":return e.av01(t);case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t);case"enca":return Ba(t,!1,(function(t,i,n){t.channelCount=wa(i,16),t.samplesize=wa(i,18),t.sampleRate=Za(i,24)/65536,i=i.subarray(28),t.sinf=e.sinf(e.findBox(i,["sinf"],n)[0]),t.esds=e.esds(e.findBox(i,["esds"],n)[0])}));case"encv":return Ba(t,!1,(function(t,i,n){t.width=wa(i,24),t.height=wa(i,26),t.horizresolution=Za(i,28),t.vertresolution=Za(i,32),i=i.subarray(78),t.sinf=e.sinf(e.findBox(i,["sinf"],n)[0]),t.avcC=e.avcC(e.findBox(i,["avcC"],n)[0]),t.hvcC=e.hvcC(e.findBox(i,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(i,["pasp"],n)[0])}))}})).filter(Boolean)}))}},{key:"tenc",value:function(e){return Ba(e,!1,(function(e,t){var i=6;e.default_IsEncrypted=t[i],i+=1,e.default_IV_size=t[i],i+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(ja(t[i])),i+=1}))}},{key:"schi",value:function(t){return Ba(t,!1,(function(t,i,n){t.tenc=e.tenc(e.findBox(i,["tenc"],n)[0])}))}},{key:"sinf",value:function(t){return Ba(t,!1,(function(t,i,n){t.schi=e.schi(e.findBox(i,["schi"],n)[0]),t.frma=e.frma(e.findBox(i,["frma"],n)[0])}))}},{key:"frma",value:function(e){return Ba(e,!1,(function(e,t){e.data_format="";for(var i=0;i<4;i++)e.data_format+=String.fromCharCode(t[i])}))}},{key:"colr",value:function(e){return Ba(e,!1,(function(t,i){var n=Aa.fromUint8(i);t.data=e.data,t.colorType=n.readString(4),"nclx"===t.colorType?(t.colorPrimaries=n.read(2),t.transferCharacteristics=n.read(2),t.matrixCoefficients=n.read(2),t.fullRangeFlag=n.read(1)>>7):"rICC"!==t.colorType&&"prof"!==t.colorType||(t.iccProfile=i.readToUint8())}))}},{key:"av01",value:function(t){return Ba(t,!1,(function(t,i,n){var r=Ka(t,i),a=i.subarray(r);n+=r,t.av1C=e.av1C(e.findBox(a,["av1C"],n)[0]),t.colr=e.colr(e.findBox(a,["colr"],n)[0])}))}},{key:"av1C",value:function(e){return Ba(e,!1,(function(t,i){t.data=e.data;var n,r=Aa.fromUint8(i),a=Ya.fromByte(r,4);t.marker=a.read(1),t.version=a.read(7),t.seqProfile=a.read(3),t.seqLevelIdx0=a.read(5),t.seqTier0=a.read(1),t.highBitdepth=a.read(1),t.twelveBit=a.read(1),t.monochrome=a.read(1),t.chromaSubsamplingX=a.read(1),t.chromaSubsamplingY=a.read(1),t.chromaSamplePosition=a.read(2),t.reserved=a.read(3),t.initialPresentationDelayPresent=a.read(1),t.initialPresentationDelayPresent?t.initialPresentationDelayMinusOne=a.read(4):t.initialPresentationDelayMinusOne=0,t.configOBUs=r.readToUint8(),2===t.seqLevelIdx0&&1===t.highBitdepth?n=1===t.twelveBit?"12":"10":t.seqProfile<=2&&(n=1===t.highBitdepth?"10":"08"),t.codec=["av01",t.seqProfile,(t.seqLevelIdx0<10?"0"+t.seqLevelIdx0:t.seqLevelIdx0)+(t.seqTier0?"H":"M"),n].join(".")}))}},{key:"avc1",value:function(t){return Ba(t,!1,(function(t,i,n){var r=Ka(t,i),a=i.subarray(r);n+=r,t.avcC=e.avcC(e.findBox(a,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return Ba(e,!1,(function(t,i){t.data=e.data,t.configurationVersion=i[0],t.AVCProfileIndication=i[1],t.profileCompatibility=i[2],t.AVCLevelIndication=i[3],t.codec=Ia([i[1],i[2],i[3]]),t.lengthSizeMinusOne=3&i[4],t.spsLength=31&i[5],t.sps=[];for(var n=6,r=0;r<t.spsLength;r++){var a=wa(i,n);n+=2,t.sps.push(i.subarray(n,n+a)),n+=a}t.ppsLength=i[n],n+=1,t.pps=[];for(var s=0;s<t.ppsLength;s++){var o=wa(i,n);n+=2,t.pps.push(i.subarray(n,n+=o)),n+=o}}))}},{key:"hvc1",value:function(t){return Ba(t,!1,(function(t,i,n){var r=Ka(t,i),a=i.subarray(r);n+=r,t.hvcC=e.hvcC(e.findBox(a,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return Ba(e,!1,(function(t,i){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=i[0];var n=i[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=Za(i,2),t.generalConstraintIndicatorFlags=i.subarray(6,12),t.generalLevelIdc=i[12],t.avgFrameRate=wa(i,19),t.numOfArrays=i[22],t.vps=[],t.sps=[],t.pps=[];for(var r=23,a=0,s=0,o=0,l=0;l<t.numOfArrays;l++){a=63&i[r],s=wa(i,r+1),r+=3;for(var u,c=[],d=0;d<s;d++)o=wa(i,r),r+=2,c.push(i.subarray(r,r+o)),r+=o;if(32===a)(u=t.vps).push.apply(u,c);else if(33===a){var h;(h=t.sps).push.apply(h,c)}else if(34===a){var f;(f=t.pps).push.apply(f,c)}}}))}},{key:"pasp",value:function(e){return Ba(e,!1,(function(e,t){e.hSpacing=Za(t),e.vSpacing=Za(t,4)}))}},{key:"mp4a",value:function(t){return Ba(t,!1,(function(t,i,n){var r=Ua(t,i);t.esds=e.esds(e.findBox(i.subarray(r),["esds"],n+r)[0])}))}},{key:"esds",value:function(e){return Ba(e,!0,(function(e,t){e.codec="mp4a.";var i=0,n=0,r=0,a=0;while(t.length){i=0,a=t[i],n=t[i+1],i+=2;while(128&n)r=(127&n)<<7,n=t[i],i+=1;if(r+=127&n,3===a)t=t.subarray(i+3);else{if(4!==a){if(5===a){var s=e.config=t.subarray(i,i+r),o=(248&s[0])>>3;return 31===o&&s.length>=2&&(o=32+((7&s[0])<<3)+((224&s[1])>>5)),e.objectType=o,e.codec+=o.toString(16),void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}return void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}e.codec+=(t[i].toString(16)+".").padStart(3,"0"),t=t.subarray(i+13)}}}))}},{key:"alaw",value:function(e){return Ba(e,!1,(function(e,t){Ua(e,t)}))}},{key:"stts",value:function(e){return Ba(e,!0,(function(e,t){for(var i=Za(t),n=[],r=4,a=0;a<i;a++)n.push({count:Za(t,r),delta:Za(t,r+4)}),r+=8;e.entryCount=i,e.entries=n}))}},{key:"ctts",value:function(e){return Ba(e,!0,(function(e,t){var i=Za(t),n=[],r=4;if(1===e.version)for(var a=0;a<i;a++)n.push({count:Za(t,r),offset:Za(t,r+4)}),r+=8;else for(var s=0;s<i;s++)n.push({count:Za(t,r),offset:-(1+~Za(t,r+4))}),r+=8;e.entryCount=i,e.entries=n}))}},{key:"stsc",value:function(e){return Ba(e,!0,(function(e,t){for(var i=Za(t),n=[],r=4,a=0;a<i;a++)n.push({firstChunk:Za(t,r),samplesPerChunk:Za(t,r+4),sampleDescriptionIndex:Za(t,r+8)}),r+=12;e.entryCount=i,e.entries=n}))}},{key:"stsz",value:function(e){return Ba(e,!0,(function(e,t){var i=Za(t),n=Za(t,4),r=[];if(!i)for(var a=8,s=0;s<n;s++)r.push(Za(t,a)),a+=4;e.sampleSize=i,e.sampleCount=n,e.entrySizes=r}))}},{key:"stco",value:function(e){return Ba(e,!0,(function(e,t){for(var i=Za(t),n=[],r=4,a=0;a<i;a++)n.push(Za(t,r)),r+=4;e.entryCount=i,e.entries=n}))}},{key:"co64",value:function(e){return Ba(e,!0,(function(e,t){for(var i=Za(t),n=[],r=4,a=0;a<i;a++)n.push(Ca(t,r)),r+=8;e.entryCount=i,e.entries=n}))}},{key:"stss",value:function(e){return Ba(e,!0,(function(e,t){for(var i=Za(t),n=[],r=4,a=0;a<i;a++)n.push(Za(t,r)),r+=4;e.entryCount=i,e.entries=n}))}},{key:"moof",value:function(t){return Ba(t,!1,(function(t,i,n){t.mfhd=e.mfhd(e.findBox(i,["mfhd"],n)[0]),t.traf=e.findBox(i,["traf"],n).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return Ba(e,!0,(function(e,t){e.sequenceNumber=Za(t)}))}},{key:"traf",value:function(t){return Ba(t,!1,(function(t,i,n){t.tfhd=e.tfhd(e.findBox(i,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(i,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(i,["trun"],n)[0])}))}},{key:"trun",value:function(e){return Ba(e,!0,(function(e,t){var i=e.version,n=e.flags,r=t.length,a=e.sampleCount=Za(t),s=4;if(r>s&&1&n&&(e.dataOffset=-(1+~Za(t,s)),s+=4),r>s&&4&n&&(e.firstSampleFlags=Za(t,s),s+=4),e.samples=[],r>s)for(var o,l=0;l<a;l++)o={},256&n&&(o.duration=Za(t,s),s+=4),512&n&&(o.size=Za(t,s),s+=4),1024&n&&(o.flags=Za(t,s),s+=4),2048&n&&(o.cts=i?-(1+~Za(t,s+4)):Za(t,s),s+=4),e.samples.push(o)}))}},{key:"tfdt",value:function(e){return Ba(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=Ca(t):e.baseMediaDecodeTime=Za(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,i){var n,r,a=e.trak;if(a&&a.length){var s=a.find((function(e){var t,i;return"vide"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),o=a.find((function(e){var t,i;return"soun"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)}));if(s&&t){var l,u,c,d,h,f,m,p=t,v=null===(l=s.tkhd)||void 0===l?void 0:l.trackId;null!==v&&void 0!==v&&(p.id=s.tkhd.trackId),p.tkhdDuration=s.tkhd.duration,p.mvhdDurtion=e.mvhd.duration,p.mvhdTimecale=e.mvhd.timescale,p.timescale=p.formatTimescale=s.mdia.mdhd.timescale,p.duration=s.mdia.mdhd.duration||p.mvhdDurtion/p.mvhdTimecale*p.timescale,p.rotation=s.tkhd.rotation,p.matrix=s.tkhd.matrix;var g,y,b,L,S,T,k,x,R=s.mdia.minf.stbl.stsd.entries[0];if(p.width=R.width,p.height=R.height,R.pasp&&(p.sarRatio=[R.pasp.hSpacing,R.pasp.vSpacing]),R.av1C)p.codecType=ga.AV1,p.codec=R.av1C.codec,p.av1C=R.av1C.data,p.colr=R.colr.data;else if(R.hvcC)p.codecType=ga.HEVC,p.codec=R.hvcC.codec,p.vps=R.hvcC.vps,p.sps=R.hvcC.sps,p.pps=R.hvcC.pps,p.hvcC=R.hvcC.data;else{if(!R.avcC)throw new Error("unknown video stsd entry");p.codec=R.avcC.codec,p.sps=R.avcC.sps,p.pps=R.avcC.pps}if(p.present=!0,p.ext={},p.ext.stss=null===(u=s.mdia)||void 0===u||null===(c=u.minf)||void 0===c||null===(d=c.stbl)||void 0===d?void 0:d.stss,p.ext.ctts=null===(h=s.mdia)||void 0===h||null===(f=h.minf)||void 0===f||null===(m=f.stbl)||void 0===m?void 0:m.ctts,R&&"encv"===R.type)p.isVideoEncryption=!0,R.default_KID=null===(g=R.sinf)||void 0===g||null===(y=g.schi)||void 0===y?void 0:y.tenc.default_KID,R.default_IsEncrypted=null===(b=R.sinf)||void 0===b||null===(L=b.schi)||void 0===L?void 0:L.tenc.default_IsEncrypted,R.default_IV_size=null===(S=R.sinf)||void 0===S||null===(T=S.schi)||void 0===T?void 0:T.tenc.default_IV_size,p.videoSenc=s.mdia.minf.stbl.senc&&s.mdia.minf.stbl.senc.samples,R.data_format=null===(k=R.sinf)||void 0===k||null===(x=k.frma)||void 0===x?void 0:x.data_format,p.useEME=e.useEME,p.kidValue=e.kidValue,p.pssh=e.pssh,p.encv=R}if(o&&i){var w,E,Z,C,I,M,G,X,_,P=i,D=null===(w=o.tkhd)||void 0===w?void 0:w.trackId;null!==D&&void 0!==D&&(P.id=o.tkhd.trackId),P.tkhdDuration=o.tkhd.duration,P.mvhdDurtion=e.mvhd.duration,P.mvhdTimecale=e.mvhd.timescale,P.timescale=P.formatTimescale=o.mdia.mdhd.timescale,P.duration=o.mdia.mdhd.duration||P.mvhdDurtion/P.mvhdTimecale*P.timescale;var W,V,N,F,A,Y,O,H,K=o.mdia.minf.stbl.stsd.entries[0];switch(P.sampleSize=K.sampleSize,P.sampleRate=K.sampleRate,P.channelCount=K.channelCount,P.present=!0,K.type){case"alaw":P.codecType=P.codec=ya.G711PCMA,P.sampleRate=8e3;break;case"ulaw":P.codecType=P.codec=ya.G711PCMU,P.sampleRate=8e3;break;default:P.sampleDuration=Fa.getFrameDuration(P.sampleRate,P.timescale),P.sampleRateIndex=Fa.getRateIndexByRate(P.sampleRate),P.objectType=(null===(n=K.esds)||void 0===n?void 0:n.objectType)||2,K.esds&&(P.config=Array.from(K.esds.config)),P.codec=(null===(r=K.esds)||void 0===r?void 0:r.codec)||"mp4a.40.2";break}if(P.sampleDuration=Fa.getFrameDuration(P.sampleRate,P.timescale),P.objectType=(null===(E=K.esds)||void 0===E?void 0:E.objectType)||2,K.esds&&(K.esds.config?P.config=Array.from(K.esds.config):console.warn("esds config is null")),P.codec=(null===(Z=K.esds)||void 0===Z?void 0:Z.codec)||"mp4a.40.2",P.sampleRateIndex=Fa.getRateIndexByRate(P.sampleRate),P.ext={},P.ext.stss=null===(C=o.mdia)||void 0===C||null===(I=C.minf)||void 0===I||null===(M=I.stbl)||void 0===M?void 0:M.stss,P.ext.ctts=null===(G=o.mdia)||void 0===G||null===(X=G.minf)||void 0===X||null===(_=X.stbl)||void 0===_?void 0:_.ctts,P.present=!0,K&&"enca"===K.type)P.isAudioEncryption=!0,K.data_format=null===(W=K.sinf)||void 0===W||null===(V=W.frma)||void 0===V?void 0:V.data_format,K.default_KID=null===(N=K.sinf)||void 0===N||null===(F=N.schi)||void 0===F?void 0:F.tenc.default_KID,K.default_IsEncrypted=null===(A=K.sinf)||void 0===A||null===(Y=A.schi)||void 0===Y?void 0:Y.tenc.default_IsEncrypted,K.default_IV_size=null===(O=K.sinf)||void 0===O||null===(H=O.schi)||void 0===H?void 0:H.tenc.default_IV_size,P.audioSenc=o.mdia.minf.stbl.senc&&o.mdia.minf.stbl.senc.samples,P.useEME=e.useEME,P.kidValue=e.kidValue,P.enca=K}if(i&&(i.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!i&&i.isAudioEncryption),null!==t&&void 0!==t&&t.encv||null!==i&&void 0!==i&&i.enca){var U,B,z=null===t||void 0===t||null===(U=t.encv)||void 0===U?void 0:U.default_KID,j=null===i||void 0===i||null===(B=i.enca)||void 0===B?void 0:B.default_KID,J=z||j?(z||j).join(""):null;t&&(t.kid=J),i&&(i.kid=J)}return t&&(t.flags=3841),i&&(i.flags=1793),{videoTrack:t,audioTrack:i}}}},{key:"evaluateDefaultDuration",value:function(e,t,i){var n,r=null===t||void 0===t||null===(n=t.samples)||void 0===n?void 0:n.length;if(!r)return 1024;var a=1024*r/t.timescale;return a*e.timescale/i}},{key:"moofToSamples",value:function(t,i,n){var r={};return t.mfhd&&(i&&(i.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var a=t.tfhd,s=t.tfdt,o=t.trun;if(a&&o){s&&(i&&i.id===a.trackId&&(i.baseMediaDecodeTime=s.baseMediaDecodeTime),n&&n.id===a.trackId&&(n.baseMediaDecodeTime=s.baseMediaDecodeTime));var l=a.defaultSampleSize||0,u=a.defaultSampleDuration||e.evaluateDefaultDuration(i,n,o.samples.length||o.sampleCount),c=o.dataOffset||0,d=0,h=-1;if(!o.samples.length&&o.sampleCount){r[a.trackId]=[];for(var f=0;f<o.sampleCount;f++)r[a.trackId].push({offset:c,dts:d,duration:u,size:l}),d+=u,c+=l}else r[a.trackId]=o.samples.map((function(e,t){return e={offset:c,dts:d,pts:d+(e.cts||0),duration:e.duration||u,size:e.size||l,gopId:h,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!==65536},e.keyframe&&(h++,e.gopId=h),d+=e.duration,c+=e.size,e}))}})),r}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var i=t.find((function(e){var t,i;return"vide"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),n=t.find((function(e){var t,i;return"soun"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)}));if(i||n){var r,a;if(i){var s,o,l=null===(s=i.mdia)||void 0===s||null===(o=s.minf)||void 0===o?void 0:o.stbl;if(!l)return;var u=l.stts,c=l.stsc,d=l.stsz,h=l.stco,f=l.stss,m=l.ctts;if(!u||!c||!d||!h||!f)return;r=Ha(u,c,d,h,m,f)}if(n){var p,v,g,y=null===(p=n.mdia)||void 0===p||null===(v=p.minf)||void 0===v?void 0:v.stbl;if(!y)return;var b=null===(g=n.mdia.mdhd)||void 0===g?void 0:g.timescale,L=y.stts,S=y.stsc,T=y.stsz,k=y.stco;if(!b||!L||!S||!T||!k)return;a=Ha(L,S,T,k)}return{videoSamples:r,audioSamples:a}}}}}]),e}();function Ha(e,t,i,n,r,a){var s,o,l,u=[],c=null===r||void 0===r?void 0:r.entries,d=t.entries,h=n.entries,f=i.entrySizes,m=null===a||void 0===a?void 0:a.entries;m&&(s={},m.forEach((function(e){s[e-1]=!0}))),c&&(o=[],c.forEach((function(e){for(var t=e.count,i=e.offset,n=0;n<t;n++)o.push(i)})));var p=-1,v=0,g=0,y=0,b=0,L=0,S=d[0].samplesPerChunk,T=d[1]?d[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,r=0;r<t;r++)l={dts:v,duration:n,size:f[g]||i.sampleSize,offset:h[y]+L,index:g},m&&(l.keyframe=s[g],l.keyframe&&p++,l.gopId=p),o&&g<o.length&&(l.pts=l.dts+o[g]),u.push(l),v+=n,g++,g<S?L+=l.size:(y++,L=0,y>=T&&(b++,T=d[b+1]?d[b+1].firstChunk-1:1/0),S+=d[b].samplesPerChunk)})),u}function Ka(e,t){return e.dataReferenceIndex=wa(t,6),e.width=wa(t,24),e.height=wa(t,26),e.horizresolution=Za(t,28),e.vertresolution=Za(t,32),e.frameCount=wa(t,40),e.depth=wa(t,74),78}function Ua(e,t){return e.dataReferenceIndex=wa(t,6),e.channelCount=wa(t,16),e.sampleSize=wa(t,18),e.sampleRate=Za(t,24)/65536,28}function Ba(e,t,i){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=Ea(e.data,e.headerSize+1),n.headerSize+=4),i(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var za=function(e,t,i){var n=String(i),r=t>>0,a=Math.ceil(r/n.length),s=[],o=String(e);while(a--)s.push(n);return s.join("").substring(0,r-o.length)+o},ja=function(){for(var e=[],t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i.forEach((function(t){e.push(za(Number(t).toString(16),2,0))})),e[0]},Ja=function(){function e(t,i,n){ea(this,e),na(this,"__loadedMoofWraps",[]),na(this,"__lastRemainData",null),na(this,"__lastRemainDataStart",0),na(this,"__nextMoofStart",-1),this.videoTrack=t||new ba,this.audioTrack=i||new La,this.metadataTrack=n||new ka}return ia(e,[{key:"demuxPart",value:function(e,t,i){var n=this,r=this.videoTrack,a=this.audioTrack,s=r.exist(),o=a.exist(),l=/av01/.test(r.codec);r.samples=[],a.samples=[];var u=e,c=t;if(this.__lastRemainData){var d=this.__lastRemainDataStart+this.__lastRemainData.byteLength,h=t<=d&&t>this.__lastRemainDataStart&&t+e.byteLength>d;if(h){var f=e.subarray(this.__lastRemainData.byteLength+this.__lastRemainDataStart-t);u=xa(this.__lastRemainData,f),c=this.__lastRemainDataStart,this.__lastRemainData=null}else this.__lastRemainData=null,this.__lastRemainDataStart=0,this.__nextMoofStart=-1}if(!i){var m=Oa.findBox(u,["moov"])[0];if(!m)throw new Error("cannot found moov box");i=Oa.moov(m)}if(u){var p=c+u.byteLength;s||o||Oa.moovToTrack(i,r,a);var v=[];this.__nextMoofStart<0?Oa.findBox(u,["moof"],c).forEach((function(e){return v.push(e)})):this.__nextMoofStart>=c&&this.__nextMoofStart<=p-8&&Oa.findBox(u.subarray(this.__nextMoofStart-c),["moof"],this.__nextMoofStart).forEach((function(e){return v.push(e)})),v.filter((function(e){return e.size<=e.data.length})).forEach((function(e){var t=Oa.moof(e);n.__nextMoofStart=t.start+Math.max.apply(Math,aa(t.traf.map((function(e){return e.trun.samples.reduce((function(e,t){return e+t.size}),e.trun.dataOffset||0)})))),n.__loadedMoofWraps.push({start:t.start,nextMoofStart:n.__nextMoofStart,moof:t}),n.__loadedMoofWraps.sort((function(e,t){return e.start-t.start}))}));var g,y=fa(this.__loadedMoofWraps);try{var b=function(){var e=g.value;if(e.start>p||e.nextMoofStart<c)return"continue";var t,i=e.start,s=Oa.moofToSamples(e.moof,r,a),o=r.baseMediaDecodeTime,d=a.baseMediaDecodeTime;Object.keys(s).forEach((function(e){r.id==e?s[e].some((function(e){var a=e.offset+=i;if(!(a<c)){if(a+e.size>p)return!0;var s=new Sa((e.pts||e.dts)+o,e.dts+o);s.duration=e.duration,s.gopId=e.gopId,e.keyframe&&s.setToKeyframe();var d=u.subarray(a-c,a-c+e.size);if(s.data=d,!l){var h=0,f=d.length-1;while(h<f)t=Za(d,h),h+=4,s.units.push(d.subarray(h,h+t)),h+=t}n.__lastRemainDataStart=a+e.size,r.samples.push(s)}})):a.id==e&&s[e].some((function(e){var t=e.offset+i;if(!(t<c)){if(t+e.size>p)return!0;var r=u.subarray(t-c,t-c+e.size);a.samples.push(new Ta(e.dts+d,r,e.duration)),n.__lastRemainDataStart=t+e.size}}))}))};for(y.s();!(g=y.n()).done;)b()}catch(L){y.e(L)}finally{y.f()}}return this.__lastRemainDataStart>c&&this.__lastRemainDataStart<u.byteLength+c?this.__lastRemainData=u.subarray(this.__lastRemainDataStart-c):(this.__lastRemainData=u,this.__lastRemainDataStart=c),r.samples.length&&(r.baseMediaDecodeTime=r.samples[0].pts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts),{videoTrack:r,audioTrack:a,metadataTrack:this.metadataTrack}}},{key:"demux",value:function(e,t){var i=this.videoTrack,n=this.audioTrack,r=i.exist(),a=n.exist();if(i.samples=[],n.samples=[],t){if(!a){var s=Oa.findBox(t,["moov"])[0];if(!s)throw new Error("cannot found moov box");Oa.moovToTrack(Oa.moov(s),null,n)}var o=Oa.findBox(t,["moof"])[0];if(o){var l=Oa.moofToSamples(Oa.moof(o),null,n)[n.id],u=n.baseMediaDecodeTime;if(l){var c=o.start;l.map((function(e){e.offset+=c;var i=t.subarray(e.offset,e.offset+e.size);n.samples.push(new Ta(e.dts+u,i,e.duration))}))}}}if(e){if(!r&&!a){var d=Oa.findBox(e,["moov"])[0];if(!d)throw new Error("cannot found moov box");Oa.moovToTrack(Oa.moov(d),i,n)}var h=Oa.findBox(e,["moof"])[0];if(h){var f,m=Oa.moofToSamples(Oa.moof(h),i,n),p=i.baseMediaDecodeTime,v=n.baseMediaDecodeTime,g=h.start;Object.keys(m).forEach((function(t){i.id==t?m[t].map((function(t){t.offset+=g;var n=new Sa((t.pts||t.dts)+p,t.dts+p);n.duration=t.duration,n.gopId=t.gopId,t.keyframe&&n.setToKeyframe();var r=e.subarray(t.offset,t.offset+t.size);n.data=r;var a=0,s=r.length-1;while(a<s)f=Za(r,a),a+=4,n.units.push(r.subarray(a,a+f)),a+=f;i.samples.push(n)})):n.id==t&&m[t].map((function(t){t.offset+=g;var i=e.subarray(t.offset,t.offset+t.size);n.samples.push(new Ta(t.dts+v,i,t.duration))}))}))}}return{videoTrack:i,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return Oa.probe(e)}}]),e}(),Qa=function(){function e(t,i){ea(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=i}return ia(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();na(Qa,"disabled",!0);class qa{static create(...e){return new this(...e)}mixIn(e){return Object.assign(this,e)}clone(){const e=new this.constructor;return Object.assign(e,this),e}}class $a extends qa{constructor(e=[],t=4*e.length){super();let i=e;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),(i instanceof Int8Array||i instanceof Uint8ClampedArray||i instanceof Int16Array||i instanceof Uint16Array||i instanceof Int32Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array)&&(i=new Uint8Array(i.buffer,i.byteOffset,i.byteLength)),i instanceof Uint8Array){const e=i.byteLength,t=[];for(let n=0;n<e;n+=1)t[n>>>2]|=i[n]<<24-n%4*8;this.words=t,this.sigBytes=e}else this.words=e,this.sigBytes=t}static random(e){const t=[],i=e=>{let t=e,i=987654321;const n=4294967295;return()=>{i=36969*(65535&i)+(i>>16)&n,t=18e3*(65535&t)+(t>>16)&n;let e=(i<<16)+t&n;return e/=4294967296,e+=.5,e*(Math.random()>.5?1:-1)}};for(let n,r=0;r<e;r+=4){const e=i(4294967296*(n||Math.random()));n=987654071*e(),t.push(4294967296*e()|0)}return new $a(t,e)}toString(e=es){return e.stringify(this)}concat(e){const t=this.words,i=e.words,n=this.sigBytes,r=e.sigBytes;if(this.clamp(),n%4)for(let a=0;a<r;a+=1){const e=i[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=e<<24-(n+a)%4*8}else for(let a=0;a<r;a+=4)t[n+a>>>2]=i[a>>>2];return this.sigBytes+=r,this}clamp(){const{words:e,sigBytes:t}=this;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}clone(){const e=super.clone.call(this);return e.words=this.words.slice(0),e}}const es={stringify(e){const{words:t,sigBytes:i}=e,n=[];for(let r=0;r<i;r+=1){const e=t[r>>>2]>>>24-r%4*8&255;n.push((e>>>4).toString(16)),n.push((15&e).toString(16))}return n.join("")},parse(e){const t=e.length,i=[];for(let n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new $a(i,t/2)}},ts={stringify(e){const{words:t,sigBytes:i}=e,n=[];for(let r=0;r<i;r+=1){const e=t[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(e))}return n.join("")},parse(e){const t=e.length,i=[];for(let n=0;n<t;n+=1)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new $a(i,t)}},is={stringify(e){try{return decodeURIComponent(escape(ts.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse(e){return ts.parse(unescape(encodeURIComponent(e)))}};class ns extends qa{constructor(){super(),this._minBufferSize=0}reset(){this._data=new $a,this._nDataBytes=0}_append(e){let t=e;"string"===typeof t&&(t=is.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(e){let t;const{_data:i,blockSize:n}=this,r=i.words,a=i.sigBytes,s=4*n;let o=a/s;o=e?Math.ceil(o):Math.max((0|o)-this._minBufferSize,0);const l=o*n,u=Math.min(4*l,a);if(l){for(let e=0;e<l;e+=n)this._doProcessBlock(r,e);t=r.splice(0,l),i.sigBytes-=u}return new $a(t,u)}clone(){const e=super.clone.call(this);return e._data=this._data.clone(),e}}class rs extends ns{constructor(e){super(),this.blockSize=16,this.cfg=Object.assign(new qa,e),this.reset()}static _createHelper(e){return(t,i)=>new e(i).finalize(t)}static _createHmacHelper(e){return(t,i)=>new as(e,i).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e);const t=this._doFinalize();return t}}class as extends qa{constructor(e,t){super();const i=new e;this._hasher=i;let n=t;"string"===typeof n&&(n=is.parse(n));const r=i.blockSize,a=4*r;n.sigBytes>a&&(n=i.finalize(t)),n.clamp();const s=n.clone();this._oKey=s;const o=n.clone();this._iKey=o;const l=s.words,u=o.words;for(let c=0;c<r;c+=1)l[c]^=1549556828,u[c]^=909522486;s.sigBytes=a,o.sigBytes=a,this.reset()}reset(){const e=this._hasher;e.reset(),e.update(this._iKey)}update(e){return this._hasher.update(e),this}finalize(e){const t=this._hasher,i=t.finalize(e);t.reset();const n=t.finalize(this._oKey.clone().concat(i));return n}}const ss=(e,t,i)=>{const n=[];let r=0;for(let a=0;a<t;a+=1)if(a%4){const t=i[e.charCodeAt(a-1)]<<a%4*2,s=i[e.charCodeAt(a)]>>>6-a%4*2,o=t|s;n[r>>>2]|=o<<24-r%4*8,r+=1}return $a.create(n,r)},os={stringify(e){const{words:t,sigBytes:i}=e,n=this._map;e.clamp();const r=[];for(let s=0;s<i;s+=3){const e=t[s>>>2]>>>24-s%4*8&255,a=t[s+1>>>2]>>>24-(s+1)%4*8&255,o=t[s+2>>>2]>>>24-(s+2)%4*8&255,l=e<<16|a<<8|o;for(let t=0;t<4&&s+.75*t<i;t+=1)r.push(n.charAt(l>>>6*(3-t)&63))}const a=n.charAt(64);if(a)while(r.length%4)r.push(a);return r.join("")},parse(e){let t=e.length;const i=this._map;let n=this._reverseMap;if(!n){this._reverseMap=[],n=this._reverseMap;for(let e=0;e<i.length;e+=1)n[i.charCodeAt(e)]=e}const r=i.charAt(64);if(r){const i=e.indexOf(r);-1!==i&&(t=i)}return ss(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},ls=[];for(let Vu=0;Vu<64;Vu+=1)ls[Vu]=4294967296*Math.abs(Math.sin(Vu+1))|0;const us=(e,t,i,n,r,a,s)=>{const o=e+(t&i|~t&n)+r+s;return(o<<a|o>>>32-a)+t},cs=(e,t,i,n,r,a,s)=>{const o=e+(t&n|i&~n)+r+s;return(o<<a|o>>>32-a)+t},ds=(e,t,i,n,r,a,s)=>{const o=e+(t^i^n)+r+s;return(o<<a|o>>>32-a)+t},hs=(e,t,i,n,r,a,s)=>{const o=e+(i^(t|~n))+r+s;return(o<<a|o>>>32-a)+t};class fs extends rs{_doReset(){this._hash=new $a([1732584193,4023233417,2562383102,271733878])}_doProcessBlock(e,t){const i=e;for(let x=0;x<16;x+=1){const n=t+x,r=e[n];i[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}const n=this._hash.words,r=i[t+0],a=i[t+1],s=i[t+2],o=i[t+3],l=i[t+4],u=i[t+5],c=i[t+6],d=i[t+7],h=i[t+8],f=i[t+9],m=i[t+10],p=i[t+11],v=i[t+12],g=i[t+13],y=i[t+14],b=i[t+15];let L=n[0],S=n[1],T=n[2],k=n[3];L=us(L,S,T,k,r,7,ls[0]),k=us(k,L,S,T,a,12,ls[1]),T=us(T,k,L,S,s,17,ls[2]),S=us(S,T,k,L,o,22,ls[3]),L=us(L,S,T,k,l,7,ls[4]),k=us(k,L,S,T,u,12,ls[5]),T=us(T,k,L,S,c,17,ls[6]),S=us(S,T,k,L,d,22,ls[7]),L=us(L,S,T,k,h,7,ls[8]),k=us(k,L,S,T,f,12,ls[9]),T=us(T,k,L,S,m,17,ls[10]),S=us(S,T,k,L,p,22,ls[11]),L=us(L,S,T,k,v,7,ls[12]),k=us(k,L,S,T,g,12,ls[13]),T=us(T,k,L,S,y,17,ls[14]),S=us(S,T,k,L,b,22,ls[15]),L=cs(L,S,T,k,a,5,ls[16]),k=cs(k,L,S,T,c,9,ls[17]),T=cs(T,k,L,S,p,14,ls[18]),S=cs(S,T,k,L,r,20,ls[19]),L=cs(L,S,T,k,u,5,ls[20]),k=cs(k,L,S,T,m,9,ls[21]),T=cs(T,k,L,S,b,14,ls[22]),S=cs(S,T,k,L,l,20,ls[23]),L=cs(L,S,T,k,f,5,ls[24]),k=cs(k,L,S,T,y,9,ls[25]),T=cs(T,k,L,S,o,14,ls[26]),S=cs(S,T,k,L,h,20,ls[27]),L=cs(L,S,T,k,g,5,ls[28]),k=cs(k,L,S,T,s,9,ls[29]),T=cs(T,k,L,S,d,14,ls[30]),S=cs(S,T,k,L,v,20,ls[31]),L=ds(L,S,T,k,u,4,ls[32]),k=ds(k,L,S,T,h,11,ls[33]),T=ds(T,k,L,S,p,16,ls[34]),S=ds(S,T,k,L,y,23,ls[35]),L=ds(L,S,T,k,a,4,ls[36]),k=ds(k,L,S,T,l,11,ls[37]),T=ds(T,k,L,S,d,16,ls[38]),S=ds(S,T,k,L,m,23,ls[39]),L=ds(L,S,T,k,g,4,ls[40]),k=ds(k,L,S,T,r,11,ls[41]),T=ds(T,k,L,S,o,16,ls[42]),S=ds(S,T,k,L,c,23,ls[43]),L=ds(L,S,T,k,f,4,ls[44]),k=ds(k,L,S,T,v,11,ls[45]),T=ds(T,k,L,S,b,16,ls[46]),S=ds(S,T,k,L,s,23,ls[47]),L=hs(L,S,T,k,r,6,ls[48]),k=hs(k,L,S,T,d,10,ls[49]),T=hs(T,k,L,S,y,15,ls[50]),S=hs(S,T,k,L,u,21,ls[51]),L=hs(L,S,T,k,v,6,ls[52]),k=hs(k,L,S,T,o,10,ls[53]),T=hs(T,k,L,S,m,15,ls[54]),S=hs(S,T,k,L,a,21,ls[55]),L=hs(L,S,T,k,h,6,ls[56]),k=hs(k,L,S,T,b,10,ls[57]),T=hs(T,k,L,S,c,15,ls[58]),S=hs(S,T,k,L,g,21,ls[59]),L=hs(L,S,T,k,l,6,ls[60]),k=hs(k,L,S,T,p,10,ls[61]),T=hs(T,k,L,S,s,15,ls[62]),S=hs(S,T,k,L,f,21,ls[63]),n[0]=n[0]+L|0,n[1]=n[1]+S|0,n[2]=n[2]+T|0,n[3]=n[3]+k|0}_doFinalize(){const e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32;const r=Math.floor(i/4294967296),a=i;t[15+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t[14+(n+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(t.length+1),this._process();const s=this._hash,o=s.words;for(let l=0;l<4;l+=1){const e=o[l];o[l]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8)}return s}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}rs._createHelper(fs),rs._createHmacHelper(fs);class ms extends qa{constructor(e){super(),this.cfg=Object.assign(new qa,{keySize:4,hasher:fs,iterations:1},e)}compute(e,t){let i;const{cfg:n}=this,r=n.hasher.create(),a=$a.create(),s=a.words,{keySize:o,iterations:l}=n;while(s.length<o){i&&r.update(i),i=r.update(e).finalize(t),r.reset();for(let e=1;e<l;e+=1)i=r.finalize(i),r.reset();a.concat(i)}return a.sigBytes=4*o,a}}class ps extends ns{constructor(e,t,i){super(),this.cfg=Object.assign(new qa,i),this._xformMode=e,this._key=t,this.reset()}static createEncryptor(e,t){return this.create(this._ENC_XFORM_MODE,e,t)}static createDecryptor(e,t){return this.create(this._DEC_XFORM_MODE,e,t)}static _createHelper(e){const t=e=>"string"===typeof e?Rs:ks;return{encrypt(i,n,r){return t(n).encrypt(e,i,n,r)},decrypt(i,n,r){return t(n).decrypt(e,i,n,r)}}}reset(){super.reset.call(this),this._doReset()}process(e){return this._append(e),this._process()}finalize(e){e&&this._append(e);const t=this._doFinalize();return t}}ps._ENC_XFORM_MODE=1,ps._DEC_XFORM_MODE=2,ps.keySize=4,ps.ivSize=4;class vs extends qa{constructor(e,t){super(),this._cipher=e,this._iv=t}static createEncryptor(e,t){return this.Encryptor.create(e,t)}static createDecryptor(e,t){return this.Decryptor.create(e,t)}}function gs(e,t,i){const n=e;let r;const a=this._iv;a?(r=a,this._iv=void 0):r=this._prevBlock;for(let s=0;s<i;s+=1)n[t+s]^=r[s]}class ys extends vs{}ys.Encryptor=class extends ys{processBlock(e,t){const i=this._cipher,{blockSize:n}=i;gs.call(this,e,t,n),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}},ys.Decryptor=class extends ys{processBlock(e,t){const i=this._cipher,{blockSize:n}=i,r=e.slice(t,t+n);i.decryptBlock(e,t),gs.call(this,e,t,n),this._prevBlock=r}};const bs={pad(e,t){const i=4*t,n=i-e.sigBytes%i,r=n<<24|n<<16|n<<8|n,a=[];for(let o=0;o<n;o+=4)a.push(r);const s=$a.create(a,n);e.concat(s)},unpad(e){const t=e,i=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=i}};class Ls extends ps{constructor(e,t,i){super(e,t,Object.assign({mode:ys,padding:bs},i)),this.blockSize=4}reset(){let e;super.reset.call(this);const{cfg:t}=this,{iv:i,mode:n}=t;this._xformMode===this.constructor._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode=e.call(n,this,i&&i.words),this._mode.__creator=e}_doProcessBlock(e,t){this._mode.processBlock(e,t)}_doFinalize(){let e;const{padding:t}=this.cfg;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e}}class Ss extends qa{constructor(e){super(),this.mixIn(e)}toString(e){return(e||this.formatter).stringify(this)}}const Ts={stringify(e){let t;const{ciphertext:i,salt:n}=e;return t=n?$a.create([1398893684,1701076831]).concat(n).concat(i):i,t.toString(os)},parse(e){let t;const i=os.parse(e),n=i.words;return 1398893684===n[0]&&1701076831===n[1]&&(t=$a.create(n.slice(2,4)),n.splice(0,4),i.sigBytes-=16),Ss.create({ciphertext:i,salt:t})}};class ks extends qa{static encrypt(e,t,i,n){const r=Object.assign(new qa,this.cfg,n),a=e.createEncryptor(i,r),s=a.finalize(t),o=a.cfg;return Ss.create({ciphertext:s,key:i,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:a.blockSize,formatter:r.format})}static decrypt(e,t,i,n){let r=t;const a=Object.assign(new qa,this.cfg,n);r=this._parse(r,a.format);const s=e.createDecryptor(i,a).finalize(r.ciphertext);return s}static _parse(e,t){return"string"===typeof e?t.parse(e,this):e}}ks.cfg=Object.assign(new qa,{format:Ts});const xs={execute(e,t,i,n){let r=n;r||(r=$a.random(8));const a=ms.create({keySize:t+i}).compute(e,r),s=$a.create(a.words.slice(t),4*i);return a.sigBytes=4*t,Ss.create({key:a,iv:s,salt:r})}};class Rs extends ks{static encrypt(e,t,i,n){const r=Object.assign(new qa,this.cfg,n),a=r.kdf.execute(i,e.keySize,e.ivSize);r.iv=a.iv;const s=ks.encrypt.call(this,e,t,a.key,r);return s.mixIn(a),s}static decrypt(e,t,i,n){let r=t;const a=Object.assign(new qa,this.cfg,n);r=this._parse(r,a.format);const s=a.kdf.execute(i,e.keySize,e.ivSize,r.salt);a.iv=s.iv;const o=ks.decrypt.call(this,e,r,s.key,a);return o}}Rs.cfg=Object.assign(ks.cfg,{kdf:xs});const ws=[],Es=[],Zs=[],Cs=[],Is=[],Ms=[],Gs=[],Xs=[],_s=[],Ps=[],Ds=[];for(let Vu=0;Vu<256;Vu+=1)Ds[Vu]=Vu<128?Vu<<1:Vu<<1^283;let Ws=0,Vs=0;for(let Vu=0;Vu<256;Vu+=1){let e=Vs^Vs<<1^Vs<<2^Vs<<3^Vs<<4;e=e>>>8^255&e^99,ws[Ws]=e,Es[e]=Ws;const t=Ds[Ws],i=Ds[t],n=Ds[i];let r=257*Ds[e]^16843008*e;Zs[Ws]=r<<24|r>>>8,Cs[Ws]=r<<16|r>>>16,Is[Ws]=r<<8|r>>>24,Ms[Ws]=r,r=16843009*n^65537*i^257*t^16843008*Ws,Gs[e]=r<<24|r>>>8,Xs[e]=r<<16|r>>>16,_s[e]=r<<8|r>>>24,Ps[e]=r,Ws?(Ws=t^Ds[Ds[Ds[n^t]]],Vs^=Ds[Ds[Vs]]):(Vs=1,Ws=Vs)}const Ns=[0,1,2,4,8,16,32,64,128,27,54];class Fs extends Ls{_doReset(){let e;if(this._nRounds&&this._keyPriorReset===this._key)return;this._keyPriorReset=this._key;const t=this._keyPriorReset,i=t.words,n=t.sigBytes/4;this._nRounds=n+6;const r=this._nRounds,a=4*(r+1);this._keySchedule=[];const s=this._keySchedule;for(let l=0;l<a;l+=1)l<n?s[l]=i[l]:(e=s[l-1],l%n?n>6&&l%n===4&&(e=ws[e>>>24]<<24|ws[e>>>16&255]<<16|ws[e>>>8&255]<<8|ws[255&e]):(e=e<<8|e>>>24,e=ws[e>>>24]<<24|ws[e>>>16&255]<<16|ws[e>>>8&255]<<8|ws[255&e],e^=Ns[l/n|0]<<24),s[l]=s[l-n]^e);this._invKeySchedule=[];const o=this._invKeySchedule;for(let l=0;l<a;l+=1){const t=a-l;e=l%4?s[t]:s[t-4],o[l]=l<4||t<=4?e:Gs[ws[e>>>24]]^Xs[ws[e>>>16&255]]^_s[ws[e>>>8&255]]^Ps[ws[255&e]]}}encryptBlock(e,t){this._doCryptBlock(e,t,this._keySchedule,Zs,Cs,Is,Ms,ws)}decryptBlock(e,t){const i=e;let n=i[t+1];i[t+1]=i[t+3],i[t+3]=n,this._doCryptBlock(i,t,this._invKeySchedule,Gs,Xs,_s,Ps,Es),n=i[t+1],i[t+1]=i[t+3],i[t+3]=n}_doCryptBlock(e,t,i,n,r,a,s,o){const l=e,u=this._nRounds;let c=l[t]^i[0],d=l[t+1]^i[1],h=l[t+2]^i[2],f=l[t+3]^i[3],m=4;for(let b=1;b<u;b+=1){const e=n[c>>>24]^r[d>>>16&255]^a[h>>>8&255]^s[255&f]^i[m];m+=1;const t=n[d>>>24]^r[h>>>16&255]^a[f>>>8&255]^s[255&c]^i[m];m+=1;const o=n[h>>>24]^r[f>>>16&255]^a[c>>>8&255]^s[255&d]^i[m];m+=1;const l=n[f>>>24]^r[c>>>16&255]^a[d>>>8&255]^s[255&h]^i[m];m+=1,c=e,d=t,h=o,f=l}const p=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[h>>>8&255]<<8|o[255&f])^i[m];m+=1;const v=(o[d>>>24]<<24|o[h>>>16&255]<<16|o[f>>>8&255]<<8|o[255&c])^i[m];m+=1;const g=(o[h>>>24]<<24|o[f>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^i[m];m+=1;const y=(o[f>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&h])^i[m];m+=1,l[t]=p,l[t+1]=v,l[t+2]=g,l[t+3]=y}}Fs.keySize=8;const As=Ls._createHelper(Fs);class Ys extends vs{}Ys.Encryptor=class extends Ys{processBlock(e,t){const i=e,n=this._cipher,{blockSize:r}=n,a=this._iv;let s=this._counter;a&&(this._counter=a.slice(0),s=this._counter,this._iv=void 0);const o=s.slice(0);n.encryptBlock(o,0),s[r-1]=s[r-1]+1|0;for(let l=0;l<r;l+=1)i[t+l]^=o[l]}},Ys.Decryptor=Ys.Encryptor;const Os={pad(){},unpad(){}};function Hs(e){for(var t=0,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];n.forEach((function(e){t+=e.length}));var a=new e(t),s=0;return n.forEach((function(e){a.set(e,s),s+=e.length})),a}var Ks=function(){function e(){ea(this,e),this.buffer=new Uint8Array(0)}return ia(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];i.forEach((function(t){t?e.buffer=Hs(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),Us={decryptWordArray:function(e,t,i){var n=es.parse(t),r=es.parse(Ma(i)),a=$a.create(new Uint8Array(e)),s=As.decrypt(Ss.create({ciphertext:a}),n,{iv:r,mode:Ys,padding:Os});return Us.wordArrayToUint8Array(s)},wordArrayToUint8Array:function(e){var t=e.sigBytes,i=e.words,n=new Uint8Array(t),r=0,a=0;while(1){if(r===t)break;var s=i[a++];if(n[r++]=(4278190080&s)>>>24,r===t)break;if(n[r++]=(16711680&s)>>>16,r===t)break;if(n[r++]=(65280&s)>>>8,r===t)break;n[r++]=255&s}return n},decoderAESCTRData:function(e,t,i){if(e.videoSenc){var n=e.kidValue,r=e.videoSenc;e.samples.forEach((function(t,a){var s=r[a],o=t.data,l=[],u=[],c=s.InitializationVector;if(s.subsamples&&s.subsamples.length)s.subsamples.forEach((function(e){var t=e.BytesOfClearData+e.BytesOfProtectedData,i=o.slice(0,t);l.push(i.slice(0,e.BytesOfClearData)),u.push(i.slice(e.BytesOfClearData)),o=o.slice(t)}));else{var d=t.size;l.push(o.slice(0,0)),u.push(o.slice(0,d)),o=o.slice(d)}var h=new Ks;h.write.apply(h,u);var f=i?i(h.buffer,n,c):Us.decryptWordArray(h.buffer,n,c),m=new Ks;l.forEach((function(e,t){var i=u[t].length,n=f.slice(0,i);m.write(e),m.write(n),f=f.slice(i)})),e.samples[a].data=m.buffer}))}if(t.audioSenc){var a=t.kidValue,s=t.audioSenc;t.samples.forEach((function(e,n){var r=s[n],o=i?i(e.data,a,r.InitializationVector):Us.decryptWordArray(e.data,a,r.InitializationVector);t.samples[n].data=o}))}}},Bs=20,zs=function(){function e(t,i,n,r){var a=this;ea(this,e),na(this,"_videoSamples",[]),na(this,"_audioSamples",[]),na(this,"_lastRemainBuffer",[]),na(this,"_lastRemainBufferStartPos",0),this.videoTrack=new ba,this.audioTrack=new La,this.metadataTrack=n||new ka,this.log=new Qa("MP4Demuxer",!r||!r.openLog||!r.openLog),t&&t.forEach((function(e){var t;(t=a._videoSamples).push.apply(t,aa(e.frames))})),i&&i.forEach((function(e){var t;(t=a._audioSamples).push.apply(t,aa(e.frames))}))}return ia(e,[{key:"parseSamples",value:function(e){if(!e)throw new Error("moov is required");if(this.videoTrack.codec||this.audioTrack.codec||(Oa.moovToTrack(e,this.videoTrack,this.audioTrack),this.videoSenc=this.videoTrack.videoSenc,this.audioSenc=this.audioTrack.audioSenc),!this._audioSamples.length&&!this._videoSamples.length){var t=Oa.moovToSamples(e);if(!t)throw new Error("cannot parse samples from moov box");this._videoSamples=t.videoSamples||[],this._audioSamples=t.audioSamples||[]}}},{key:"demux",value:function(e,t,i,n,r){this.parseSamples(r);var a,s,o,l=this.videoTrack,u=this.audioTrack;if(l.samples=[],u.samples=[],i){for(var c,d=0,h=i[0],f=i[1];h<=f;h++){if(a=this._videoSamples[h],!a)throw new Error("cannot found video frame #".concat(h));o=a.offset-t,s=e.subarray(o,o+a.size),c=new Sa(a.pts||a.dts,a.dts),c.duration=a.duration,c.gopId=a.gopId,a.keyframe&&c.setToKeyframe();var m=0,p=s.length-1;while(m<p)d=Za(s,m),m+=4,c.units.push(s.subarray(m,m+d)),m+=d;l.samples.push(c)}l.baseMediaDecodeTime=l.samples[0].dts}if(n){for(var v=n[0],g=n[1];v<=g;v++){if(a=this._audioSamples[v],!a)throw new Error("cannot found video frame #".concat(v));o=a.offset-t,s=e.subarray(o,o+a.size),u.samples.push(new Ta(a.dts,s,a.duration))}u.baseMediaDecodeTime=u.samples[0].dts}return{videoTrack:l,audioTrack:u,metadataTrack:this.metadataTrack}}},{key:"demuxPart",value:function(e,t,i,n,r,a,s,o){if(this.parseSamples(r),this.videoTrack.useEME=a,this.audioTrack.useEME=a,this._lastRemainBuffer&&this._lastRemainBuffer.byteLength>0&&t>this._lastRemainBufferStartPos&&t<=this._lastRemainBufferStartPos+this._lastRemainBuffer.byteLength){var l=0;while(l<Bs)try{var u=this._lastRemainBuffer.subarray(0,t-this._lastRemainBufferStartPos),c=new Uint8Array(e.byteLength+u.byteLength);c.set(u,0),c.set(new Uint8Array(e),u.byteLength),e=c,t-=u.byteLength,this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0;break}catch(E){if(!(l<Bs))throw new Error("new Uint8Array error:,"+E.errorMessage);l++}}var d,h,f,m=this.videoTrack,p=this.audioTrack;m.samples=[],p.samples=[],m.videoSenc=null,p.audioSenc=null;var v=0,g=0;if(this._videoSamples.length>0&&i.length>0){for(var y,b=e.byteLength+t,L=i[0];L<=i[1];L++){if(d=this._videoSamples[L],!d)throw new Error("cannot found video frame #".concat(L));d.offset>=t&&d.offset+d.size<=b&&(f=d.offset-t,v=f+d.size,h=e.subarray(f,v),y=new Sa(d.pts||d.dts,d.dts),y.duration=d.duration,y.gopId=d.gopId,y.sampleOffset=d.index,d.keyframe&&y.setToKeyframe(),y.data=h,y.size=d.size,m.samples.push(y))}m.samples.length>0&&(m.gopId=m.samples[0].gopId,m.baseMediaDecodeTime=m.samples[0].dts,m.startPts=m.samples[0].pts/m.timescale,m.endPts=m.samples[m.samples.length-1].pts/m.timescale,this.videoSenc&&(m.videoSenc=this.videoSenc.slice(m.samples[0].sampleOffset,m.samples[0].sampleOffset+m.samples.length),m.kidValue=s))}if(this._audioSamples.length>0&&n.length>0){for(var S=n[0];S<=n[1];S++){if(d=this._audioSamples[S],!d)throw new Error("cannot found video frame #".concat(S));d.offset>=t&&d.offset+d.size<=e.byteLength+t&&(f=d.offset-t,g=f+d.size,h=e.subarray(f,g),p.samples.push(new Ta(d.dts,h,d.duration,d.index)))}p.samples.length>0&&(p.gopId=p.samples[0].gopId||m.gopId,p.baseMediaDecodeTime=p.samples[0].dts,p.startPts=p.samples[0].pts/p.timescale,p.endPts=p.samples[p.samples.length-1].pts/p.timescale,this.audioSenc&&(p.audioSenc=this.audioSenc.slice(p.samples[0].sampleOffset,p.samples[0].sampleOffset+p.samples.length),p.kidValue=s))}this.decoderData(m,p,o);for(var T=0,k=0;k<m.samples.length;k++){var x=0,R=m.samples[k].data,w=R.length-1;while(x<w)T=Za(R,x),x+=4,m.samples[k].units.push(R.subarray(x,x+T)),x+=T}return this._lastRemainBuffer=e.subarray(Math.max(v,g)),this._lastRemainBuffer.byteLength>0?this._lastRemainBufferStartPos=t+e.byteLength-this._lastRemainBuffer.byteLength:this._lastRemainBufferStartPos=0,{videoTrack:m,audioTrack:p,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this._videoSamples=[],this._audioSamples=[],this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0,this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}},{key:"decoderData",value:function(e,t,i){e.useEME||t.useEME||Us.decoderAESCTRData(e,t,i)}}],[{key:"probe",value:function(e){return Oa.probe(e)}}]),e}(),js=Math.pow(2,32)-1,Js=function(){function e(){ea(this,e)}return ia(e,null,[{key:"box",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i=i.filter(Boolean);var r=8+i.reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(r);a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(e,4);var s=8;return i.forEach((function(e){a.set(e,s),s+=e.byteLength})),a}},{key:"ftyp",value:function(t){var i=t.find((function(e){return e.type===va.VIDEO&&e.codecType===ga.HEVC}));return i?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){var i=e.ftyp(t),n=xa(i,e.moov(t));return n}},{key:"pssh",value:function(t){var i=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],Ga(t.kid),[0,0,0,0]));return e.box(e.types.pssh,i)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var i=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(aa(t.map((function(t){return e.trak(t)}))),[i]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(aa(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(t){var i=e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t));return i}},{key:"tkhd",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,r>>8&255,255&r,0,0]));return a}},{key:"mdia",value:function(t){var i=e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t));return i}},{key:"mdhd",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]));return n}},{key:"hdlr",value:function(t){var i=e.box(e.types.hdlr,e.HDLR_TYPES[t]);return i}},{key:"minf",value:function(t){var i=e.box(e.types.minf,t.type===va.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t));return i}},{key:"stbl",value:function(t){var i=[];t&&t.ext&&t.ext.stss&&i.push(e.stss(t.ext.stss.entries));var n=e.box(e.types.stbl,e.stsd(t),e.STTS,i[0],e.STSC,e.STSZ,e.STCO);return n}},{key:"stsd",value:function(t){var i;i="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):t.av1C?e.av01(t):e.avc1hev1(t);var n=e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),i);return n}},{key:"enca",value:function(t){var i=t.enca.channelCount,n=t.enca.sampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),s=e.sinf(t.enca);return e.box(e.types.enca,r,a,s)}},{key:"encv",value:function(t){var i,n,r=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],s=t.width,o=t.height,l=t.sarRatio[0],u=t.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,o>>8&255,255&o,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((i=(n=[1,r[1],r[2],r[3],255,225,r.length>>>8&255,255&r.length]).concat.apply(n,aa(r)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(i,aa(a))),h=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),m=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u]);return e.box(e.types.encv,c,e.box(e.types.avcC,d),e.box(e.types.btrt,h),f,e.box(e.types.pasp,m))}},{key:"schi",value:function(t){var i=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,i,n)}},{key:"tenc",value:function(t){var i=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(Ga(t.default_KID)));return e.box(e.types.tenc,i)}},{key:"sinf",value:function(t){var i=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),r=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,i,e.box(e.types.frma,n),e.box(e.types.schm,r),a)}},{key:"av01",value:function(t){return e.box(e.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t.av1C,t.colr)}},{key:"avc1hev1",value:function(t){var i=t.codecType===ga.HEVC,n=i?e.types.hvc1:e.types.avc1,r=i?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),r];return i?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var i,n,r,a=[],s=[];return t.sps.forEach((function(e){r=e.byteLength,a.push(r>>>8&255),a.push(255&r),a.push.apply(a,aa(e))})),t.pps.forEach((function(e){r=e.byteLength,s.push(r>>>8&255),s.push(255&r),s.push.apply(s,aa(e))})),e.box(e.types.avcC,new Uint8Array((i=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(i,s)))}},{key:"hvcC",value:function(t){var i=t.hvcC;if(i instanceof ArrayBuffer||i instanceof Uint8Array)return i;var n,r=t.vps,a=t.sps,s=t.pps;if(i){var o=i.generalProfileCompatibilityFlags,l=i.generalConstraintIndicatorFlags,u=(r.length&&1)+(a.length&&1)+(s.length&&1);n=[1,i.generalProfileSpace<<6|i.generalTierFlag<<5|i.generalProfileIdc,o>>>24,o>>>16,o>>>8,o,l[0],l[1],l[2],l[3],l[4],l[5],i.generalLevelIdc,240,0,252,252|i.chromaFormatIdc,248|i.bitDepthLumaMinus8,248|i.bitDepthChromaMinus8,0,0,i.numTemporalLayers<<3|i.temporalIdNested<<2|3,u];var c=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,aa(e))};r.length&&(n.push(160,0,r.length),r.forEach(c)),a.length&&(n.push(161,0,a.length),a.forEach(c)),s.length&&(n.push(162,0,s.length),s.forEach(c))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var i=ra(t,2),n=i[0],r=i[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var i=t.length,n=e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+i,0,0,0,4,15+i,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([i]).concat(t).concat([6,1,2])));return n}},{key:"mvex",value:function(t){var i=e.box.apply(e,[e.types.mvex].concat(aa(t.map((function(t){return e.trex(t.id)})))));return i}},{key:"trex",value:function(t){var i=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return i}},{key:"trex1",value:function(t){var i=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return i}},{key:"trex2",value:function(t){var i=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return i}},{key:"moof",value:function(t){var i=e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(aa(t.map((function(t){return e.traf(t)})))));return i}},{key:"mfhd",value:function(t){var i=e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]));return i}},{key:"traf",value:function(t){var i,n=e.tfhd(t.id),r=e.tfdt(t,t.baseMediaDecodeTime),a=0;if(t.isVideo&&t.videoSenc&&(i=t.videoSenc,i.forEach((function(e){a+=8,e.subsamples&&e.subsamples.length&&(a+=2,a+=6*e.subsamples.length)}))),t.videoSencLength=a,t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(t.isVideo){var s=e.saiz(t),o=e.saio(t),l=e.trun1(t),u=e.senc(t),c=e.box(e.types.traf,n,r,s,o,l,u);return c}if(t.isAudioEncryption){var d=e.sbgp(),h=e.saiz(t),f=e.saio(t),m=e.senc(t),p=e.trun1(t),v=e.box(e.types.traf,n,r,d,h,f,m,p);return v}var g=e.sbgp(),y=e.trun1(t);return e.box(e.types.traf,n,r,g,y)}if(t.isVideo){var b=e.trun1(t);return e.box(e.types.traf,n,r,b)}var L=e.sbgp(),S=e.saiz(t),T=e.saio(t),k=e.senc(t),x=e.trun1(t),R=e.box(e.types.traf,n,r,L,S,T,k,x);return R}var w=e.sdtp(t),E=76;return e.box(e.types.traf,n,r,w,e.trun(t.samples,w.byteLength+E))}},{key:"sdtp",value:function(t){var i=new Ks;return t.samples.forEach((function(e){i.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),i.buffer)}},{key:"trun1",value:function(t){var i=new Ks,n=Ks.writeUint32(t.samples.length),r=null;if(t.isVideo){var a=t.videoSencLength;r=Ks.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(r=Ks.writeUint32(16*t.samples.length+92))}else{var s=12*t.samples.length+124;t.isAudioEncryption&&(s=12*t.samples.length+8*t.audioSenc.length+177),r=Ks.writeUint32(s)}return t.samples.forEach((function(e){i.write(Ks.writeUint32(e.duration)),i.write(Ks.writeUint32(e.size)),i.write(Ks.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&i.write(Ks.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,r,i.buffer)}},{key:"senc",value:function(t){var i=new Ks,n=t.samples.length,r=t.isVideo?16:8,a=t.isVideo?2:0,s=[],o=0;return t.isVideo?(s=t.videoSenc,o=t.videoSencLength):s=t.audioSenc,o=o||r*n,i.write(Ks.writeUint32(16+o),e.types.senc,this.extension(0,a)),i.write(Ks.writeUint32(n)),s.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)i.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(i.write(Ks.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){i.write(Ks.writeUint16(e.BytesOfClearData)),i.write(Ks.writeUint32(e.BytesOfProtectedData))})))})),i.buffer}},{key:"saio",value:function(t){var i=12*t.samples.length+141;!t.isVideo&&t.isAudioEncryption&&(i=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var i=t.samples.length,n=new Uint8Array([0,0,0,0,16,i>>24&255,i>>16&255,i>>8&255,255&i]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,i){var n=Math.floor(i/(js+1)),r=Math.floor(i%(js+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r]))}},{key:"trun",value:function(t,i){var n=t.length,r=12+16*n;i+=8+r;var a=new Uint8Array(r);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var s=0;s<n;s++){var o=t[s],l=o.duration,u=o.size,c=o.flag,d=void 0===c?{}:c,h=o.cts,f=void 0===h?0:h;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,d.isLeading<<2|(null===d.dependsOn||void 0===d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null===d.isNonSyncSample||void 0===d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*s)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(aa(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===va.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var i=t.ext,n=[e.stsd(t),e.stts(i.stts),e.stsc(i.stsc),e.stsz(i.stsz),e.stco(i.stco)];return i.stss.length&&n.push(e.stss(i.stss)),i.ctts.length&&n.push(e.ctts(i.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var i=t.length,n=new Uint8Array(8*i),r=0;return t.forEach((function(e){var t=e.value,i=e.count;n.set([i>>24,i>>16&255,i>>8&255,255&i,t>>24,t>>16&255,t>>8&255,255&t],r),r+=8})),e.box(e.types.stts,xa(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stsc",value:function(t){var i=t.length,n=new Uint8Array(12*i),r=0;return t.forEach((function(e){var t=e.firstChunk,i=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a],r),r+=12})),e.box(e.types.stsc,xa(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stsz",value:function(t){var i=t.length,n=new Uint8Array(4*i),r=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],r),r+=4})),e.box(e.types.stsz,xa(new Uint8Array([0,0,0,0,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stco",value:function(t){var i=t.length,n=new Uint8Array(4*i),r=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],r),r+=4})),e.box(e.types.stco,xa(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"stss",value:function(t){var i=t.length,n=new Uint8Array(4*i),r=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],r),r+=4})),e.box(e.types.stss,xa(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"ctts",value:function(t){var i=t.length,n=new Uint8Array(8*i),r=0;return t.forEach((function(e){var t=e.value,i=e.count;n.set([i>>24,i>>16&255,i>>8&255,255&i,t>>24,t>>16&255,t>>8&255,255&t],r),r+=8})),e.box(e.types.ctts,xa(new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var i=t.timescale,n=t.samples[0].duration,r=n*t.samples.length,a=t.samples[0].sampleOffset*n,s=8;t.samples.forEach((function(e){s+=e.size}));var o=0;if(t.isVideo){var l,u=0;t.videoSenc&&(l=t.videoSenc),t.isVideo&&l.forEach((function(e){u+=8,e.subsamples&&e.subsamples.length&&(u+=2,u+=6*e.subsamples.length)})),t.videoSencLength=u,o=s+141+16*t.samples.length+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(o=s+16*t.samples.length+84)}else o=s+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(o=s+169+12*t.samples.length+8*t.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,255&t.id,i>>24&255,i>>16&255,i>>8&255,255&i,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,o>>16&255,o>>8&255,255&o,r>>24&255,r>>16&255,r>>8&255,255&r,144,0,0,0]);return e.box(e.types.sidx,c)}},{key:"mdat",value:function(t){var i=e.box(e.types.mdat,t);return i}}]),e}();na(Js,"types",["av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),na(Js,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),na(Js,"FTYPAVC1",Js.box(Js.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),na(Js,"FTYPHEV1",Js.box(Js.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),na(Js,"DINF",Js.box(Js.types.dinf,Js.box(Js.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),na(Js,"VMHD",Js.box(Js.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),na(Js,"SMHD",Js.box(Js.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),na(Js,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),na(Js,"STTS",Js.box(Js.types.stts,Js.StblTable)),na(Js,"STSC",Js.box(Js.types.stsc,Js.StblTable)),na(Js,"STSZ",Js.box(Js.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),na(Js,"STCO",Js.box(Js.types.stco,Js.StblTable));var Qs,qs=function(){function e(t,i,n){ea(this,e),this.videoTrack=t,this.audioTrack=i;var r=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=r&&Number(r[1])<50,this.log=new Qa("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return ia(e,[{key:"remux",value:function(){var e,t,i,n,r,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.videoTrack,l=this.audioTrack,u=o.exist(),c=l.exist(),d=[];return a&&(s&&s.initMerge?(u&&d.push(this.videoTrack),c&&d.push(this.audioTrack),i=Js.initSegment(d)):(u&&(e=Js.initSegment([this.videoTrack])),c&&(t=Js.initSegment([this.audioTrack])))),u&&o.hasSample()&&(n=this._remuxVideo()),c&&l.hasSample()&&(r=this._remuxAudio()),o.samples=[],l.samples=[],{initSegment:i,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:r}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,i=/av01/.test(e.codec),n=0;i?t.forEach((function(e){n+=e.data.byteLength})):t.forEach((function(e){n+=e.units.reduce((function(e,t){return e+t.byteLength}),0),n+=4*e.units.length}));var r=new Uint8Array(n);if(i)for(var a,s=0,o=t.length,l=0;s<o;s++)a=t[s],r.set(a.data,l),a.size=a.data.byteLength,l+=a.size;else for(var u,c=new DataView(r.buffer),d=function(e,i){i=t[h];var n=0;i.units.forEach((function(t){c.setUint32(e,t.byteLength),e+=4,r.set(t,e),e+=t.byteLength,n+=4+t.byteLength})),i.size=n,m=e,u=i},h=0,f=t.length,m=0;h<f;h++)d(m,u);var p=Js.mdat(r),v=Js.moof([e]);return xa(v,p)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,i){return t.set(i.data,e),e+i.size}),0);var i=Js.mdat(t),n=Js.moof([e]);return xa(n,i)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),$s="3.0.19";function eo(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function to(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?eo(Object(i),!0).forEach((function(t){uo(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eo(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function io(){io=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(Z){l=function(e,t,i){return e[t]=i}}function u(e,t,i,r){var a=t&&t.prototype instanceof h?t:h,s=Object.create(a.prototype),o=new R(r||[]);return n(s,"_invoke",{value:S(e,i,o)}),s}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(Z){return{type:"throw",arg:Z}}}e.wrap=u;var d={};function h(){}function f(){}function m(){}var p={};l(p,a,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(w([])));g&&g!==t&&i.call(g,a)&&(p=g);var y=m.prototype=h.prototype=Object.create(p);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(n,a,s,o){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==typeof d&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,o)}))}o(l.arg)}var a;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){r(e,i,t,n)}))}return a=a?a.then(n,n):n()}})}function S(e,t,i){var n="suspendedStart";return function(r,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw a;return E()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var o=T(s,i);if(o){if(o===d)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=c(e,t,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}function T(e,t){var i=t.method,n=e.iterator[i];if(void 0===n)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=m,n(y,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:f,configurable:!0}),f.displayName=l(m,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(L.prototype),l(L.prototype,s,(function(){return this})),e.AsyncIterator=L,e.async=function(t,i,n,r,a){void 0===a&&(a=Promise);var s=new L(u(t,i,n,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),l(y,o,"Generator"),l(y,a,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return s.type="throw",s.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var o=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(o&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),x(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;x(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:w(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function no(e){return no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},no(e)}function ro(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(u){return void i(u)}o.done?t(l):Promise.resolve(l).then(n,r)}function ao(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function s(e){ro(a,n,r,s,o,"next",e)}function o(e){ro(a,n,r,s,o,"throw",e)}s(void 0)}))}}function so(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Co(n.key),n)}}function lo(e,t,i){return t&&oo(e.prototype,t),i&&oo(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function uo(e,t,i){return t=Co(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function co(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fo(e,t)}function ho(e){return ho=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ho(e)}function fo(e,t){return fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fo(e,t)}function mo(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function po(e,t,i){return po=mo()?Reflect.construct.bind():function(e,t,i){var n=[null];n.push.apply(n,t);var r=Function.bind.apply(e,n),a=new r;return i&&fo(a,i.prototype),a},po.apply(null,arguments)}function vo(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function go(e){var t="function"===typeof Map?new Map:void 0;return go=function(e){if(null===e||!vo(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return po(e,arguments,ho(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),fo(i,e)},go(e)}function yo(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}function bo(e,t){if(null==e)return{};var i,n,r=yo(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function Lo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function So(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Lo(e)}function To(e){var t=mo();return function(){var i,n=ho(e);if(t){var r=ho(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return So(this,i)}}function ko(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=ho(e),null===e)break;return e}function xo(){return xo="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=ko(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},xo.apply(this,arguments)}function Ro(e,t){if(e){if("string"===typeof e)return wo(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?wo(e,t):void 0}}function wo(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Eo(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Ro(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Zo(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Co(e){var t=Zo(e,"string");return"symbol"===typeof t?t:String(t)}var Io={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},Mo=(Qs={},uo(Qs,Io.MANIFEST,{HLS:1100,DASH:1200}),uo(Qs,Io.NETWORK,2100),uo(Qs,Io.NETWORK_TIMEOUT,2101),uo(Qs,Io.NETWORK_FORBIDDEN,2103),uo(Qs,Io.NETWORK_NOTFOUND,2104),uo(Qs,Io.NETWROK_RANGE_NOT_SATISFIABLE,2116),uo(Qs,Io.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),uo(Qs,Io.REMUX,{FMP4:4100,MP4:4200}),uo(Qs,Io.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),uo(Qs,Io.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),uo(Qs,Io.OTHER,8e3),uo(Qs,Io.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),Qs),Go=function(e){co(i,e);var t=To(i);function i(e,n,r,a,s){var o;return so(this,i),o=t.call(this,s||(null===r||void 0===r?void 0:r.message)),o.errorType=e===Io.NETWORK_TIMEOUT?Io.NETWORK:e,o.originError=r,o.ext=a,o.errorCode=Mo[e][n]||Mo[e],o.errorMessage=o.message,o.errorCode||(o.errorType=Io.OTHER,o.errorCode=Mo[o.errorType]),o}return lo(i,null,[{key:"create",value:function(e,t,n,r,a){return e instanceof i?e:(e instanceof Error&&(n=e,e=""),e||(e=Io.OTHER),new i(e,t,n,r,a))}},{key:"network",value:function(e){var t;return new i(null!==e&&void 0!==e&&e.isTimeout?Io.NETWORK_TIMEOUT:Io.NETWORK,null,e instanceof Error?e:null,{url:null===e||void 0===e?void 0:e.url,response:null===e||void 0===e?void 0:e.response,httpCode:null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),i}(go(Error)),Xo={416:Mo[Io.NETWROK_RANGE_NOT_SATISFIABLE],403:Mo[Io.NETWORK_FORBIDDEN],404:Mo[Io.NETWORK_NOTFOUND],timeout:Mo[Io.NETWORK_TIMEOUT],"4xx":"".concat(Mo[Io.NETWORK],"4XX"),"5xx":"".concat(Mo[Io.NETWORK],"5XX"),networkError:Mo[Io.NETWORK],contentError:"".concat(Mo[Io.NETWORK],"contentError"),mse:Mo[Io.MEDIA][Io.SUB_TYPES.MSE_OTHER],mseOpen:Mo[Io.MEDIA][Io.SUB_TYPES.MSE_ADD_SB],mseAppend:Mo[Io.MEDIA][Io.SUB_TYPES.MSE_APPEND_BUFFER],mse_hijack:Mo[Io.MEDIA][Io.SUB_TYPES.MSE_HIJACK],eme_hijack:Mo[Io.MEDIA][Io.SUB_TYPES.EME_HIJACK],metaError:Mo[Io.DEMUX][Io.SUB_TYPES.MP4],muxError:Mo[Io.REMUX][Io.SUB_TYPES.FMP4],other:Mo[Io.OTHER],waitTimeout:Mo[Io.RUNTIME][Io.SUB_TYPES.BUFFERBREAK_ERROR],waitTimeoutWithHidden:Mo[Io.RUNTIME][Io.SUB_TYPES.WAITING_TIMEOUT_ERROR],drm:Mo[Io.DRM][Io.SUB_TYPES.LICENSE]},_o=Io;function Po(e){return Xo[e]||e}var Do=Fr((function e(t,i,n){Vr(this,e);var r=0,a=0;n&&n.range&&n.range.length>1&&(r=n.range[0],a=n.range[1]);var s=Po(i);return{errorCode:s,errorType:t,errorMessage:(null===n||void 0===n?void 0:n.httpText)||(null===n||void 0===n?void 0:n.message),url:null===n||void 0===n?void 0:n.url,httpCode:i,version:$s,rangeStart:r,rangeEnd:a,ext:n,mediaError:{code:s,message:(null===n||void 0===n?void 0:n.httpText)||(null===n||void 0===n?void 0:n.message)}}})),Wo=Fr((function e(t,i,n){return Vr(this,e),{errorCode:i,errorType:t,version:$s,errorMessage:n.msg,ext:n,mediaError:{code:i,message:n.msg}}})),Vo={};function No(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,a,s,o=[],l=!0,u=!1;try{if(a=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=a.call(i)).done)&&(o.push(n.value),o.length!==t);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(u)throw r}}return o}}function Fo(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Ao(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(i),!0).forEach((function(t){zo(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Fo(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Yo(){Yo=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(Z){l=function(e,t,i){return e[t]=i}}function u(e,t,i,r){var a=t&&t.prototype instanceof h?t:h,s=Object.create(a.prototype),o=new R(r||[]);return n(s,"_invoke",{value:S(e,i,o)}),s}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(Z){return{type:"throw",arg:Z}}}e.wrap=u;var d={};function h(){}function f(){}function m(){}var p={};l(p,a,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(w([])));g&&g!==t&&i.call(g,a)&&(p=g);var y=m.prototype=h.prototype=Object.create(p);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(n,a,s,o){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==typeof d&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,o)}))}o(l.arg)}var a;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){r(e,i,t,n)}))}return a=a?a.then(n,n):n()}})}function S(e,t,i){var n="suspendedStart";return function(r,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw a;return E()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var o=T(s,i);if(o){if(o===d)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=c(e,t,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}function T(e,t){var i=t.method,n=e.iterator[i];if(void 0===n)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=m,n(y,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:f,configurable:!0}),f.displayName=l(m,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(L.prototype),l(L.prototype,s,(function(){return this})),e.AsyncIterator=L,e.async=function(t,i,n,r,a){void 0===a&&(a=Promise);var s=new L(u(t,i,n,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),l(y,o,"Generator"),l(y,a,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return s.type="throw",s.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var o=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(o&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),x(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;x(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:w(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function Oo(e,t,i,n,r,a,s){try{var o=e[a](s),l=o.value}catch(u){return void i(u)}o.done?t(l):Promise.resolve(l).then(n,r)}function Ho(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function s(e){Oo(a,n,r,s,o,"next",e)}function o(e){Oo(a,n,r,s,o,"throw",e)}s(void 0)}))}}function Ko(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Uo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ml(n.key),n)}}function Bo(e,t,i){return t&&Uo(e.prototype,t),i&&Uo(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function zo(e,t,i){return t=ml(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function jo(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Qo(e,t)}function Jo(e){return Jo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Jo(e)}function Qo(e,t){return Qo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Qo(e,t)}function qo(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function $o(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}function el(e,t){if(null==e)return{};var i,n,r=$o(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function tl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function il(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return tl(e)}function nl(e){var t=qo();return function(){var i,n=Jo(e);if(t){var r=Jo(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return il(this,i)}}function rl(e,t){return ol(e)||No(e,t)||ul(e,t)||hl()}function al(e){return sl(e)||ll(e)||ul(e)||dl()}function sl(e){if(Array.isArray(e))return cl(e)}function ol(e){if(Array.isArray(e))return e}function ll(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ul(e,t){if(e){if("string"===typeof e)return cl(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?cl(e,t):void 0}}function cl(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function dl(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function hl(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fl(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function ml(e){var t=fl(e,"string");return"symbol"===typeof t?t:String(t)}Vo.nowTime=function(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}},Vo.concatData=function(e,t){var i=[],n=0;e&&i.push(e),t&&i.push(t),i.every((function(e){return e&&(n+=e.byteLength),!0}));var r=new Uint8Array(n),a=0;return i.every((function(e){return e&&(r.set(e,a),a+=e.byteLength),!0})),r};var pl={DEBUG:1,LOG:2,WARN:3,ERROR:4},vl=204800,gl=["Boolean","Number","String","Undefined","Null","Date","Object"],yl=function(){function e(t,i){so(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(null===i||void 0===i?void 0:i.logCacheLevel)||3,this.logMaxSize=(null===i||void 0===i?void 0:i.logMaxSize)||vl,this.logSize=0,this.logTextArray=[]}return lo(e,[{key:"debug",value:function(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];this.logCache.apply(this,[pl.DEBUG].concat(n)),e.disabled||(t=console).debug.apply(t,[this._prefix,bl()].concat(n))}},{key:"log",value:function(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];this.logCache.apply(this,[pl.LOG].concat(n)),e.disabled||(t=console).log.apply(t,[this._prefix,bl()].concat(n))}},{key:"warn",value:function(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];this.logCache.apply(this,[pl.WARN].concat(n)),e.disabled||(t=console).warn.apply(t,[this._prefix,bl()].concat(n))}},{key:"error",value:function(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];this.logCache.apply(this,[pl.ERROR].concat(n)),e.disabled||(t=console).error.apply(t,[this._prefix,bl()].concat(n))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=n.map((function(e){return Sl(e)}));t=this._prefix+bl()+JSON.stringify(a)}catch(o){return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var s=this.logTextArray.shift();this.logSize-=s.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join("\n");return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function bl(){return(new Date).toLocaleString()}function Ll(e){if("object"!==no(e))return e;var t=Object.prototype.toString.call(e).slice(8,-1);switch(t){case"Array":case"Uint8Array":case"ArrayBuffer":return t+"["+e.length+"]";case"Object":return"{}";default:return t}}function Sl(e,t,i){i||(i=1),t||(t=2);var n={};if(!e||"object"!==no(e))return e;var r=Object.prototype.toString.call(e).slice(8,-1);if(!gl.includes(r))return r;if(!(i>t)){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i===t?n[a]=Ll(e[a]):"object"===no(e[a])?n[a]=Sl(e[a],t,i+1):n[a]=e[a]);return n}}uo(yl,"disabled",!0);var Tl={FETCH:"fetch",XHR:"xhr"},kl={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},xl=function(e){co(i,e);var t=To(i);function i(e,n,r,a){var s;return so(this,i),s=t.call(this,a),uo(Lo(s),"retryCount",0),uo(Lo(s),"isTimeout",!1),uo(Lo(s),"loaderType",Tl.FETCH),uo(Lo(s),"startTime",0),uo(Lo(s),"endTime",0),uo(Lo(s),"options",{}),s.url=e,s.request=n,s.response=r,s}return lo(i)}(go(Error)),Rl=Object.prototype.toString;function wl(e){return null!==e&&"object"===no(e)}function El(e){if("[object Object]"!==Rl.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function Zl(e){return"[object Date]"===Rl.call(e)}function Cl(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function Il(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ml(e,t){if(e){if(!t)return e;var i,n=Object.keys(t).map((function(e){if(i=t[e],null!==i&&void 0!==i)return Array.isArray(i)?e+="[]":i=[i],i.map((function(t){return Zl(t)?t=t.toISOString():wl(t)&&(t=JSON.stringify(t)),"".concat(Il(e),"=").concat(Il(t))})).join("&")})).filter(Boolean).join("&");if(n){var r=e.indexOf("#");-1!==r&&(e=e.slice(0,r)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function Gl(e,t,i,n,r,a,s,o,l,u,c){r=null!==r&&void 0!==r?parseFloat(r):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0);var d={range:l,vid:u,index:o,contentLength:n,age:r,startTime:a,firstByteTime:s,endTime:Date.now(),priOptions:c};return{data:e,done:t,options:d,response:i}}function Xl(e,t){return Math.round(8*e*1e3/t/1024)}var _l={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},Pl=2097152,Dl=function(e){co(i,e);var t=To(i);function i(){var e;return so(this,i),e=t.call(this),uo(Lo(e),"_abortController",null),uo(Lo(e),"_timeoutTimer",null),uo(Lo(e),"_reader",null),uo(Lo(e),"_response",null),uo(Lo(e),"_aborted",!1),uo(Lo(e),"_index",-1),uo(Lo(e),"_range",null),uo(Lo(e),"_receivedLength",0),uo(Lo(e),"_running",!1),uo(Lo(e),"_logger",null),uo(Lo(e),"_vid",""),uo(Lo(e),"_onProcessMinLen",0),uo(Lo(e),"_onCancel",null),uo(Lo(e),"_priOptions",null),e}return lo(i,[{key:"load",value:function(e){var t,i=this,n=e.url,r=e.vid,a=e.timeout,s=e.responseType,o=e.onProgress,l=e.index,u=e.onTimeout,c=e.onCancel,d=e.range,h=e.transformResponse,f=e.request,m=e.params,p=e.logger,v=e.method,g=e.headers,y=e.body,b=e.mode,L=e.credentials,S=e.cache,T=e.redirect,k=e.referrer,x=e.referrerPolicy,R=e.onProcessMinLen,w=e.priOptions;this._logger=p,this._aborted=!1,this._onProcessMinLen=R,this._onCancel=c,this._abortController="undefined"!==typeof AbortController&&new AbortController,this._running=!0,this._index=l,this._range=d||[0,0],this._vid=r||n,this._priOptions=w||{};var E={method:v,headers:g,body:y,mode:b,credentials:L,cache:S,redirect:T,referrer:k,referrerPolicy:x,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},Z=!1;clearTimeout(this._timeoutTimer),n=Ml(n,m);var C=Cl(d);C&&(g=f?f.headers:E.headers=E.headers||(Headers?new Headers:{}),Headers&&g instanceof Headers?g.append("Range",C):g.Range=C),a&&(this._timeoutTimer=setTimeout((function(){if(Z=!0,i.cancel(),u){var e=new xl(n,E,null,"timeout");e.isTimeout=!0,u(e,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})}}),a));var I=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",d),new Promise((function(e,t){fetch(f||n,f?void 0:E).then(function(){var r=ao(io().mark((function r(a){var u,c,f,m;return io().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(clearTimeout(i._timeoutTimer),i._response=a,!i._aborted&&i._running){r.next=4;break}return r.abrupt("return");case 4:if(h&&(a=h(a,n)||a),a.ok){r.next=7;break}throw new xl(n,E,a,"bad network response");case 7:if(u=Date.now(),s!==kl.TEXT){r.next=15;break}return r.next=11,a.text();case 11:c=r.sent,i._running=!1,r.next=37;break;case 15:if(s!==kl.JSON){r.next=22;break}return r.next=18,a.json();case 18:c=r.sent,i._running=!1,r.next=37;break;case 22:if(!o){r.next=29;break}return i.resolve=e,i.reject=t,i._loadChunk(a,o,I,u),r.abrupt("return");case 29:return r.next=31,a.arrayBuffer();case 31:c=r.sent,c=new Uint8Array(c),i._running=!1,f=Date.now()-I,m=Xl(c.byteLength,f),i.emit(_l.REAL_TIME_SPEED,{speed:m,len:c.byteLength,time:f,vid:i._vid,index:i._index,range:i._range,priOptions:i._priOptions});case 37:i._logger.debug("[fetch load end], index,",l,",range,",d),e(Gl(c,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),I,u,l,d,i._vid,i._priOptions));case 39:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()).catch((function(e){var r;clearTimeout(i._timeoutTimer),i._running=!1,i._aborted&&!Z||(e=e instanceof xl?e:new xl(n,E,null,null===(r=e)||void 0===r?void 0:r.message),e.startTime=I,e.endTime=Date.now(),e.isTimeout=Z,e.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},t(e))}))}))}},{key:"cancel",value:function(){var e=ao(io().mark((function e(){return io().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e["catch"](5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(t){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}}),e,this,[[5,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadChunk",value:function(e,t,i,n){var r=this;if(!e.body||!e.body.getReader){this._running=!1;var a=new xl(e.url,"",e,"onProgress of bad response.body.getReader");return a.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(a)}this._onProcessMinLen>0&&(this._cache=new Uint8Array(Pl),this._writeIdx=0);var s,o,l,u=this._reader=e.body.getReader(),c=function(){var a=ao(io().mark((function a(){var d,h,f,m,p,v,g,y;return io().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=Date.now(),a.prev=1,a.next=4,u.read();case 4:s=a.sent,l=Date.now(),a.next=13;break;case 8:return a.prev=8,a.t0=a["catch"](1),l=Date.now(),r._aborted||(r._running=!1,a.t0.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},r.reject(a.t0)),a.abrupt("return");case 13:if(h=(null===(d=r._range)||void 0===d?void 0:d.length)>0?r._range[0]:0,f=h+r._receivedLength,!r._aborted){a.next=19;break}return r._running=!1,t(void 0,!1,{range:[f,f],vid:r._vid,index:r._index,startTime:o,endTime:l,st:i,firstByteTime:n,priOptions:r._priOptions},e),a.abrupt("return");case 19:m=s.value?s.value.byteLength:0,r._receivedLength+=m,r._logger.debug("fetchLoader,onProgress call,task,",r._range,", start,",f,", end,",h+r._receivedLength,", done,",s.done),r._onProcessMinLen>0?r._writeIdx+m>=r._onProcessMinLen||s.done?(p=new Uint8Array(r._writeIdx+m),p.set(r._cache.slice(0,r._writeIdx),0),m>0&&p.set(s.value,r._writeIdx),r._writeIdx=0,r._logger.debug("fetchLoader,onProgress enough,done,",s.done,",len,",p.byteLength,", writeIdx,",r._writeIdx)):m>0&&r._writeIdx+m<Pl?(r._cache.set(s.value,r._writeIdx),r._writeIdx+=m,r._logger.debug("fetchLoader,onProgress cache,len,",m,", writeIdx,",r._writeIdx)):m>0&&(v=new Uint8Array(r._writeIdx+m+2048),r._logger.debug("fetchLoader,onProgress extra start,size,",r._writeIdx+m+2048,", datalen,",m,", writeIdx,",r._writeIdx),v.set(r._cache.slice(0,r._writeIdx),0),m>0&&v.set(s.value,r._writeIdx),r._writeIdx+=m,delete r._cache,r._cache=v,r._logger.debug("fetchLoader,onProgress extra end,len,",m,", writeIdx,",r._writeIdx)):p=s.value,(p&&p.byteLength>0||s.done)&&t(p,s.done,{range:[r._range[0]+r._receivedLength-(p?p.byteLength:0),r._range[0]+r._receivedLength],vid:r._vid,index:r._index,startTime:o,endTime:l,st:i,firstByteTime:n,priOptions:r._priOptions},e),s.done?(g=Date.now()-i,y=Xl(r._receivedLength,g),r.emit(_l.REAL_TIME_SPEED,{speed:y,len:r._receivedLength,time:g,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions}),r._running=!1,r._logger.debug("[fetchLoader onProgress end],task,",r._range,",done,",s.done),r.resolve(Gl(s,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),i,n,r._index,r._range,r._vid,r._priOptions))):c();case 25:case"end":return a.stop()}}),a,null,[[1,8]])})));return function(){return a.apply(this,arguments)}}();c()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"===typeof fetch)}}]),i}(X.a);function Wl(e){return to({loaderType:Tl.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:kl.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e)}var Vl=function(e){co(i,e);var t=To(i);function i(){var e;return so(this,i),e=t.call(this),uo(Lo(e),"_xhr",null),uo(Lo(e),"_aborted",!1),uo(Lo(e),"_timeoutTimer",null),uo(Lo(e),"_range",null),uo(Lo(e),"_receivedLength",0),uo(Lo(e),"_url",null),uo(Lo(e),"_onProgress",null),uo(Lo(e),"_index",-1),uo(Lo(e),"_headers",null),uo(Lo(e),"_currentChunkSizeKB",384),uo(Lo(e),"_timeout",null),uo(Lo(e),"_xhr",null),uo(Lo(e),"_withCredentials",null),uo(Lo(e),"_startTime",-1),uo(Lo(e),"_loadCompleteResolve",null),uo(Lo(e),"_loadCompleteReject",null),uo(Lo(e),"_runing",!1),uo(Lo(e),"_logger",!1),uo(Lo(e),"_vid",""),uo(Lo(e),"_responseType",void 0),uo(Lo(e),"_credentials",void 0),uo(Lo(e),"_method",void 0),uo(Lo(e),"_transformResponse",void 0),uo(Lo(e),"_firstRtt",void 0),uo(Lo(e),"_onCancel",null),uo(Lo(e),"_priOptions",null),e}return lo(i,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("xhrLoader task, range",this._range),this._url=Ml(e.url,e.params);var i=Date.now();return new Promise((function(e,i){t._loadCompleteResolve=e,t._loadCompleteReject=i,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw e=e instanceof xl?e:new xl(t._url,t._request),e.startTime=i,e.endTime=Date.now(),e.options={index:t._index,vid:t._vid,priOptions:t._priOptions},e}))}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===kl.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,i=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-i&&(n=i+t),e=[i,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var t=this;try{this._startTime=Date.now();var i=this._xhr=new XMLHttpRequest;i.open(this._method||"GET",this._url,!0),i.responseType=this._responseType,this._timeout&&(i.timeout=this._timeout),i.withCredentials=this._withCredentials,i.onload=this._onLoad.bind(this),i.onreadystatechange=this._onReadyStatechange.bind(this),i.onerror=function(e){var i,n,r;t._running=!1;var a=new xl(t._url,t._request,null===e||void 0===e||null===(i=e.currentTarget)||void 0===i?void 0:i.response,"xhr.onerror.status:"+(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.status)+",statusText,"+(null===e||void 0===e||null===(r=e.currentTarget)||void 0===r?void 0:r.statusText));a.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(a)},i.ontimeout=function(e){t.cancel();var i=new xl(t._url,t._request,{status:408},"timeout");t._onTimeout&&(i.isTimeout=!0,t._onTimeout(i,{index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions})),i.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(i)};var n=this._headers||{},r=Cl(e);r&&(n.Range=r),n&&Object.keys(n).forEach((function(e){i.setRequestHeader(e,n[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),i.send(this._body)}catch(a){a.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(a)}}},{key:"_onReadyStatechange",value:function(e){var t=e.target;2===t.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t,i=e.target.status;if(i<200||i>299){var n=new xl(this._url,null,to(to({},e.target.response),{},{status:i}),"bad response,status:"+i);return n.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(n)}var r,a=null,s=!1,o=(null===(t=this._range)||void 0===t?void 0:t.length)>0?this._range[0]:0;if(this._responseType===kl.ARRAY_BUFFER){var l,u=new Uint8Array(e.target.response);if(r=o+this._receivedLength,u&&u.byteLength>0){this._receivedLength+=u.byteLength;var c=Date.now()-this._startTime,d=Xl(this._receivedLength,c);this.emit(_l.REAL_TIME_SPEED,{speed:d,len:this._receivedLength,time:c,vid:this._vid,index:this._index,range:[r,o+this._receivedLength],priOptions:this._priOptions})}a=u,s=!((null===(l=this._range)||void 0===l?void 0:l.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",r,"end ",o+this._receivedLength,",dataLen,",u?u.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",s)}else s=!0,a=e.target.response;var h={ok:i>=200&&i<300,status:i,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(h=this._transformResponse(h,this._url)||h),this._onProgress&&this._onProgress(a,s,{index:this._index,vid:this._vid,range:[r,o+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},h),s?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Gl(this._onProgress?null:a,s,h,h.headers["content-length"],h.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,xo(ho(i.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,i=e.getAllResponseHeaders().trim().split("\r\n"),n={},r=Eo(i);try{for(r.s();!(t=r.n()).done;){var a=t.value,s=a.split(": ");n[s[0].toLowerCase()]=s.slice(1).join(": ")}}catch(o){r.e(o)}finally{r.f()}return n}}],[{key:"isSupported",value:function(){return"undefined"!==typeof XMLHttpRequest}}]),i}(X.a);function Nl(){var e,t,i=new Promise((function(i,n){e=i,t=n}));return i.used=!1,i.resolve=function(){return i.used=!0,e.apply(void 0,arguments)},i.reject=function(){return i.used=!0,t.apply(void 0,arguments)},i}function Fl(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}var Al={stringify:function(e){try{return JSON.stringify(e)}catch(t){return""}},parse:function(e){try{return JSON.parse(e)}catch(t){return}}},Yl=["retry","retryDelay","onRetryError","transformError"],Ol=function(){function e(t,i){so(this,e),this.promise=Nl(),this.alive=!!i.onProgress,!i.logger&&(i.logger=new yl("Loader")),this._loaderType=t,this._loader=t===Tl.FETCH&&"undefined"!==typeof fetch?new Dl:new Vl,this._config=i,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=i.retryCheckFunc,this._logger=i.logger}return lo(e,[{key:"exec",value:function(){var e=this,t=this._config,i=t.retry,n=t.retryDelay,r=t.onRetryError,a=t.transformError,s=bo(t,Yl),o=function(){var t=ao(io().mark((function t(){var l,u,c;return io().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(s);case 3:l=t.sent,e.promise.resolve(l),t.next=27;break;case 7:if(t.prev=7,t.t0=t["catch"](0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,u=t.t0,a&&(u=a(u)||u),r&&e._retryCount>0&&r(u,e._retryCount,{index:s.index,vid:s.vid,range:s.range,priOptions:s.priOptions}),e._retryCount++,c=!0,e._retryCheckFunc&&(c=e._retryCheckFunc(t.t0)),!(c&&e._retryCount<=i)){t.next=26;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",s.range),e._retryTimer=setTimeout(o,n),t.abrupt("return");case 26:e.promise.reject(u);case 27:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return o(),this.promise}},{key:"cancel",value:function(){var e=ao(io().mark((function e(){return io().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),e}();function Hl(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(t=t.filter(Boolean),t.length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),r=0;return t.forEach((function(e){n.set(e,r),r+=e.byteLength})),n}function Kl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var Ul=function(e){co(i,e);var t=To(i);function i(e){var n;return so(this,i),n=t.call(this,e),uo(Lo(n),"type",Tl.FETCH),uo(Lo(n),"_queue",[]),uo(Lo(n),"_alive",[]),uo(Lo(n),"_currentTask",null),uo(Lo(n),"_finnalUrl",""),uo(Lo(n),"_config",void 0),n._config=Wl(e),n._config.loaderType!==Tl.XHR&&Dl.isSupported()||(n.type=Tl.XHR),n.log=e.logger,n}return lo(i,[{key:"isFetch",value:function(){return this.type===Tl.FETCH}},{key:"load",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!==typeof e&&e?i=e:i.url=e||i.url||this._config.url,i=Object.assign({},this._config,i),i.params&&(i.params=Object.assign({},i.params)),i.headers&&El(i.headers)&&(i.headers=Object.assign({},i.headers)),i.body&&El(i.body)&&(i.body=Object.assign({},i.body)),i.transformRequest&&(i=i.transformRequest(i)||i),i.logger=this.log;var n=new Ol(this.type,i);return n.loader.on(_l.REAL_TIME_SPEED,(function(e){t.emit(_l.REAL_TIME_SPEED,e)})),this._queue.push(n),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),n.promise}},{key:"cancel",value:function(){var e=ao(io().mark((function e(){var t;return io().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,Kl();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var t=this._currentTask.exec().catch((function(e){}));t&&"function"===typeof t.finally&&t.finally((function(){var t,i;null!==(t=e._currentTask)&&void 0!==t&&t.alive&&(null===(i=e._alive)||void 0===i?void 0:i.length)>0&&(e._alive=e._alive.filter((function(t){return t&&t!==e._currentTask}))),e._processTask()}))}}}],[{key:"isFetchSupport",value:function(){return Dl.isSupported()}}]),i}(X.a);function Bl(e){return Ao({vid:"",moovEnd:8e4,segmentDuration:2,maxDownloadInfoSize:30,responseType:"arraybuffer",cache:null},e)}var zl=Bo((function e(t,i){Ko(this,e),this.type="file",this.message=t,this.data=i})),jl=function(){function e(){Ko(this,e),zo(this,"_data",Object.create(null))}return Bo(e,[{key:"set",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return this._data[e]}},{key:"clear",value:function(){this._data=Object.create(null)}}]),e}();function Jl(e,t){var i=e.trak;if(i&&i.length){var n=i.find((function(e){var t,i;return"vide"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),r=i.find((function(e){var t,i;return"soun"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)}));if(n||r){var a=[],s=[];if(t){var o=[],l=0,u=t.start+t.size;t.references.forEach((function(e,i){o.push({index:i,startTime:l,endTime:l+e.subsegment_duration/t.timescale,duration:e.subsegment_duration/t.timescale,range:[u,u+e.referenced_size],frames:[]}),l+=e.subsegment_duration/t.timescale,u+=e.referenced_size})),a=o,s=o}else{var c,d,h=function(t){return t?[{index:0,startTime:0,endTime:t.duration/t.timescale,duration:t.duration/t.timescale,range:[e.start+e.size,""],frames:[]}]:[]};s=h(e.mvhd.duration?e.mvhd:null===(c=n.mdia)||void 0===c?void 0:c.mdhd),a=h(e.mvhd.duration?e.mvhd:null===(d=r.mdia)||void 0===d?void 0:d.mdhd)}return{videoSegments:s,audioSegments:a}}}}function Ql(e,t){var i=e.trak;if(i&&i.length){var n=i.find((function(e){var t,i;return"vide"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),r=i.find((function(e){var t,i;return"soun"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)}));if(n||r){var a,s=[],o=[];if(n){var l,u,c,d=null===(l=n.mdia)||void 0===l||null===(u=l.minf)||void 0===u?void 0:u.stbl;if(!d)return;var h=null===(c=n.mdia.mdhd)||void 0===c?void 0:c.timescale,f=d.stts,m=d.stsc,p=d.stsz,v=d.stco,g=d.stss,y=d.ctts;if(!h||!f||!m||!p||!v||!g)return;s=ql(t,h,f,m,p,v,g,y),a=s.map((function(e){return e.duration}))}if(r){var b,L,S,T=null===(b=r.mdia)||void 0===b||null===(L=b.minf)||void 0===L?void 0:L.stbl;if(!T)return;var k=null===(S=r.mdia.mdhd)||void 0===S?void 0:S.timescale,x=T.stts,R=T.stsc,w=T.stsz,E=T.stco;if(!k||!x||!R||!w||!E)return;o=ql(t,k,x,R,w,E,null,null,a)}return{videoSegments:s,audioSegments:o}}}}function ql(e,t,i,n,r,a,s,o,l){var u,c,d,h,f,m=[],p=[],v=[],g=n.entries,y=a.entries,b=r.entrySizes,L=null===s||void 0===s?void 0:s.entries,S=null===o||void 0===o?void 0:o.entries;S&&(c=[],S.forEach((function(e){for(var t=e.count,i=e.offset,n=0;n<t;n++)c.push(i)}))),L&&(d={},L.forEach((function(e){d[e-1]=!0})));var T=0,k=0,x=0,R=0,w=0,E=null===(u=g[0])||void 0===u?void 0:u.samplesPerChunk,Z=g[1]?g[1].firstChunk-1:1/0,C=0,I=-1;i.entries.forEach((function(e){var t=e.count,i=e.delta;f=i;for(var n=0;n<t;n++)h={dts:C,startTime:T,duration:f,size:b[k]||r.sampleSize,offset:y[x]+w,index:k},L&&(h.keyframe=d[k],h.keyframe?(I++,p.push([h]),v.push(h.duration)):(p[p.length-1].push(h),v[p.length-1]+=h.duration),h.gopId=I),c&&k<c.length&&(h.pts=C+c[k]),0===k&&(h.pts=0),m.push(h),T+=f,C+=i,k++,k<E?w+=h.size:(x++,w=0,x>=Z&&(R++,Z=g[R+1]?g[R+1].firstChunk-1:1/0),E+=g[R].samplesPerChunk)}));var M=m.length;if(!M||s&&!m[0].keyframe)return[];var G,X=[],_=[],P=0,D=0,W=function(e){var i;G=_[_.length-1],X.push({index:X.length,startTime:(null===(i=X[X.length-1])||void 0===i?void 0:i.endTime)||_[0].startTime/t,endTime:(G.startTime+G.duration)/t,duration:e,range:[_[0].offset,G.offset+G.size],frames:_}),P=0,_=[]};if(s)for(var V=e*t,N=0,F=p.length;N<F;N++){var A;P+=v[N],(A=_).push.apply(A,al(p[N])),N+1<F?(0===N||P>V)&&W(P/t):W(P/t)}else{l=l||[];for(var Y=l[0]||e,O=0;O<M;O++){_.push(m[O]),P+=m[O].duration;var H=P/t;(O+1>=M||H+D>=Y)&&(D+=H-Y,W(H),Y=l[X.length]||e)}}return X}function $l(e,t){var i="",n="",r=0,a=0,s=0,o=0,l=0,u=0,c=0;e.mvhd&&(l=e.mvhd.duration/e.mvhd.timescale);var d=e.trak;if(d){var h,f,m,p,v,g,y,b,L,S,T,k,x,R,w,E,Z,C=d.find((function(e){var t,i;return"vide"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),I=d.find((function(e){var t,i;return"soun"===(null===(t=e.mdia)||void 0===t||null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)})),M=null;if(C)if(M=null===(f=C.mdia)||void 0===f||null===(m=f.minf)||void 0===m||null===(p=m.stbl)||void 0===p?void 0:p.stsd.entries[0],M)if(r=M.width,a=M.height,u=null===(v=C.mdia)||void 0===v||null===(g=v.mdhd)||void 0===g?void 0:g.timescale,i=null===(y=M.avcC||M.hvcC||M.av1C)||void 0===y?void 0:y.codec,"encv"===M.type)h=null===(b=M.sinf)||void 0===b||null===(L=b.schi)||void 0===L?void 0:L.tenc.default_KID;if(I)if(M=null===(S=I.mdia)||void 0===S||null===(T=S.minf)||void 0===T||null===(k=T.stbl)||void 0===k?void 0:k.stsd.entries[0],M)if(s=M.channelCount,o=M.sampleRate,n=null===(x=M.esds)||void 0===x?void 0:x.codec,c=null===(R=I.mdia)||void 0===R||null===(w=R.mdhd)||void 0===w?void 0:w.timescale,"enca"===M.type)h=h||(null===(E=M.sinf)||void 0===E||null===(Z=E.schi)||void 0===Z?void 0:Z.tenc.default_KID);return{kid:h?h.join(""):null,videoCodec:i,audioCodec:n,width:r,height:a,videoTimescale:u,audioChannelCount:s,audioSampleRate:o,duration:l,audioTimescale:c,moov:e,isFragmentMP4:t}}}function eu(e){return"number"===typeof e&&!Number.isNaN(e)}var tu=["vid","cache"],iu=function(e){jo(i,e);var t=nl(i);function i(e){var n;Ko(this,i),n=t.call(this),zo(tl(n),"vid",""),zo(tl(n),"url",""),zo(tl(n),"meta",{}),zo(tl(n),"downloadInfo",[]),zo(tl(n),"videoSegments",[]),zo(tl(n),"audioSegments",[]),zo(tl(n),"cache",null),zo(tl(n),"_currentSegmentIndex",-1),zo(tl(n),"_currentLoadingSegmentIndex",-1),zo(tl(n),"buffer",void 0),zo(tl(n),"_error",void 0),zo(tl(n),"_transformError",(function(e){return e})),n._config=Bl(e);var r=n._config,a=r.vid,s=r.cache,o=el(r,tu);return n.cache=s||new jl,n.vid=a||o.url,n.url=o.url,o.transformError=n._transformError,n.logger=new yl("MP4Loader_"+n.vid),e.openLog&&yl.enable(),o.logger=n.logger,n._loader=new Ul(o),n._loader.on(_l.REAL_TIME_SPEED,(function(e){n.emit(_l.REAL_TIME_SPEED,e)})),n}return Bo(i,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){eu(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){if(eu(e)){var t,i,n=(null===(t=this.videoSegments[this.videoSegments.length-1])||void 0===t?void 0:t.index)||(null===(i=this.audioSegments[this.audioSegments.length-1])||void 0===i?void 0:i.index)||0;return e>=n}return!1}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:function(){var e=Ho(Yo().mark((function e(t){var i,n,r,a=arguments;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=a.length>1&&void 0!==a[1]?a[1]:t,n=a.length>2?a[2]:void 0,r=a.length>3?a[3]:void 0,e.next=5,this.reset(r);case 5:t&&(this.url=t),i&&(this.vid=i),n&&(this._config.moovEnd=n);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getOrLoadMeta",value:function(){var e=Ho(Yo().mark((function e(t){return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(t);case 3:return e.abrupt("return",this.meta);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadMetaProcess",value:function(){var e=Ho(Yo().mark((function e(t,i,n,r){var a,s,o,l,u=this;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=rl(i,2),s=a[0],o=a[1],this._error=!1,this.logger.debug("[loadMetaProcess start], range,",[s,o]),l=function(){var e=Ho(Yo().mark((function e(i,a,l){var c,d,h,f,m,p,v,g,y,b,L,S,T;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(u.meta&&null!==l&&void 0!==l&&l.range&&l.range.length>0&&l.range[1]>=o&&(a=!0,u.logger.debug("[loadMetaProcess],data done,setstate true,[",s,o,"]")),a&&null!==l&&void 0!==l&&l.range&&l.range.length>0&&l.range[1]<o&&(a=!1,u.logger.debug("[loadMetaProcess],data not done,setstate false,[",s,o,"]")),u.logger.debug("[loadMetaProcess],task,[",s,o,"], range,",l.range,",dataLen,",i?i.byteLength:void 0,", state,",a,",err,",u._error),!u._error&&i&&i.byteLength>0&&n(i,a,l),!u.meta.moov&&!u._error){e.next=6;break}return e.abrupt("return");case 6:if(!(i&&i.byteLength>0)){e.next=51;break}if(u.buffer=Hl(u.buffer,i),c=Oa.findBox(u.buffer,["moov"])[0],c){e.next=23;break}if(d=Oa.findBox(u.buffer,["mdat"])[0],!a){e.next=23;break}if(d){e.next=18;break}return u._error=!0,n(null,a,l,{err:"cannot find moov or mdat box"}),e.abrupt("return");case 18:return h=d.start+d.size,e.next=21,u.loadData([h,""],t,r);case 21:f=e.sent,f&&(c=Oa.findBox(f.data,["moov"])[0]);case 23:if(!(c&&a&&c.size>c.data.length)){e.next=27;break}return u.logger.debug("[loadMetaProcess],moov not all, range,",l.range[1],",dataLen,",u.buffer.byteLength,", state,",a),e.next=27,u.loadMetaProcess(t,[l.range[1],c.start+c.size-1],n);case 27:if(!(c&&c.size<=c.data.length)||u.meta.moov){e.next=51;break}if(m=Oa.moov(c),m){e.next=33;break}return u._error=!0,n(null,a,l,{err:"cannot parse moov box"}),e.abrupt("return");case 33:if(p=Ql(m,u._config.segmentDuration),v=function(){var e=Ho(Yo().mark((function e(i){var n,a;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Oa.findBox(u.buffer,[i])[0],!n){e.next=11;break}if(!(n.size>n.data.length)){e.next=10;break}return e.next=5,u.loadData([n.start,n.start+n.size-1],t,r);case 5:if(a=e.sent,!a){e.next=8;break}return e.abrupt("return",Oa.findBox(a.data,[i])[0]);case 8:e.next=11;break;case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=!1,p&&p.videoSegments.length&&p.audioSegments.length){e.next=41;break}return e.next=39,v("sidx");case 39:y=e.sent,y&&(b=Oa.sidx(y),b&&(p=Jl(m,b),g=!0));case 41:if(p){e.next=45;break}return u._error=!0,n(null,a,l,{err:"cannot parse segments"}),e.abrupt("return");case 45:u.meta=$l(m,g),L=p,S=L.videoSegments,T=L.audioSegments,u.videoSegments=S,u.audioSegments=T,u.logger.debug("[loadMetaProcess] moov ok"),n(void 0,a,{meta:{meta:u.meta,videoSegments:S,audioSegments:T}});case 51:case"end":return e.stop()}}),e)})));return function(t,i,n){return e.apply(this,arguments)}}(),e.next=6,this.loadData([s,o||this._config.moovEnd],t,Ao({onProgress:l},r));case 6:case"end":return e.stop()}}),e,this)})));function t(t,i,n,r){return e.apply(this,arguments)}return t}()},{key:"loadMeta",value:function(){var e=Ho(Yo().mark((function e(t,i,n){var r,a,s,o,l,u,c,d,h,f,m,p,v,g;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=[],this.logger.debug("[loadMeta start]"),e.next=4,this.loadData([0,i||this._config.moovEnd],t,n);case 4:if(a=e.sent,a){e.next=7;break}return e.abrupt("return");case 7:if(r.push(a),s=Oa.findBox(a.data,["moov"])[0],s){e.next=23;break}if(o=Oa.findBox(a.data,["mdat"])[0],o){e.next=13;break}throw new zl("cannot find moov or mdat box",a.data);case 13:return l=o.start+o.size,e.next=16,this.loadData([l],t,n);case 16:if(a=e.sent,a){e.next=19;break}return e.abrupt("return");case 19:if(r.push(a),s=Oa.findBox(a.data,["moov"],l)[0],s){e.next=23;break}throw new zl("cannot find moov box",a.data);case 23:if(!(s.size>s.data.length)){e.next=31;break}return e.next=26,this.loadData([a.data.length,s.start+s.size-1],t,n);case 26:if(a=e.sent,a){e.next=29;break}return e.abrupt("return");case 29:r.push(a),s.data=Hl(s.data,a.data);case 31:if(u=Oa.moov(s),u){e.next=34;break}throw new zl("cannot parse moov box",s.data);case 34:if(c=Ql(u,this._config.segmentDuration),c){e.next=37;break}throw new zl("cannot parse segments",s.data);case 37:return c.videoSegments.length&&c.audioSegments.length||(h=Oa.findBox(this.buffer,["moof"])[0],f=Oa.findBox(this.buffer,["sidx"])[0],h&&h.size<=h.data.length&&f&&(m=Oa.moof(h),d=Oa.sidx(f),m&&d&&(c=Jl(u,d)))),this.meta=$l(u,d),p=c,v=p.videoSegments,g=p.audioSegments,this.videoSegments=v,this.audioSegments=g,this.logger.debug("[load moov end!!!!!]"),e.abrupt("return",{meta:this.meta,videoSegments:v,audioSegments:g,responses:r});case 44:case"end":return e.stop()}}),e,this)})));function t(t,i,n){return e.apply(this,arguments)}return t}()},{key:"loadCacheMeta",value:function(e,t){var i=e.moov,n=Ql(i,this._config.segmentDuration),r=n.videoSegments,a=n.audioSegments;this.videoSegments=r,this.audioSegments=a,this._currentSegmentIndex=t,this.meta=e}},{key:"getSegmentByTime",value:function(e){var t,i;return this.videoSegments.length?(t=this.videoSegments.find((function(t){return t.startTime<=e&&t.endTime>e})),t&&(i=this.audioSegments[t.index])):i=this.audioSegments.find((function(t){return t.startTime<=e&&t.endTime>e})),{video:t,audio:i}}},{key:"loadSegmentByTime",value:function(){var e=Ho(Yo().mark((function e(t,i){var n,r,a,s,o,l=arguments;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=!(l.length>2&&void 0!==l[2])||l[2],r=l.length>3&&void 0!==l[3]?l[3]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta(i);case 5:return a=this.getSegmentByTime(t),s=a.video,o=a.audio,e.abrupt("return",this._loadSegment(s,o,i,n,r));case 7:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"loadNextSegment",value:function(){var e=Ho(Yo().mark((function e(t){var i,n,r,a,s=arguments;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=!(s.length>1&&void 0!==s[1])||s[1],n=s.length>2&&void 0!==s[2]?s[2]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta();case 5:return r=this.videoSegments[this._currentSegmentIndex+1],a=this.audioSegments[this._currentSegmentIndex+1],e.abrupt("return",this._loadSegment(r,a,t,i,n));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"preload",value:function(){var e=Ho(Yo().mark((function e(t){var i,n,r,a,s,o,l,u=this;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(!0);case 3:if(t&&!(t<0)){e.next=5;break}return e.abrupt("return");case 5:if(i=this.getSegmentByTime(t),n=i.video,r=i.audio,a=Math.max((null===n||void 0===n?void 0:n.index)||0,(null===r||void 0===r?void 0:r.index)||0),a){e.next=9;break}return e.abrupt("return");case 9:return s=this.videoSegments.slice(0,a),o=this.audioSegments.slice(0,a),l=function(){var e=Ho(Yo().mark((function e(t){return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t>a)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,u._loadSegment(s[t],o[t],!0,!1);case 4:return e.next=6,l(t+1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=14,l(0);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:function(){var e=Ho(Yo().mark((function e(){var t,i=arguments;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],t){e.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),e.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1;case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var e=Ho(Yo().mark((function e(){return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.reset();case 2:this.cache.clear();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadSegment",value:function(){var e=Ho(Yo().mark((function e(t,i,n,r,a){var s,o;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t||i){e.next=2;break}return e.abrupt("return");case 2:return s=(null===t||void 0===t?void 0:t.index)||(null===i||void 0===i?void 0:i.index)||0,this._currentLoadingSegmentIndex=s,e.prev=4,e.next=7,this.loadData([Math.min((null===t||void 0===t?void 0:t.range[0])||1/0,(null===i||void 0===i?void 0:i.range[0])||1/0),Math.max((null===t||void 0===t?void 0:t.range[1])||0,(null===i||void 0===i?void 0:i.range[1])||0)],n,a);case 7:o=e.sent;case 8:return e.prev=8,this._currentLoadingSegmentIndex=-1,e.finish(8);case 11:if(o){e.next=13;break}return e.abrupt("return");case 13:return r&&(this._currentSegmentIndex=s),o.video=t,o.audio=i,e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this,[[4,,8,11]])})));function t(t,i,n,r,a){return e.apply(this,arguments)}return t}()},{key:"loadData",value:function(){var e=Ho(Yo().mark((function e(t,i,n){var r,a,s,o;return Yo().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=this._getCacheKey(t),e.next=3,this.cache.get(r);case 3:if(a=e.sent,a){e.next=11;break}return o=n&&n.url?n.url:this.url,e.next=8,this._loader.load(o,Ao({range:t,vid:this.vid},n));case 8:s=e.sent,e.next=12;break;case 11:s={data:a,state:!0,options:{fromCache:!0,range:t,vid:this.vid}};case 12:if(s){e.next=14;break}return e.abrupt("return");case 14:return a||(s.data&&this.downloadInfo.push({startTime:s.startTime,endTime:s.endTime,size:s.data.byteLength,range:t}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)})));function t(t,i,n){return e.apply(this,arguments)}return t}()},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}]),i}(X.a),nu=lu(),ru=ou();function au(){try{return"undefined"!==typeof localStorage&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch(e){return!1}}function su(){var e="_localstorage_support_test";try{return window.localStorage.setItem(e,!0),window.localStorage.removeItem(e),!1}catch(t){return!0}}function ou(){if(nu)try{return!!window.localStorage.getItem("playerlog")}catch(e){return!1}return!1}function lu(){return au()&&!su()}function uu(e){for(var t,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];ru&&console.log&&(t=console).log.apply(t,["[logger]",Vo.nowTime(),e].concat(n))}function cu(){if(nu)try{return!!window.localStorage.getItem("playertestlog")}catch(e){return!1}return!1}cu();var du="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGUoZSx0KXt2YXIgcj1PYmplY3Qua2V5cyhlKTtpZihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgYT1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpO3QmJihhPWEuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLHQpLmVudW1lcmFibGV9KSkpLHIucHVzaC5hcHBseShyLGEpfXJldHVybiByfWZ1bmN0aW9uIHQodCl7Zm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyl7dmFyIGE9bnVsbCE9YXJndW1lbnRzW3JdP2FyZ3VtZW50c1tyXTp7fTtyJTI/ZShPYmplY3QoYSksITApLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kodCxlLGFbZV0pfSkpOk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHQsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoYSkpOmUoT2JqZWN0KGEpKS5mb3JFYWNoKChmdW5jdGlvbihlKXtPYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYSxlKSl9KSl9cmV0dXJuIHR9ZnVuY3Rpb24gcihlLHQpe2lmKCEoZSBpbnN0YW5jZW9mIHQpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGEoZSx0KXtmb3IodmFyIHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIGE9dFtyXTthLmVudW1lcmFibGU9YS5lbnVtZXJhYmxlfHwhMSxhLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gYSYmKGEud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLGsoYS5rZXkpLGEpfX1mdW5jdGlvbiBuKGUsdCxyKXtyZXR1cm4gdCYmYShlLnByb3RvdHlwZSx0KSxyJiZhKGUsciksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksZX1mdW5jdGlvbiBpKGUsdCxyKXtyZXR1cm4odD1rKHQpKWluIGU/T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOmVbdF09cixlfWZ1bmN0aW9uIHMoZSx0KXtpZigiZnVuY3Rpb24iIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTtlLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKHQmJnQucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6ZSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksdCYmdShlLHQpfWZ1bmN0aW9uIG8oZSl7cmV0dXJuKG89T2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSl9KShlKX1mdW5jdGlvbiB1KGUsdCl7cmV0dXJuKHU9T2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCk6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5fX3Byb3RvX189dCxlfSkoZSx0KX1mdW5jdGlvbiBjKCl7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBSZWZsZWN0fHwhUmVmbGVjdC5jb25zdHJ1Y3QpcmV0dXJuITE7aWYoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSlyZXR1cm4hMTtpZigiZnVuY3Rpb24iPT10eXBlb2YgUHJveHkpcmV0dXJuITA7dHJ5e3JldHVybiBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbixbXSwoZnVuY3Rpb24oKXt9KSkpLCEwfWNhdGNoKGUpe3JldHVybiExfX1mdW5jdGlvbiBsKGUsdCxyKXtyZXR1cm4obD1jKCk/UmVmbGVjdC5jb25zdHJ1Y3QuYmluZCgpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT1bbnVsbF07YS5wdXNoLmFwcGx5KGEsdCk7dmFyIG49bmV3KEZ1bmN0aW9uLmJpbmQuYXBwbHkoZSxhKSk7cmV0dXJuIHImJnUobixyLnByb3RvdHlwZSksbn0pLmFwcGx5KG51bGwsYXJndW1lbnRzKX1mdW5jdGlvbiBmKGUsdCl7aWYodCYmKCJvYmplY3QiPT10eXBlb2YgdHx8ImZ1bmN0aW9uIj09dHlwZW9mIHQpKXJldHVybiB0O2lmKHZvaWQgMCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTtyZXR1cm4gZnVuY3Rpb24oZSl7aWYodm9pZCAwPT09ZSl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiBlfShlKX1mdW5jdGlvbiBkKGUpe3ZhciB0PWMoKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcixhPW8oZSk7aWYodCl7dmFyIG49byh0aGlzKS5jb25zdHJ1Y3RvcjtyPVJlZmxlY3QuY29uc3RydWN0KGEsYXJndW1lbnRzLG4pfWVsc2Ugcj1hLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gZih0aGlzLHIpfX1mdW5jdGlvbiBoKGUsdCl7Zm9yKDshT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdCkmJm51bGwhPT0oZT1vKGUpKTspO3JldHVybiBlfWZ1bmN0aW9uIHAoKXtyZXR1cm4gcD0idW5kZWZpbmVkIiE9dHlwZW9mIFJlZmxlY3QmJlJlZmxlY3QuZ2V0P1JlZmxlY3QuZ2V0LmJpbmQoKTpmdW5jdGlvbihlLHQscil7dmFyIGE9aChlLHQpO2lmKGEpe3ZhciBuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYSx0KTtyZXR1cm4gbi5nZXQ/bi5nZXQuY2FsbChhcmd1bWVudHMubGVuZ3RoPDM/ZTpyKTpuLnZhbHVlfX0scC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZnVuY3Rpb24gdihlLHQpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBlfShlKXx8ZnVuY3Rpb24oZSx0KXt2YXIgcj1udWxsPT1lP251bGw6InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJmVbU3ltYm9sLml0ZXJhdG9yXXx8ZVsiQEBpdGVyYXRvciJdO2lmKG51bGwhPXIpe3ZhciBhLG4saSxzLG89W10sdT0hMCxjPSExO3RyeXtpZihpPShyPXIuY2FsbChlKSkubmV4dCwwPT09dCl7aWYoT2JqZWN0KHIpIT09cilyZXR1cm47dT0hMX1lbHNlIGZvcig7ISh1PShhPWkuY2FsbChyKSkuZG9uZSkmJihvLnB1c2goYS52YWx1ZSksby5sZW5ndGghPT10KTt1PSEwKTt9Y2F0Y2gobCl7Yz0hMCxuPWx9ZmluYWxseXt0cnl7aWYoIXUmJm51bGwhPXIucmV0dXJuJiYocz1yLnJldHVybigpLE9iamVjdChzKSE9PXMpKXJldHVybn1maW5hbGx5e2lmKGMpdGhyb3cgbn19cmV0dXJuIG99fShlLHQpfHxtKGUsdCl8fGZ1bmN0aW9uKCl7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiB5KGUpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBnKGUpfShlKXx8ZnVuY3Rpb24oZSl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJm51bGwhPWVbU3ltYm9sLml0ZXJhdG9yXXx8bnVsbCE9ZVsiQEBpdGVyYXRvciJdKXJldHVybiBBcnJheS5mcm9tKGUpfShlKXx8bShlKXx8ZnVuY3Rpb24oKXt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiBtKGUsdCl7aWYoZSl7aWYoInN0cmluZyI9PXR5cGVvZiBlKXJldHVybiBnKGUsdCk7dmFyIHI9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpLnNsaWNlKDgsLTEpO3JldHVybiJPYmplY3QiPT09ciYmZS5jb25zdHJ1Y3RvciYmKHI9ZS5jb25zdHJ1Y3Rvci5uYW1lKSwiTWFwIj09PXJ8fCJTZXQiPT09cj9BcnJheS5mcm9tKGUpOiJBcmd1bWVudHMiPT09cnx8L14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3Qocik/ZyhlLHQpOnZvaWQgMH19ZnVuY3Rpb24gZyhlLHQpeyhudWxsPT10fHx0PmUubGVuZ3RoKSYmKHQ9ZS5sZW5ndGgpO2Zvcih2YXIgcj0wLGE9bmV3IEFycmF5KHQpO3I8dDtyKyspYVtyXT1lW3JdO3JldHVybiBhfWZ1bmN0aW9uIGsoZSl7dmFyIHQ9ZnVuY3Rpb24oZSx0KXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiBlO3ZhciByPWVbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZih2b2lkIDAhPT1yKXt2YXIgYT1yLmNhbGwoZSx0fHwiZGVmYXVsdCIpO2lmKCJvYmplY3QiIT10eXBlb2YgYSlyZXR1cm4gYTt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpfXJldHVybigic3RyaW5nIj09PXQ/U3RyaW5nOk51bWJlcikoZSl9KGUsInN0cmluZyIpO3JldHVybiJzeW1ib2wiPT10eXBlb2YgdD90OlN0cmluZyh0KX12YXIgYj0idmlkZW8iLF89ImF1ZGlvIix3PSJtZXRhZGF0YSIseD0iYXYxIixTPSJhdmMiLEE9ImhldmMiLEQ9ImFhYyIsQj0iZzcxMTBhIixFPSJnNzExMG0iLFQ9IkxBUkdFX0FWX1NISUZUIixVPSJMQVJHRV9WSURFT19HQVAiLEM9IkxBUkdFX1ZJREVPX0dBUF9CRVRXRUVOX0NIVU5LIixQPSJMQVJHRV9BVURJT19HQVAiLEk9IkFVRElPX0ZJTExFRCIsTT0iQVVESU9fRFJPUFBFRCIsej1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSksaSh0aGlzLCJpZCIsMSksaSh0aGlzLCJ0eXBlIixiKSxpKHRoaXMsImNvZGVjVHlwZSIsUyksaSh0aGlzLCJwaWQiLC0xKSxpKHRoaXMsImh2Y0MiLHZvaWQgMCksaSh0aGlzLCJjb2RlYyIsIiIpLGkodGhpcywidGltZXNjYWxlIiwwKSxpKHRoaXMsImZvcm1hdFRpbWVzY2FsZSIsMCksaSh0aGlzLCJzZXF1ZW5jZU51bWJlciIsMCksaSh0aGlzLCJiYXNlTWVkaWFEZWNvZGVUaW1lIiwwKSxpKHRoaXMsImJhc2VEdHMiLDApLGkodGhpcywiZHVyYXRpb24iLDApLGkodGhpcywid2FybmluZ3MiLFtdKSxpKHRoaXMsInNhbXBsZXMiLFtdKSxpKHRoaXMsInBwcyIsW10pLGkodGhpcywic3BzIixbXSksaSh0aGlzLCJ2cHMiLFtdKSxpKHRoaXMsImZwc051bSIsMCksaSh0aGlzLCJmcHNEZW4iLDApLGkodGhpcywic2FyUmF0aW8iLFtdKSxpKHRoaXMsIndpZHRoIiwwKSxpKHRoaXMsImhlaWdodCIsMCksaSh0aGlzLCJuYWxVbml0U2l6ZSIsNCksaSh0aGlzLCJwcmVzZW50IiwhMSksaSh0aGlzLCJpc1ZpZGVvRW5jcnlwdGlvbiIsITEpLGkodGhpcywiaXNBdWRpb0VuY3J5cHRpb24iLCExKSxpKHRoaXMsImlzVmlkZW8iLCEwKSxpKHRoaXMsImtpZCIsbnVsbCksaSh0aGlzLCJwc3NoIixudWxsKSxpKHRoaXMsImV4dCIsdm9pZCAwKX1yZXR1cm4gbihlLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNlcXVlbmNlTnVtYmVyPXRoaXMud2lkdGg9dGhpcy5oZWlnaHQ9dGhpcy5mcHNEZW49dGhpcy5mcHNOdW09dGhpcy5kdXJhdGlvbj10aGlzLmJhc2VNZWRpYURlY29kZVRpbWU9dGhpcy50aW1lc2NhbGU9MCx0aGlzLmNvZGVjPSIiLHRoaXMucHJlc2VudD0hMSx0aGlzLnBpZD0tMSx0aGlzLnBwcz1bXSx0aGlzLnNwcz1bXSx0aGlzLnZwcz1bXSx0aGlzLnNhclJhdGlvPVtdLHRoaXMuc2FtcGxlcz1bXSx0aGlzLndhcm5pbmdzPVtdLHRoaXMuaHZjQz1udWxsfX0se2tleToiZmlyc3REdHMiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNhbXBsZXMubGVuZ3RoP3RoaXMuc2FtcGxlc1swXS5kdHM6bnVsbH19LHtrZXk6ImZpcnN0UHRzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zYW1wbGVzLmxlbmd0aD90aGlzLnNhbXBsZXNbMF0ucHRzOm51bGx9fSx7a2V5OiJzYW1wbGVzRHVyYXRpb24iLGdldDpmdW5jdGlvbigpe2lmKHRoaXMuc2FtcGxlcy5sZW5ndGg+MCl7dmFyIGU9dGhpcy5zYW1wbGVzWzBdLHQ9dGhpcy5zYW1wbGVzW3RoaXMuc2FtcGxlcy5sZW5ndGgtMV07cmV0dXJuIHQuZHRzLWUuZHRzK3QuZHVyYXRpb259cmV0dXJuIDB9fSx7a2V5OiJleGlzdCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hIS9hdjAxLy50ZXN0KHRoaXMuY29kZWMpfHwhISh0aGlzLnBwcy5sZW5ndGgmJnRoaXMuc3BzLmxlbmd0aCYmdGhpcy5jb2RlYyl9fSx7a2V5OiJoYXNTYW1wbGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLnNhbXBsZXMubGVuZ3RofX0se2tleToiaXNFbmNyeXB0aW9uIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc1ZpZGVvRW5jcnlwdGlvbn19XSksZX0oKSxPPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKSxpKHRoaXMsImlkIiwyKSxpKHRoaXMsInR5cGUiLF8pLGkodGhpcywiY29kZWNUeXBlIixEKSxpKHRoaXMsInBpZCIsLTEpLGkodGhpcywiY29kZWMiLCIiKSxpKHRoaXMsInNlcXVlbmNlTnVtYmVyIiwwKSxpKHRoaXMsInNhbXBsZUR1cmF0aW9uIiwwKSxpKHRoaXMsInRpbWVzY2FsZSIsMCksaSh0aGlzLCJmb3JtYXRUaW1lc2NhbGUiLDApLGkodGhpcywiYmFzZU1lZGlhRGVjb2RlVGltZSIsMCksaSh0aGlzLCJkdXJhdGlvbiIsMCksaSh0aGlzLCJ3YXJuaW5ncyIsW10pLGkodGhpcywic2FtcGxlcyIsW10pLGkodGhpcywiYmFzZUR0cyIsMCksaSh0aGlzLCJzYW1wbGVTaXplIiwxNiksaSh0aGlzLCJzYW1wbGVSYXRlIiwwKSxpKHRoaXMsImNoYW5uZWxDb3VudCIsMCksaSh0aGlzLCJvYmplY3RUeXBlIiwwKSxpKHRoaXMsInNhbXBsZVJhdGVJbmRleCIsMCksaSh0aGlzLCJjb25maWciLFtdKSxpKHRoaXMsInByZXNlbnQiLCExKSxpKHRoaXMsImlzVmlkZW9FbmNyeXB0aW9uIiwhMSksaSh0aGlzLCJpc0F1ZGlvRW5jcnlwdGlvbiIsITEpLGkodGhpcywia2lkIixudWxsKSxpKHRoaXMsImV4dCIsdm9pZCAwKX1yZXR1cm4gbihlLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNlcXVlbmNlTnVtYmVyPTAsdGhpcy50aW1lc2NhbGU9MCx0aGlzLnNhbXBsZUR1cmF0aW9uPTAsdGhpcy5zYW1wbGVSYXRlPTAsdGhpcy5jaGFubmVsQ291bnQ9MCx0aGlzLmJhc2VNZWRpYURlY29kZVRpbWU9MCx0aGlzLnByZXNlbnQ9ITEsdGhpcy5waWQ9LTEsdGhpcy5jb2RlYz0iIix0aGlzLnNhbXBsZXM9W10sdGhpcy5jb25maWc9W10sdGhpcy53YXJuaW5ncz1bXX19LHtrZXk6ImV4aXN0Iix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiEhKHRoaXMuc2FtcGxlUmF0ZSYmdGhpcy5jaGFubmVsQ291bnQmJnRoaXMuY29kZWMmJnRoaXMuY29kZWNUeXBlPT09RCl9fSx7a2V5OiJoYXNTYW1wbGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLnNhbXBsZXMubGVuZ3RofX0se2tleToiaXNFbmNyeXB0aW9uIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc0F1ZGlvRW5jcnlwdGlvbn19LHtrZXk6ImZpcnN0RHRzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zYW1wbGVzLmxlbmd0aD90aGlzLnNhbXBsZXNbMF0uZHRzOm51bGx9fSx7a2V5OiJmaXJzdFB0cyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2FtcGxlcy5sZW5ndGg/dGhpcy5zYW1wbGVzWzBdLnB0czpudWxsfX0se2tleToic2FtcGxlc0R1cmF0aW9uIixnZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLnNhbXBsZXMubGVuZ3RoPjApe3ZhciBlPXRoaXMuc2FtcGxlc1swXSx0PXRoaXMuc2FtcGxlc1t0aGlzLnNhbXBsZXMubGVuZ3RoLTFdO3JldHVybiB0LmR0cy1lLmR0cyt0LmR1cmF0aW9ufXJldHVybiAwfX1dKSxlfSgpLFI9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksaSh0aGlzLCJmbGFnIix7fSksaSh0aGlzLCJrZXlmcmFtZSIsITEpLGkodGhpcywiZ29wSWQiLDApLGkodGhpcywiZHVyYXRpb24iLDApLGkodGhpcywic2l6ZSIsMCksaSh0aGlzLCJ1bml0cyIsW10pLGkodGhpcywiY2hyb21hRm9ybWF0Iiw0MjApLHRoaXMub3JpZ2luUHRzPXRoaXMucHRzPXQsdGhpcy5vcmlnaW5EdHM9dGhpcy5kdHM9YSxuJiYodGhpcy51bml0cz1uKX1yZXR1cm4gbihlLFt7a2V5OiJjdHMiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnB0cy10aGlzLmR0c319LHtrZXk6InNldFRvS2V5ZnJhbWUiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5rZXlmcmFtZT0hMCx0aGlzLmZsYWcuZGVwZW5kc09uPTIsdGhpcy5mbGFnLmlzTm9uU3luY1NhbXBsZT0wfX1dKSxlfSgpLEw9bigoZnVuY3Rpb24gZSh0LGEsbixzKXtyKHRoaXMsZSksaSh0aGlzLCJkdXJhdGlvbiIsMTAyNCksaSh0aGlzLCJmbGFnIix7ZGVwZW5kc09uOjIsaXNOb25TeW5jU2FtcGxlOjB9KSxpKHRoaXMsImtleWZyYW1lIiwhMCksdGhpcy5vcmlnaW5QdHM9dGhpcy5wdHM9dGhpcy5kdHM9dCx0aGlzLmRhdGE9YSx0aGlzLnNpemU9YS5ieXRlTGVuZ3RoLHRoaXMuc2FtcGxlT2Zmc2V0PXMsbiYmKHRoaXMuZHVyYXRpb249bil9KSksVj1uKChmdW5jdGlvbiBlKHQsYSl7cih0aGlzLGUpLGkodGhpcywidGltZSIsMCksdGhpcy5kYXRhPXQsdGhpcy5vcmlnaW5QdHM9dGhpcy5wdHM9YX0pKSxGPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEpfShWKSxOPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEpfShWKSxqPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKSxpKHRoaXMsImlkIiwzKSxpKHRoaXMsInR5cGUiLHcpLGkodGhpcywidGltZXNjYWxlIiwwKSxpKHRoaXMsImZsdlNjcmlwdFNhbXBsZXMiLFtdKSxpKHRoaXMsInNlaVNhbXBsZXMiLFtdKX1yZXR1cm4gbihlLFt7a2V5OiJleGlzdCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzLmZsdlNjcmlwdFNhbXBsZXMubGVuZ3RoJiYhdGhpcy5zZWlTYW1wbGVzLmxlbmd0aHx8IXRoaXMudGltZXNjYWxlKX19LHtrZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMudGltZXNjYWxlPTAsdGhpcy5mbHZTY3JpcHRTYW1wbGVzPVtdLHRoaXMuc2VpU2FtcGxlcz1bXX19LHtrZXk6Imhhc1NhbXBsZSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzLmZsdlNjcmlwdFNhbXBsZXMubGVuZ3RoJiYhdGhpcy5zZWlTYW1wbGVzLmxlbmd0aCl9fV0pLGV9KCksRz1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCl7aWYocih0aGlzLGUpLGkodGhpcywiX2J5dGVzQXZhaWxhYmxlIix2b2lkIDApLGkodGhpcywiX2JpdHNBdmFpbGFibGUiLDApLGkodGhpcywiX3dvcmQiLDApLCF0KXRocm93IG5ldyBFcnJvcigiRXhwR29sb21iIGRhdGEgcGFyYW1zIGlzIHJlcXVpcmVkIik7dGhpcy5fZGF0YT10LHRoaXMuX2J5dGVzQXZhaWxhYmxlPXQuYnl0ZUxlbmd0aCx0aGlzLl9ieXRlc0F2YWlsYWJsZSYmdGhpcy5fbG9hZFdvcmQoKX1yZXR1cm4gbihlLFt7a2V5OiJiaXRzQXZhaWxhYmxlIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYml0c0F2YWlsYWJsZX19LHtrZXk6Il9sb2FkV29yZCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9kYXRhLmJ5dGVMZW5ndGgtdGhpcy5fYnl0ZXNBdmFpbGFibGUsdD1NYXRoLm1pbig0LHRoaXMuX2J5dGVzQXZhaWxhYmxlKTtpZigwPT09dCl0aHJvdyBuZXcgRXJyb3IoIk5vIGJ5dGVzIGF2YWlsYWJsZSIpO3ZhciByPW5ldyBVaW50OEFycmF5KDQpO3Iuc2V0KHRoaXMuX2RhdGEuc3ViYXJyYXkoZSxlK3QpKSx0aGlzLl93b3JkPW5ldyBEYXRhVmlldyhyLmJ1ZmZlcikuZ2V0VWludDMyKDApLHRoaXMuX2JpdHNBdmFpbGFibGU9OCp0LHRoaXMuX2J5dGVzQXZhaWxhYmxlLT10fX0se2tleToic2tpcEJpdHMiLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKHRoaXMuX2JpdHNBdmFpbGFibGU+ZSl0aGlzLl93b3JkPDw9ZSx0aGlzLl9iaXRzQXZhaWxhYmxlLT1lO2Vsc2V7ZS09dGhpcy5fYml0c0F2YWlsYWJsZTt2YXIgdD1NYXRoLmZsb29yKGUvOCk7ZS09OCp0LHRoaXMuX2J5dGVzQXZhaWxhYmxlLT10LHRoaXMuX2xvYWRXb3JkKCksdGhpcy5fd29yZDw8PWUsdGhpcy5fYml0c0F2YWlsYWJsZS09ZX19fSx7a2V5OiJyZWFkQml0cyIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoZT4zMil0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZWFkIG1vcmUgdGhhbiAzMiBiaXRzIik7dmFyIHQ9TWF0aC5taW4odGhpcy5fYml0c0F2YWlsYWJsZSxlKSxyPXRoaXMuX3dvcmQ+Pj4zMi10O3JldHVybiB0aGlzLl9iaXRzQXZhaWxhYmxlLT10LHRoaXMuX2JpdHNBdmFpbGFibGU+MD90aGlzLl93b3JkPDw9dDp0aGlzLl9ieXRlc0F2YWlsYWJsZT4wJiZ0aGlzLl9sb2FkV29yZCgpLCh0PWUtdCk+MCYmdGhpcy5fYml0c0F2YWlsYWJsZT9yPDx0fHRoaXMucmVhZEJpdHModCk6cn19LHtrZXk6InNraXBMWiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtmb3IoZT0wO2U8dGhpcy5fYml0c0F2YWlsYWJsZTsrK2UpaWYoMCE9KHRoaXMuX3dvcmQmMjE0NzQ4MzY0OD4+PmUpKXJldHVybiB0aGlzLl93b3JkPDw9ZSx0aGlzLl9iaXRzQXZhaWxhYmxlLT1lLGU7cmV0dXJuIHRoaXMuX2xvYWRXb3JkKCksZSt0aGlzLnNraXBMWigpfX0se2tleToic2tpcFVFRyIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNraXBCaXRzKDErdGhpcy5za2lwTFooKSl9fSx7a2V5OiJyZWFkVUVHIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuc2tpcExaKCk7cmV0dXJuIHRoaXMucmVhZEJpdHMoZSsxKS0xfX0se2tleToicmVhZEVHIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMucmVhZFVFRygpO3JldHVybiAxJmU/MStlPj4+MTotMSooZT4+PjEpfX0se2tleToicmVhZEJvb2wiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIDE9PT10aGlzLnJlYWRCaXRzKDEpfX0se2tleToicmVhZFVCeXRlIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnJlYWRCaXRzKDgpfX0se2tleToic2tpcFNjYWxpbmdMaXN0Iix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9OCxyPTgsYT0wO2E8ZTthKyspMCE9PXImJihyPSh0K3RoaXMucmVhZEVHKCkrMjU2KSUyNTYpLHQ9MD09PXI/dDpyfX1dKSxlfSgpLEg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQpe3IodGhpcyxlKSx0aGlzLm5hbWU9dHx8IiIsdGhpcy5fcHJlZml4PSJbIi5jb25jYXQodGhpcy5uYW1lLCJdIil9cmV0dXJuIG4oZSxbe2tleToid2FybiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkud2Fybi5hcHBseSh0LFt0aGlzLl9wcmVmaXhdLmNvbmNhdChhKSl9fX1dLFt7a2V5OiJlbmFibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMX19LHtrZXk6ImRpc2FibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMH19XSksZX0oKTtpKEgsImRpc2FibGVkIiwhMCk7dmFyIEs9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToiZGVjb2RlIix2YWx1ZTpmdW5jdGlvbih0KXtmb3IodmFyIHI9W10sYT10LG49MCxpPXQubGVuZ3RoO248aTspaWYoYVtuXTwxMjgpci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYVtuXSkpLCsrbjtlbHNle2lmKGFbbl08MTkyKTtlbHNlIGlmKGFbbl08MjI0KXtpZihlLl9jaGVja0NvbnRpbnVhdGlvbihhLG4sMSkpe3ZhciBzPSgzMSZhW25dKTw8Nnw2MyZhW24rMV07aWYocz49MTI4KXtyLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSg2NTUzNSZzKSksbis9Mjtjb250aW51ZX19fWVsc2UgaWYoYVtuXTwyNDApe2lmKGUuX2NoZWNrQ29udGludWF0aW9uKGEsbiwyKSl7dmFyIG89KDE1JmFbbl0pPDwxMnwoNjMmYVtuKzFdKTw8Nnw2MyZhW24rMl07aWYobz49MjA0OCYmNTUyOTYhPSg2MzQ4OCZvKSl7ci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoNjU1MzUmbykpLG4rPTM7Y29udGludWV9fX1lbHNlIGlmKGFbbl08MjQ4JiZlLl9jaGVja0NvbnRpbnVhdGlvbihhLG4sMykpe3ZhciB1PSg3JmFbbl0pPDwxOHwoNjMmYVtuKzFdKTw8MTJ8KDYzJmFbbisyXSk8PDZ8NjMmYVtuKzNdO2lmKHU+NjU1MzYmJnU8MTExNDExMil7dS09NjU1MzYsci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUodT4+PjEwfDU1Mjk2KSksci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoMTAyMyZ1fDU2MzIwKSksbis9NDtjb250aW51ZX19ci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoNjU1MzMpKSwrK259cmV0dXJuIHIuam9pbigiIil9fSx7a2V5OiJfY2hlY2tDb250aW51YXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT1lO2lmKHQrcjxhLmxlbmd0aCl7Zm9yKDtyLS07KWlmKDEyOCE9KDE5MiZhWysrdF0pKXJldHVybiExO3JldHVybiEwfXJldHVybiExfX1dKSxlfSgpLHE9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3csVz1xJiZuYXZpZ2F0b3IudXNlckFnZW50LnRvTG9jYWxlTG93ZXJDYXNlKCksWD1xJiYvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvLnRlc3QoVyksWT1xJiZXLmluY2x1ZGVzKCJmaXJlZm94IiksWj1xJiZXLmluY2x1ZGVzKCJhbmRyb2lkIik7ZnVuY3Rpb24gUSgpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHQ9bmV3IEFycmF5KGUpLHI9MDtyPGU7cisrKXRbcl09YXJndW1lbnRzW3JdO3Q9dC5maWx0ZXIoQm9vbGVhbik7dmFyIGE9bmV3IFVpbnQ4QXJyYXkodC5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCkpLG49MDtyZXR1cm4gdC5mb3JFYWNoKChmdW5jdGlvbihlKXthLnNldChlLG4pLG4rPWUuYnl0ZUxlbmd0aH0pKSxhfXZhciBKPU1hdGgucG93KDIsMzIpO2Z1bmN0aW9uICQoZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjA7cmV0dXJuKGVbdF08PDgpKyhlW3QrMV18fDApfWZ1bmN0aW9uIGVlKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowO3JldHVybihlW3RdPDwyND4+PjApKyhlW3QrMV08PDE2KSsoZVt0KzJdPDw4KSsoZVt0KzNdfHwwKX1mdW5jdGlvbiB0ZShlKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MDtyZXR1cm4gZWUoZSx0KSpKK2VlKGUsdCs0KX1mdW5jdGlvbiByZShlKXtmb3IodmFyIHQscj0iYXZjMS4iLGE9MDthPDM7YSsrKSh0PWVbYV0udG9TdHJpbmcoMTYpKS5sZW5ndGg8MiYmKHQ9IjAiLmNvbmNhdCh0KSkscis9dDtyZXR1cm4gcn1mdW5jdGlvbiBhZShlKXt2YXIgdD0iIjtpZihlLmZvckVhY2goKGZ1bmN0aW9uKGUpe3QrPWZ1bmN0aW9uKGUpe3JldHVybigiMCIrTnVtYmVyKGUpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpLnRvVXBwZXJDYXNlKCl9KGUpfSkpLHQubGVuZ3RoPD0zMilmb3IodmFyIHI9MzItdC5sZW5ndGgsYT0wO2E8cjthKyspdCs9IjAiO3JldHVybiB0fWZ1bmN0aW9uIG5lKGUpe2lmKCFBcnJheS5pc0FycmF5KGUpKXtmb3IodmFyIHQ9W10scj0iIixhPTA7YTxlLmxlbmd0aDthKyspYSUyJiYocj1lW2EtMV0rZVthXSx0LnB1c2gocGFyc2VJbnQociwxNikpLHI9IiIpO3JldHVybiB0fXJldHVybiBlLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIHBhcnNlSW50KGUsMTYpfSkpfWZ1bmN0aW9uIGllKGUsdCl7cmV0dXJuIE51bWJlcihlKyIuIit0KX12YXIgc2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToicGFyc2VBbm5leEIiLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPTIsYT0wO251bGwhPT1lW3JdJiZ2b2lkIDAhPT1lW3JdJiYxIT09ZVtyXTspcisrO2lmKChhPSsrcisyKT49dClyZXR1cm5bXTtmb3IodmFyIG49W107YTx0Oylzd2l0Y2goZVthXSl7Y2FzZSAwOmlmKDAhPT1lW2EtMV0pe2ErPTI7YnJlYWt9aWYoMCE9PWVbYS0yXSl7YSsrO2JyZWFrfXIhPT1hLTImJm4ucHVzaChlLnN1YmFycmF5KHIsYS0yKSk7ZG97YSsrfXdoaWxlKDEhPT1lW2FdJiZhPHQpO2E9KHI9YSsxKSsyO2JyZWFrO2Nhc2UgMTppZigwIT09ZVthLTFdfHwwIT09ZVthLTJdKXthKz0zO2JyZWFrfXIhPT1hLTImJm4ucHVzaChlLnN1YmFycmF5KHIsYS0yKSksYT0ocj1hKzEpKzI7YnJlYWs7ZGVmYXVsdDphKz0zfXJldHVybiByPHQmJm4ucHVzaChlLnN1YmFycmF5KHIpKSxufX0se2tleToicGFyc2VBdmNDIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06NDtpZighKGUubGVuZ3RoPDQpKXtmb3IodmFyIHIsYT1lLmxlbmd0aCxuPVtdLGk9MDtpK3Q8YTspaWYocj1lZShlLGkpLDM9PT10JiYocj4+Pj04KSxpKz10LHIpe2lmKGkrcj5hKWJyZWFrO24ucHVzaChlLnN1YmFycmF5KGksaStyKSksaSs9cn1yZXR1cm4gbn19fSx7a2V5OiJwYXJzZVNFSSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZS5sZW5ndGgsYT10PzI6MSxuPTAsaT0wLHM9IiI7MjU1PT09ZVthXTspbis9MjU1LGErKztmb3Iobis9ZVthKytdOzI1NT09PWVbYV07KWkrPTI1NSxhKys7aWYoaSs9ZVthKytdLDU9PT1uJiZyPmErMTYpZm9yKHZhciBvPTA7bzwxNjtvKyspcys9ZVthXS50b1N0cmluZygxNiksYSsrO3JldHVybntwYXlsb2FkOmUuc3ViYXJyYXkoYSxhK2kpLHR5cGU6bixzaXplOmksdXVpZDpzfX19LHtrZXk6InJlbW92ZUVQQiIsdmFsdWU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUuYnl0ZUxlbmd0aCxyPVtdLGE9MTthPHQtMjspMD09PWVbYV0mJjA9PT1lW2ErMV0mJjM9PT1lW2ErMl0/KHIucHVzaChhKzIpLGErPTIpOmErKztpZighci5sZW5ndGgpcmV0dXJuIGU7dmFyIG49dC1yLmxlbmd0aCxpPW5ldyBVaW50OEFycmF5KG4pLHM9MDtmb3IoYT0wO2E8bjtzKyssYSsrKXM9PT1yWzBdJiYocysrLHIuc2hpZnQoKSksaVthXT1lW3NdO3JldHVybiBpfX1dKSxlfSgpLG9lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKX1yZXR1cm4gbihlLG51bGwsW3trZXk6InBhcnNlQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQiLHZhbHVlOmZ1bmN0aW9uKHQpe2lmKCEodC5sZW5ndGg8Nykpe2Zvcih2YXIgcixhLG49MSsoMyZ0WzRdKSxpPVtdLHM9W10sbz02LHU9MzEmdFs1XSxjPTA7Yzx1O2MrKylpZihhPXRbb108PDh8dFtvKzFdLG8rPTIsYSl7dmFyIGw9dC5zdWJhcnJheShvLG8rYSk7bys9YSxpLnB1c2gobCkscnx8KHI9ZS5wYXJzZVNQUyhzZS5yZW1vdmVFUEIobCkpKX12YXIgZixkPXRbb107bysrO2Zvcih2YXIgaD0wO2g8ZDtoKyspZj10W29dPDw4fHRbbysxXSxvKz0yLGYmJihzLnB1c2godC5zdWJhcnJheShvLG8rZikpLG8rPWYpO3JldHVybntzcHM6cixzcHNBcnI6aSxwcHNBcnI6cyxuYWxVbml0U2l6ZTpufX19fSx7a2V5OiJwYXJzZVNQUyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IEcoZSk7dC5yZWFkVUJ5dGUoKTt2YXIgcj10LnJlYWRVQnl0ZSgpLGE9dC5yZWFkVUJ5dGUoKSxuPXQucmVhZFVCeXRlKCk7dC5za2lwVUVHKCk7dmFyIGk9NDIwO2lmKDEwMD09PXJ8fDExMD09PXJ8fDEyMj09PXJ8fDI0ND09PXJ8fDQ0PT09cnx8ODM9PT1yfHw4Nj09PXJ8fDExOD09PXJ8fDEyOD09PXJ8fDEzOD09PXJ8fDE0ND09PXIpe3ZhciBzPXQucmVhZFVFRygpO2lmKHM8PTMmJihpPVswLDQyMCw0MjIsNDQ0XVtzXSksMz09PXMmJnQuc2tpcEJpdHMoMSksdC5za2lwVUVHKCksdC5za2lwVUVHKCksdC5za2lwQml0cygxKSx0LnJlYWRCb29sKCkpZm9yKHZhciBvPTMhPT1zPzg6MTIsdT0wO3U8bzt1KyspdC5yZWFkQm9vbCgpJiYodTw2P3Quc2tpcFNjYWxpbmdMaXN0KDE2KTp0LnNraXBTY2FsaW5nTGlzdCg2NCkpfXQuc2tpcFVFRygpO3ZhciBjPXQucmVhZFVFRygpO2lmKDA9PT1jKXQucmVhZFVFRygpO2Vsc2UgaWYoMT09PWMpe3Quc2tpcEJpdHMoMSksdC5za2lwVUVHKCksdC5za2lwVUVHKCk7Zm9yKHZhciBsPXQucmVhZFVFRygpLGY9MDtmPGw7ZisrKXQuc2tpcFVFRygpfXQuc2tpcFVFRygpLHQuc2tpcEJpdHMoMSk7dmFyIGQ9dC5yZWFkVUVHKCksaD10LnJlYWRVRUcoKSxwPXQucmVhZEJpdHMoMSk7MD09PXAmJnQuc2tpcEJpdHMoMSksdC5za2lwQml0cygxKTt2YXIgdix5LG0sZyxrLGI9MCxfPTAsdz0wLHg9MDtpZih0LnJlYWRCb29sKCkmJihiPXQucmVhZFVFRygpLF89dC5yZWFkVUVHKCksdz10LnJlYWRVRUcoKSx4PXQucmVhZFVFRygpKSx0LnJlYWRCb29sKCkpe2lmKHQucmVhZEJvb2woKSlzd2l0Y2godC5yZWFkVUJ5dGUoKSl7Y2FzZSAxOnY9WzEsMV07YnJlYWs7Y2FzZSAyOnY9WzEyLDExXTticmVhaztjYXNlIDM6dj1bMTAsMTFdO2JyZWFrO2Nhc2UgNDp2PVsxNiwxMV07YnJlYWs7Y2FzZSA1OnY9WzQwLDMzXTticmVhaztjYXNlIDY6dj1bMjQsMTFdO2JyZWFrO2Nhc2UgNzp2PVsyMCwxMV07YnJlYWs7Y2FzZSA4OnY9WzMyLDExXTticmVhaztjYXNlIDk6dj1bODAsMzNdO2JyZWFrO2Nhc2UgMTA6dj1bMTgsMTFdO2JyZWFrO2Nhc2UgMTE6dj1bMTUsMTFdO2JyZWFrO2Nhc2UgMTI6dj1bNjQsMzNdO2JyZWFrO2Nhc2UgMTM6dj1bMTYwLDk5XTticmVhaztjYXNlIDE0OnY9WzQsM107YnJlYWs7Y2FzZSAxNTp2PVszLDJdO2JyZWFrO2Nhc2UgMTY6dj1bMiwxXTticmVhaztjYXNlIDI1NTp2PVt0LnJlYWRVQnl0ZSgpPDw4fHQucmVhZFVCeXRlKCksdC5yZWFkVUJ5dGUoKTw8OHx0LnJlYWRVQnl0ZSgpXX1pZih0LnJlYWRCb29sKCkmJnQucmVhZEJvb2woKSx0LnJlYWRCb29sKCkmJih0LnJlYWRCaXRzKDQpLHQucmVhZEJvb2woKSYmdC5yZWFkQml0cygyNCkpLHQucmVhZEJvb2woKSYmKHQucmVhZFVFRygpLHQucmVhZFVFRygpKSx0LnJlYWRCb29sKCkpe3ZhciBTPXQucmVhZEJpdHMoMzIpLEE9dC5yZWFkQml0cygzMik7eT10LnJlYWRCb29sKCksaz0obT1BKS8oZz0yKlMpfX1yZXR1cm57Y29kZWM6cmUoZS5zdWJhcnJheSgxLDQpKSxwcm9maWxlSWRjOnIscHJvZmlsZUNvbXBhdGliaWxpdHk6YSxsZXZlbElkYzpuLGNocm9tYUZvcm1hdDppLHdpZHRoOk1hdGguY2VpbCgxNiooZCsxKS0yKihiK18pKSxoZWlnaHQ6KDItcCkqKGgrMSkqMTYtKHA/Mjo0KSoodyt4KSxzYXJSYXRpbzp2LGZwc051bTptLGZwc0RlbjpnLGZwczprLGZpeGVkRnJhbWU6eX19fV0pLGV9KCksdWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToiZ2V0UmF0ZUluZGV4QnlSYXRlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5GUkVRLmluZGV4T2YodCl9fSx7a2V5OiJwYXJzZUFEVFMiLHZhbHVlOmZ1bmN0aW9uKHQscil7Zm9yKHZhciBhPXQubGVuZ3RoLG49MDtuKzI8YSYmKDI1NSE9PXRbbl18fDI0MCE9KDI0NiZ0W24rMV0pKTspbisrO2lmKCEobj49YSkpe3ZhciBpPW4scz1bXSxvPSg2MCZ0W24rMl0pPj4+Mix1PWUuRlJFUVtvXTtpZighdSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc2FtcGxpbmcgaW5kZXg6ICIuY29uY2F0KG8pKTtmb3IodmFyIGMsbCxmPTErKCgxOTImdFtuKzJdKT4+PjYpLGQ9KDEmdFtuKzJdKTw8MnwoMTkyJnRbbiszXSk+Pj42LGg9ZS5fZ2V0Q29uZmlnKG8sZCxmKSxwPWguY29uZmlnLHY9aC5jb2RlYyx5PTAsbT1lLmdldEZyYW1lRHVyYXRpb24odSk7bis3PGE7KWlmKDI1NT09PXRbbl0mJjI0MD09KDI0NiZ0W24rMV0pKXtpZighKGw9KDMmdFtuKzNdKTw8MTF8dFtuKzRdPDwzfCgyMjQmdFtuKzVdKT4+NSl8fGEtbjxsKWJyZWFrO2M9MiooMSZ+dFtuKzFdKSxzLnB1c2goe3B0czpyK3kqbSxkYXRhOnQuc3ViYXJyYXkobis3K2MsbitsKX0pLHkrKyxuKz1sfWVsc2UgbisrO3JldHVybntza2lwOmkscmVtYWluaW5nOm4+PWE/dm9pZCAwOnQuc3ViYXJyYXkobiksZnJhbWVzOnMsc2FtcGxpbmdGcmVxdWVuY3lJbmRleDpvLHNhbXBsZVJhdGU6dSxvYmplY3RUeXBlOmYsY2hhbm5lbENvdW50OmQsY29kZWM6dixjb25maWc6cCxvcmlnaW5Db2RlYzoibXA0YS40MC4iLmNvbmNhdChmKX19fX0se2tleToicGFyc2VBdWRpb1NwZWNpZmljQ29uZmlnIix2YWx1ZTpmdW5jdGlvbih0KXtpZih0Lmxlbmd0aCl7dmFyIHI9dFswXT4+PjMsYT0oNyZ0WzBdKTw8MXx0WzFdPj4+NyxuPSgxMjAmdFsxXSk+Pj4zLGk9ZS5GUkVRW2FdO2lmKGkpe3ZhciBzPWUuX2dldENvbmZpZyhhLG4scik7cmV0dXJue3NhbXBsaW5nRnJlcXVlbmN5SW5kZXg6YSxzYW1wbGVSYXRlOmksb2JqZWN0VHlwZTpyLGNoYW5uZWxDb3VudDpuLGNvbmZpZzpzLmNvbmZpZyxjb2RlYzpzLmNvZGVjLG9yaWdpbkNvZGVjOiJtcDRhLjQwLiIuY29uY2F0KHIpfX19fX0se2tleToiZ2V0RnJhbWVEdXJhdGlvbiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjllNDtyZXR1cm4gMTAyNCp0L2V9fSx7a2V5OiJfZ2V0Q29uZmlnIix2YWx1ZTpmdW5jdGlvbihlLHQscil7dmFyIGEsbixpPVtdO3JldHVybiBZP2U+PTY/KGE9NSxuPWUtMyk6KGE9MixuPWUpOlo/KGE9MixuPWUpOihhPTI9PT1yfHw1PT09cj9yOjUsbj1lLGU+PTY/bj1lLTM6MT09PXQmJihhPTIsbj1lKSksaVswXT1hPDwzLGlbMF18PSgxNCZlKT4+MSxpWzFdPSgxJmUpPDw3LGlbMV18PXQ8PDMsNT09PWEmJihpWzFdfD0oMTQmbik+PjEsaVsyXT0oMSZuKTw8NyxpWzJdfD04LGlbM109MCkse2NvbmZpZzppLGNvZGVjOiJtcDRhLjQwLiIuY29uY2F0KGEpfX19LHtrZXk6ImdldFNpbGVudEZyYW1lIix2YWx1ZTpmdW5jdGlvbihlLHQpe2lmKCJtcDRhLjQwLjIiPT09ZSl7aWYoMT09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzNSwxMjhdKTtpZigyPT09dClyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzMzLDAsNzMsMTQ0LDIsMjUsMCwzNSwxMjhdKTtpZigzPT09dClyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzAsMjAwLDAsMTI4LDMyLDEzMiwxLDM4LDY0LDgsMTAwLDAsMTQyXSk7aWYoND09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEyOCw0NCwxMjgsOCwyLDU2XSk7aWYoNT09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEzMCw0OCw0LDE1MywwLDMzLDE0NCwyLDU2XSk7aWYoNj09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEzMCw0OCw0LDE1MywwLDMzLDE0NCwyLDAsMTc4LDAsMzIsOCwyMjRdKX1lbHNle2lmKDE9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMSw2NCwzNCwxMjgsMTYzLDc4LDIzMCwxMjgsMTg2LDgsMCwwLDAsMjgsNiwyNDEsMTkzLDEwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDk0XSk7aWYoMj09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFsxLDY0LDM0LDEyOCwxNjMsOTQsMjMwLDEyOCwxODYsOCwwLDAsMCwwLDE0OSwwLDYsMjQxLDE2MSwxMCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5NF0pO2lmKDM9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMSw2NCwzNCwxMjgsMTYzLDk0LDIzMCwxMjgsMTg2LDgsMCwwLDAsMCwxNDksMCw2LDI0MSwxNjEsMTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTRdKX19fV0pLGV9KCk7aSh1ZSwiRlJFUSIsWzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdKTt2YXIgY2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToicGFyc2VIRVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fTtpZighKHQubGVuZ3RoPDIzKSl7cj1yfHx7fTtmb3IodmFyIGEsbixpLHMsbyx1PTErKDMmdFsyMV0pLGM9W10sbD1bXSxmPVtdLGQ9MjMsaD10WzIyXSxwPTA7cDxoO3ArKyl7aT02MyZ0W2RdLHM9dFtkKzFdPDw4fHRbZCsyXSxkKz0zO2Zvcih2YXIgdj0wO3Y8czt2KyspaWYobz10W2RdPDw4fHRbZCsxXSxkKz0yLG8pe3N3aXRjaChpKXtjYXNlIDMyOnZhciB5PXQuc3ViYXJyYXkoZCxkK28pO2F8fChhPWUucGFyc2VWUFMoc2UucmVtb3ZlRVBCKHkpLHIpKSxmLnB1c2goeSk7YnJlYWs7Y2FzZSAzMzp2YXIgbT10LnN1YmFycmF5KGQsZCtvKTtufHwobj1lLnBhcnNlU1BTKHNlLnJlbW92ZUVQQihtKSxyKSksYy5wdXNoKG0pO2JyZWFrO2Nhc2UgMzQ6bC5wdXNoKHQuc3ViYXJyYXkoZCxkK28pKX1kKz1vfX1yZXR1cm57aHZjQzpyLHNwczpuLHNwc0FycjpjLHBwc0FycjpsLHZwc0FycjpmLG5hbFVuaXRTaXplOnV9fX19LHtrZXk6InBhcnNlVlBTIix2YWx1ZTpmdW5jdGlvbih0LHIpe3I9cnx8e307dmFyIGE9bmV3IEcodCk7YS5yZWFkVUJ5dGUoKSxhLnJlYWRVQnl0ZSgpLGEucmVhZEJpdHMoMTIpO3ZhciBuPWEucmVhZEJpdHMoMyk7cmV0dXJuIHIubnVtVGVtcG9yYWxMYXllcnM9TWF0aC5tYXgoci5udW1UZW1wb3JhbExheWVyc3x8MCxuKzEpLGEucmVhZEJpdHMoMTcpLGUuX3BhcnNlUHJvZmlsZVRpZXJMZXZlbChhLG4scikscn19LHtrZXk6InBhcnNlU1BTIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e307cj1yfHx7fTt2YXIgYT1uZXcgRyh0KTthLnJlYWRVQnl0ZSgpLGEucmVhZFVCeXRlKCksYS5yZWFkQml0cyg0KTt2YXIgbj1hLnJlYWRCaXRzKDMpO3IubnVtVGVtcG9yYWxMYXllcnM9TWF0aC5tYXgobisxLHIubnVtVGVtcG9yYWxMYXllcnN8fDApLHIudGVtcG9yYWxJZE5lc3RlZD1hLnJlYWRCaXRzKDEpLGUuX3BhcnNlUHJvZmlsZVRpZXJMZXZlbChhLG4sciksYS5yZWFkVUVHKCk7dmFyIGk9ci5jaHJvbWFGb3JtYXRJZGM9YS5yZWFkVUVHKCkscz00MjA7aTw9MyYmKHM9WzAsNDIwLDQyMiw0NDRdW2ldKTt2YXIgbz0wOzM9PT1pJiYobz1hLnJlYWRCaXRzKDEpKTt2YXIgdSxjLGwsZixkPWEucmVhZFVFRygpLGg9YS5yZWFkVUVHKCkscD1hLnJlYWRCaXRzKDEpO2lmKDE9PT1wJiYodT1hLnJlYWRVRUcoKSxjPWEucmVhZFVFRygpLGw9YS5yZWFkVUVHKCksZj1hLnJlYWRVRUcoKSksci5iaXREZXB0aEx1bWFNaW51czg9YS5yZWFkVUVHKCksci5iaXREZXB0aENocm9tYU1pbnVzOD1hLnJlYWRVRUcoKSwxPT09cCl7dmFyIHY9MSE9PWkmJjIhPT1pfHwwIT09bz8xOjIseT0xPT09aSYmMD09PW8/MjoxO2QtPXYqKGMrdSksaC09eSooZitsKX1yZXR1cm57Y29kZWM6ImhldjEuMS42Lkw5My5CMCIsd2lkdGg6ZCxoZWlnaHQ6aCxjaHJvbWFGb3JtYXQ6cyxodmNDOnJ9fX0se2tleToiX3BhcnNlUHJvZmlsZVRpZXJMZXZlbCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBhPXIuZ2VuZXJhbFRpZXJGbGFnfHwwO3IuZ2VuZXJhbFByb2ZpbGVTcGFjZT1lLnJlYWRCaXRzKDIpLHIuZ2VuZXJhbFRpZXJGbGFnPU1hdGgubWF4KGUucmVhZEJpdHMoMSksYSksci5nZW5lcmFsUHJvZmlsZUlkYz1NYXRoLm1heChlLnJlYWRCaXRzKDUpLHIuZ2VuZXJhbFByb2ZpbGVJZGN8fDApLHIuZ2VuZXJhbFByb2ZpbGVDb21wYXRpYmlsaXR5RmxhZ3M9ZS5yZWFkQml0cygzMiksci5nZW5lcmFsQ29uc3RyYWludEluZGljYXRvckZsYWdzPVtlLnJlYWRCaXRzKDgpLGUucmVhZEJpdHMoOCksZS5yZWFkQml0cyg4KSxlLnJlYWRCaXRzKDgpLGUucmVhZEJpdHMoOCksZS5yZWFkQml0cyg4KV07dmFyIG49ZS5yZWFkQml0cyg4KTthPHIuZ2VuZXJhbFRpZXJGbGFnP3IuZ2VuZXJhbExldmVsSWRjPW46ci5nZW5lcmFsTGV2ZWxJZGM9TWF0aC5tYXgobixyLmdlbmVyYWxMZXZlbElkY3x8MCk7dmFyIGk9W10scz1bXTtpZih0PmUuYml0c0F2YWlsYWJsZSl0aHJvdyBuZXcgRXJyb3IoIm1heFN1YkxheWVyc01pbnVzIGluYXZsaWQgc2l6ZSAiLmNvbmNhdCh0KSk7Zm9yKHZhciBvPTA7bzx0O28rKylpW29dPWUucmVhZEJpdHMoMSksc1tvXT1lLnJlYWRCaXRzKDEpO3Q+MCYmZS5yZWFkQml0cygyKig4LXQpKTtmb3IodmFyIHU9MDt1PHQ7dSsrKTAhPT1pW3VdJiYoZS5yZWFkQml0cygyKSxlLnJlYWRCaXRzKDEpLGUucmVhZEJpdHMoNSksZS5yZWFkQml0cygxNiksZS5yZWFkQml0cygxNiksZS5yZWFkQml0cyg0KSxlLnJlYWRCaXRzKDE2KSxlLnJlYWRCaXRzKDE2KSxlLnJlYWRCaXRzKDEyKSksMCE9PXNbdV0mJmUucmVhZEJpdHMoOCl9fV0pLGV9KCksbGU9MWUzLGZlPTVlMyxkZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxhLG4pe3IodGhpcyxlKSx0aGlzLnZpZGVvVHJhY2s9dCx0aGlzLmF1ZGlvVHJhY2s9YSx0aGlzLm1ldGFkYXRhVHJhY2s9bix0aGlzLl9iYXNlRHRzPS0xLHRoaXMuX2Jhc2VEdHNJbml0ZWQ9ITEsdGhpcy5fYXVkaW9OZXh0UHRzPXZvaWQgMCx0aGlzLl92aWRlb05leHREdHM9dm9pZCAwLHRoaXMuX2F1ZGlvVGltZXN0YW1wQnJlYWs9MCx0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPTAsdGhpcy5fbGFzdFZpZGVvRHVyYXRpb249MCx0aGlzLl9rZXlGcmFtZUluTmV4dENodW5rPSExLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkdhcERvdD0tMS8wLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbk92ZXJsYXBEb3Q9LTEvMCx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25MYXJnZUdhcERvdD0tMS8wLHRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkxhcmdlR2FwRG90PS0xLzAsdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uQ2h1bmtGaXJzdER0c0RvdD0tMS8wfXJldHVybiBuKGUsW3trZXk6ImZpeCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOjAscj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXSYmYXJndW1lbnRzWzFdLGE9IShhcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXSl8fGFyZ3VtZW50c1syXTt0PU1hdGgucm91bmQoMWUzKnQpO3ZhciBuPXRoaXMudmlkZW9UcmFjayxpPXRoaXMuYXVkaW9UcmFjazshciYmYXx8KHRoaXMuX3ZpZGVvTGFzdFNhbXBsZT1udWxsLHRoaXMuX2F1ZGlvTmV4dFB0cz12b2lkIDAsdGhpcy5fdmlkZW9OZXh0RHRzPXZvaWQgMCx0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrPTAsdGhpcy5fdmlkZW9UaW1lc3RhbXBCcmVhaz0wLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkdhcERvdD0tMS8wLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbk92ZXJsYXBEb3Q9LTEvMCx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25MYXJnZUdhcERvdD0tMS8wLHRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkxhcmdlR2FwRG90PS0xLzAsdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uQ2h1bmtGaXJzdER0c0RvdD0tMS8wKSxyJiYhYSYmKHRoaXMuX2Jhc2VEdHNJbml0ZWQ9ITEpLHRoaXMuX2Jhc2VEdHNJbml0ZWR8fHRoaXMuX2NhbGN1bGF0ZUJhc2VEdHMoaSxuKSwhYSYmdCYmKHRoaXMuX2F1ZGlvTmV4dFB0cz10aGlzLl92aWRlb05leHREdHM9dCk7dmFyIHM9dGhpcy5fYmFzZUR0c0luaXRlZCYmKHRoaXMuX3ZpZGVvVGltZXN0YW1wQnJlYWt8fCF0aGlzLnZpZGVvVHJhY2suZXhpc3QoKSkmJih0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrfHwhdGhpcy5hdWRpb1RyYWNrLmV4aXN0KCkpO2lmKHMmJnRoaXMuX3Jlc2V0QmFzZUR0c1doZW5TdHJlYW1CcmVha2VkKCksdGhpcy5fZml4QXVkaW8oaSksdGhpcy5fa2V5RnJhbWVJbk5leHRDaHVuaz0hMSx0aGlzLl9maXhWaWRlbyhuKSx0aGlzLm1ldGFkYXRhVHJhY2suZXhpc3QoKSl7dmFyIG89dGhpcy5tZXRhZGF0YVRyYWNrLnRpbWVzY2FsZTt0aGlzLm1ldGFkYXRhVHJhY2suc2VpU2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbih0KXt0LnB0cz10Lm9yaWdpblB0cy1lLl9iYXNlRHRzLHQudGltZT1NYXRoLm1heCgwLHQucHRzKS9vfSkpLHRoaXMubWV0YWRhdGFUcmFjay5mbHZTY3JpcHRTYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQpe3QucHRzPXQub3JpZ2luUHRzLWUuX2Jhc2VEdHMsdC50aW1lPU1hdGgubWF4KDAsdC5wdHMpL299KSl9bi5zYW1wbGVzLmxlbmd0aCYmKG4uYmFzZU1lZGlhRGVjb2RlVGltZT1uLnNhbXBsZXNbMF0uZHRzKSxpLnNhbXBsZXMubGVuZ3RoJiYoaS5iYXNlTWVkaWFEZWNvZGVUaW1lPWkuc2FtcGxlc1swXS5wdHMqaS50aW1lc2NhbGUvMWUzKX19LHtrZXk6Il9maXhWaWRlbyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxyPWUuc2FtcGxlcztpZihyLmxlbmd0aCl7dmFyIGE7aWYoci5mb3JFYWNoKChmdW5jdGlvbihlKXtlLmR0cy09dC5fYmFzZUR0cyxlLnB0cy09dC5fYmFzZUR0cyxlLmtleWZyYW1lJiYodC5fa2V5RnJhbWVJbk5leHRDaHVuaz0hMCl9KSksZS5mcHNOdW0mJmUuZnBzRGVuKWE9ZS50aW1lc2NhbGUqKGUuZnBzRGVuL2UuZnBzTnVtKTtlbHNlIGlmKGUubGVuZ3RoPjEpe3ZhciBuPWUuc2FtcGxlc1swXSxpPWUuc2FtcGxlc1tyLmxlbmd0aC0xXTthPU1hdGguZmxvb3IoKGkuZHRzLW4uZHRzKS8oci5sZW5ndGgtMSkpfWVsc2UgYT10aGlzLl9sYXN0VmlkZW9EdXJhdGlvbnx8NDA7dmFyIHM9ci5wb3AoKTtpZih0aGlzLl92aWRlb0xhc3RTYW1wbGUmJnIudW5zaGlmdCh0aGlzLl92aWRlb0xhc3RTYW1wbGUpLHRoaXMuX3ZpZGVvTGFzdFNhbXBsZT1zLHIubGVuZ3RoKXtpZih2b2lkIDA9PT10aGlzLl92aWRlb05leHREdHMpe3ZhciBvPXJbMF07dGhpcy5fdmlkZW9OZXh0RHRzPW8uZHRzfXZhciB1PXIubGVuZ3RoLGM9MCxsPXJbMF0sZj10aGlzLl92aWRlb05leHREdHMtbC5kdHM7aWYoTWF0aC5hYnMoZik+MjAwKXt2YXIgZDtpZihNYXRoLmFicyhsLmR0cy10aGlzLl9sYXN0VmlkZW9FeGNlcHRpb25DaHVua0ZpcnN0RHRzRG90KT41ZTMpdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uQ2h1bmtGaXJzdER0c0RvdD1sLmR0cyxlLndhcm5pbmdzLnB1c2goe3R5cGU6QyxuZXh0RHRzOnRoaXMuX3ZpZGVvTmV4dER0cyxmaXJzdFNhbXBsZUR0czpsLmR0cyxuZXh0U2FtcGxlRHRzOm51bGw9PT0oZD1yWzFdKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5kdHMsc2FtcGxlRHVyYXRpb246Zn0pO3RoaXMuX3ZpZGVvVGltZXN0YW1wQnJlYWs+PTU/KHRoaXMuX3ZpZGVvTmV4dER0cz1sLmR0cyx0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPTApOihsLmR0cys9ZixsLnB0cys9Zix0aGlzLmF1ZGlvVHJhY2suZXhpc3QoKXx8KHRoaXMuX3ZpZGVvVGltZXN0YW1wQnJlYWs9MSkpfWZvcih2YXIgaD0wO2g8dTtoKyspe3ZhciBwPXJbaF0uZHRzLHY9cltoKzFdOygoYz1oPHUtMT92LmR0cy1wOnM/cy5kdHMtcDphKT4xZTN8fGM8MCkmJih0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrKyssTWF0aC5hYnMocC10aGlzLl9sYXN0VmlkZW9FeGNlcHRpb25MYXJnZUdhcERvdCk+NWUzJiYodGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uTGFyZ2VHYXBEb3Q9cCxlLndhcm5pbmdzLnB1c2goe3R5cGU6VSx0aW1lOnAvZS50aW1lc2NhbGUsZHRzOnAsb3JpZ2luRHRzOnJbaF0ub3JpZ2luRHRzLG5leHREdHM6dGhpcy5fdmlkZW9OZXh0RHRzLHNhbXBsZUR1cmF0aW9uOmMscmVmU2FtcGxlRHVyYXRpb246YX0pKSxjPWEpLHJbaF0uZHVyYXRpb249Yyx0aGlzLl92aWRlb05leHREdHMrPWMsdGhpcy5fbGFzdFZpZGVvRHVyYXRpb249Y319fX19LHtrZXk6Il9maXhBdWRpbyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxyPWUuc2FtcGxlcztyLmxlbmd0aCYmKHIuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ZS5kdHM9ZS5wdHMtPXQuX2Jhc2VEdHN9KSksdGhpcy5fZG9GaXhBdWRpb0ludGVybmFsKGUsciwxZTMpKX19LHtrZXk6Il9jYWxjdWxhdGVCYXNlRHRzIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPWUuc2FtcGxlcyxhPXQuc2FtcGxlcztpZighci5sZW5ndGgmJiFhLmxlbmd0aClyZXR1cm4hMTt2YXIgbj0xLzAsaT0xLzA7ci5sZW5ndGgmJihlLmJhc2VEdHM9bj1yWzBdLnB0cyksYS5sZW5ndGgmJih0LmJhc2VEdHM9aT1hWzBdLmR0cyksdGhpcy5fYmFzZUR0cz1NYXRoLm1pbihuLGkpO3ZhciBzPWktbjtyZXR1cm4gTnVtYmVyLmlzRmluaXRlKHMpJiZNYXRoLmFicyhzKT41MDAmJnQud2FybmluZ3MucHVzaCh7dHlwZTpULHZpZGVvQmFzZUR0czppLGF1ZGlvQmFzZVB0czpuLGJhc2VEdHM6dGhpcy5fYmFzZUR0cyxkZWx0YTpzfSksdGhpcy5fYmFzZUR0c0luaXRlZD0hMCwhMH19LHtrZXk6Il9yZXNldEJhc2VEdHNXaGVuU3RyZWFtQnJlYWtlZCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9jYWxjdWxhdGVCYXNlRHRzKHRoaXMuYXVkaW9UcmFjayx0aGlzLnZpZGVvVHJhY2spJiYodGhpcy5hdWRpb1RyYWNrLmV4aXN0KCk/dGhpcy52aWRlb1RyYWNrLmV4aXN0KCk/dGhpcy5fYmFzZUR0cy09TWF0aC5taW4odGhpcy5fYXVkaW9OZXh0UHRzLHRoaXMuX3ZpZGVvTmV4dER0cyk6dGhpcy5fYmFzZUR0cy09dGhpcy5fYXVkaW9OZXh0UHRzOnRoaXMuX2Jhc2VEdHMtPXRoaXMuX3ZpZGVvTmV4dER0cyx0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPTAsdGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaz0wKX19LHtrZXk6Il9kb0ZpeEF1ZGlvSW50ZXJuYWwiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXtlLnNhbXBsZUR1cmF0aW9ufHwoZS5zYW1wbGVEdXJhdGlvbj1lLmNvZGVjVHlwZT09PUQ/dWUuZ2V0RnJhbWVEdXJhdGlvbihlLnRpbWVzY2FsZSxyKTp0aGlzLl9nZXRHNzExRHVyYXRpb24oZSkpO3ZhciBhPWUuc2FtcGxlRHVyYXRpb24sbj1lLmNvZGVjVHlwZT09PUQ/MTAyNDphKmUudGltZXNjYWxlLzFlMztpZih2b2lkIDA9PT10aGlzLl9hdWRpb05leHRQdHMpe3ZhciBpPXRbMF07dGhpcy5fYXVkaW9OZXh0UHRzPWkucHRzfWZvcih2YXIgcz0wO3M8dC5sZW5ndGg7cysrKXt2YXIgbz10aGlzLl9hdWRpb05leHRQdHMsdT10W3NdLGM9dS5wdHMtbztpZigwPT09cyYmdGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaz49NSYmdGhpcy5fa2V5RnJhbWVJbk5leHRDaHVuayYmKG89dGhpcy5fYXVkaW9OZXh0UHRzPXUuZHRzLGM9MCx0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrPTApLCF0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrJiZjPj0zKmEmJmM8PWxlJiYhWCl7dmFyIGw9dGhpcy5fZ2V0U2lsZW50RnJhbWUoZSl8fHRbMF0uZGF0YS5zdWJhcnJheSgpLGY9TWF0aC5mbG9vcihjL2EpO01hdGguYWJzKHUucHRzLXRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkdhcERvdCk+ZmUmJih0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25HYXBEb3Q9dS5wdHMsZS53YXJuaW5ncy5wdXNoKHt0eXBlOkkscHRzOnUucHRzLG9yaWdpblB0czp1Lm9yaWdpblB0cyxjb3VudDpmLG5leHRQdHM6byxyZWZTYW1wbGVEdXJhdGlvbjphfSkpO2Zvcih2YXIgZD0wO2Q8ZjtkKyspe3ZhciBoPW5ldyBMKE1hdGguZmxvb3IodGhpcy5fYXVkaW9OZXh0UHRzK2EpLU1hdGguZmxvb3IodGhpcy5fYXVkaW9OZXh0UHRzKSxsLG4pO2gub3JpZ2luUHRzPU1hdGguZmxvb3IodGhpcy5fYmFzZUR0cytvKSx0LnNwbGljZShzLDAsaCksdGhpcy5fYXVkaW9OZXh0UHRzKz1hLHMrK31zLS19ZWxzZSBjPD0tMyphJiZjPj0tMWUzPyhNYXRoLmFicyh1LnB0cy10aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25PdmVybGFwRG90KT5mZSYmKHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbk92ZXJsYXBEb3Q9dS5wdHMsZS53YXJuaW5ncy5wdXNoKHt0eXBlOk0scHRzOnUucHRzLG9yaWdpblB0czp1Lm9yaWdpblB0cyxuZXh0UHRzOm8scmVmU2FtcGxlRHVyYXRpb246YX0pKSx0LnNwbGljZShzLDEpLHMtLSk6KE1hdGguYWJzKGMpPmxlJiYodGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaysrLE1hdGguYWJzKHUucHRzLXRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkxhcmdlR2FwRG90KT5mZSYmKHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkxhcmdlR2FwRG90PXUucHRzLGUud2FybmluZ3MucHVzaCh7dHlwZTpQLHRpbWU6dS5wdHMvMWUzLHB0czp1LnB0cyxvcmlnaW5QdHM6dS5vcmlnaW5QdHMsbmV4dFB0czpvLHNhbXBsZUR1cmF0aW9uOmMscmVmU2FtcGxlRHVyYXRpb246YX0pKSksdS5kdHM9dS5wdHM9byx1LmR1cmF0aW9uPW4sdGhpcy5fYXVkaW9OZXh0UHRzKz1hKX19fSx7a2V5OiJfZ2V0RzcxMUR1cmF0aW9uIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1lLnNhbXBsZVNpemUscj1lLmNoYW5uZWxDb3VudCxhPWUuc2FtcGxlUmF0ZSxuPWUuc2FtcGxlc1swXTtpZihuKXJldHVybiAyKm4uZGF0YS5ieXRlTGVuZ3RoL3IvKHQvOCkvYSoxZTN9fSx7a2V5OiJfZ2V0U2lsZW50RnJhbWUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlLmNvZGVjVHlwZT09PUQ/dWUuZ2V0U2lsZW50RnJhbWUoZS5jb2RlYyxlLmNoYW5uZWxDb3VudCk6bmV3IFVpbnQ4QXJyYXkoOCplLnNhbXBsZUR1cmF0aW9uKmUuY2hhbm5lbENvdW50KX19XSksZX0oKSxoZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJwYXJzZSIsdmFsdWU6ZnVuY3Rpb24odCl7aWYoISh0Lmxlbmd0aDwzKSl7dmFyIHI9e30sYT1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKSksbj1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrYS5zaXplLHQuYnl0ZUxlbmd0aC1hLnNpemUpKTtyZXR1cm4gclthLmRhdGFdPW4uZGF0YSxyfX19LHtrZXk6Il9wYXJzZVZhbHVlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcixhPXQuYnl0ZUxlbmd0aCxuPTEsaT0hMTtzd2l0Y2godC5nZXRVaW50OCgwKSl7Y2FzZSAwOnI9dC5nZXRGbG9hdDY0KDEpLG4rPTg7YnJlYWs7Y2FzZSAxOnI9ISF0LmdldFVpbnQ4KDEpLG4rPTE7YnJlYWs7Y2FzZSAyOnZhciBzPWUuX3BhcnNlU3RyaW5nKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbix0LmJ5dGVMZW5ndGgtbikpO3I9cy5kYXRhLG4rPXMuc2l6ZTticmVhaztjYXNlIDM6cj17fTt2YXIgbz0wO2Zvcig5PT0oMTY3NzcyMTUmdC5nZXRVaW50MzIoYS00KSkmJihvPTMpO248YS00Oyl7dmFyIHU9ZS5fcGFyc2VPYmplY3QobmV3IERhdGFWaWV3KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCtuLHQuYnl0ZUxlbmd0aC1uLW8pKSxjPXUuc2l6ZSxsPXUuZGF0YTtpZih1LmlzRW5kKWJyZWFrO3JbbC5uYW1lXT1sLnZhbHVlLG4rPWN9aWYobjw9YS0zKTk9PT0oMTY3NzcyMTUmdC5nZXRVaW50MzIobi0xKSkmJihuKz0zKTticmVhaztjYXNlIDg6cj17fSxuKz00O3ZhciBmPTA7Zm9yKDk9PSgxNjc3NzIxNSZ0LmdldFVpbnQzMihhLTQpKSYmKGY9Myk7bjxhLTg7KXt2YXIgZD1lLl9wYXJzZU9iamVjdChuZXcgRGF0YVZpZXcodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sdC5ieXRlTGVuZ3RoLW4tZikpLGg9ZC5zaXplLHA9ZC5kYXRhO2lmKGQuaXNFbmQpYnJlYWs7cltwLm5hbWVdPXAudmFsdWUsbis9aH1pZihuPD1hLTMpOT09PSgxNjc3NzIxNSZ0LmdldFVpbnQzMihuLTEpKSYmKG4rPTMpO2JyZWFrO2Nhc2UgOTpyPXZvaWQgMCxuPTEsaT0hMDticmVhaztjYXNlIDEwOnI9W107dmFyIHY9dC5nZXRVaW50MzIoMSk7bis9NDtmb3IodmFyIHk9MDt5PHY7eSsrKXt2YXIgbT1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbix0LmJ5dGVMZW5ndGgtbikpLGc9bS5kYXRhLGs9bS5zaXplO3IucHVzaChnKSxuKz1rfWJyZWFrO2Nhc2UgMTE6dmFyIGI9dC5nZXRGbG9hdDY0KG4pKzZlNCp0LmdldEludDE2KG4rOCk7cj1uZXcgRGF0ZShiKSxuKz0xMDticmVhaztjYXNlIDEyOnZhciBfPXQuZ2V0VWludDMyKDEpO24rPTQscj0iIixfPjAmJihyPUsuZGVjb2RlKG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCtuLF8pKSksbis9XzticmVhaztkZWZhdWx0Om49YX1yZXR1cm57ZGF0YTpyLHNpemU6bixpc0VuZDppfX19LHtrZXk6Il9wYXJzZVN0cmluZyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5nZXRVaW50MTYoMCkscj0iIjtyZXR1cm4gdD4wJiYocj1LLmRlY29kZShuZXcgVWludDhBcnJheShlLmJ1ZmZlcixlLmJ5dGVPZmZzZXQrMix0KSkpLHtkYXRhOnIsc2l6ZToyK3R9fX0se2tleToiX3BhcnNlT2JqZWN0Iix2YWx1ZTpmdW5jdGlvbih0KXtpZighKHQuYnl0ZUxlbmd0aDwzKSl7dmFyIHI9ZS5fcGFyc2VTdHJpbmcodCksYT1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrci5zaXplLHQuYnl0ZUxlbmd0aC1yLnNpemUpKTtyZXR1cm57ZGF0YTp7bmFtZTpyLmRhdGEsdmFsdWU6YS5kYXRhfSxzaXplOnIuc2l6ZSthLnNpemUsaXNFbmQ6YS5pc0VuZH19fX1dKSxlfSgpLHBlPW5ldyBIKCJGbHZEZW11eGVyIiksdmU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksaSh0aGlzLCJfaGVhZGVyUGFyc2VkIiwhMSksaSh0aGlzLCJfcmVtYWluaW5nRGF0YSIsbnVsbCksaSh0aGlzLCJfZ29wSWQiLDApLGkodGhpcywiX25lZWRBZGRNZXRhQmVmb3JlS2V5RnJhbWVOYWwiLCEwKSx0aGlzLnZpZGVvVHJhY2s9dHx8bmV3IHosdGhpcy5hdWRpb1RyYWNrPWF8fG5ldyBPLHRoaXMubWV0YWRhdGFUcmFjaz1ufHxuZXcgaix0aGlzLl9maXhlcj1uZXcgZGUodGhpcy52aWRlb1RyYWNrLHRoaXMuYXVkaW9UcmFjayx0aGlzLm1ldGFkYXRhVHJhY2spfXJldHVybiBuKGUsW3trZXk6ImRlbXV4Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXSYmYXJndW1lbnRzWzFdLGE9IShhcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXSl8fGFyZ3VtZW50c1syXSxuPXRoaXMuYXVkaW9UcmFjayxpPXRoaXMudmlkZW9UcmFjayxzPXRoaXMubWV0YWRhdGFUcmFjaztpZighciYmYXx8KHRoaXMuX3JlbWFpbmluZ0RhdGE9bnVsbCksciYmKHRoaXMuX2hlYWRlclBhcnNlZD0hMSkscj8oaS5yZXNldCgpLG4ucmVzZXQoKSxzLnJlc2V0KCkpOihpLnNhbXBsZXM9W10sbi5zYW1wbGVzPVtdLHMuc2VpU2FtcGxlcz1bXSxzLmZsdlNjcmlwdFNhbXBsZXM9W10saS53YXJuaW5ncz1bXSxuLndhcm5pbmdzPVtdLHRoaXMuX3JlbWFpbmluZ0RhdGEmJih0PVEodGhpcy5fcmVtYWluaW5nRGF0YSx0KSx0aGlzLl9yZW1haW5pbmdEYXRhPW51bGwpKSwhdC5sZW5ndGgpcmV0dXJue3ZpZGVvVHJhY2s6aSxhdWRpb1RyYWNrOm4sbWV0YWRhdGFUcmFjazpzfTt2YXIgbz0wO2lmKCF0aGlzLl9oZWFkZXJQYXJzZWQpe2lmKCFlLnByb2JlKHQpKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBmbHYgZmlsZSIpO24ucHJlc2VudD0oNCZ0WzRdKT4+PjIhPTAsaS5wcmVzZW50PTAhPSgxJnRbNF0pLHRoaXMuX2hlYWRlclBhcnNlZD0hMCxvPWVlKHQsNSkrNH1mb3IodmFyIHUsYyxsLGYsZCxoPXQubGVuZ3RoO28rMTU8aCYmKHU9dFtvXSwhKG8rMTUrKGM9dFtvKzFdPDwxNnx0W28rMl08PDh8dFtvKzNdKT5oKSk7KWw9KHRbbys3XTw8MjQ+Pj4wKSsodFtvKzRdPDwxNikrKHRbbys1XTw8OCkrdFtvKzZdLG8rPTExLGY9dC5zdWJhcnJheShvLG8rYyksOD09PXU/dGhpcy5fcGFyc2VBdWRpbyhmLGwpOjk9PT11P3RoaXMuX3BhcnNlVmlkZW8oZixsKToxOD09PXU/dGhpcy5fcGFyc2VTY3JpcHQoZixsKTpwZS53YXJuKCJJbnZhbGlkIHRhZyB0eXBlOiAiLmNvbmNhdCh1KSksKGQ9ZWUodCxvKz1jKSkhPT0xMStjJiZwZS53YXJuKCJJbnZhbGlkIFByZXZUYWdTaXplICIuY29uY2F0KGQsIiAoIikuY29uY2F0KDExK2MsIikiKSksbys9NDtyZXR1cm4gbzxoJiYodGhpcy5fcmVtYWluaW5nRGF0YT10LnN1YmFycmF5KG8pKSxuLmZvcm1hdFRpbWVzY2FsZT1pLmZvcm1hdFRpbWVzY2FsZT1pLnRpbWVzY2FsZT1zLnRpbWVzY2FsZT0xZTMsbi50aW1lc2NhbGU9bi5zYW1wbGVSYXRlfHwwLCFuLmV4aXN0KCkmJm4uaGFzU2FtcGxlKCkmJm4ucmVzZXQoKSwhaS5leGlzdCgpJiZpLmhhc1NhbXBsZSgpJiZpLnJlc2V0KCkse3ZpZGVvVHJhY2s6aSxhdWRpb1RyYWNrOm4sbWV0YWRhdGFUcmFjazpzfX19LHtrZXk6ImZpeCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiB0aGlzLl9maXhlci5maXgoZSx0LHIpLHt2aWRlb1RyYWNrOnRoaXMudmlkZW9UcmFjayxhdWRpb1RyYWNrOnRoaXMuYXVkaW9UcmFjayxtZXRhZGF0YVRyYWNrOnRoaXMubWV0YWRhdGFUcmFja319fSx7a2V5OiJkZW11eEFuZEZpeCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSl7cmV0dXJuIHRoaXMuZGVtdXgoZSx0LHIpLHRoaXMuZml4KGEsdCxyKX19LHtrZXk6Il9wYXJzZUF1ZGlvIix2YWx1ZTpmdW5jdGlvbih0LHIpe2lmKHQubGVuZ3RoKXt2YXIgYT0oMjQwJnRbMF0pPj4+NCxuPXRoaXMuYXVkaW9UcmFjaztpZigxMCE9PWEmJjchPT1hJiY4IT09YSlyZXR1cm4gcGUud2FybigiVW5zdXBwb3J0ZWQgc291bmQgZm9ybWF0OiAiLmNvbmNhdChhKSksdm9pZCBuLnJlc2V0KCk7aWYoMTAhPT1hKXt2YXIgaT0oMTImdFswXSk+PjIscz0oMiZ0WzBdKT4+MSxvPTEmdFswXTtuLnNhbXBsZVJhdGU9ZS5BVURJT19SQVRFW2ldLG4uc2FtcGxlU2l6ZT1zPzE2Ojgsbi5jaGFubmVsQ291bnQ9bysxfTEwPT09YT90aGlzLl9wYXJzZUFhYyh0LHIpOnRoaXMuX3BhcnNlRzcxMSh0LHIsYSl9fX0se2tleToiX3BhcnNlRzcxMSIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBhPXRoaXMuYXVkaW9UcmFjazthLmNvZGVjVHlwZT03PT09cj9COkUsYS5zYW1wbGVSYXRlPThlMyxhLmNvZGVjPWEuY29kZWNUeXBlLGEuc2FtcGxlcy5wdXNoKG5ldyBMKHQsZS5zdWJhcnJheSgxKSkpfX0se2tleToiX3BhcnNlQWFjIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuYXVkaW9UcmFjaztpZihyLmNvZGVjVHlwZT1ELDA9PT1lWzFdKXt2YXIgYT11ZS5wYXJzZUF1ZGlvU3BlY2lmaWNDb25maWcoZS5zdWJhcnJheSgyKSk7YT8oci5jb2RlYz1hLmNvZGVjLHIuY2hhbm5lbENvdW50PWEuY2hhbm5lbENvdW50LHIuc2FtcGxlUmF0ZT1hLnNhbXBsZVJhdGUsci5jb25maWc9YS5jb25maWcsci5vYmplY3RUeXBlPWEub2JqZWN0VHlwZSxyLnNhbXBsZVJhdGVJbmRleD1hLnNhbXBsaW5nRnJlcXVlbmN5SW5kZXgpOihyLnJlc2V0KCkscGUud2FybigiQ2Fubm90IHBhcnNlIEF1ZGlvU3BlY2lmaWNDb25maWciLGUpKX1lbHNlIGlmKDE9PT1lWzFdKXtpZihudWxsPT10KXJldHVybjtyLnNhbXBsZXMucHVzaChuZXcgTCh0LGUuc3ViYXJyYXkoMikpKX1lbHNlIHBlLndhcm4oIlVua25vd24gQUFDUGFja2V0VHlwZTogIi5jb25jYXQoZVsxXSkpfX0se2tleToiX3BhcnNlVmlkZW8iLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcztpZighKGUubGVuZ3RoPDYpKXt2YXIgYT0oMjQwJmVbMF0pPj4+NCxuPTE1JmVbMF0saT10aGlzLnZpZGVvVHJhY2s7aWYoNyE9PW4mJjEyIT09bilyZXR1cm4gaS5yZXNldCgpLHZvaWQgcGUud2FybigiVW5zdXBwb3J0ZWQgY29kZWNJZDogIi5jb25jYXQobikpO3ZhciBzPTEyPT09bjtpLmNvZGVjVHlwZT1zP0E6Uzt2YXIgbz1lWzFdLHU9KGVbMl08PDE2fGVbM108PDh8ZVs0XSk8PDg+Pjg7aWYoMD09PW8pe3ZhciBjPWUuc3ViYXJyYXkoNSksbD1zP2NlLnBhcnNlSEVWQ0RlY29kZXJDb25maWd1cmF0aW9uUmVjb3JkKGMpOm9lLnBhcnNlQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQoYyk7aWYobCl7dmFyIGY9bC5odmNDLGQ9bC5zcHMsaD1sLnBwc0FycixwPWwuc3BzQXJyLHY9bC52cHNBcnIseT1sLm5hbFVuaXRTaXplO2YmJihpLmh2Y0M9aS5odmNDfHxmKSxkJiYoaS5jb2RlYz1kLmNvZGVjLGkud2lkdGg9ZC53aWR0aCxpLmhlaWdodD1kLmhlaWdodCxpLnNhclJhdGlvPWQuc2FyUmF0aW8saS5mcHNOdW09ZC5mcHNOdW0saS5mcHNEZW49ZC5mcHNEZW4pLHAubGVuZ3RoJiYoaS5zcHM9cCksaC5sZW5ndGgmJihpLnBwcz1oKSx2JiZ2Lmxlbmd0aCYmKGkudnBzPXYpLHkmJihpLm5hbFVuaXRTaXplPXkpfWVsc2UgcGUud2FybigiQ2Fubm90IHBhcnNlICIuY29uY2F0KHM/IkhFVkMiOiJBVkMiLCJEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZCIpLGUpfWVsc2UgaWYoMT09PW8pe3ZhciBtPXNlLnBhcnNlQXZjQyhlLnN1YmFycmF5KDUpLGkubmFsVW5pdFNpemUpO2lmKChtPXRoaXMuX2NoZWNrQWRkTWV0YU5hbFRvVW5pdHMocyxtLGkpKSYmbS5sZW5ndGgpe3ZhciBnPW5ldyBSKHQrdSx0LG0pOzE9PT1hJiZnLnNldFRvS2V5ZnJhbWUoKSxpLnNhbXBsZXMucHVzaChnKSxtLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciBhPXM/ZVswXT4+PjEmNjM6MzEmZVswXTtzd2l0Y2goYSl7Y2FzZSA1OmNhc2UgMTY6Y2FzZSAxNzpjYXNlIDE4OmNhc2UgMTk6Y2FzZSAyMDpjYXNlIDIxOmNhc2UgMjI6Y2FzZSAyMzppZighcyYmNSE9PWF8fHMmJjU9PT1hKWJyZWFrO2cuc2V0VG9LZXlmcmFtZSgpO2JyZWFrO2Nhc2UgNjpjYXNlIDM5OmNhc2UgNDA6aWYoIXMmJjYhPT1hfHxzJiY2PT09YSlicmVhaztyLm1ldGFkYXRhVHJhY2suc2VpU2FtcGxlcy5wdXNoKG5ldyBOKHNlLnBhcnNlU0VJKHNlLnJlbW92ZUVQQihlKSxzKSx0K3UpKX19KSksZy5rZXlmcmFtZSYmdGhpcy5fZ29wSWQrKyxnLmdvcElkPXRoaXMuX2dvcElkfWVsc2UgcGUud2FybigiQ2Fubm90IHBhcnNlIE5BTFVzIixlKX1lbHNlIDI9PT1vfHxwZS53YXJuKCJVbmtub3duIEFWQ1BhY2tldFR5cGU6ICIuY29uY2F0KG8pKX19fSx7a2V5OiJfY2hlY2tBZGRNZXRhTmFsVG9Vbml0cyIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlJiZ0aGlzLl9uZWVkQWRkTWV0YUJlZm9yZUtleUZyYW1lTmFsP3QubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gZVswXT4+PjEmNjN9KSkuaW5jbHVkZXMoMzIpPyh0aGlzLl9uZWVkQWRkTWV0YUJlZm9yZUtleUZyYW1lTmFsPSExLHQpOih0LnVuc2hpZnQoci5wcHNbMF0pLHQudW5zaGlmdChyLnNwc1swXSksdC51bnNoaWZ0KHIudnBzWzBdKSx0LmZpbHRlcihCb29sZWFuKSk6KHRoaXMuX25lZWRBZGRNZXRhQmVmb3JlS2V5RnJhbWVOYWw9ITEsdCl9fSx7a2V5OiJfcGFyc2VTY3JpcHQiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5tZXRhZGF0YVRyYWNrLmZsdlNjcmlwdFNhbXBsZXMucHVzaChuZXcgRihoZS5wYXJzZShlKSx0KSl9fV0sW3trZXk6InByb2JlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gNzA9PT1lWzBdJiY3Nj09PWVbMV0mJjg2PT09ZVsyXSYmMT09PWVbM10mJmVlKGUsNSk+PTl9fV0pLGV9KCk7aSh2ZSwiQVVESU9fUkFURSIsWzU1MDAsMTFlMywyMmUzLDQ0ZTNdKSxuZXcgSCgiVHNEZW11eGVyIik7dmFyIHllPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEsbil7cih0aGlzLGUpLHRoaXMuZHY9bmV3IERhdGFWaWV3KHQpLHRoaXMuc3RhcnQ9dGhpcy5vZmZzZXQ9YXx8dGhpcy5kdi5ieXRlT2Zmc2V0LHRoaXMuZW5kPW4/dGhpcy5zdGFydCtuOnRoaXMuc3RhcnQrdGhpcy5kdi5ieXRlTGVuZ3RofXJldHVybiBuKGUsW3trZXk6ImJ1ZmZlciIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZHYuYnVmZmVyfX0se2tleToidW5yZWFkTGVuZ3RoIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5tYXgodGhpcy5lbmQtdGhpcy5vZmZzZXQsMCl9fSx7a2V5OiJzaXplIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbmQtdGhpcy5zdGFydH19LHtrZXk6InJlYWRGbG9hdCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9MDtzd2l0Y2goZSl7Y2FzZSA0OnQ9dGhpcy5kdi5nZXRGbG9hdDMyKHRoaXMub2Zmc2V0KTticmVhaztjYXNlIDg6dD10aGlzLmR2LmdldEZsb2F0NjQodGhpcy5vZmZzZXQpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJyZWFkICIuY29uY2F0KGUsIi1ieXRlIGZsb2F0IGlzIG5vdCBzdXBwb3J0ZWQiKSl9cmV0dXJuIHRoaXMub2Zmc2V0Kz1lLHR9fSx7a2V5OiJiYWNrIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLm9mZnNldC09ZX19LHtrZXk6InNraXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3RoaXMub2Zmc2V0Kz1lfX0se2tleToicmVhZEludCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5vZmZzZXQ7c3dpdGNoKHRoaXMub2Zmc2V0Kz1lLGUpe2Nhc2UgMTpyZXR1cm4gdGhpcy5kdi5nZXRJbnQ4KHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5nZXRJbnQxNih0KTtjYXNlIDQ6cmV0dXJuIHRoaXMuZHYuZ2V0SW50MzIodCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoInJlYWQgIi5jb25jYXQoZSwiLWJ5dGUgaW50ZWdlcnMgaXMgbm90IHN1cHBvcnRlZCIpKX19fSx7a2V5OiJyZWFkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLm9mZnNldDtzd2l0Y2godGhpcy5vZmZzZXQrPWUsZSl7Y2FzZSAxOnJldHVybiB0aGlzLmR2LmdldFVpbnQ4KHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5nZXRVaW50MTYodCk7Y2FzZSAzOnJldHVybih0aGlzLmR2LmdldFVpbnQxNih0KTw8OCkrdGhpcy5kdi5nZXRVaW50OCh0KzIpO2Nhc2UgNDpyZXR1cm4gdGhpcy5kdi5nZXRVaW50MzIodCk7ZGVmYXVsdDpyZXR1cm4gdGhpcy5iYWNrKGUtNCksdGhpcy5yZWFkKGUtNCkrdGhpcy5kdi5nZXRVaW50MzIodCkqTWF0aC5wb3coMjU2LGUtNCl9fX0se2tleToid3JpdGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcy5vZmZzZXQ7c3dpdGNoKHRoaXMub2Zmc2V0Kz1lLGUpe2Nhc2UgMTpyZXR1cm4gdGhpcy5kdi5zZXRVaW50OChyLHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5zZXRVaW50MTYocix0KTtjYXNlIDM6cmV0dXJuIHRoaXMuZHYuc2V0VWludDgocix0Pj4+MTYpLHRoaXMuZHYuc2V0VWludDE2KHIrMSw2NTUzNSZ0KTtjYXNlIDQ6cmV0dXJuIHRoaXMuZHYuc2V0VWludDMyKHIsdCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIndyaXRlICIuY29uY2F0KGUsIi1ieXRlIGludGVnZXJzIGlzIG5vdCBzdXBwb3J0ZWQiKSl9fX0se2tleToicmVhZFRvQnVmZmVyIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdDtyZXR1cm4gdD10aGlzLm9mZnNldHx8ZT90aGlzLmR2LmJ1ZmZlci5zbGljZSh0aGlzLm9mZnNldCxlP3RoaXMub2Zmc2V0K2U6dGhpcy5lbmQpOnRoaXMuZHYuYnVmZmVyLHRoaXMub2Zmc2V0Kz10LmJ5dGVMZW5ndGgsdH19LHtrZXk6InJlYWRUb1VpbnQ4Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1uZXcgVWludDhBcnJheSh0aGlzLmR2LmJ1ZmZlcix0aGlzLm9mZnNldCxlfHx0aGlzLnVucmVhZExlbmd0aCk7cmV0dXJuIHRoaXMub2Zmc2V0Kz10LmJ5dGVMZW5ndGgsdH19LHtrZXk6InJlYWRTdHJpbmciLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLHI9IiI7dDxlO3QrKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRoaXMuZHYuZ2V0VWludDgodGhpcy5vZmZzZXQpKSx0aGlzLm9mZnNldCsrO3JldHVybiByfX1dLFt7a2V5OiJmcm9tVWludDgiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKX19LHtrZXk6ImNvbmNhdFVpbnQ4cyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoZS5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCkpLHI9MDtyZXR1cm4gZS5mb3JFYWNoKChmdW5jdGlvbihlKXt0LnNldChlLHIpLHIrPWUuYnl0ZUxlbmd0aH0pKSx0fX0se2tleToiY29uY2F0VWludDgiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSkscj0wO3I8ZTtyKyspdFtyXT1hcmd1bWVudHNbcl07cmV0dXJuIHRoaXMuY29uY2F0VWludDhzKHQpfX1dKSxlfSgpLG1lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEpe3IodGhpcyxlKSx0aGlzLm9mZnNldD0wLHRoaXMudmFsPXQsdGhpcy5zaXplPWF9cmV0dXJuIG4oZSxbe2tleToic2tpcCIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5vZmZzZXQrPWV9fSx7a2V5OiJyZWFkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLnNpemUtdGhpcy5vZmZzZXQtZTtpZih0Pj0wKXt2YXIgcj0wLGE9MDtpZih0aGlzLm9mZnNldCs9ZSx0aGlzLnNpemU+MzEpe2Zvcig7YTxlO2ErKylyKz1NYXRoLnBvdygyLGEpO3JldHVybiB0aGlzLnZhbC9NYXRoLnBvdygyLHQpJnJ9Zm9yKDthPGU7YSsrKXIrPTE8PGE7cmV0dXJuIHRoaXMudmFsPj4+dCZyfXRocm93IG5ldyBFcnJvcigidGhlIG51bWJlciBvZiB0aGUgcmVhZCBvcGVyYXRpb24gZXhjZWVkcyB0aGUgdG90YWwgbGVuZ3RoIGxpbWl0IG9mIGJpdHMiKX19XSxbe2tleToiZnJvbUJ5dGUiLHZhbHVlOmZ1bmN0aW9uKHQscil7cmV0dXJuIG5ldyBlKHQucmVhZChyKSxyPDwzKX19XSksZX0oKSxnZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJmaW5kQm94Iix2YWx1ZTpmdW5jdGlvbih0LHIpe3ZhciBhPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTowLG49W107aWYoIXQpcmV0dXJuIG47Zm9yKHZhciBpPTAscz0iIixvPTA7dC5sZW5ndGg+Nzspe2lmKGk9ZWUodCkscz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsdC5zdWJhcnJheSg0LDgpKSxvPTgsMT09PWk/KGk9dGUodCw4KSxvKz04KTppfHwoaT10Lmxlbmd0aCksIXJbMF18fHM9PT1yWzBdKXt2YXIgdT10LnN1YmFycmF5KDAsaSk7aWYoIShyLmxlbmd0aDwyKSlyZXR1cm4gZS5maW5kQm94KHUuc3ViYXJyYXkobyksci5zbGljZSgxKSxhK28pO24ucHVzaCh7c3RhcnQ6YSxzaXplOmksaGVhZGVyU2l6ZTpvLHR5cGU6cyxkYXRhOnV9KX1hKz1pLHQ9dC5zdWJhcnJheShpKX1yZXR1cm4gbn19LHtrZXk6InRmaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2UudHJhY2tJZD1lZSh0KTt2YXIgcj00LGE9MSZlLmZsYWdzLG49MiZlLmZsYWdzLGk9OCZlLmZsYWdzLHM9MTYmZS5mbGFncyxvPTMyJmUuZmxhZ3M7YSYmKHIrPTQsZS5iYXNlRGF0YU9mZnNldD1lZSh0LHIpLHIrPTQpLG4mJihlLnNhbXBsZURlc2NyaXB0aW9uSW5kZXg9ZWUodCxyKSxyKz00KSxpJiYoZS5kZWZhdWx0U2FtcGxlRHVyYXRpb249ZWUodCxyKSxyKz00KSxzJiYoZS5kZWZhdWx0U2FtcGxlU2l6ZT1lZSh0LHIpLHIrPTQpLG8mJihlLmRlZmF1bHRTYW1wbGVGbGFncz1lZSh0LHIpKX0pKX19LHtrZXk6InNpZHgiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPTA7ZS5yZWZlcmVuY2VfSUQ9ZWUodCxyKSxyKz00LGUudGltZXNjYWxlPWVlKHQscikscis9NCwwPT09ZS52ZXJzaW9uPyhlLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lPWVlKHQscikscis9NCxlLmZpcnN0X29mZnNldD1lZSh0LHIpLHIrPTQpOihlLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lPXRlKHQscikscis9OCxlLmZpcnN0X29mZnNldD10ZSh0LHIpLHIrPTgpLHIrPTIsZS5yZWZlcmVuY2VzPVtdO3ZhciBhPSQodCxyKTtyKz0yO2Zvcih2YXIgbj0wO248YTtuKyspe3ZhciBpPXt9O2UucmVmZXJlbmNlcy5wdXNoKGkpO3ZhciBzPWVlKHQscik7cis9NCxpLnJlZmVyZW5jZV90eXBlPXM+PjMxJjEsaS5yZWZlcmVuY2VkX3NpemU9MjE0NzQ4MzY0NyZzLGkuc3Vic2VnbWVudF9kdXJhdGlvbj1lZSh0LHIpLHM9ZWUodCxyKz00KSxyKz00LGkuc3RhcnRzX3dpdGhfU0FQPXM+PjMxJjEsaS5TQVBfdHlwZT1zPj4yOCY3LGkuU0FQX2RlbHRhX3RpbWU9MjY4NDM1NDU1JnN9fSkpfX0se2tleToibW9vdiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0Lm12aGQ9ZS5tdmhkKGUuZmluZEJveChyLFsibXZoZCJdLGEpWzBdKSx0LnRyYWs9ZS5maW5kQm94KHIsWyJ0cmFrIl0sYSkubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFrKHQpfSkpLHQucHNzaD1lLnBzc2goZS5maW5kQm94KHIsWyJwc3NoIl0sYSlbMF0pfSkpfX0se2tleToibXZoZCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUsdCl7dmFyIHI9MDsxPT09ZS52ZXJzaW9uPyhlLnRpbWVzY2FsZT1lZSh0LDE2KSxlLmR1cmF0aW9uPXRlKHQsMjApLHIrPTI4KTooZS50aW1lc2NhbGU9ZWUodCw4KSxlLmR1cmF0aW9uPWVlKHQsMTIpLHIrPTE2KSxlLm5leHRUcmFja0lkPWVlKHQscis3Nil9KSl9fSx7a2V5OiJ0cmFrIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3QudGtoZD1lLnRraGQoZS5maW5kQm94KHIsWyJ0a2hkIl0sYSlbMF0pLHQubWRpYT1lLm1kaWEoZS5maW5kQm94KHIsWyJtZGlhIl0sYSlbMF0pfSkpfX0se2tleToidGtoZCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUsdCl7dmFyIHI9eWUuZnJvbVVpbnQ4KHQpOzE9PT1lLnZlcnNpb24/KHIucmVhZCg4KSxyLnJlYWQoOCksZS50cmFja0lkPXIucmVhZCg0KSxyLnJlYWQoNCksZS5kdXJhdGlvbj1yLnJlYWQoOCkpOihyLnJlYWQoNCksci5yZWFkKDQpLGUudHJhY2tJZD1yLnJlYWQoNCksci5yZWFkKDQpLGUuZHVyYXRpb249ci5yZWFkKDQpKSxyLnNraXAoMTYpLGUubWF0cml4PVtdO2Zvcih2YXIgYT0wO2E8MzY7YSsrKWUubWF0cml4LnB1c2goci5yZWFkKDEpKTtyLmJhY2soMzYpO2Zvcih2YXIgbixpPVtdLHM9MDtzPDM7cysrKWkucHVzaChpZShyLnJlYWRJbnQoMiksci5yZWFkSW50KDIpKSksaS5wdXNoKGllKHIucmVhZEludCgyKSxyLnJlYWRJbnQoMikpKSxuPXIucmVhZEludCg0KSxpLnB1c2goaWUobj4+MzAsMTA3Mzc0MTgyMyZuKSk7ZS5yb3RhdGlvbj1mdW5jdGlvbihlKXtpZihlLmxlbmd0aDw1KXJldHVybiAwO3ZhciB0PU1hdGguaHlwb3QoZVswXSxlWzNdKSxyPU1hdGguaHlwb3QoZVsxXSxlWzRdKTtyZXR1cm4gMD09PXR8fDA9PT1yPzA6MTgwKk1hdGguYXRhbjIoZVsxXS9yLGVbMF0vdCkvTWF0aC5QSX0oaSksZS53aWR0aD1yLnJlYWQoNCksZS5oZWlnaHQ9ci5yZWFkKDQpfSkpfX0se2tleToibWRpYSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0Lm1kaGQ9ZS5tZGhkKGUuZmluZEJveChyLFsibWRoZCJdLGEpWzBdKSx0LmhkbHI9ZS5oZGxyKGUuZmluZEJveChyLFsiaGRsciJdLGEpWzBdKSx0Lm1pbmY9ZS5taW5mKGUuZmluZEJveChyLFsibWluZiJdLGEpWzBdKX0pKX19LHtrZXk6Im1kaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPTA7MT09PWUudmVyc2lvbj8oZS50aW1lc2NhbGU9ZWUodCwxNiksZS5kdXJhdGlvbj10ZSh0LDIwKSxyKz0yOCk6KGUudGltZXNjYWxlPWVlKHQsOCksZS5kdXJhdGlvbj1lZSh0LDEyKSxyKz0xNik7dmFyIGE9JCh0LHIpO2UubGFuZ3VhZ2U9U3RyaW5nLmZyb21DaGFyQ29kZSg5NisoYT4+MTAmMzEpLDk2KyhhPj41JjMxKSw5NisoMzEmYSkpfSkpfX0se2tleToiaGRsciIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUsdCl7MD09PWUudmVyc2lvbiYmKGUuaGFuZGxlclR5cGU9U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLHQuc3ViYXJyYXkoNCw4KSkpfSkpfX0se2tleToibWluZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnZtaGQ9ZS52bWhkKGUuZmluZEJveChyLFsidm1oZCJdLGEpWzBdKSx0LnNtaGQ9ZS5zbWhkKGUuZmluZEJveChyLFsic21oZCJdLGEpWzBdKSx0LnN0Ymw9ZS5zdGJsKGUuZmluZEJveChyLFsic3RibCJdLGEpWzBdKX0pKX19LHtrZXk6InZtaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2UuZ3JhcGhpY3Ntb2RlPSQodCksZS5vcGNvbG9yPVskKHQsMiksJCh0LDQpLCQodCw2KV19KSl9fSx7a2V5OiJzbWhkIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLmJhbGFuY2U9JCh0KX0pKX19LHtrZXk6InN0YmwiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dmFyIG4saSxzO3Quc3RzZD1lLnN0c2QoZS5maW5kQm94KHIsWyJzdHNkIl0sYSlbMF0pLHQuc3R0cz1lLnN0dHMoZS5maW5kQm94KHIsWyJzdHRzIl0sYSlbMF0pLHQuY3R0cz1lLmN0dHMoZS5maW5kQm94KHIsWyJjdHRzIl0sYSlbMF0pLHQuc3RzYz1lLnN0c2MoZS5maW5kQm94KHIsWyJzdHNjIl0sYSlbMF0pLHQuc3Rzej1lLnN0c3ooZS5maW5kQm94KHIsWyJzdHN6Il0sYSlbMF0pLHQuc3Rjbz1lLnN0Y28oZS5maW5kQm94KHIsWyJzdGNvIl0sYSlbMF0pLHQuc3Rjb3x8KHQuY282ND1lLmNvNjQoZS5maW5kQm94KHIsWyJjbzY0Il0sYSlbMF0pLHQuc3Rjbz10LmNvNjQpO3ZhciBvPW51bGw9PT0obj10LnN0c2QuZW50cmllc1swXSl8fHZvaWQgMD09PW58fG51bGw9PT0oaT1uLnNpbmYpfHx2b2lkIDA9PT1pfHxudWxsPT09KHM9aS5zY2hpKXx8dm9pZCAwPT09cz92b2lkIDA6cy50ZW5jLmRlZmF1bHRfSVZfc2l6ZTt0LnN0c3M9ZS5zdHNzKGUuZmluZEJveChyLFsic3RzcyJdLGEpWzBdKSx0LnNlbmM9ZS5zZW5jKGUuZmluZEJveChyLFsic2VuYyJdLGEpWzBdLG8pfSkpfX0se2tleToic2VuYyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjg7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUscil7dmFyIGE9MCxuPWVlKHIsYSk7YSs9NCxlLnNhbXBsZXM9W107Zm9yKHZhciBpPTA7aTxuO2krKyl7Zm9yKHZhciBzPXtJbml0aWFsaXphdGlvblZlY3RvcjpbXX0sbz0wO288dDtvKyspcy5Jbml0aWFsaXphdGlvblZlY3RvcltvXT1yW2Erb107aWYoYSs9dCwyJmUuZmxhZ3Mpe3Muc3Vic2FtcGxlcz1bXTt2YXIgdT0kKHIsYSk7YSs9Mjtmb3IodmFyIGM9MDtjPHU7YysrKXt2YXIgbD17fTtsLkJ5dGVzT2ZDbGVhckRhdGE9JChyLGEpLGErPTIsbC5CeXRlc09mUHJvdGVjdGVkRGF0YT1lZShyLGEpLGErPTQscy5zdWJzYW1wbGVzLnB1c2gobCl9fWUuc2FtcGxlcy5wdXNoKHMpfX0pKX19LHtrZXk6InBzc2giLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1bXSxhPVtdLG49MCxpPTA7aTwxNjtpKyspYS5wdXNoKFNlKHRbbitpXSkpO2lmKG4rPTE2LGUudmVyc2lvbj4wKXt2YXIgcz1lZSh0LG4pO24rPTQ7Zm9yKHZhciBvPTA7bzwoIiIrcykubGVuZ3RoO28rKylmb3IodmFyIHU9MDt1PDE2O3UrKyl7dmFyIGM9dFtuXTtuKz0xLHIucHVzaChTZShjKSl9fXZhciBsPWVlKHQsbik7ZS5kYXRhX3NpemU9bCxuKz00LGUua2lkPXIsZS5zeXN0ZW1faWQ9YSxlLmJ1ZmZlcj10fSkpfX0se2tleToic3RzZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITAsKGZ1bmN0aW9uKHQscixhKXt0LmVudHJ5Q291bnQ9ZWUociksdC5lbnRyaWVzPWUuZmluZEJveChyLnN1YmFycmF5KDQpLFtdLGErNCkubWFwKChmdW5jdGlvbih0KXtzd2l0Y2godC50eXBlKXtjYXNlImF2MDEiOnJldHVybiBlLmF2MDEodCk7Y2FzZSJhdmMxIjpjYXNlImF2YzIiOmNhc2UiYXZjMyI6Y2FzZSJhdmM0IjpyZXR1cm4gZS5hdmMxKHQpO2Nhc2UiaHZjMSI6Y2FzZSJoZXYxIjpyZXR1cm4gZS5odmMxKHQpO2Nhc2UibXA0YSI6cmV0dXJuIGUubXA0YSh0KTtjYXNlImFsYXciOmNhc2UidWxhdyI6cmV0dXJuIGUuYWxhdyh0KTtjYXNlImVuY2EiOnJldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC5jaGFubmVsQ291bnQ9JChyLDE2KSx0LnNhbXBsZXNpemU9JChyLDE4KSx0LnNhbXBsZVJhdGU9ZWUociwyNCkvNjU1MzYscj1yLnN1YmFycmF5KDI4KSx0LnNpbmY9ZS5zaW5mKGUuZmluZEJveChyLFsic2luZiJdLGEpWzBdKSx0LmVzZHM9ZS5lc2RzKGUuZmluZEJveChyLFsiZXNkcyJdLGEpWzBdKX0pKTtjYXNlImVuY3YiOnJldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC53aWR0aD0kKHIsMjQpLHQuaGVpZ2h0PSQociwyNiksdC5ob3JpenJlc29sdXRpb249ZWUociwyOCksdC52ZXJ0cmVzb2x1dGlvbj1lZShyLDMyKSxyPXIuc3ViYXJyYXkoNzgpLHQuc2luZj1lLnNpbmYoZS5maW5kQm94KHIsWyJzaW5mIl0sYSlbMF0pLHQuYXZjQz1lLmF2Y0MoZS5maW5kQm94KHIsWyJhdmNDIl0sYSlbMF0pLHQuaHZjQz1lLmh2Y0MoZS5maW5kQm94KHIsWyJodmNDIl0sYSlbMF0pLHQucGFzcD1lLnBhc3AoZS5maW5kQm94KHIsWyJwYXNwIl0sYSlbMF0pfSkpfX0pKS5maWx0ZXIoQm9vbGVhbil9KSl9fSx7a2V5OiJ0ZW5jIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24oZSx0KXt2YXIgcj02O2UuZGVmYXVsdF9Jc0VuY3J5cHRlZD10W3JdLHIrPTEsZS5kZWZhdWx0X0lWX3NpemU9dFtyXSxyKz0xLGUuZGVmYXVsdF9LSUQ9W107Zm9yKHZhciBhPTA7YTwxNjthKyspZS5kZWZhdWx0X0tJRC5wdXNoKFNlKHRbcl0pKSxyKz0xfSkpfX0se2tleToic2NoaSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnRlbmM9ZS50ZW5jKGUuZmluZEJveChyLFsidGVuYyJdLGEpWzBdKX0pKX19LHtrZXk6InNpbmYiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC5zY2hpPWUuc2NoaShlLmZpbmRCb3gocixbInNjaGkiXSxhKVswXSksdC5mcm1hPWUuZnJtYShlLmZpbmRCb3gocixbImZybWEiXSxhKVswXSl9KSl9fSx7a2V5OiJmcm1hIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24oZSx0KXtlLmRhdGFfZm9ybWF0PSIiO2Zvcih2YXIgcj0wO3I8NDtyKyspZS5kYXRhX2Zvcm1hdCs9U3RyaW5nLmZyb21DaGFyQ29kZSh0W3JdKX0pKX19LHtrZXk6ImNvbHIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCExLChmdW5jdGlvbih0LHIpe3ZhciBhPXllLmZyb21VaW50OChyKTt0LmRhdGE9ZS5kYXRhLHQuY29sb3JUeXBlPWEucmVhZFN0cmluZyg0KSwibmNseCI9PT10LmNvbG9yVHlwZT8odC5jb2xvclByaW1hcmllcz1hLnJlYWQoMiksdC50cmFuc2ZlckNoYXJhY3RlcmlzdGljcz1hLnJlYWQoMiksdC5tYXRyaXhDb2VmZmljaWVudHM9YS5yZWFkKDIpLHQuZnVsbFJhbmdlRmxhZz1hLnJlYWQoMSk+PjcpOiJySUNDIiE9PXQuY29sb3JUeXBlJiYicHJvZiIhPT10LmNvbG9yVHlwZXx8KHQuaWNjUHJvZmlsZT1yLnJlYWRUb1VpbnQ4KCkpfSkpfX0se2tleToiYXYwMSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt2YXIgbj1iZSh0LHIpLGk9ci5zdWJhcnJheShuKTthKz1uLHQuYXYxQz1lLmF2MUMoZS5maW5kQm94KGksWyJhdjFDIl0sYSlbMF0pLHQuY29scj1lLmNvbHIoZS5maW5kQm94KGksWyJjb2xyIl0sYSlbMF0pfSkpfX0se2tleToiYXYxQyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITEsKGZ1bmN0aW9uKHQscil7dC5kYXRhPWUuZGF0YTt2YXIgYSxuPXllLmZyb21VaW50OChyKSxpPW1lLmZyb21CeXRlKG4sNCk7dC5tYXJrZXI9aS5yZWFkKDEpLHQudmVyc2lvbj1pLnJlYWQoNyksdC5zZXFQcm9maWxlPWkucmVhZCgzKSx0LnNlcUxldmVsSWR4MD1pLnJlYWQoNSksdC5zZXFUaWVyMD1pLnJlYWQoMSksdC5oaWdoQml0ZGVwdGg9aS5yZWFkKDEpLHQudHdlbHZlQml0PWkucmVhZCgxKSx0Lm1vbm9jaHJvbWU9aS5yZWFkKDEpLHQuY2hyb21hU3Vic2FtcGxpbmdYPWkucmVhZCgxKSx0LmNocm9tYVN1YnNhbXBsaW5nWT1pLnJlYWQoMSksdC5jaHJvbWFTYW1wbGVQb3NpdGlvbj1pLnJlYWQoMiksdC5yZXNlcnZlZD1pLnJlYWQoMyksdC5pbml0aWFsUHJlc2VudGF0aW9uRGVsYXlQcmVzZW50PWkucmVhZCgxKSx0LmluaXRpYWxQcmVzZW50YXRpb25EZWxheVByZXNlbnQ/dC5pbml0aWFsUHJlc2VudGF0aW9uRGVsYXlNaW51c09uZT1pLnJlYWQoNCk6dC5pbml0aWFsUHJlc2VudGF0aW9uRGVsYXlNaW51c09uZT0wLHQuY29uZmlnT0JVcz1uLnJlYWRUb1VpbnQ4KCksMj09PXQuc2VxTGV2ZWxJZHgwJiYxPT09dC5oaWdoQml0ZGVwdGg/YT0xPT09dC50d2VsdmVCaXQ/IjEyIjoiMTAiOnQuc2VxUHJvZmlsZTw9MiYmKGE9MT09PXQuaGlnaEJpdGRlcHRoPyIxMCI6IjA4IiksdC5jb2RlYz1bImF2MDEiLHQuc2VxUHJvZmlsZSwodC5zZXFMZXZlbElkeDA8MTA/IjAiK3Quc2VxTGV2ZWxJZHgwOnQuc2VxTGV2ZWxJZHgwKSsodC5zZXFUaWVyMD8iSCI6Ik0iKSxhXS5qb2luKCIuIil9KSl9fSx7a2V5OiJhdmMxIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3ZhciBuPWJlKHQsciksaT1yLnN1YmFycmF5KG4pO2ErPW4sdC5hdmNDPWUuYXZjQyhlLmZpbmRCb3goaSxbImF2Y0MiXSxhKVswXSksdC5wYXNwPWUucGFzcChlLmZpbmRCb3goaSxbInBhc3AiXSxhKVswXSl9KSl9fSx7a2V5OiJhdmNDIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24odCxyKXt0LmRhdGE9ZS5kYXRhLHQuY29uZmlndXJhdGlvblZlcnNpb249clswXSx0LkFWQ1Byb2ZpbGVJbmRpY2F0aW9uPXJbMV0sdC5wcm9maWxlQ29tcGF0aWJpbGl0eT1yWzJdLHQuQVZDTGV2ZWxJbmRpY2F0aW9uPXJbM10sdC5jb2RlYz1yZShbclsxXSxyWzJdLHJbM11dKSx0Lmxlbmd0aFNpemVNaW51c09uZT0zJnJbNF0sdC5zcHNMZW5ndGg9MzEmcls1XSx0LnNwcz1bXTtmb3IodmFyIGE9NixuPTA7bjx0LnNwc0xlbmd0aDtuKyspe3ZhciBpPSQocixhKTthKz0yLHQuc3BzLnB1c2goci5zdWJhcnJheShhLGEraSkpLGErPWl9dC5wcHNMZW5ndGg9clthXSxhKz0xLHQucHBzPVtdO2Zvcih2YXIgcz0wO3M8dC5wcHNMZW5ndGg7cysrKXt2YXIgbz0kKHIsYSk7YSs9Mix0LnBwcy5wdXNoKHIuc3ViYXJyYXkoYSxhKz1vKSksYSs9b319KSl9fSx7a2V5OiJodmMxIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3ZhciBuPWJlKHQsciksaT1yLnN1YmFycmF5KG4pO2ErPW4sdC5odmNDPWUuaHZjQyhlLmZpbmRCb3goaSxbImh2Y0MiXSxhKVswXSksdC5wYXNwPWUucGFzcChlLmZpbmRCb3goaSxbInBhc3AiXSxhKVswXSl9KSl9fSx7a2V5OiJodmNDIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24odCxyKXt0LmRhdGE9ZS5kYXRhLHQuY29kZWM9ImhldjEuMS42Lkw5My5CMCIsdC5jb25maWd1cmF0aW9uVmVyc2lvbj1yWzBdO3ZhciBhPXJbMV07dC5nZW5lcmFsUHJvZmlsZVNwYWNlPWE+PjYsdC5nZW5lcmFsVGllckZsYWc9KDMyJmEpPj41LHQuZ2VuZXJhbFByb2ZpbGVJZGM9MzEmYSx0LmdlbmVyYWxQcm9maWxlQ29tcGF0aWJpbGl0eT1lZShyLDIpLHQuZ2VuZXJhbENvbnN0cmFpbnRJbmRpY2F0b3JGbGFncz1yLnN1YmFycmF5KDYsMTIpLHQuZ2VuZXJhbExldmVsSWRjPXJbMTJdLHQuYXZnRnJhbWVSYXRlPSQociwxOSksdC5udW1PZkFycmF5cz1yWzIyXSx0LnZwcz1bXSx0LnNwcz1bXSx0LnBwcz1bXTtmb3IodmFyIG49MjMsaT0wLHM9MCxvPTAsdT0wO3U8dC5udW1PZkFycmF5czt1Kyspe2k9NjMmcltuXSxzPSQocixuKzEpLG4rPTM7Zm9yKHZhciBjLGw9W10sZj0wO2Y8cztmKyspbz0kKHIsbiksbis9MixsLnB1c2goci5zdWJhcnJheShuLG4rbykpLG4rPW87aWYoMzI9PT1pKShjPXQudnBzKS5wdXNoLmFwcGx5KGMsbCk7ZWxzZSBpZigzMz09PWkpe3ZhciBkOyhkPXQuc3BzKS5wdXNoLmFwcGx5KGQsbCl9ZWxzZSBpZigzND09PWkpe3ZhciBoOyhoPXQucHBzKS5wdXNoLmFwcGx5KGgsbCl9fX0pKX19LHtrZXk6InBhc3AiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCExLChmdW5jdGlvbihlLHQpe2UuaFNwYWNpbmc9ZWUodCksZS52U3BhY2luZz1lZSh0LDQpfSkpfX0se2tleToibXA0YSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt2YXIgbj1fZSh0LHIpO3QuZXNkcz1lLmVzZHMoZS5maW5kQm94KHIuc3ViYXJyYXkobiksWyJlc2RzIl0sYStuKVswXSl9KSl9fSx7a2V5OiJlc2RzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLmNvZGVjPSJtcDRhLiI7Zm9yKHZhciByPTAsYT0wLG49MCxpPTA7dC5sZW5ndGg7KXtmb3IoaT10W3I9MF0sYT10W3IrMV0scis9MjsxMjgmYTspbj0oMTI3JmEpPDw3LGE9dFtyXSxyKz0xO2lmKG4rPTEyNyZhLDM9PT1pKXQ9dC5zdWJhcnJheShyKzMpO2Vsc2V7aWYoNCE9PWkpe2lmKDU9PT1pKXt2YXIgcz1lLmNvbmZpZz10LnN1YmFycmF5KHIscituKSxvPSgyNDgmc1swXSk+PjM7cmV0dXJuIDMxPT09byYmcy5sZW5ndGg+PTImJihvPTMyKygoNyZzWzBdKTw8MykrKCgyMjQmc1sxXSk+PjUpKSxlLm9iamVjdFR5cGU9byxlLmNvZGVjKz1vLnRvU3RyaW5nKDE2KSx2b2lkKCIuIj09PWUuY29kZWNbZS5jb2RlYy5sZW5ndGgtMV0mJihlLmNvZGVjPWUuY29kZWMuc3Vic3RyaW5nKDAsZS5jb2RlYy5sZW5ndGgtMSkpKX1yZXR1cm4gdm9pZCgiLiI9PT1lLmNvZGVjW2UuY29kZWMubGVuZ3RoLTFdJiYoZS5jb2RlYz1lLmNvZGVjLnN1YnN0cmluZygwLGUuY29kZWMubGVuZ3RoLTEpKSl9ZS5jb2RlYys9KHRbcl0udG9TdHJpbmcoMTYpKyIuIikucGFkU3RhcnQoMywiMCIpLHQ9dC5zdWJhcnJheShyKzEzKX19fSkpfX0se2tleToiYWxhdyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITEsKGZ1bmN0aW9uKGUsdCl7X2UoZSx0KX0pKX19LHtrZXk6InN0dHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1lZSh0KSxhPVtdLG49NCxpPTA7aTxyO2krKylhLnB1c2goe2NvdW50OmVlKHQsbiksZGVsdGE6ZWUodCxuKzQpfSksbis9ODtlLmVudHJ5Q291bnQ9cixlLmVudHJpZXM9YX0pKX19LHtrZXk6ImN0dHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPWVlKHQpLGE9W10sbj00O2lmKDE9PT1lLnZlcnNpb24pZm9yKHZhciBpPTA7aTxyO2krKylhLnB1c2goe2NvdW50OmVlKHQsbiksb2Zmc2V0OmVlKHQsbis0KX0pLG4rPTg7ZWxzZSBmb3IodmFyIHM9MDtzPHI7cysrKWEucHVzaCh7Y291bnQ6ZWUodCxuKSxvZmZzZXQ6LSgxK35lZSh0LG4rNCkpfSksbis9ODtlLmVudHJ5Q291bnQ9cixlLmVudHJpZXM9YX0pKX19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1lZSh0KSxhPVtdLG49NCxpPTA7aTxyO2krKylhLnB1c2goe2ZpcnN0Q2h1bms6ZWUodCxuKSxzYW1wbGVzUGVyQ2h1bms6ZWUodCxuKzQpLHNhbXBsZURlc2NyaXB0aW9uSW5kZXg6ZWUodCxuKzgpfSksbis9MTI7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJzdHN6Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXt2YXIgcj1lZSh0KSxhPWVlKHQsNCksbj1bXTtpZighcilmb3IodmFyIGk9OCxzPTA7czxhO3MrKyluLnB1c2goZWUodCxpKSksaSs9NDtlLnNhbXBsZVNpemU9cixlLnNhbXBsZUNvdW50PWEsZS5lbnRyeVNpemVzPW59KSl9fSx7a2V5OiJzdGNvIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZWUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKGVlKHQsbikpLG4rPTQ7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJjbzY0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZWUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKHRlKHQsbikpLG4rPTg7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJzdHNzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZWUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKGVlKHQsbikpLG4rPTQ7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJtb29mIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3QubWZoZD1lLm1maGQoZS5maW5kQm94KHIsWyJtZmhkIl0sYSlbMF0pLHQudHJhZj1lLmZpbmRCb3gocixbInRyYWYiXSxhKS5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWYodCl9KSl9KSl9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLnNlcXVlbmNlTnVtYmVyPWVlKHQpfSkpfX0se2tleToidHJhZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnRmaGQ9ZS50ZmhkKGUuZmluZEJveChyLFsidGZoZCJdLGEpWzBdKSx0LnRmZHQ9ZS50ZmR0KGUuZmluZEJveChyLFsidGZkdCJdLGEpWzBdKSx0LnRydW49ZS50cnVuKGUuZmluZEJveChyLFsidHJ1biJdLGEpWzBdKX0pKX19LHtrZXk6InRydW4iLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPWUudmVyc2lvbixhPWUuZmxhZ3Msbj10Lmxlbmd0aCxpPWUuc2FtcGxlQ291bnQ9ZWUodCkscz00O2lmKG4+cyYmMSZhJiYoZS5kYXRhT2Zmc2V0PS0oMSt+ZWUodCxzKSkscys9NCksbj5zJiY0JmEmJihlLmZpcnN0U2FtcGxlRmxhZ3M9ZWUodCxzKSxzKz00KSxlLnNhbXBsZXM9W10sbj5zKWZvcih2YXIgbyx1PTA7dTxpO3UrKylvPXt9LDI1NiZhJiYoby5kdXJhdGlvbj1lZSh0LHMpLHMrPTQpLDUxMiZhJiYoby5zaXplPWVlKHQscykscys9NCksMTAyNCZhJiYoby5mbGFncz1lZSh0LHMpLHMrPTQpLDIwNDgmYSYmKG8uY3RzPXI/LSgxK35lZSh0LHMrNCkpOmVlKHQscykscys9NCksZS5zYW1wbGVzLnB1c2gobyl9KSl9fSx7a2V5OiJ0ZmR0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXsxPT09ZS52ZXJzaW9uP2UuYmFzZU1lZGlhRGVjb2RlVGltZT10ZSh0KTplLmJhc2VNZWRpYURlY29kZVRpbWU9ZWUodCl9KSl9fSx7a2V5OiJwcm9iZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuISFlLmZpbmRCb3godCxbImZ0eXAiXSl9fSx7a2V5OiJwYXJzZVNhbXBsZUZsYWdzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm57aXNMZWFkaW5nOigxMiZlWzBdKT4+PjIsZGVwZW5kc09uOjMmZVswXSxpc0RlcGVuZGVkT246KDE5MiZlWzFdKT4+PjYsaGFzUmVkdW5kYW5jeTooNDgmZVsxXSk+Pj40LHBhZGRpbmdWYWx1ZTooMTQmZVsxXSk+Pj4xLGlzTm9uU3luY1NhbXBsZToxJmVbMV0sZGVncmFkYXRpb25Qcmlvcml0eTplWzJdPDw4fGVbM119fX0se2tleToibW9vdlRvVHJhY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYSxuLGk9ZS50cmFrO2lmKGkmJmkubGVuZ3RoKXt2YXIgcz1pLmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInZpZGUiPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSksbz1pLmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInNvdW4iPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSk7aWYocyYmdCl7dmFyIHUsYyxsLGYsZCxoLHAsdj10LHk9bnVsbD09PSh1PXMudGtoZCl8fHZvaWQgMD09PXU/dm9pZCAwOnUudHJhY2tJZDtudWxsIT15JiYodi5pZD1zLnRraGQudHJhY2tJZCksdi50a2hkRHVyYXRpb249cy50a2hkLmR1cmF0aW9uLHYubXZoZER1cnRpb249ZS5tdmhkLmR1cmF0aW9uLHYubXZoZFRpbWVjYWxlPWUubXZoZC50aW1lc2NhbGUsdi50aW1lc2NhbGU9di5mb3JtYXRUaW1lc2NhbGU9cy5tZGlhLm1kaGQudGltZXNjYWxlLHYuZHVyYXRpb249cy5tZGlhLm1kaGQuZHVyYXRpb258fHYubXZoZER1cnRpb24vdi5tdmhkVGltZWNhbGUqdi50aW1lc2NhbGUsdi5yb3RhdGlvbj1zLnRraGQucm90YXRpb24sdi5tYXRyaXg9cy50a2hkLm1hdHJpeDt2YXIgbSxnLGssYixfLHcsUyxELFQ9cy5tZGlhLm1pbmYuc3RibC5zdHNkLmVudHJpZXNbMF07aWYodi53aWR0aD1ULndpZHRoLHYuaGVpZ2h0PVQuaGVpZ2h0LFQucGFzcCYmKHYuc2FyUmF0aW89W1QucGFzcC5oU3BhY2luZyxULnBhc3AudlNwYWNpbmddKSxULmF2MUMpdi5jb2RlY1R5cGU9eCx2LmNvZGVjPVQuYXYxQy5jb2RlYyx2LmF2MUM9VC5hdjFDLmRhdGEsdi5jb2xyPVQuY29sci5kYXRhO2Vsc2UgaWYoVC5odmNDKXYuY29kZWNUeXBlPUEsdi5jb2RlYz1ULmh2Y0MuY29kZWMsdi52cHM9VC5odmNDLnZwcyx2LnNwcz1ULmh2Y0Muc3BzLHYucHBzPVQuaHZjQy5wcHMsdi5odmNDPVQuaHZjQy5kYXRhO2Vsc2V7aWYoIVQuYXZjQyl0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdmlkZW8gc3RzZCBlbnRyeSIpO3YuY29kZWM9VC5hdmNDLmNvZGVjLHYuc3BzPVQuYXZjQy5zcHMsdi5wcHM9VC5hdmNDLnBwc31pZih2LnByZXNlbnQ9ITAsdi5leHQ9e30sdi5leHQuc3Rzcz1udWxsPT09KGM9cy5tZGlhKXx8dm9pZCAwPT09Y3x8bnVsbD09PShsPWMubWluZil8fHZvaWQgMD09PWx8fG51bGw9PT0oZj1sLnN0YmwpfHx2b2lkIDA9PT1mP3ZvaWQgMDpmLnN0c3Msdi5leHQuY3R0cz1udWxsPT09KGQ9cy5tZGlhKXx8dm9pZCAwPT09ZHx8bnVsbD09PShoPWQubWluZil8fHZvaWQgMD09PWh8fG51bGw9PT0ocD1oLnN0YmwpfHx2b2lkIDA9PT1wP3ZvaWQgMDpwLmN0dHMsVCYmImVuY3YiPT09VC50eXBlKXYuaXNWaWRlb0VuY3J5cHRpb249ITAsVC5kZWZhdWx0X0tJRD1udWxsPT09KG09VC5zaW5mKXx8dm9pZCAwPT09bXx8bnVsbD09PShnPW0uc2NoaSl8fHZvaWQgMD09PWc/dm9pZCAwOmcudGVuYy5kZWZhdWx0X0tJRCxULmRlZmF1bHRfSXNFbmNyeXB0ZWQ9bnVsbD09PShrPVQuc2luZil8fHZvaWQgMD09PWt8fG51bGw9PT0oYj1rLnNjaGkpfHx2b2lkIDA9PT1iP3ZvaWQgMDpiLnRlbmMuZGVmYXVsdF9Jc0VuY3J5cHRlZCxULmRlZmF1bHRfSVZfc2l6ZT1udWxsPT09KF89VC5zaW5mKXx8dm9pZCAwPT09X3x8bnVsbD09PSh3PV8uc2NoaSl8fHZvaWQgMD09PXc/dm9pZCAwOncudGVuYy5kZWZhdWx0X0lWX3NpemUsdi52aWRlb1NlbmM9cy5tZGlhLm1pbmYuc3RibC5zZW5jJiZzLm1kaWEubWluZi5zdGJsLnNlbmMuc2FtcGxlcyxULmRhdGFfZm9ybWF0PW51bGw9PT0oUz1ULnNpbmYpfHx2b2lkIDA9PT1TfHxudWxsPT09KEQ9Uy5mcm1hKXx8dm9pZCAwPT09RD92b2lkIDA6RC5kYXRhX2Zvcm1hdCx2LnVzZUVNRT1lLnVzZUVNRSx2LmtpZFZhbHVlPWUua2lkVmFsdWUsdi5wc3NoPWUucHNzaCx2LmVuY3Y9VH1pZihvJiZyKXt2YXIgVSxDLFAsSSxNLHosTyxSLEwsVj1yLEY9bnVsbD09PShVPW8udGtoZCl8fHZvaWQgMD09PVU/dm9pZCAwOlUudHJhY2tJZDtudWxsIT1GJiYoVi5pZD1vLnRraGQudHJhY2tJZCksVi50a2hkRHVyYXRpb249by50a2hkLmR1cmF0aW9uLFYubXZoZER1cnRpb249ZS5tdmhkLmR1cmF0aW9uLFYubXZoZFRpbWVjYWxlPWUubXZoZC50aW1lc2NhbGUsVi50aW1lc2NhbGU9Vi5mb3JtYXRUaW1lc2NhbGU9by5tZGlhLm1kaGQudGltZXNjYWxlLFYuZHVyYXRpb249by5tZGlhLm1kaGQuZHVyYXRpb258fFYubXZoZER1cnRpb24vVi5tdmhkVGltZWNhbGUqVi50aW1lc2NhbGU7dmFyIE4saixHLEgsSyxxLFcsWCxZPW8ubWRpYS5taW5mLnN0Ymwuc3RzZC5lbnRyaWVzWzBdO3N3aXRjaChWLnNhbXBsZVNpemU9WS5zYW1wbGVTaXplLFYuc2FtcGxlUmF0ZT1ZLnNhbXBsZVJhdGUsVi5jaGFubmVsQ291bnQ9WS5jaGFubmVsQ291bnQsVi5wcmVzZW50PSEwLFkudHlwZSl7Y2FzZSJhbGF3IjpWLmNvZGVjVHlwZT1WLmNvZGVjPUIsVi5zYW1wbGVSYXRlPThlMzticmVhaztjYXNlInVsYXciOlYuY29kZWNUeXBlPVYuY29kZWM9RSxWLnNhbXBsZVJhdGU9OGUzO2JyZWFrO2RlZmF1bHQ6Vi5zYW1wbGVEdXJhdGlvbj11ZS5nZXRGcmFtZUR1cmF0aW9uKFYuc2FtcGxlUmF0ZSxWLnRpbWVzY2FsZSksVi5zYW1wbGVSYXRlSW5kZXg9dWUuZ2V0UmF0ZUluZGV4QnlSYXRlKFYuc2FtcGxlUmF0ZSksVi5vYmplY3RUeXBlPShudWxsPT09KGE9WS5lc2RzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5vYmplY3RUeXBlKXx8MixZLmVzZHMmJihWLmNvbmZpZz1BcnJheS5mcm9tKFkuZXNkcy5jb25maWcpKSxWLmNvZGVjPShudWxsPT09KG49WS5lc2RzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5jb2RlYyl8fCJtcDRhLjQwLjIifWlmKFYuc2FtcGxlRHVyYXRpb249dWUuZ2V0RnJhbWVEdXJhdGlvbihWLnNhbXBsZVJhdGUsVi50aW1lc2NhbGUpLFYub2JqZWN0VHlwZT0obnVsbD09PShDPVkuZXNkcyl8fHZvaWQgMD09PUM/dm9pZCAwOkMub2JqZWN0VHlwZSl8fDIsWS5lc2RzJiYoWS5lc2RzLmNvbmZpZz9WLmNvbmZpZz1BcnJheS5mcm9tKFkuZXNkcy5jb25maWcpOmNvbnNvbGUud2FybigiZXNkcyBjb25maWcgaXMgbnVsbCIpKSxWLmNvZGVjPShudWxsPT09KFA9WS5lc2RzKXx8dm9pZCAwPT09UD92b2lkIDA6UC5jb2RlYyl8fCJtcDRhLjQwLjIiLFYuc2FtcGxlUmF0ZUluZGV4PXVlLmdldFJhdGVJbmRleEJ5UmF0ZShWLnNhbXBsZVJhdGUpLFYuZXh0PXt9LFYuZXh0LnN0c3M9bnVsbD09PShJPW8ubWRpYSl8fHZvaWQgMD09PUl8fG51bGw9PT0oTT1JLm1pbmYpfHx2b2lkIDA9PT1NfHxudWxsPT09KHo9TS5zdGJsKXx8dm9pZCAwPT09ej92b2lkIDA6ei5zdHNzLFYuZXh0LmN0dHM9bnVsbD09PShPPW8ubWRpYSl8fHZvaWQgMD09PU98fG51bGw9PT0oUj1PLm1pbmYpfHx2b2lkIDA9PT1SfHxudWxsPT09KEw9Ui5zdGJsKXx8dm9pZCAwPT09TD92b2lkIDA6TC5jdHRzLFYucHJlc2VudD0hMCxZJiYiZW5jYSI9PT1ZLnR5cGUpVi5pc0F1ZGlvRW5jcnlwdGlvbj0hMCxZLmRhdGFfZm9ybWF0PW51bGw9PT0oTj1ZLnNpbmYpfHx2b2lkIDA9PT1OfHxudWxsPT09KGo9Ti5mcm1hKXx8dm9pZCAwPT09aj92b2lkIDA6ai5kYXRhX2Zvcm1hdCxZLmRlZmF1bHRfS0lEPW51bGw9PT0oRz1ZLnNpbmYpfHx2b2lkIDA9PT1HfHxudWxsPT09KEg9Ry5zY2hpKXx8dm9pZCAwPT09SD92b2lkIDA6SC50ZW5jLmRlZmF1bHRfS0lELFkuZGVmYXVsdF9Jc0VuY3J5cHRlZD1udWxsPT09KEs9WS5zaW5mKXx8dm9pZCAwPT09S3x8bnVsbD09PShxPUsuc2NoaSl8fHZvaWQgMD09PXE/dm9pZCAwOnEudGVuYy5kZWZhdWx0X0lzRW5jcnlwdGVkLFkuZGVmYXVsdF9JVl9zaXplPW51bGw9PT0oVz1ZLnNpbmYpfHx2b2lkIDA9PT1XfHxudWxsPT09KFg9Vy5zY2hpKXx8dm9pZCAwPT09WD92b2lkIDA6WC50ZW5jLmRlZmF1bHRfSVZfc2l6ZSxWLmF1ZGlvU2VuYz1vLm1kaWEubWluZi5zdGJsLnNlbmMmJm8ubWRpYS5taW5mLnN0Ymwuc2VuYy5zYW1wbGVzLFYudXNlRU1FPWUudXNlRU1FLFYua2lkVmFsdWU9ZS5raWRWYWx1ZSxWLmVuY2E9WX1pZihyJiYoci5pc1ZpZGVvRW5jcnlwdGlvbj0hIXQmJnQuaXNWaWRlb0VuY3J5cHRpb24pLHQmJih0LmlzQXVkaW9FbmNyeXB0aW9uPSEhciYmci5pc0F1ZGlvRW5jcnlwdGlvbiksbnVsbCE9dCYmdC5lbmN2fHxudWxsIT1yJiZyLmVuY2Epe3ZhciBaLFEsSj1udWxsPT10fHxudWxsPT09KFo9dC5lbmN2KXx8dm9pZCAwPT09Wj92b2lkIDA6Wi5kZWZhdWx0X0tJRCwkPW51bGw9PXJ8fG51bGw9PT0oUT1yLmVuY2EpfHx2b2lkIDA9PT1RP3ZvaWQgMDpRLmRlZmF1bHRfS0lELGVlPUp8fCQ/KEp8fCQpLmpvaW4oIiIpOm51bGw7dCYmKHQua2lkPWVlKSxyJiYoci5raWQ9ZWUpfXJldHVybiB0JiYodC5mbGFncz0zODQxKSxyJiYoci5mbGFncz0xNzkzKSx7dmlkZW9UcmFjazp0LGF1ZGlvVHJhY2s6cn19fX0se2tleToiZXZhbHVhdGVEZWZhdWx0RHVyYXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYSxuPW51bGw9PXR8fG51bGw9PT0oYT10LnNhbXBsZXMpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLmxlbmd0aDtyZXR1cm4gbj8xMDI0Km4vdC50aW1lc2NhbGUqZS50aW1lc2NhbGUvcjoxMDI0fX0se2tleToibW9vZlRvU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24odCxyLGEpe3ZhciBuPXt9O3JldHVybiB0Lm1maGQmJihyJiYoci5zZXF1ZW5jZU51bWJlcj10Lm1maGQuc2VxdWVuY2VOdW1iZXIpLGEmJihhLnNlcXVlbmNlTnVtYmVyPXQubWZoZC5zZXF1ZW5jZU51bWJlcikpLHQudHJhZi5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgaT10LnRmaGQscz10LnRmZHQsbz10LnRydW47aWYoaSYmbyl7cyYmKHImJnIuaWQ9PT1pLnRyYWNrSWQmJihyLmJhc2VNZWRpYURlY29kZVRpbWU9cy5iYXNlTWVkaWFEZWNvZGVUaW1lKSxhJiZhLmlkPT09aS50cmFja0lkJiYoYS5iYXNlTWVkaWFEZWNvZGVUaW1lPXMuYmFzZU1lZGlhRGVjb2RlVGltZSkpO3ZhciB1PWkuZGVmYXVsdFNhbXBsZVNpemV8fDAsYz1pLmRlZmF1bHRTYW1wbGVEdXJhdGlvbnx8ZS5ldmFsdWF0ZURlZmF1bHREdXJhdGlvbihyLGEsby5zYW1wbGVzLmxlbmd0aHx8by5zYW1wbGVDb3VudCksbD1vLmRhdGFPZmZzZXR8fDAsZj0wLGQ9LTE7aWYoIW8uc2FtcGxlcy5sZW5ndGgmJm8uc2FtcGxlQ291bnQpe25baS50cmFja0lkXT1bXTtmb3IodmFyIGg9MDtoPG8uc2FtcGxlQ291bnQ7aCsrKW5baS50cmFja0lkXS5wdXNoKHtvZmZzZXQ6bCxkdHM6ZixkdXJhdGlvbjpjLHNpemU6dX0pLGYrPWMsbCs9dX1lbHNlIG5baS50cmFja0lkXT1vLnNhbXBsZXMubWFwKChmdW5jdGlvbihlLHQpe3JldHVybihlPXtvZmZzZXQ6bCxkdHM6ZixwdHM6ZisoZS5jdHN8fDApLGR1cmF0aW9uOmUuZHVyYXRpb258fGMsc2l6ZTplLnNpemV8fHUsZ29wSWQ6ZCxrZXlmcmFtZTowPT09dHx8bnVsbCE9PWUuZmxhZ3MmJnZvaWQgMCE9PWUuZmxhZ3MmJig2NTUzNiZlLmZsYWdzKT4+PjAhPTY1NTM2fSkua2V5ZnJhbWUmJihkKyssZS5nb3BJZD1kKSxmKz1lLmR1cmF0aW9uLGwrPWUuc2l6ZSxlfSkpfX0pKSxufX0se2tleToibW9vdlRvU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50cmFrO2lmKHQmJnQubGVuZ3RoKXt2YXIgcj10LmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInZpZGUiPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSksYT10LmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInNvdW4iPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSk7aWYocnx8YSl7dmFyIG4saTtpZihyKXt2YXIgcyxvLHU9bnVsbD09PShzPXIubWRpYSl8fHZvaWQgMD09PXN8fG51bGw9PT0obz1zLm1pbmYpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLnN0Ymw7aWYoIXUpcmV0dXJuO3ZhciBjPXUuc3R0cyxsPXUuc3RzYyxmPXUuc3RzeixkPXUuc3RjbyxoPXUuc3RzcyxwPXUuY3R0cztpZighKGMmJmwmJmYmJmQmJmgpKXJldHVybjtuPWtlKGMsbCxmLGQscCxoKX1pZihhKXt2YXIgdix5LG0sZz1udWxsPT09KHY9YS5tZGlhKXx8dm9pZCAwPT09dnx8bnVsbD09PSh5PXYubWluZil8fHZvaWQgMD09PXk/dm9pZCAwOnkuc3RibDtpZighZylyZXR1cm47dmFyIGs9bnVsbD09PShtPWEubWRpYS5tZGhkKXx8dm9pZCAwPT09bT92b2lkIDA6bS50aW1lc2NhbGUsYj1nLnN0dHMsXz1nLnN0c2Msdz1nLnN0c3oseD1nLnN0Y287aWYoIShrJiZiJiZfJiZ3JiZ4KSlyZXR1cm47aT1rZShiLF8sdyx4KX1yZXR1cm57dmlkZW9TYW1wbGVzOm4sYXVkaW9TYW1wbGVzOml9fX19fV0pLGV9KCk7ZnVuY3Rpb24ga2UoZSx0LHIsYSxuLGkpe3ZhciBzLG8sdSxjPVtdLGw9bnVsbD09bj92b2lkIDA6bi5lbnRyaWVzLGY9dC5lbnRyaWVzLGQ9YS5lbnRyaWVzLGg9ci5lbnRyeVNpemVzLHA9bnVsbD09aT92b2lkIDA6aS5lbnRyaWVzO3AmJihzPXt9LHAuZm9yRWFjaCgoZnVuY3Rpb24oZSl7c1tlLTFdPSEwfSkpKSxsJiYobz1bXSxsLmZvckVhY2goKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmNvdW50LHI9ZS5vZmZzZXQsYT0wO2E8dDthKyspby5wdXNoKHIpfSkpKTt2YXIgdj0tMSx5PTAsbT0wLGc9MCxrPTAsYj0wLF89ZlswXS5zYW1wbGVzUGVyQ2h1bmssdz1mWzFdP2ZbMV0uZmlyc3RDaHVuay0xOjEvMDtyZXR1cm4gZS5lbnRyaWVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmNvdW50LGE9ZS5kZWx0YSxuPTA7bjx0O24rKyl1PXtkdHM6eSxkdXJhdGlvbjphLHNpemU6aFttXXx8ci5zYW1wbGVTaXplLG9mZnNldDpkW2ddK2IsaW5kZXg6bX0scCYmKHUua2V5ZnJhbWU9c1ttXSx1LmtleWZyYW1lJiZ2KyssdS5nb3BJZD12KSxvJiZtPG8ubGVuZ3RoJiYodS5wdHM9dS5kdHMrb1ttXSksYy5wdXNoKHUpLHkrPWEsKyttPF8/Yis9dS5zaXplOihnKyssYj0wLGc+PXcmJihrKyssdz1mW2srMV0/ZltrKzFdLmZpcnN0Q2h1bmstMToxLzApLF8rPWZba10uc2FtcGxlc1BlckNodW5rKX0pKSxjfWZ1bmN0aW9uIGJlKGUsdCl7cmV0dXJuIGUuZGF0YVJlZmVyZW5jZUluZGV4PSQodCw2KSxlLndpZHRoPSQodCwyNCksZS5oZWlnaHQ9JCh0LDI2KSxlLmhvcml6cmVzb2x1dGlvbj1lZSh0LDI4KSxlLnZlcnRyZXNvbHV0aW9uPWVlKHQsMzIpLGUuZnJhbWVDb3VudD0kKHQsNDApLGUuZGVwdGg9JCh0LDc0KSw3OH1mdW5jdGlvbiBfZShlLHQpe3JldHVybiBlLmRhdGFSZWZlcmVuY2VJbmRleD0kKHQsNiksZS5jaGFubmVsQ291bnQ9JCh0LDE2KSxlLnNhbXBsZVNpemU9JCh0LDE4KSxlLnNhbXBsZVJhdGU9ZWUodCwyNCkvNjU1MzYsMjh9ZnVuY3Rpb24gd2UoZSx0LHIpe2lmKGUpe2lmKGUuc2l6ZSE9PWUuZGF0YS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJib3ggIi5jb25jYXQoZS50eXBlLCIgc2l6ZSAhPT0gZGF0YS5sZW5ndGgiKSk7dmFyIGE9e3N0YXJ0OmUuc3RhcnQsc2l6ZTplLnNpemUsaGVhZGVyU2l6ZTplLmhlYWRlclNpemUsdHlwZTplLnR5cGV9O3JldHVybiB0JiYoYS52ZXJzaW9uPWUuZGF0YVtlLmhlYWRlclNpemVdLGEuZmxhZ3M9ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjA7cmV0dXJuKGVbdF08PDE2KSsoZVt0KzFdPDw4KSsoZVt0KzJdfHwwKX0oZS5kYXRhLGUuaGVhZGVyU2l6ZSsxKSxhLmhlYWRlclNpemUrPTQpLHIoYSxlLmRhdGEuc3ViYXJyYXkoYS5oZWFkZXJTaXplKSxhLnN0YXJ0K2EuaGVhZGVyU2l6ZSksYX19dmFyIHhlPWZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIGE9U3RyaW5nKHIpLG49dD4+MCxpPU1hdGguY2VpbChuL2EubGVuZ3RoKSxzPVtdLG89U3RyaW5nKGUpO2ktLTspcy5wdXNoKGEpO3JldHVybiBzLmpvaW4oIiIpLnN1YnN0cmluZygwLG4tby5sZW5ndGgpK299LFNlPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPVtdLHQ9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheSh0KSxhPTA7YTx0O2ErKylyW2FdPWFyZ3VtZW50c1thXTtyZXR1cm4gci5mb3JFYWNoKChmdW5jdGlvbih0KXtlLnB1c2goeGUoTnVtYmVyKHQpLnRvU3RyaW5nKDE2KSwyLDApKX0pKSxlWzBdfTtmdW5jdGlvbiBBZShlKXtmb3IodmFyIHQ9MCxyPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkocj4xP3ItMTowKSxuPTE7bjxyO24rKylhW24tMV09YXJndW1lbnRzW25dO2EuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dCs9ZS5sZW5ndGh9KSk7dmFyIGk9bmV3IGUodCkscz0wO3JldHVybiBhLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kuc2V0KGUscykscys9ZS5sZW5ndGh9KSksaX12YXIgRGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpLHRoaXMuYnVmZmVyPW5ldyBVaW50OEFycmF5KDApfXJldHVybiBuKGUsW3trZXk6IndyaXRlIix2YWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLHQ9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheSh0KSxhPTA7YTx0O2ErKylyW2FdPWFyZ3VtZW50c1thXTtyLmZvckVhY2goKGZ1bmN0aW9uKHQpe3Q/ZS5idWZmZXI9QWUoVWludDhBcnJheSxlLmJ1ZmZlcix0KTp3aW5kb3cuY29uc29sZS53YXJuKHQpfSkpfX1dLFt7a2V5OiJ3cml0ZVVpbnQxNiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlPj44JjI1NSwyNTUmZV0pfX0se2tleToid3JpdGVVaW50MzIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgVWludDhBcnJheShbZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSl9fV0pLGV9KCksQmU9TWF0aC5wb3coMiwzMiktMSxFZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJib3giLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQ+MT90LTE6MCksYT0xO2E8dDthKyspclthLTFdPWFyZ3VtZW50c1thXTt2YXIgbj04KyhyPXIuZmlsdGVyKEJvb2xlYW4pKS5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCksaT1uZXcgVWludDhBcnJheShuKTtpWzBdPW4+PjI0JjI1NSxpWzFdPW4+PjE2JjI1NSxpWzJdPW4+PjgmMjU1LGlbM109MjU1Jm4saS5zZXQoZSw0KTt2YXIgcz04O3JldHVybiByLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kuc2V0KGUscykscys9ZS5ieXRlTGVuZ3RofSkpLGl9fSx7a2V5OiJmdHlwIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdC5maW5kKChmdW5jdGlvbihlKXtyZXR1cm4gZS50eXBlPT09YiYmZS5jb2RlY1R5cGU9PT1BfSkpP2UuRlRZUEhFVjE6ZS5GVFlQQVZDMX19LHtrZXk6ImluaXRTZWdtZW50Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gUShlLmZ0eXAodCksZS5tb292KHQpKX19LHtrZXk6InBzc2giLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBVaW50OEFycmF5KFsxLDAsMCwwXS5jb25jYXQoWzE2LDExOSwyMzksMjM2LDE5MiwxNzgsNzcsMiwxNzIsMjI3LDYwLDMwLDgyLDIyNiwyNTEsNzVdLFswLDAsMCwxXSxuZSh0LmtpZCksWzAsMCwwLDBdKSk7cmV0dXJuIGUuYm94KGUudHlwZXMucHNzaCxyKX19LHtrZXk6Im1vb3YiLHZhbHVlOmZ1bmN0aW9uKHQpe2lmKHRbMF0udXNlRU1FJiYodFswXS5lbmN2fHx0WzBdLmVuY2EpKXt0WzBdLnBzc2h8fCh0WzBdLnBzc2g9e2tpZDp0WzBdLmtpZH0pO3ZhciByPXRoaXMucHNzaCh0WzBdLnBzc2gpO3JldHVybiBlLmJveC5hcHBseShlLFtlLnR5cGVzLm1vb3YsZS5tdmhkKHRbMF0ubXZoZER1cnRpb258fHRbMF0uZHVyYXRpb24sdFswXS5tdmhkVGltZWNhbGV8fHRbMF0udGltZXNjYWxlKSxlLm12ZXgodCldLmNvbmNhdCh5KHQubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFrKHQpfSkpKSxbcl0pKX1yZXR1cm4gZS5ib3guYXBwbHkoZSxbZS50eXBlcy5tb292LGUubXZoZCh0WzBdLm12aGREdXJ0aW9ufHx0WzBdLmR1cmF0aW9uLHRbMF0ubXZoZFRpbWVjYWxlfHx0WzBdLnRpbWVzY2FsZSldLmNvbmNhdCh5KHQubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFrKHQpfSkpKSxbZS5tdmV4KHQpXSkpfX0se2tleToibXZoZCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjllNCxhPWUuYm94KGUudHlwZXMubXZoZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcix0Pj4yNCYyNTUsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0LDAsMSwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDY0LDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDI1NSwyNTUsMjU1LDI1NV0pKTtyZXR1cm4gYX19LHtrZXk6InRyYWsiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLnRyYWssZS50a2hkKHQuaWQsdC50a2hkRHVyYXRpb258fDAsdC53aWR0aCx0LmhlaWdodCksZS5tZGlhKHQpKX19LHtrZXk6InRraGQiLHZhbHVlOmZ1bmN0aW9uKHQscil7dmFyIGE9YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOjAsbj1hcmd1bWVudHMubGVuZ3RoPjMmJnZvaWQgMCE9PWFyZ3VtZW50c1szXT9hcmd1bWVudHNbM106MCxpPWUuYm94KGUudHlwZXMudGtoZCxuZXcgVWludDhBcnJheShbMCwwLDAsNywwLDAsMCwwLDAsMCwwLDAsdD4+MjQmMjU1LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCwwLDAsMCwwLHI+PjI0JjI1NSxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsYT4+OCYyNTUsMjU1JmEsMCwwLG4+PjgmMjU1LDI1NSZuLDAsMF0pKTtyZXR1cm4gaX19LHtrZXk6Im1kaWEiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1kaWEsZS5tZGhkKHQuZHVyYXRpb24sdC50aW1lc2NhbGUpLGUuaGRscih0LnR5cGUpLGUubWluZih0KSl9fSx7a2V5OiJtZGhkIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06OWU0LGE9ZS5ib3goZS50eXBlcy5tZGhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyLHQ+PjI0JjI1NSx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnQsODUsMTk2LDAsMF0pKTtyZXR1cm4gYX19LHtrZXk6ImhkbHIiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLmhkbHIsZS5IRExSX1RZUEVTW3RdKX19LHtrZXk6Im1pbmYiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1pbmYsdC50eXBlPT09Yj9lLlZNSEQ6ZS5TTUhELGUuRElORixlLnN0YmwodCkpfX0se2tleToic3RibCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9W107cmV0dXJuIHQmJnQuZXh0JiZ0LmV4dC5zdHNzJiZyLnB1c2goZS5zdHNzKHQuZXh0LnN0c3MuZW50cmllcykpLGUuYm94KGUudHlwZXMuc3RibCxlLnN0c2QodCksZS5TVFRTLHJbMF0sZS5TVFNDLGUuU1RTWixlLlNUQ08pfX0se2tleToic3RzZCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI7cmV0dXJuIHI9ImF1ZGlvIj09PXQudHlwZT90LnVzZUVNRSYmdC5lbmNhP2UuZW5jYSh0KTplLm1wNGEodCk6dC51c2VFTUUmJnQuZW5jdj9lLmVuY3YodCk6dC5hdjFDP2UuYXYwMSh0KTplLmF2YzFoZXYxKHQpLGUuYm94KGUudHlwZXMuc3RzZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxXSkscil9fSx7a2V5OiJlbmNhIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10LmVuY2EuY2hhbm5lbENvdW50LGE9dC5lbmNhLnNhbXBsZVJhdGUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLHIsMCwxNiwwLDAsMCwwLGE+PjgmMjU1LDI1NSZhLDAsMF0pLGk9ZS5lc2RzKHQuY29uZmlnKSxzPWUuc2luZih0LmVuY2EpO3JldHVybiBlLmJveChlLnR5cGVzLmVuY2EsbixpLHMpfX0se2tleToiZW5jdiIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHIsYSxuPXQuc3BzLmxlbmd0aD4wP3Quc3BzWzBdOltdLGk9dC5wcHMubGVuZ3RoPjA/dC5wcHNbMF06W10scz10LndpZHRoLG89dC5oZWlnaHQsdT10LnNhclJhdGlvWzBdLGM9dC5zYXJSYXRpb1sxXSxsPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxzPj44JjI1NSwyNTUmcyxvPj44JjI1NSwyNTUmbywwLDcyLDAsMCwwLDcyLDAsMCwwLDAsMCwwLDAsMSwxOCwxMDAsOTcsMTA1LDEwOCwxMjEsMTA5LDExMSwxMTYsMTA1LDExMSwxMTAsNDcsMTA0LDEwOCwxMTUsNDYsMTA2LDExNSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMjQsMTcsMTddKSxmPW5ldyBVaW50OEFycmF5KChyPShhPVsxLG5bMV0sblsyXSxuWzNdLDI1NSwyMjUsbi5sZW5ndGg+Pj44JjI1NSwyNTUmbi5sZW5ndGhdKS5jb25jYXQuYXBwbHkoYSx5KG4pKS5jb25jYXQoWzEsaS5sZW5ndGg+Pj44JjI1NSwyNTUmaS5sZW5ndGhdKSkuY29uY2F0LmFwcGx5KHIseShpKSkpLGQ9bmV3IFVpbnQ4QXJyYXkoWzAsMCw4OCw1NywwLDE1LDIwMCwxOTIsMCw0LDg2LDcyXSksaD1lLnNpbmYodC5lbmN2KSxwPW5ldyBVaW50OEFycmF5KFt1Pj4yNCx1Pj4xNiYyNTUsdT4+OCYyNTUsMjU1JnUsYz4+MjQsYz4+MTYmMjU1LGM+PjgmMjU1LDI1NSZjXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuZW5jdixsLGUuYm94KGUudHlwZXMuYXZjQyxmKSxlLmJveChlLnR5cGVzLmJ0cnQsZCksaCxlLmJveChlLnR5cGVzLnBhc3AscCkpfX0se2tleToic2NoaSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IFVpbnQ4QXJyYXkoW10pLGE9ZS50ZW5jKHQpO3JldHVybiBlLmJveChlLnR5cGVzLnNjaGkscixhKX19LHtrZXk6InRlbmMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwyNTUmdC5kZWZhdWx0X0lzRW5jcnlwdGVkLDI1NSZ0LmRlZmF1bHRfSVZfc2l6ZV0uY29uY2F0KG5lKHQuZGVmYXVsdF9LSUQpKSk7cmV0dXJuIGUuYm94KGUudHlwZXMudGVuYyxyKX19LHtrZXk6InNpbmYiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBVaW50OEFycmF5KFtdKSxhPW5ldyBVaW50OEFycmF5KFt0LmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMCksdC5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDEpLHQuZGF0YV9mb3JtYXQuY2hhckNvZGVBdCgyKSx0LmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMyldKSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDk5LDEwMSwxMTAsOTksMCwxLDAsMF0pLGk9ZS5zY2hpKHQpO3JldHVybiBlLmJveChlLnR5cGVzLnNpbmYscixlLmJveChlLnR5cGVzLmZybWEsYSksZS5ib3goZS50eXBlcy5zY2htLG4pLGkpfX0se2tleToiYXYwMSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMuYXYwMSxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsdC53aWR0aD4+OCYyNTUsMjU1JnQud2lkdGgsdC5oZWlnaHQ+PjgmMjU1LDI1NSZ0LmhlaWdodCwwLDcyLDAsMCwwLDcyLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLHQuYXYxQyx0LmNvbHIpfX0se2tleToiYXZjMWhldjEiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuY29kZWNUeXBlPT09QSxhPXI/ZS50eXBlcy5odmMxOmUudHlwZXMuYXZjMSxuPXI/ZS5odmNDKHQpOmUuYXZjQyh0KSxpPVtuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsdC53aWR0aD4+OCYyNTUsMjU1JnQud2lkdGgsdC5oZWlnaHQ+PjgmMjU1LDI1NSZ0LmhlaWdodCwwLDcyLDAsMCwwLDcyLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLG5dO3JldHVybiByP2kucHVzaChlLmJveChlLnR5cGVzLmZpZWwsbmV3IFVpbnQ4QXJyYXkoWzEsMF0pKSk6dC5zYXJSYXRpbyYmdC5zYXJSYXRpby5sZW5ndGg+MSYmaS5wdXNoKGUucGFzcCh0LnNhclJhdGlvKSksZS5ib3guYXBwbHkoZSxbYV0uY29uY2F0KGkpKX19LHtrZXk6ImF2Y0MiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByLGEsbixpPVtdLHM9W107cmV0dXJuIHQuc3BzLmZvckVhY2goKGZ1bmN0aW9uKGUpe249ZS5ieXRlTGVuZ3RoLGkucHVzaChuPj4+OCYyNTUpLGkucHVzaCgyNTUmbiksaS5wdXNoLmFwcGx5KGkseShlKSl9KSksdC5wcHMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7bj1lLmJ5dGVMZW5ndGgscy5wdXNoKG4+Pj44JjI1NSkscy5wdXNoKDI1NSZuKSxzLnB1c2guYXBwbHkocyx5KGUpKX0pKSxlLmJveChlLnR5cGVzLmF2Y0MsbmV3IFVpbnQ4QXJyYXkoKHI9KGE9WzEsaVszXSxpWzRdLGlbNV0sMjU1LDIyNHx0LnNwcy5sZW5ndGhdKS5jb25jYXQuYXBwbHkoYSxpKS5jb25jYXQoW3QucHBzLmxlbmd0aF0pKS5jb25jYXQuYXBwbHkocixzKSkpfX0se2tleToiaHZjQyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC5odmNDO2lmKHIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcnx8ciBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpcmV0dXJuIHI7dmFyIGEsbj10LnZwcyxpPXQuc3BzLHM9dC5wcHM7aWYocil7dmFyIG89ci5nZW5lcmFsUHJvZmlsZUNvbXBhdGliaWxpdHlGbGFncyx1PXIuZ2VuZXJhbENvbnN0cmFpbnRJbmRpY2F0b3JGbGFncyxjPShuLmxlbmd0aCYmMSkrKGkubGVuZ3RoJiYxKSsocy5sZW5ndGgmJjEpO2E9WzEsci5nZW5lcmFsUHJvZmlsZVNwYWNlPDw2fHIuZ2VuZXJhbFRpZXJGbGFnPDw1fHIuZ2VuZXJhbFByb2ZpbGVJZGMsbz4+PjI0LG8+Pj4xNixvPj4+OCxvLHVbMF0sdVsxXSx1WzJdLHVbM10sdVs0XSx1WzVdLHIuZ2VuZXJhbExldmVsSWRjLDI0MCwwLDI1MiwyNTJ8ci5jaHJvbWFGb3JtYXRJZGMsMjQ4fHIuYml0RGVwdGhMdW1hTWludXM4LDI0OHxyLmJpdERlcHRoQ2hyb21hTWludXM4LDAsMCxyLm51bVRlbXBvcmFsTGF5ZXJzPDwzfHIudGVtcG9yYWxJZE5lc3RlZDw8MnwzLGNdO3ZhciBsPWZ1bmN0aW9uKGUpe3ZhciB0O2EucHVzaChlLmxlbmd0aD4+OCxlLmxlbmd0aCksKHQ9YSkucHVzaC5hcHBseSh0LHkoZSkpfTtuLmxlbmd0aCYmKGEucHVzaCgxNjAsMCxuLmxlbmd0aCksbi5mb3JFYWNoKGwpKSxpLmxlbmd0aCYmKGEucHVzaCgxNjEsMCxpLmxlbmd0aCksaS5mb3JFYWNoKGwpKSxzLmxlbmd0aCYmKGEucHVzaCgxNjIsMCxzLmxlbmd0aCkscy5mb3JFYWNoKGwpKX1lbHNlIGE9WzEsMSw5NiwwLDAsMCwxNDQsMCwwLDAsMCwwLDkzLDI0MCwwLDI1MiwyNTMsMjQ4LDI0OCwwLDAsMTUsMywxNjAsMCwxLDAsMjQsNjQsMSwxMiwxLDI1NSwyNTUsMSw5NiwwLDAsMywwLDE0NCwwLDAsMywwLDAsMywwLDkzLDE1MywxNTIsOSwxNjEsMCwxLDAsNDUsNjYsMSwxLDEsOTYsMCwwLDMsMCwxNDQsMCwwLDMsMCwwLDMsMCw5MywxNjAsMiwxMjgsMTI4LDQ1LDIyLDg5LDE1MywxNjQsMTQ3LDQzLDE1NCwxMjgsMTI4LDEyOCwxMzAsMCwwLDMsMCwyLDAsMCwzLDAsNTAsMTYsMTYyLDAsMSwwLDcsNjgsMSwxOTMsMTE0LDE4MCw5OCw2NF07cmV0dXJuIGUuYm94KGUudHlwZXMuaHZjQyxuZXcgVWludDhBcnJheShhKSl9fSx7a2V5OiJwYXNwIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj12KHQsMiksYT1yWzBdLG49clsxXTtyZXR1cm4gZS5ib3goZS50eXBlcy5wYXNwLG5ldyBVaW50OEFycmF5KFthPj4yNCxhPj4xNiYyNTUsYT4+OCYyNTUsMjU1JmEsbj4+MjQsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuXSkpfX0se2tleToibXA0YSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMubXA0YSxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLHQuY2hhbm5lbENvdW50LDAsMTYsMCwwLDAsMCx0LnNhbXBsZVJhdGU+PjgmMjU1LDI1NSZ0LnNhbXBsZVJhdGUsMCwwXSksdC5jb25maWcubGVuZ3RoP2UuZXNkcyh0LmNvbmZpZyk6dm9pZCAwKX19LHtrZXk6ImVzZHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoO3JldHVybiBlLmJveChlLnR5cGVzLmVzZHMsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMywyMytyLDAsMCwwLDQsMTUrciw2NCwyMSwwLDYsMCwwLDAsMjE4LDE5MiwwLDAsMjE4LDE5Miw1XS5jb25jYXQoW3JdKS5jb25jYXQodCkuY29uY2F0KFs2LDEsMl0pKSl9fSx7a2V5OiJtdmV4Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3guYXBwbHkoZSxbZS50eXBlcy5tdmV4XS5jb25jYXQoeSh0Lm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIGUudHJleCh0LmlkKX0pKSkpKX19LHtrZXk6InRyZXgiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLnRyZXgsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0LDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDFdKSl9fSx7a2V5OiJ0cmV4MSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMudHJleCxuZXcgVWludDhBcnJheShbMCwwLDAsMCx0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnQsMCwwLDAsMSwwLDAsMiwwLDAsMCwwLDAsMCwxLDAsMF0pKX19LHtrZXk6InRyZXgyIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy50cmV4LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHQ+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCwwLDAsMCwxLDAsMCw0LDAsMCwwLDAsMCwyLDAsMCwwXSkpfX0se2tleToibW9vZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94LmFwcGx5KGUsW2UudHlwZXMubW9vZixlLm1maGQodFswXS5zYW1wbGVzP3RbMF0uc2FtcGxlc1swXS5nb3BJZDowKV0uY29uY2F0KHkodC5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWYodCl9KSkpKSl9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5tZmhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHQ+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdF0pKX19LHtrZXk6InRyYWYiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPWUudGZoZCh0LmlkKSxhPWUudGZkdCh0LHQuYmFzZU1lZGlhRGVjb2RlVGltZSksbj0wO2lmKHQuaXNWaWRlbyYmdC52aWRlb1NlbmMmJnQudmlkZW9TZW5jLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPTgsZS5zdWJzYW1wbGVzJiZlLnN1YnNhbXBsZXMubGVuZ3RoJiYobis9MixuKz02KmUuc3Vic2FtcGxlcy5sZW5ndGgpfSkpLHQudmlkZW9TZW5jTGVuZ3RoPW4sdC51c2VFTUUmJih0LmlzVmlkZW9FbmNyeXB0aW9ufHx0LmlzQXVkaW9FbmNyeXB0aW9uKSl7aWYodC5pc1ZpZGVvRW5jcnlwdGlvbil7aWYodC5pc1ZpZGVvKXt2YXIgaT1lLnNhaXoodCkscz1lLnNhaW8odCksbz1lLnRydW4xKHQpLHU9ZS5zZW5jKHQpO3JldHVybiBlLmJveChlLnR5cGVzLnRyYWYscixhLGkscyxvLHUpfWlmKHQuaXNBdWRpb0VuY3J5cHRpb24pe3ZhciBjPWUuc2JncCgpLGw9ZS5zYWl6KHQpLGY9ZS5zYWlvKHQpLGQ9ZS5zZW5jKHQpLGg9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSxjLGwsZixkLGgpfXZhciBwPWUuc2JncCgpLHY9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSxwLHYpfWlmKHQuaXNWaWRlbyl7dmFyIHk9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSx5KX12YXIgbT1lLnNiZ3AoKSxnPWUuc2Fpeih0KSxrPWUuc2Fpbyh0KSxiPWUuc2VuYyh0KSxfPWUudHJ1bjEodCk7cmV0dXJuIGUuYm94KGUudHlwZXMudHJhZixyLGEsbSxnLGssYixfKX12YXIgdz1lLnNkdHAodCk7cmV0dXJuIGUuYm94KGUudHlwZXMudHJhZixyLGEsdyxlLnRydW4odC5zYW1wbGVzLHcuYnl0ZUxlbmd0aCs3NikpfX0se2tleToic2R0cCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IERlO3JldHVybiB0LnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShuZXcgVWludDhBcnJheSh0LmlzVmlkZW8/W2Uua2V5ZnJhbWU/MzI6MTZdOlsxNl0pKX0pKSxlLmJveChlLnR5cGVzLnNkdHAsdGhpcy5leHRlbnNpb24oMCwwKSxyLmJ1ZmZlcil9fSx7a2V5OiJ0cnVuMSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IERlLGE9RGUud3JpdGVVaW50MzIodC5zYW1wbGVzLmxlbmd0aCksbj1udWxsO2lmKHQuaXNWaWRlbyl7dmFyIGk9dC52aWRlb1NlbmNMZW5ndGg7bj1EZS53cml0ZVVpbnQzMigxNip0LnNhbXBsZXMubGVuZ3RoK2krMTQ5KSwhdC5pc1ZpZGVvRW5jcnlwdGlvbiYmdC5pc0F1ZGlvRW5jcnlwdGlvbiYmKG49RGUud3JpdGVVaW50MzIoMTYqdC5zYW1wbGVzLmxlbmd0aCs5MikpfWVsc2V7dmFyIHM9MTIqdC5zYW1wbGVzLmxlbmd0aCsxMjQ7dC5pc0F1ZGlvRW5jcnlwdGlvbiYmKHM9MTIqdC5zYW1wbGVzLmxlbmd0aCs4KnQuYXVkaW9TZW5jLmxlbmd0aCsxNzcpLG49RGUud3JpdGVVaW50MzIocyl9cmV0dXJuIHQuc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtyLndyaXRlKERlLndyaXRlVWludDMyKGUuZHVyYXRpb24pKSxyLndyaXRlKERlLndyaXRlVWludDMyKGUuc2l6ZSkpLHIud3JpdGUoRGUud3JpdGVVaW50MzIoZS5rZXlmcmFtZT8zMzU1NDQzMjo2NTUzNikpLHQuaXNWaWRlbyYmci53cml0ZShEZS53cml0ZVVpbnQzMihlLmN0cz9lLmN0czowKSl9KSksZS5ib3goZS50eXBlcy50cnVuLHRoaXMuZXh0ZW5zaW9uKDAsdC5mbGFncyksYSxuLHIuYnVmZmVyKX19LHtrZXk6InNlbmMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBEZSxhPXQuc2FtcGxlcy5sZW5ndGgsbj10LmlzVmlkZW8/MTY6OCxpPXQuaXNWaWRlbz8yOjAscz1bXSxvPTA7cmV0dXJuIHQuaXNWaWRlbz8ocz10LnZpZGVvU2VuYyxvPXQudmlkZW9TZW5jTGVuZ3RoKTpzPXQuYXVkaW9TZW5jLG89b3x8biphLHIud3JpdGUoRGUud3JpdGVVaW50MzIoMTYrbyksZS50eXBlcy5zZW5jLHRoaXMuZXh0ZW5zaW9uKDAsaSkpLHIud3JpdGUoRGUud3JpdGVVaW50MzIoYSkpLHMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTA7dDxlLkluaXRpYWxpemF0aW9uVmVjdG9yLmxlbmd0aDt0Kyspci53cml0ZShuZXcgVWludDhBcnJheShbZS5Jbml0aWFsaXphdGlvblZlY3Rvclt0XV0pKTtlLnN1YnNhbXBsZXMmJmUuc3Vic2FtcGxlcy5sZW5ndGgmJihyLndyaXRlKERlLndyaXRlVWludDE2KGUuc3Vic2FtcGxlcy5sZW5ndGgpKSxlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShEZS53cml0ZVVpbnQxNihlLkJ5dGVzT2ZDbGVhckRhdGEpKSxyLndyaXRlKERlLndyaXRlVWludDMyKGUuQnl0ZXNPZlByb3RlY3RlZERhdGEpKX0pKSl9KSksci5idWZmZXJ9fSx7a2V5OiJzYWlvIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj0xMip0LnNhbXBsZXMubGVuZ3RoKzE0MTshdC5pc1ZpZGVvJiZ0LmlzQXVkaW9FbmNyeXB0aW9uJiYocj0xNDkpO3ZhciBhPW5ldyBVaW50OEFycmF5KFsxLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuc2FpbyxhKX19LHtrZXk6InNhaXoiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuc2FtcGxlcy5sZW5ndGgsYT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwxNixyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuc2FpeixhKX19LHtrZXk6InNiZ3AiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoWzExNCwxMTEsMTA4LDEwOCwwLDAsMCwxLDAsMCwxLDI1LDAsMCwwLDFdKTtyZXR1cm4gZS5ib3goZS50eXBlcy5zYmdwLHRoaXMuZXh0ZW5zaW9uKDAsMCksdCl9fSx7a2V5OiJleHRlbnNpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlLHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdF0pfX0se2tleToidGZoZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMudGZoZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCx0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnRdKSl9fSx7a2V5OiJ0ZmR0Iix2YWx1ZTpmdW5jdGlvbih0LHIpe3ZhciBhPU1hdGguZmxvb3Ioci8oQmUrMSkpLG49TWF0aC5mbG9vcihyJShCZSsxKSk7cmV0dXJuIHQudXNlRU1FJiYodC5pc1ZpZGVvRW5jcnlwdGlvbnx8dC5pc0F1ZGlvRW5jcnlwdGlvbik/ZS5ib3goZS50eXBlcy50ZmR0LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pKTplLmJveChlLnR5cGVzLnRmZHQsbmV3IFVpbnQ4QXJyYXkoWzEsMCwwLDAsYT4+MjQsYT4+MTYmMjU1LGE+PjgmMjU1LDI1NSZhLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pKX19LHtrZXk6InRydW4iLHZhbHVlOmZ1bmN0aW9uKHQscil7dmFyIGE9dC5sZW5ndGgsbj0xMisxNiphO3IrPTgrbjt2YXIgaT1uZXcgVWludDhBcnJheShuKTtpLnNldChbMCwwLDE1LDEsYT4+PjI0JjI1NSxhPj4+MTYmMjU1LGE+Pj44JjI1NSwyNTUmYSxyPj4+MjQmMjU1LHI+Pj4xNiYyNTUscj4+PjgmMjU1LDI1NSZyXSwwKTtmb3IodmFyIHM9MDtzPGE7cysrKXt2YXIgbz10W3NdLHU9by5kdXJhdGlvbixjPW8uc2l6ZSxsPW8uZmxhZyxmPXZvaWQgMD09PWw/e306bCxkPW8uY3RzLGg9dm9pZCAwPT09ZD8wOmQ7aS5zZXQoW3U+Pj4yNCYyNTUsdT4+PjE2JjI1NSx1Pj4+OCYyNTUsMjU1JnUsYz4+PjI0JjI1NSxjPj4+MTYmMjU1LGM+Pj44JjI1NSwyNTUmYyxmLmlzTGVhZGluZzw8MnwobnVsbD09PWYuZGVwZW5kc09ufHx2b2lkIDA9PT1mLmRlcGVuZHNPbj8xOmYuZGVwZW5kc09uKSxmLmlzRGVwZW5kZWRPbjw8NnxmLmhhc1JlZHVuZGFuY3k8PDR8Zi5wYWRkaW5nVmFsdWU8PDF8KG51bGw9PT1mLmlzTm9uU3luY1NhbXBsZXx8dm9pZCAwPT09Zi5pc05vblN5bmNTYW1wbGU/MTpmLmlzTm9uU3luY1NhbXBsZSksNjE0NDAmZi5kZWdyYWRhdGlvblByaW9yaXR5LDE1JmYuZGVncmFkYXRpb25Qcmlvcml0eSxoPj4+MjQmMjU1LGg+Pj4xNiYyNTUsaD4+PjgmMjU1LDI1NSZoXSwxMisxNipzKX1yZXR1cm4gZS5ib3goZS50eXBlcy50cnVuLGkpfX0se2tleToibW9vdk1QNCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94LmFwcGx5KGUsW2UudHlwZXMubW9vdixlLm12aGQodFswXS5kdXJhdGlvbix0WzBdLnRpbWVzY2FsZSldLmNvbmNhdCh5KHQubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFja01QNCh0KX0pKSkpKX19LHtrZXk6InRyYWNrTVA0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFrLGUudGtoZCh0LmlkLHQuZHVyYXRpb24sdC53aWR0aCx0LmhlaWdodCksZS5tZGlhTVA0KHQpKX19LHtrZXk6Im1kaWFNUDQiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1kaWEsZS5tZGhkKHQuZHVyYXRpb24sdC50aW1lc2NhbGUpLGUuaGRscih0LnR5cGUpLGUubWluZk1QNCh0KSl9fSx7a2V5OiJtaW5mTVA0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5taW5mLHQudHlwZT09PWI/ZS5WTUhEOmUuU01IRCxlLkRJTkYsZS5zdGJsTVA0KHQpKX19LHtrZXk6InN0YmxNUDQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuZXh0LGE9W2Uuc3RzZCh0KSxlLnN0dHMoci5zdHRzKSxlLnN0c2Moci5zdHNjKSxlLnN0c3ooci5zdHN6KSxlLnN0Y28oci5zdGNvKV07cmV0dXJuIHIuc3Rzcy5sZW5ndGgmJmEucHVzaChlLnN0c3Moci5zdHNzKSksci5jdHRzLmxlbmd0aCYmYS5wdXNoKGUuY3R0cyhyLmN0dHMpKSxlLmJveC5hcHBseShlLFtlLnR5cGVzLnN0YmxdLmNvbmNhdChhKSl9fSx7a2V5OiJzdHRzIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDgqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUudmFsdWUscj1lLmNvdW50O2Euc2V0KFtyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0XSxuKSxuKz04fSkpLGUuYm94KGUudHlwZXMuc3R0cyxRKG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLGEpKX19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoLGE9bmV3IFVpbnQ4QXJyYXkoMTIqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUuZmlyc3RDaHVuayxyPWUuc2FtcGxlc1BlckNodW5rLGk9ZS5zYW1wbGVEZXNjSW5kZXg7YS5zZXQoW3Q+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsaT4+MjQsaT4+MTYmMjU1LGk+PjgmMjU1LDI1NSZpXSxuKSxuKz0xMn0pKSxlLmJveChlLnR5cGVzLnN0c2MsUShuZXcgVWludDhBcnJheShbMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxhKSl9fSx7a2V5OiJzdHN6Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDQqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe2Euc2V0KFtlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdLG4pLG4rPTR9KSksZS5ib3goZS50eXBlcy5zdHN6LFEobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxhKSl9fSx7a2V5OiJzdGNvIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDQqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe2Euc2V0KFtlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdLG4pLG4rPTR9KSksZS5ib3goZS50eXBlcy5zdGNvLFEobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksYSkpfX0se2tleToic3RzcyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC5sZW5ndGgsYT1uZXcgVWludDhBcnJheSg0KnIpLG49MDtyZXR1cm4gdC5mb3JFYWNoKChmdW5jdGlvbihlKXthLnNldChbZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSxuKSxuKz00fSkpLGUuYm94KGUudHlwZXMuc3RzcyxRKG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLGEpKX19LHtrZXk6ImN0dHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoLGE9bmV3IFVpbnQ4QXJyYXkoOCpyKSxuPTA7cmV0dXJuIHQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS52YWx1ZSxyPWUuY291bnQ7YS5zZXQoW3I+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcix0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnRdLG4pLG4rPTh9KSksZS5ib3goZS50eXBlcy5jdHRzLFEobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksYSkpfX0se2tleToic3R5cCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gZS5ib3goZS50eXBlcy5zdHlwLG5ldyBVaW50OEFycmF5KFsxMDksMTE1LDEwMCwxMDQsMCwwLDAsMCwxMDksMTE1LDEwMCwxMDQsMTA5LDExNSwxMDUsMTIwXSkpfX0se2tleToic2lkeCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC50aW1lc2NhbGUsYT10LnNhbXBsZXNbMF0uZHVyYXRpb24sbj1hKnQuc2FtcGxlcy5sZW5ndGgsaT10LnNhbXBsZXNbMF0uc2FtcGxlT2Zmc2V0KmEscz04O3Quc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtzKz1lLnNpemV9KSk7dmFyIG89MDtpZih0LmlzVmlkZW8pe3ZhciB1LGM9MDt0LnZpZGVvU2VuYyYmKHU9dC52aWRlb1NlbmMpLHQuaXNWaWRlbyYmdS5mb3JFYWNoKChmdW5jdGlvbihlKXtjKz04LGUuc3Vic2FtcGxlcyYmZS5zdWJzYW1wbGVzLmxlbmd0aCYmKGMrPTIsYys9NiplLnN1YnNhbXBsZXMubGVuZ3RoKX0pKSx0LnZpZGVvU2VuY0xlbmd0aD1jLG89cysxNDErMTYqdC5zYW1wbGVzLmxlbmd0aCtjLHQudXNlRU1FJiZ0LmlzQXVkaW9FbmNyeXB0aW9uJiYhdC5pc1ZpZGVvRW5jcnlwdGlvbiYmKG89cysxNip0LnNhbXBsZXMubGVuZ3RoKzg0KX1lbHNlIG89cysxMTYrMTIqdC5zYW1wbGVzLmxlbmd0aCx0LnVzZUVNRSYmdC5pc0F1ZGlvRW5jcnlwdGlvbiYmKG89cysxNjkrMTIqdC5zYW1wbGVzLmxlbmd0aCs4KnQuYXVkaW9TZW5jLmxlbmd0aCk7dmFyIGw9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMjU1JnQuaWQscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcixpPj4yNCYyNTUsaT4+MTYmMjU1LGk+PjgmMjU1LDI1NSZpLDAsMCwwLDAsMCwwLDAsMSwwLG8+PjE2JjI1NSxvPj44JjI1NSwyNTUmbyxuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLDE0NCwwLDAsMF0pO3JldHVybiBlLmJveChlLnR5cGVzLnNpZHgsbCl9fSx7a2V5OiJtZGF0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5tZGF0LHQpfX1dKSxlfSgpO2koRWUsInR5cGVzIixbImF2MDEiLCJhdjFDIiwiYXZjMSIsImF2Y0MiLCJodmMxIiwiaHZjQyIsImRpbmYiLCJkcmVmIiwiZXNkcyIsImZ0eXAiLCJoZGxyIiwibWRhdCIsIm1kaGQiLCJtZGlhIiwibWZoZCIsIm1pbmYiLCJtb29mIiwibW9vdiIsIm1wNGEiLCJtdmV4IiwibXZoZCIsInBhc3AiLCJzdGJsIiwic3RjbyIsInN0c2MiLCJzdHNkIiwic3RzeiIsInN0dHMiLCJ0ZmR0IiwidGZoZCIsInRyYWYiLCJ0cmFrIiwidHJleCIsInRraGQiLCJ2bWhkIiwic21oZCIsImN0dHMiLCJzdHNzIiwic3R5cCIsInBzc2giLCJzaWR4Iiwic2JncCIsInNhaXoiLCJzYWlvIiwic2VuYyIsInRydW4iLCJlbmN2IiwiZW5jYSIsInNpbmYiLCJidHJ0IiwiZnJtYSIsInRlbmMiLCJzY2htIiwic2NoaSIsIm1laGQiLCJmaWVsIiwic2R0cCJdLnJlZHVjZSgoZnVuY3Rpb24oZSx0KXtyZXR1cm4gZVt0XT1bdC5jaGFyQ29kZUF0KDApLHQuY2hhckNvZGVBdCgxKSx0LmNoYXJDb2RlQXQoMiksdC5jaGFyQ29kZUF0KDMpXSxlfSksT2JqZWN0LmNyZWF0ZShudWxsKSkpLGkoRWUsIkhETFJfVFlQRVMiLHt2aWRlbzpuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDExOCwxMDUsMTAwLDEwMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCw4NiwxMDUsMTAwLDEwMSwxMTEsNzIsOTcsMTEwLDEwMCwxMDgsMTAxLDExNCwwXSksYXVkaW86bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwxMTUsMTExLDExNywxMTAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsODMsMTExLDExNywxMTAsMTAwLDcyLDk3LDExMCwxMDAsMTA4LDEwMSwxMTQsMF0pfSksaShFZSwiRlRZUEFWQzEiLEVlLmJveChFZS50eXBlcy5mdHlwLG5ldyBVaW50OEFycmF5KFsxMDUsMTE1LDExMSwxMDksMCwwLDAsMSwxMDUsMTE1LDExMSwxMDksOTcsMTE4LDk5LDQ5XSkpKSxpKEVlLCJGVFlQSEVWMSIsRWUuYm94KEVlLnR5cGVzLmZ0eXAsbmV3IFVpbnQ4QXJyYXkoWzEwNSwxMTUsMTExLDEwOSwwLDAsMCwxLDEwNSwxMTUsMTExLDEwOSwxMDQsMTAxLDExOCw0OV0pKSksaShFZSwiRElORiIsRWUuYm94KEVlLnR5cGVzLmRpbmYsRWUuYm94KEVlLnR5cGVzLmRyZWYsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwxMiwxMTcsMTE0LDEwOCwzMiwwLDAsMCwxXSkpKSksaShFZSwiVk1IRCIsRWUuYm94KEVlLnR5cGVzLnZtaGQsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwXSkpKSxpKEVlLCJTTUhEIixFZS5ib3goRWUudHlwZXMuc21oZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSkpKSxpKEVlLCJTdGJsVGFibGUiLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDBdKSksaShFZSwiU1RUUyIsRWUuYm94KEVlLnR5cGVzLnN0dHMsRWUuU3RibFRhYmxlKSksaShFZSwiU1RTQyIsRWUuYm94KEVlLnR5cGVzLnN0c2MsRWUuU3RibFRhYmxlKSksaShFZSwiU1RTWiIsRWUuYm94KEVlLnR5cGVzLnN0c3osbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwXSkpKSxpKEVlLCJTVENPIixFZS5ib3goRWUudHlwZXMuc3RjbyxFZS5TdGJsVGFibGUpKTt2YXIgVGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSl7cih0aGlzLGUpLHRoaXMubmFtZT10fHwiIix0aGlzLl9wcmVmaXg9IlsiLmNvbmNhdCh0aGlzLm5hbWUsIl0iKSxlLmRpc2FibGVkPWF9cmV0dXJuIG4oZSxbe2tleToiZGVidWciLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ7aWYoIWUuZGlzYWJsZWQpe2Zvcih2YXIgcj1hcmd1bWVudHMubGVuZ3RoLGE9bmV3IEFycmF5KHIpLG49MDtuPHI7bisrKWFbbl09YXJndW1lbnRzW25dOyh0PWNvbnNvbGUpLmRlYnVnLmFwcGx5KHQsW3RoaXMuX3ByZWZpeF0uY29uY2F0KGEpKX19fSx7a2V5OiJsb2ciLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ7aWYoIWUuZGlzYWJsZWQpe2Zvcih2YXIgcj1hcmd1bWVudHMubGVuZ3RoLGE9bmV3IEFycmF5KHIpLG49MDtuPHI7bisrKWFbbl09YXJndW1lbnRzW25dOyh0PWNvbnNvbGUpLmxvZy5hcHBseSh0LFt0aGlzLl9wcmVmaXhdLmNvbmNhdChhKSl9fX0se2tleToid2FybiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkud2Fybi5hcHBseSh0LFt0aGlzLl9wcmVmaXhdLmNvbmNhdChhKSl9fX0se2tleToiZXJyb3IiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ7aWYoIWUuZGlzYWJsZWQpe2Zvcih2YXIgcj1hcmd1bWVudHMubGVuZ3RoLGE9bmV3IEFycmF5KHIpLG49MDtuPHI7bisrKWFbbl09YXJndW1lbnRzW25dOyh0PWNvbnNvbGUpLmVycm9yLmFwcGx5KHQsW3RoaXMuX3ByZWZpeF0uY29uY2F0KGEpKX19fSx7a2V5OiJ0YWJsZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtlLmRpc2FibGVkfHwoY29uc29sZS5ncm91cCh0aGlzLl9wcmVmaXgpLCh0PWNvbnNvbGUpLnRhYmxlLmFwcGx5KHQsYXJndW1lbnRzKSxjb25zb2xlLmdyb3VwRW5kKCkpfX1dLFt7a2V5OiJlbmFibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMX19LHtrZXk6ImRpc2FibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMH19XSksZX0oKTtpKFRlLCJkaXNhYmxlZCIsITApO2Zvcih2YXIgVWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksdGhpcy52aWRlb1RyYWNrPXQsdGhpcy5hdWRpb1RyYWNrPWE7dmFyIGk9L0Nocm9tZVwvKFteLl0rKS8uZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KTt0aGlzLmZvcmNlRmlyc3RJRFI9aSYmTnVtYmVyKGlbMV0pPDUwLHRoaXMubG9nPW5ldyBUZSgiRk1QNFJlbXV4ZXIiLCFufHwhbi5vcGVuTG9nfHwhbi5vcGVuTG9nKX1yZXR1cm4gbihlLFt7a2V5OiJyZW11eCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZSx0LHIsYSxuLGk9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0mJmFyZ3VtZW50c1swXSxzPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fSxvPXRoaXMudmlkZW9UcmFjayx1PXRoaXMuYXVkaW9UcmFjayxjPW8uZXhpc3QoKSxsPXUuZXhpc3QoKSxmPVtdO3JldHVybiBpJiYocyYmcy5pbml0TWVyZ2U/KGMmJmYucHVzaCh0aGlzLnZpZGVvVHJhY2spLGwmJmYucHVzaCh0aGlzLmF1ZGlvVHJhY2spLHI9RWUuaW5pdFNlZ21lbnQoZikpOihjJiYoZT1FZS5pbml0U2VnbWVudChbdGhpcy52aWRlb1RyYWNrXSkpLGwmJih0PUVlLmluaXRTZWdtZW50KFt0aGlzLmF1ZGlvVHJhY2tdKSkpKSxjJiZvLmhhc1NhbXBsZSgpJiYoYT10aGlzLl9yZW11eFZpZGVvKCkpLGwmJnUuaGFzU2FtcGxlKCkmJihuPXRoaXMuX3JlbXV4QXVkaW8oKSksby5zYW1wbGVzPVtdLHUuc2FtcGxlcz1bXSx7aW5pdFNlZ21lbnQ6cix2aWRlb0luaXRTZWdtZW50OmUsYXVkaW9Jbml0U2VnbWVudDp0LHZpZGVvU2VnbWVudDphLGF1ZGlvU2VnbWVudDpufX19LHtrZXk6Il9yZW11eFZpZGVvIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMudmlkZW9UcmFjazt0aGlzLmZvcmNlRmlyc3RJRFImJihlLnNhbXBsZXNbMF0uZmxhZz17ZGVwZW5kc09uOjIsaXNOb25TeW5jU2FtcGxlOjB9KTt2YXIgdD1lLnNhbXBsZXMscj0vYXYwMS8udGVzdChlLmNvZGVjKSxhPTA7cj90LmZvckVhY2goKGZ1bmN0aW9uKGUpe2ErPWUuZGF0YS5ieXRlTGVuZ3RofSkpOnQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7YSs9ZS51bml0cy5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCksYSs9NCplLnVuaXRzLmxlbmd0aH0pKTt2YXIgbj1uZXcgVWludDhBcnJheShhKTtpZihyKWZvcih2YXIgaSxzPTAsbz10Lmxlbmd0aCx1PTA7czxvO3MrKylpPXRbc10sbi5zZXQoaS5kYXRhLHUpLGkuc2l6ZT1pLmRhdGEuYnl0ZUxlbmd0aCx1Kz1pLnNpemU7ZWxzZSBmb3IodmFyIGMsbD1uZXcgRGF0YVZpZXcobi5idWZmZXIpLGY9ZnVuY3Rpb24oZSxyKXtyPXRbZF07dmFyIGE9MDtyLnVuaXRzLmZvckVhY2goKGZ1bmN0aW9uKHQpe2wuc2V0VWludDMyKGUsdC5ieXRlTGVuZ3RoKSxlKz00LG4uc2V0KHQsZSksZSs9dC5ieXRlTGVuZ3RoLGErPTQrdC5ieXRlTGVuZ3RofSkpLHIuc2l6ZT1hLHA9ZSxjPXJ9LGQ9MCxoPXQubGVuZ3RoLHA9MDtkPGg7ZCsrKWYocCxjKTt2YXIgdj1FZS5tZGF0KG4pO3JldHVybiBRKEVlLm1vb2YoW2VdKSx2KX19LHtrZXk6Il9yZW11eEF1ZGlvIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuYXVkaW9UcmFjayx0PW5ldyBVaW50OEFycmF5KGUuc2FtcGxlcy5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5zaXplfSksMCkpO2Uuc2FtcGxlcy5yZWR1Y2UoKGZ1bmN0aW9uKGUscil7cmV0dXJuIHQuc2V0KHIuZGF0YSxlKSxlK3Iuc2l6ZX0pLDApO3ZhciByPUVlLm1kYXQodCk7cmV0dXJuIFEoRWUubW9vZihbZV0pLHIpfX0se2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy52aWRlb1RyYWNrLnJlc2V0KCksdGhpcy5hdWRpb1RyYWNrLnJlc2V0KCl9fV0pLGV9KCksQ2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsW3trZXk6Im1peEluIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmFzc2lnbih0aGlzLGUpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9bmV3IHRoaXMuY29uc3RydWN0b3I7cmV0dXJuIE9iamVjdC5hc3NpZ24oZSx0aGlzKSxlfX1dLFt7a2V5OiJjcmVhdGUiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSkscj0wO3I8ZTtyKyspdFtyXT1hcmd1bWVudHNbcl07cmV0dXJuIGwodGhpcyx0KX19XSksZX0oKSxQZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7dmFyIGUsbj1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06W10saT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06NCpuLmxlbmd0aDtyKHRoaXMsYSksZT10LmNhbGwodGhpcyk7dmFyIHM9bjtpZihzIGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJihzPW5ldyBVaW50OEFycmF5KHMpKSwocyBpbnN0YW5jZW9mIEludDhBcnJheXx8cyBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHxzIGluc3RhbmNlb2YgSW50MTZBcnJheXx8cyBpbnN0YW5jZW9mIFVpbnQxNkFycmF5fHxzIGluc3RhbmNlb2YgSW50MzJBcnJheXx8cyBpbnN0YW5jZW9mIFVpbnQzMkFycmF5fHxzIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHxzIGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSYmKHM9bmV3IFVpbnQ4QXJyYXkocy5idWZmZXIscy5ieXRlT2Zmc2V0LHMuYnl0ZUxlbmd0aCkpLHMgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtmb3IodmFyIG89cy5ieXRlTGVuZ3RoLHU9W10sYz0wO2M8bztjKz0xKXVbYz4+PjJdfD1zW2NdPDwyNC1jJTQqODtlLndvcmRzPXUsZS5zaWdCeXRlcz1vfWVsc2UgZS53b3Jkcz1uLGUuc2lnQnl0ZXM9aTtyZXR1cm4gZX1yZXR1cm4gbihhLFt7a2V5OiJ0b1N0cmluZyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06SWU7cmV0dXJuIGUuc3RyaW5naWZ5KHRoaXMpfX0se2tleToiY29uY2F0Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLndvcmRzLHI9ZS53b3JkcyxhPXRoaXMuc2lnQnl0ZXMsbj1lLnNpZ0J5dGVzO2lmKHRoaXMuY2xhbXAoKSxhJTQpZm9yKHZhciBpPTA7aTxuO2krPTEpe3ZhciBzPXJbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O3RbYStpPj4+Ml18PXM8PDI0LShhK2kpJTQqOH1lbHNlIGZvcih2YXIgbz0wO288bjtvKz00KXRbYStvPj4+Ml09cltvPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPW4sdGhpc319LHtrZXk6ImNsYW1wIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMud29yZHMsdD10aGlzLnNpZ0J5dGVzO2VbdD4+PjJdJj00Mjk0OTY3Mjk1PDwzMi10JTQqOCxlLmxlbmd0aD1NYXRoLmNlaWwodC80KX19LHtrZXk6ImNsb25lIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXAobyhhLnByb3RvdHlwZSksImNsb25lIix0aGlzKS5jYWxsKHRoaXMpO3JldHVybiBlLndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksZX19XSxbe2tleToicmFuZG9tIix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQscj1bXSxuPWZ1bmN0aW9uKGUpe3ZhciB0PWUscj05ODc2NTQzMjEsYT00Mjk0OTY3Mjk1O3JldHVybiBmdW5jdGlvbigpe3ZhciBlPSgocj0zNjk2OSooNjU1MzUmcikrKHI+PjE2KSZhKTw8MTYpKyh0PTE4ZTMqKDY1NTM1JnQpKyh0Pj4xNikmYSkmYTtyZXR1cm4gZS89NDI5NDk2NzI5NiwoZSs9LjUpKihNYXRoLnJhbmRvbSgpPi41PzE6LTEpfX0saT0wO2k8ZTtpKz00KXt2YXIgcz1uKDQyOTQ5NjcyOTYqKHR8fE1hdGgucmFuZG9tKCkpKTt0PTk4NzY1NDA3MSpzKCksci5wdXNoKDQyOTQ5NjcyOTYqcygpfDApfXJldHVybiBuZXcgYShyLGUpfX1dKSxhfShDZSksSWU9e3N0cmluZ2lmeTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS53b3JkcyxyPWUuc2lnQnl0ZXMsYT1bXSxuPTA7bjxyO24rPTEpe3ZhciBpPXRbbj4+PjJdPj4+MjQtbiU0KjgmMjU1O2EucHVzaCgoaT4+PjQpLnRvU3RyaW5nKDE2KSksYS5wdXNoKCgxNSZpKS50b1N0cmluZygxNikpfXJldHVybiBhLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5sZW5ndGgscj1bXSxhPTA7YTx0O2ErPTIpclthPj4+M118PXBhcnNlSW50KGUuc3Vic3RyKGEsMiksMTYpPDwyNC1hJTgqNDtyZXR1cm4gbmV3IFBlKHIsdC8yKX19LE1lPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPVtdLGE9MDthPHQ7YSs9MSlyW2E+Pj4yXXw9KDI1NSZlLmNoYXJDb2RlQXQoYSkpPDwyNC1hJTQqODtyZXR1cm4gbmV3IFBlKHIsdCl9LHplPWZ1bmN0aW9uKGUpe3JldHVybiBNZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoZSkpKX0sT2U9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3ZhciBlO3JldHVybiByKHRoaXMsYSksKGU9dC5jYWxsKHRoaXMpKS5fbWluQnVmZmVyU2l6ZT0wLGV9cmV0dXJuIG4oYSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YT1uZXcgUGUsdGhpcy5fbkRhdGFCeXRlcz0wfX0se2tleToiX2FwcGVuZCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZTsic3RyaW5nIj09dHlwZW9mIHQmJih0PXplKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfX0se2tleToiX3Byb2Nlc3MiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0LHI9dGhpcy5fZGF0YSxhPXRoaXMuYmxvY2tTaXplLG49ci53b3JkcyxpPXIuc2lnQnl0ZXMscz1pLyg0KmEpLG89KHM9ZT9NYXRoLmNlaWwocyk6TWF0aC5tYXgoKDB8cyktdGhpcy5fbWluQnVmZmVyU2l6ZSwwKSkqYSx1PU1hdGgubWluKDQqbyxpKTtpZihvKXtmb3IodmFyIGM9MDtjPG87Yys9YSl0aGlzLl9kb1Byb2Nlc3NCbG9jayhuLGMpO3Q9bi5zcGxpY2UoMCxvKSxyLnNpZ0J5dGVzLT11fXJldHVybiBuZXcgUGUodCx1KX19LHtrZXk6ImNsb25lIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXAobyhhLnByb3RvdHlwZSksImNsb25lIix0aGlzKS5jYWxsKHRoaXMpO3JldHVybiBlLl9kYXRhPXRoaXMuX2RhdGEuY2xvbmUoKSxlfX1dKSxhfShDZSksUmU9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlKXt2YXIgbjtyZXR1cm4gcih0aGlzLGEpLChuPXQuY2FsbCh0aGlzKSkuYmxvY2tTaXplPTE2LG4uY2ZnPU9iamVjdC5hc3NpZ24obmV3IENlLGUpLG4ucmVzZXQoKSxufXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3AobyhhLnByb3RvdHlwZSksInJlc2V0Iix0aGlzKS5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX19LHtrZXk6InVwZGF0ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX2FwcGVuZChlKSx0aGlzLl9wcm9jZXNzKCksdGhpc319LHtrZXk6ImZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmdGhpcy5fYXBwZW5kKGUpLHRoaXMuX2RvRmluYWxpemUoKX19XSxbe2tleToiX2NyZWF0ZUhlbHBlciIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQscil7cmV0dXJuIG5ldyBlKHIpLmZpbmFsaXplKHQpfX19LHtrZXk6Il9jcmVhdGVIbWFjSGVscGVyIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCxyKXtyZXR1cm4gbmV3IExlKGUscikuZmluYWxpemUodCl9fX1dKSxhfShPZSksTGU9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlLG4pe3ZhciBpO3IodGhpcyxhKSxpPXQuY2FsbCh0aGlzKTt2YXIgcz1uZXcgZTtpLl9oYXNoZXI9czt2YXIgbz1uOyJzdHJpbmciPT10eXBlb2YgbyYmKG89emUobykpO3ZhciB1PXMuYmxvY2tTaXplLGM9NCp1O28uc2lnQnl0ZXM+YyYmKG89cy5maW5hbGl6ZShuKSksby5jbGFtcCgpO3ZhciBsPW8uY2xvbmUoKTtpLl9vS2V5PWw7dmFyIGY9by5jbG9uZSgpO2kuX2lLZXk9Zjtmb3IodmFyIGQ9bC53b3JkcyxoPWYud29yZHMscD0wO3A8dTtwKz0xKWRbcF1ePTE1NDk1NTY4MjgsaFtwXV49OTA5NTIyNDg2O3JldHVybiBsLnNpZ0J5dGVzPWMsZi5zaWdCeXRlcz1jLGkucmVzZXQoKSxpfXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuX2hhc2hlcjtlLnJlc2V0KCksZS51cGRhdGUodGhpcy5faUtleSl9fSx7a2V5OiJ1cGRhdGUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9oYXNoZXIudXBkYXRlKGUpLHRoaXN9fSx7a2V5OiJmaW5hbGl6ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5faGFzaGVyLHI9dC5maW5hbGl6ZShlKTtyZXR1cm4gdC5yZXNldCgpLHQuZmluYWxpemUodGhpcy5fb0tleS5jbG9uZSgpLmNvbmNhdChyKSl9fV0pLGF9KENlKSxWZT17c3RyaW5naWZ5OmZ1bmN0aW9uKGUpe3ZhciB0PWUud29yZHMscj1lLnNpZ0J5dGVzLGE9dGhpcy5fbWFwO2UuY2xhbXAoKTtmb3IodmFyIG49W10saT0wO2k8cjtpKz0zKWZvcih2YXIgcz0odFtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTUpPDwxNnwodFtpKzE+Pj4yXT4+PjI0LShpKzEpJTQqOCYyNTUpPDw4fHRbaSsyPj4+Ml0+Pj4yNC0oaSsyKSU0KjgmMjU1LG89MDtvPDQmJmkrLjc1Km88cjtvKz0xKW4ucHVzaChhLmNoYXJBdChzPj4+NiooMy1vKSY2MykpO3ZhciB1PWEuY2hhckF0KDY0KTtpZih1KWZvcig7bi5sZW5ndGglNDspbi5wdXNoKHUpO3JldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbihlKXt2YXIgdD1lLmxlbmd0aCxyPXRoaXMuX21hcCxhPXRoaXMuX3JldmVyc2VNYXA7aWYoIWEpe3RoaXMuX3JldmVyc2VNYXA9W10sYT10aGlzLl9yZXZlcnNlTWFwO2Zvcih2YXIgbj0wO248ci5sZW5ndGg7bis9MSlhW3IuY2hhckNvZGVBdChuKV09bn12YXIgaT1yLmNoYXJBdCg2NCk7aWYoaSl7dmFyIHM9ZS5pbmRleE9mKGkpOy0xIT09cyYmKHQ9cyl9cmV0dXJuIGZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIGE9W10sbj0wLGk9MDtpPHQ7aSs9MSlpZihpJTQpe3ZhciBzPXJbZS5jaGFyQ29kZUF0KGktMSldPDxpJTQqMnxyW2UuY2hhckNvZGVBdChpKV0+Pj42LWklNCoyO2Fbbj4+PjJdfD1zPDwyNC1uJTQqOCxuKz0xfXJldHVybiBQZS5jcmVhdGUoYSxuKX0oZSx0LGEpfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9LEZlPVtdLE5lPTA7TmU8NjQ7TmUrPTEpRmVbTmVdPTQyOTQ5NjcyOTYqTWF0aC5hYnMoTWF0aC5zaW4oTmUrMSkpfDA7dmFyIGplPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHQmcnx+dCZhKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LEdlPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHQmYXxyJn5hKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LEhlPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHRecl5hKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LEtlPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHJeKHR8fmEpKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LHFlPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEsW3trZXk6Il9kb1Jlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IFBlKFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX19LHtrZXk6Il9kb1Byb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZSxhPTA7YTwxNjthKz0xKXt2YXIgbj10K2EsaT1lW25dO3Jbbl09MTY3MTE5MzUmKGk8PDh8aT4+PjI0KXw0Mjc4MjU1MzYwJihpPDwyNHxpPj4+OCl9dmFyIHM9dGhpcy5faGFzaC53b3JkcyxvPXJbdCswXSx1PXJbdCsxXSxjPXJbdCsyXSxsPXJbdCszXSxmPXJbdCs0XSxkPXJbdCs1XSxoPXJbdCs2XSxwPXJbdCs3XSx2PXJbdCs4XSx5PXJbdCs5XSxtPXJbdCsxMF0sZz1yW3QrMTFdLGs9clt0KzEyXSxiPXJbdCsxM10sXz1yW3QrMTRdLHc9clt0KzE1XSx4PXNbMF0sUz1zWzFdLEE9c1syXSxEPXNbM107eD1qZSh4LFMsQSxELG8sNyxGZVswXSksRD1qZShELHgsUyxBLHUsMTIsRmVbMV0pLEE9amUoQSxELHgsUyxjLDE3LEZlWzJdKSxTPWplKFMsQSxELHgsbCwyMixGZVszXSkseD1qZSh4LFMsQSxELGYsNyxGZVs0XSksRD1qZShELHgsUyxBLGQsMTIsRmVbNV0pLEE9amUoQSxELHgsUyxoLDE3LEZlWzZdKSxTPWplKFMsQSxELHgscCwyMixGZVs3XSkseD1qZSh4LFMsQSxELHYsNyxGZVs4XSksRD1qZShELHgsUyxBLHksMTIsRmVbOV0pLEE9amUoQSxELHgsUyxtLDE3LEZlWzEwXSksUz1qZShTLEEsRCx4LGcsMjIsRmVbMTFdKSx4PWplKHgsUyxBLEQsayw3LEZlWzEyXSksRD1qZShELHgsUyxBLGIsMTIsRmVbMTNdKSxBPWplKEEsRCx4LFMsXywxNyxGZVsxNF0pLFM9amUoUyxBLEQseCx3LDIyLEZlWzE1XSkseD1HZSh4LFMsQSxELHUsNSxGZVsxNl0pLEQ9R2UoRCx4LFMsQSxoLDksRmVbMTddKSxBPUdlKEEsRCx4LFMsZywxNCxGZVsxOF0pLFM9R2UoUyxBLEQseCxvLDIwLEZlWzE5XSkseD1HZSh4LFMsQSxELGQsNSxGZVsyMF0pLEQ9R2UoRCx4LFMsQSxtLDksRmVbMjFdKSxBPUdlKEEsRCx4LFMsdywxNCxGZVsyMl0pLFM9R2UoUyxBLEQseCxmLDIwLEZlWzIzXSkseD1HZSh4LFMsQSxELHksNSxGZVsyNF0pLEQ9R2UoRCx4LFMsQSxfLDksRmVbMjVdKSxBPUdlKEEsRCx4LFMsbCwxNCxGZVsyNl0pLFM9R2UoUyxBLEQseCx2LDIwLEZlWzI3XSkseD1HZSh4LFMsQSxELGIsNSxGZVsyOF0pLEQ9R2UoRCx4LFMsQSxjLDksRmVbMjldKSxBPUdlKEEsRCx4LFMscCwxNCxGZVszMF0pLFM9R2UoUyxBLEQseCxrLDIwLEZlWzMxXSkseD1IZSh4LFMsQSxELGQsNCxGZVszMl0pLEQ9SGUoRCx4LFMsQSx2LDExLEZlWzMzXSksQT1IZShBLEQseCxTLGcsMTYsRmVbMzRdKSxTPUhlKFMsQSxELHgsXywyMyxGZVszNV0pLHg9SGUoeCxTLEEsRCx1LDQsRmVbMzZdKSxEPUhlKEQseCxTLEEsZiwxMSxGZVszN10pLEE9SGUoQSxELHgsUyxwLDE2LEZlWzM4XSksUz1IZShTLEEsRCx4LG0sMjMsRmVbMzldKSx4PUhlKHgsUyxBLEQsYiw0LEZlWzQwXSksRD1IZShELHgsUyxBLG8sMTEsRmVbNDFdKSxBPUhlKEEsRCx4LFMsbCwxNixGZVs0Ml0pLFM9SGUoUyxBLEQseCxoLDIzLEZlWzQzXSkseD1IZSh4LFMsQSxELHksNCxGZVs0NF0pLEQ9SGUoRCx4LFMsQSxrLDExLEZlWzQ1XSksQT1IZShBLEQseCxTLHcsMTYsRmVbNDZdKSxTPUhlKFMsQSxELHgsYywyMyxGZVs0N10pLHg9S2UoeCxTLEEsRCxvLDYsRmVbNDhdKSxEPUtlKEQseCxTLEEscCwxMCxGZVs0OV0pLEE9S2UoQSxELHgsUyxfLDE1LEZlWzUwXSksUz1LZShTLEEsRCx4LGQsMjEsRmVbNTFdKSx4PUtlKHgsUyxBLEQsayw2LEZlWzUyXSksRD1LZShELHgsUyxBLGwsMTAsRmVbNTNdKSxBPUtlKEEsRCx4LFMsbSwxNSxGZVs1NF0pLFM9S2UoUyxBLEQseCx1LDIxLEZlWzU1XSkseD1LZSh4LFMsQSxELHYsNixGZVs1Nl0pLEQ9S2UoRCx4LFMsQSx3LDEwLEZlWzU3XSksQT1LZShBLEQseCxTLGgsMTUsRmVbNThdKSxTPUtlKFMsQSxELHgsYiwyMSxGZVs1OV0pLHg9S2UoeCxTLEEsRCxmLDYsRmVbNjBdKSxEPUtlKEQseCxTLEEsZywxMCxGZVs2MV0pLEE9S2UoQSxELHgsUyxjLDE1LEZlWzYyXSksUz1LZShTLEEsRCx4LHksMjEsRmVbNjNdKSxzWzBdPXNbMF0reHwwLHNbMV09c1sxXStTfDAsc1syXT1zWzJdK0F8MCxzWzNdPXNbM10rRHwwfX0se2tleToiX2RvRmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5fZGF0YSx0PWUud29yZHMscj04KnRoaXMuX25EYXRhQnl0ZXMsYT04KmUuc2lnQnl0ZXM7dFthPj4+NV18PTEyODw8MjQtYSUzMjt2YXIgbj1NYXRoLmZsb29yKHIvNDI5NDk2NzI5NiksaT1yO3RbMTUrKGErNjQ+Pj45PDw0KV09MTY3MTE5MzUmKG48PDh8bj4+PjI0KXw0Mjc4MjU1MzYwJihuPDwyNHxuPj4+OCksdFsxNCsoYSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KSxlLnNpZ0J5dGVzPTQqKHQubGVuZ3RoKzEpLHRoaXMuX3Byb2Nlc3MoKTtmb3IodmFyIHM9dGhpcy5faGFzaCxvPXMud29yZHMsdT0wO3U8NDt1Kz0xKXt2YXIgYz1vW3VdO29bdV09MTY3MTE5MzUmKGM8PDh8Yz4+PjI0KXw0Mjc4MjU1MzYwJihjPDwyNHxjPj4+OCl9cmV0dXJuIHN9fSx7a2V5OiJjbG9uZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1wKG8oYS5wcm90b3R5cGUpLCJjbG9uZSIsdGhpcykuY2FsbCh0aGlzKTtyZXR1cm4gZS5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksZX19XSksYX0oUmUpO1JlLl9jcmVhdGVIZWxwZXIocWUpLFJlLl9jcmVhdGVIbWFjSGVscGVyKHFlKTt2YXIgV2U9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlKXt2YXIgbjtyZXR1cm4gcih0aGlzLGEpLChuPXQuY2FsbCh0aGlzKSkuY2ZnPU9iamVjdC5hc3NpZ24obmV3IENlLHtrZXlTaXplOjQsaGFzaGVyOnFlLGl0ZXJhdGlvbnM6MX0sZSksbn1yZXR1cm4gbihhLFt7a2V5OiJjb21wdXRlIix2YWx1ZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcixhPXRoaXMuY2ZnLG49YS5oYXNoZXIuY3JlYXRlKCksaT1QZS5jcmVhdGUoKSxzPWkud29yZHMsbz1hLmtleVNpemUsdT1hLml0ZXJhdGlvbnM7cy5sZW5ndGg8bzspe3ImJm4udXBkYXRlKHIpLHI9bi51cGRhdGUoZSkuZmluYWxpemUodCksbi5yZXNldCgpO2Zvcih2YXIgYz0xO2M8dTtjKz0xKXI9bi5maW5hbGl6ZShyKSxuLnJlc2V0KCk7aS5jb25jYXQocil9cmV0dXJuIGkuc2lnQnl0ZXM9NCpvLGl9fV0pLGF9KENlKSxYZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKGUsbixpKXt2YXIgcztyZXR1cm4gcih0aGlzLGEpLChzPXQuY2FsbCh0aGlzKSkuY2ZnPU9iamVjdC5hc3NpZ24obmV3IENlLGkpLHMuX3hmb3JtTW9kZT1lLHMuX2tleT1uLHMucmVzZXQoKSxzfXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3AobyhhLnByb3RvdHlwZSksInJlc2V0Iix0aGlzKS5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX19LHtrZXk6InByb2Nlc3MiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9hcHBlbmQoZSksdGhpcy5fcHJvY2VzcygpfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlJiZ0aGlzLl9hcHBlbmQoZSksdGhpcy5fZG9GaW5hbGl6ZSgpfX1dLFt7a2V5OiJjcmVhdGVFbmNyeXB0b3IiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLGUsdCl9fSx7a2V5OiJjcmVhdGVEZWNyeXB0b3IiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0RFQ19YRk9STV9NT0RFLGUsdCl9fSx7a2V5OiJfY3JlYXRlSGVscGVyIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1mdW5jdGlvbihlKXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGU/bnQ6cnR9O3JldHVybntlbmNyeXB0OmZ1bmN0aW9uKHIsYSxuKXtyZXR1cm4gdChhKS5lbmNyeXB0KGUscixhLG4pfSxkZWNyeXB0OmZ1bmN0aW9uKHIsYSxuKXtyZXR1cm4gdChhKS5kZWNyeXB0KGUscixhLG4pfX19fV0pLGF9KE9lKTtYZS5fRU5DX1hGT1JNX01PREU9MSxYZS5fREVDX1hGT1JNX01PREU9MixYZS5rZXlTaXplPTQsWGUuaXZTaXplPTQ7dmFyIFllPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoZSxuKXt2YXIgaTtyZXR1cm4gcih0aGlzLGEpLChpPXQuY2FsbCh0aGlzKSkuX2NpcGhlcj1lLGkuX2l2PW4saX1yZXR1cm4gbihhLG51bGwsW3trZXk6ImNyZWF0ZUVuY3J5cHRvciIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5FbmNyeXB0b3IuY3JlYXRlKGUsdCl9fSx7a2V5OiJjcmVhdGVEZWNyeXB0b3IiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZShlLHQpfX1dKSxhfShDZSk7ZnVuY3Rpb24gWmUoZSx0LHIpe3ZhciBhLG49ZSxpPXRoaXMuX2l2O2k/KGE9aSx0aGlzLl9pdj12b2lkIDApOmE9dGhpcy5fcHJldkJsb2NrO2Zvcih2YXIgcz0wO3M8cjtzKz0xKW5bdCtzXV49YVtzXX12YXIgUWU9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSl9KFllKTtRZS5FbmNyeXB0b3I9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixhPXIuYmxvY2tTaXplO1plLmNhbGwodGhpcyxlLHQsYSksci5lbmNyeXB0QmxvY2soZSx0KSx0aGlzLl9wcmV2QmxvY2s9ZS5zbGljZSh0LHQrYSl9fV0pLGF9KFFlKSxRZS5EZWNyeXB0b3I9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixhPXIuYmxvY2tTaXplLG49ZS5zbGljZSh0LHQrYSk7ci5kZWNyeXB0QmxvY2soZSx0KSxaZS5jYWxsKHRoaXMsZSx0LGEpLHRoaXMuX3ByZXZCbG9jaz1ufX1dKSxhfShRZSk7dmFyIEplPXtwYWQ6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9NCp0LGE9ci1lLnNpZ0J5dGVzJXIsbj1hPDwyNHxhPDwxNnxhPDw4fGEsaT1bXSxzPTA7czxhO3MrPTQpaS5wdXNoKG4pO3ZhciBvPVBlLmNyZWF0ZShpLGEpO2UuY29uY2F0KG8pfSx1bnBhZDpmdW5jdGlvbihlKXt2YXIgdD1lLHI9MjU1JnQud29yZHNbdC5zaWdCeXRlcy0xPj4+Ml07dC5zaWdCeXRlcy09cn19LCRlPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoZSxuLGkpe3ZhciBzO3JldHVybiByKHRoaXMsYSksKHM9dC5jYWxsKHRoaXMsZSxuLE9iamVjdC5hc3NpZ24oe21vZGU6UWUscGFkZGluZzpKZX0saSkpKS5ibG9ja1NpemU9NCxzfXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlO3AobyhhLnByb3RvdHlwZSksInJlc2V0Iix0aGlzKS5jYWxsKHRoaXMpO3ZhciB0PXRoaXMuY2ZnLHI9dC5pdixuPXQubW9kZTt0aGlzLl94Zm9ybU1vZGU9PT10aGlzLmNvbnN0cnVjdG9yLl9FTkNfWEZPUk1fTU9ERT9lPW4uY3JlYXRlRW5jcnlwdG9yOihlPW4uY3JlYXRlRGVjcnlwdG9yLHRoaXMuX21pbkJ1ZmZlclNpemU9MSksdGhpcy5fbW9kZT1lLmNhbGwobix0aGlzLHImJnIud29yZHMpLHRoaXMuX21vZGUuX19jcmVhdG9yPWV9fSx7a2V5OiJfZG9Qcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5fbW9kZS5wcm9jZXNzQmxvY2soZSx0KX19LHtrZXk6Il9kb0ZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlLHQ9dGhpcy5jZmcucGFkZGluZztyZXR1cm4gdGhpcy5feGZvcm1Nb2RlPT09dGhpcy5jb25zdHJ1Y3Rvci5fRU5DX1hGT1JNX01PREU/KHQucGFkKHRoaXMuX2RhdGEsdGhpcy5ibG9ja1NpemUpLGU9dGhpcy5fcHJvY2VzcyghMCkpOihlPXRoaXMuX3Byb2Nlc3MoITApLHQudW5wYWQoZSkpLGV9fV0pLGF9KFhlKSxldD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKGUpe3ZhciBuO3JldHVybiByKHRoaXMsYSksKG49dC5jYWxsKHRoaXMpKS5taXhJbihlKSxufXJldHVybiBuKGEsW3trZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4oZXx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19XSksYX0oQ2UpLHR0PXtzdHJpbmdpZnk6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5jaXBoZXJ0ZXh0LHI9ZS5zYWx0O3JldHVybihyP1BlLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdCh0KTp0KS50b1N0cmluZyhWZSl9LHBhcnNlOmZ1bmN0aW9uKGUpe3ZhciB0LHI9VmUucGFyc2UoZSksYT1yLndvcmRzO3JldHVybiAxMzk4ODkzNjg0PT09YVswXSYmMTcwMTA3NjgzMT09PWFbMV0mJih0PVBlLmNyZWF0ZShhLnNsaWNlKDIsNCkpLGEuc3BsaWNlKDAsNCksci5zaWdCeXRlcy09MTYpLGV0LmNyZWF0ZSh7Y2lwaGVydGV4dDpyLHNhbHQ6dH0pfX0scnQ9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxudWxsLFt7a2V5OiJlbmNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj1PYmplY3QuYXNzaWduKG5ldyBDZSx0aGlzLmNmZyxhKSxpPWUuY3JlYXRlRW5jcnlwdG9yKHIsbikscz1pLmZpbmFsaXplKHQpLG89aS5jZmc7cmV0dXJuIGV0LmNyZWF0ZSh7Y2lwaGVydGV4dDpzLGtleTpyLGl2Om8uaXYsYWxnb3JpdGhtOmUsbW9kZTpvLm1vZGUscGFkZGluZzpvLnBhZGRpbmcsYmxvY2tTaXplOmkuYmxvY2tTaXplLGZvcm1hdHRlcjpuLmZvcm1hdH0pfX0se2tleToiZGVjcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSl7dmFyIG49dCxpPU9iamVjdC5hc3NpZ24obmV3IENlLHRoaXMuY2ZnLGEpO3JldHVybiBuPXRoaXMuX3BhcnNlKG4saS5mb3JtYXQpLGUuY3JlYXRlRGVjcnlwdG9yKHIsaSkuZmluYWxpemUobi5jaXBoZXJ0ZXh0KX19LHtrZXk6Il9wYXJzZSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGU/dC5wYXJzZShlLHRoaXMpOmV9fV0pLGF9KENlKTtydC5jZmc9T2JqZWN0LmFzc2lnbihuZXcgQ2Use2Zvcm1hdDp0dH0pO3ZhciBhdD17ZXhlY3V0ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj1hO258fChuPVBlLnJhbmRvbSg4KSk7dmFyIGk9V2UuY3JlYXRlKHtrZXlTaXplOnQrcn0pLmNvbXB1dGUoZSxuKSxzPVBlLmNyZWF0ZShpLndvcmRzLnNsaWNlKHQpLDQqcik7cmV0dXJuIGkuc2lnQnl0ZXM9NCp0LGV0LmNyZWF0ZSh7a2V5OmksaXY6cyxzYWx0Om59KX19LG50PWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEsbnVsbCxbe2tleToiZW5jcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSl7dmFyIG49T2JqZWN0LmFzc2lnbihuZXcgQ2UsdGhpcy5jZmcsYSksaT1uLmtkZi5leGVjdXRlKHIsZS5rZXlTaXplLGUuaXZTaXplKTtuLml2PWkuaXY7dmFyIHM9cnQuZW5jcnlwdC5jYWxsKHRoaXMsZSx0LGkua2V5LG4pO3JldHVybiBzLm1peEluKGkpLHN9fSx7a2V5OiJkZWNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj10LGk9T2JqZWN0LmFzc2lnbihuZXcgQ2UsdGhpcy5jZmcsYSk7bj10aGlzLl9wYXJzZShuLGkuZm9ybWF0KTt2YXIgcz1pLmtkZi5leGVjdXRlKHIsZS5rZXlTaXplLGUuaXZTaXplLG4uc2FsdCk7cmV0dXJuIGkuaXY9cy5pdixydC5kZWNyeXB0LmNhbGwodGhpcyxlLG4scy5rZXksaSl9fV0pLGF9KHJ0KTtudC5jZmc9T2JqZWN0LmFzc2lnbihydC5jZmcse2tkZjphdH0pO2Zvcih2YXIgaXQ9W10sc3Q9W10sb3Q9W10sdXQ9W10sY3Q9W10sbHQ9W10sZnQ9W10sZHQ9W10saHQ9W10scHQ9W10sdnQ9W10seXQ9MDt5dDwyNTY7eXQrPTEpdnRbeXRdPXl0PDEyOD95dDw8MTp5dDw8MV4yODM7Zm9yKHZhciBtdD0wLGd0PTAsa3Q9MDtrdDwyNTY7a3QrPTEpe3ZhciBidD1ndF5ndDw8MV5ndDw8Ml5ndDw8M15ndDw8NDtidD1idD4+PjheMjU1JmJ0Xjk5LGl0W210XT1idCxzdFtidF09bXQ7dmFyIF90PXZ0W210XSx3dD12dFtfdF0seHQ9dnRbd3RdLFN0PTI1Nyp2dFtidF1eMTY4NDMwMDgqYnQ7b3RbbXRdPVN0PDwyNHxTdD4+PjgsdXRbbXRdPVN0PDwxNnxTdD4+PjE2LGN0W210XT1TdDw8OHxTdD4+PjI0LGx0W210XT1TdCxTdD0xNjg0MzAwOSp4dF42NTUzNyp3dF4yNTcqX3ReMTY4NDMwMDgqbXQsZnRbYnRdPVN0PDwyNHxTdD4+PjgsZHRbYnRdPVN0PDwxNnxTdD4+PjE2LGh0W2J0XT1TdDw8OHxTdD4+PjI0LHB0W2J0XT1TdCxtdD8obXQ9X3RednRbdnRbdnRbeHReX3RdXV0sZ3RePXZ0W3Z0W2d0XV0pOm10PWd0PTF9dmFyIEF0PVswLDEsMiw0LDgsMTYsMzIsNjQsMTI4LDI3LDU0XSxEdD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhLFt7a2V5OiJfZG9SZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7dGhpcy5fa2V5UHJpb3JSZXNldD10aGlzLl9rZXk7dmFyIHQ9dGhpcy5fa2V5UHJpb3JSZXNldCxyPXQud29yZHMsYT10LnNpZ0J5dGVzLzQ7dGhpcy5fblJvdW5kcz1hKzY7dmFyIG49NCoodGhpcy5fblJvdW5kcysxKTt0aGlzLl9rZXlTY2hlZHVsZT1bXTtmb3IodmFyIGk9dGhpcy5fa2V5U2NoZWR1bGUscz0wO3M8bjtzKz0xKXM8YT9pW3NdPXJbc106KGU9aVtzLTFdLHMlYT9hPjYmJnMlYT09NCYmKGU9aXRbZT4+PjI0XTw8MjR8aXRbZT4+PjE2JjI1NV08PDE2fGl0W2U+Pj44JjI1NV08PDh8aXRbMjU1JmVdKTooZT1pdFsoZT1lPDw4fGU+Pj4yNCk+Pj4yNF08PDI0fGl0W2U+Pj4xNiYyNTVdPDwxNnxpdFtlPj4+OCYyNTVdPDw4fGl0WzI1NSZlXSxlXj1BdFtzL2F8MF08PDI0KSxpW3NdPWlbcy1hXV5lKTt0aGlzLl9pbnZLZXlTY2hlZHVsZT1bXTtmb3IodmFyIG89dGhpcy5faW52S2V5U2NoZWR1bGUsdT0wO3U8bjt1Kz0xKXt2YXIgYz1uLXU7ZT11JTQ/aVtjXTppW2MtNF0sb1t1XT11PDR8fGM8PTQ/ZTpmdFtpdFtlPj4+MjRdXV5kdFtpdFtlPj4+MTYmMjU1XV1eaHRbaXRbZT4+PjgmMjU1XV1ecHRbaXRbMjU1JmVdXX19fX0se2tleToiZW5jcnlwdEJsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3RoaXMuX2RvQ3J5cHRCbG9jayhlLHQsdGhpcy5fa2V5U2NoZWR1bGUsb3QsdXQsY3QsbHQsaXQpfX0se2tleToiZGVjcnlwdEJsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPWUsYT1yW3QrMV07clt0KzFdPXJbdCszXSxyW3QrM109YSx0aGlzLl9kb0NyeXB0QmxvY2socix0LHRoaXMuX2ludktleVNjaGVkdWxlLGZ0LGR0LGh0LHB0LHN0KSxhPXJbdCsxXSxyW3QrMV09clt0KzNdLHJbdCszXT1hfX0se2tleToiX2RvQ3J5cHRCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyxvKXtmb3IodmFyIHU9ZSxjPXRoaXMuX25Sb3VuZHMsbD11W3RdXnJbMF0sZj11W3QrMV1eclsxXSxkPXVbdCsyXV5yWzJdLGg9dVt0KzNdXnJbM10scD00LHY9MTt2PGM7dis9MSl7dmFyIHk9YVtsPj4+MjRdXm5bZj4+PjE2JjI1NV1eaVtkPj4+OCYyNTVdXnNbMjU1JmhdXnJbcF07cCs9MTt2YXIgbT1hW2Y+Pj4yNF1ebltkPj4+MTYmMjU1XV5pW2g+Pj44JjI1NV1ec1syNTUmbF1ecltwXTtwKz0xO3ZhciBnPWFbZD4+PjI0XV5uW2g+Pj4xNiYyNTVdXmlbbD4+PjgmMjU1XV5zWzI1NSZmXV5yW3BdO3ArPTE7dmFyIGs9YVtoPj4+MjRdXm5bbD4+PjE2JjI1NV1eaVtmPj4+OCYyNTVdXnNbMjU1JmRdXnJbcF07cCs9MSxsPXksZj1tLGQ9ZyxoPWt9dmFyIGI9KG9bbD4+PjI0XTw8MjR8b1tmPj4+MTYmMjU1XTw8MTZ8b1tkPj4+OCYyNTVdPDw4fG9bMjU1JmhdKV5yW3BdO3ArPTE7dmFyIF89KG9bZj4+PjI0XTw8MjR8b1tkPj4+MTYmMjU1XTw8MTZ8b1toPj4+OCYyNTVdPDw4fG9bMjU1JmxdKV5yW3BdO3ArPTE7dmFyIHc9KG9bZD4+PjI0XTw8MjR8b1toPj4+MTYmMjU1XTw8MTZ8b1tsPj4+OCYyNTVdPDw4fG9bMjU1JmZdKV5yW3BdO3ArPTE7dmFyIHg9KG9baD4+PjI0XTw8MjR8b1tsPj4+MTYmMjU1XTw8MTZ8b1tmPj4+OCYyNTVdPDw4fG9bMjU1JmRdKV5yW3BdO3ArPTEsdVt0XT1iLHVbdCsxXT1fLHVbdCsyXT13LHVbdCszXT14fX1dKSxhfSgkZSk7RHQua2V5U2l6ZT04O3ZhciBCdD0kZS5fY3JlYXRlSGVscGVyKER0KSxFdD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhKX0oWWUpO0V0LkVuY3J5cHRvcj1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhLFt7a2V5OiJwcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9ZSxhPXRoaXMuX2NpcGhlcixuPWEuYmxvY2tTaXplLGk9dGhpcy5faXYscz10aGlzLl9jb3VudGVyO2kmJih0aGlzLl9jb3VudGVyPWkuc2xpY2UoMCkscz10aGlzLl9jb3VudGVyLHRoaXMuX2l2PXZvaWQgMCk7dmFyIG89cy5zbGljZSgwKTthLmVuY3J5cHRCbG9jayhvLDApLHNbbi0xXT1zW24tMV0rMXwwO2Zvcih2YXIgdT0wO3U8bjt1Kz0xKXJbdCt1XV49b1t1XX19XSksYX0oRXQpLEV0LkRlY3J5cHRvcj1FdC5FbmNyeXB0b3I7dmFyIFR0PXtwYWQ6ZnVuY3Rpb24oKXt9LHVucGFkOmZ1bmN0aW9uKCl7fX0sVXQ9e2RlY3J5cHRXb3JkQXJyYXk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBhPUllLnBhcnNlKHQpLG49SWUucGFyc2UoYWUocikpLGk9UGUuY3JlYXRlKG5ldyBVaW50OEFycmF5KGUpKSxzPUJ0LmRlY3J5cHQoZXQuY3JlYXRlKHtjaXBoZXJ0ZXh0Oml9KSxhLHtpdjpuLG1vZGU6RXQscGFkZGluZzpUdH0pO3JldHVybiBVdC53b3JkQXJyYXlUb1VpbnQ4QXJyYXkocyl9LHdvcmRBcnJheVRvVWludDhBcnJheTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5zaWdCeXRlcyxyPWUud29yZHMsYT1uZXcgVWludDhBcnJheSh0KSxuPTAsaT0wO24hPT10Oyl7dmFyIHM9cltpKytdO2lmKGFbbisrXT0oNDI3ODE5MDA4MCZzKT4+PjI0LG49PT10KWJyZWFrO2lmKGFbbisrXT0oMTY3MTE2ODAmcyk+Pj4xNixuPT09dClicmVhaztpZihhW24rK109KDY1MjgwJnMpPj4+OCxuPT09dClicmVhazthW24rK109MjU1JnN9cmV0dXJuIGF9LGRlY29kZXJBRVNDVFJEYXRhOmZ1bmN0aW9uKGUsdCxyKXtpZihlLnZpZGVvU2VuYyl7dmFyIGE9ZS5raWRWYWx1ZSxuPWUudmlkZW9TZW5jO2Uuc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbih0LGkpe3ZhciBzPW5baV0sbz10LmRhdGEsdT1bXSxjPVtdLGw9cy5Jbml0aWFsaXphdGlvblZlY3RvcjtpZihzLnN1YnNhbXBsZXMmJnMuc3Vic2FtcGxlcy5sZW5ndGgpcy5zdWJzYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUuQnl0ZXNPZkNsZWFyRGF0YStlLkJ5dGVzT2ZQcm90ZWN0ZWREYXRhLHI9by5zbGljZSgwLHQpO3UucHVzaChyLnNsaWNlKDAsZS5CeXRlc09mQ2xlYXJEYXRhKSksYy5wdXNoKHIuc2xpY2UoZS5CeXRlc09mQ2xlYXJEYXRhKSksbz1vLnNsaWNlKHQpfSkpO2Vsc2V7dmFyIGY9dC5zaXplO3UucHVzaChvLnNsaWNlKDAsMCkpLGMucHVzaChvLnNsaWNlKDAsZikpLG89by5zbGljZShmKX12YXIgZD1uZXcgRGU7ZC53cml0ZS5hcHBseShkLGMpO3ZhciBoPXI/cihkLmJ1ZmZlcixhLGwpOlV0LmRlY3J5cHRXb3JkQXJyYXkoZC5idWZmZXIsYSxsKSxwPW5ldyBEZTt1LmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7dmFyIHI9Y1t0XS5sZW5ndGgsYT1oLnNsaWNlKDAscik7cC53cml0ZShlKSxwLndyaXRlKGEpLGg9aC5zbGljZShyKX0pKSxlLnNhbXBsZXNbaV0uZGF0YT1wLmJ1ZmZlcn0pKX1pZih0LmF1ZGlvU2VuYyl7dmFyIGk9dC5raWRWYWx1ZSxzPXQuYXVkaW9TZW5jO3Quc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlLGEpe3ZhciBuPXNbYV0sbz1yP3IoZS5kYXRhLGksbi5Jbml0aWFsaXphdGlvblZlY3Rvcik6VXQuZGVjcnlwdFdvcmRBcnJheShlLmRhdGEsaSxuLkluaXRpYWxpemF0aW9uVmVjdG9yKTt0LnNhbXBsZXNbYV0uZGF0YT1vfSkpfX19LEN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEsbixzKXt2YXIgbz10aGlzO3IodGhpcyxlKSxpKHRoaXMsIl92aWRlb1NhbXBsZXMiLFtdKSxpKHRoaXMsIl9hdWRpb1NhbXBsZXMiLFtdKSxpKHRoaXMsIl9sYXN0UmVtYWluQnVmZmVyIixbXSksaSh0aGlzLCJfbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zIiwwKSx0aGlzLnZpZGVvVHJhY2s9bmV3IHosdGhpcy5hdWRpb1RyYWNrPW5ldyBPLHRoaXMubWV0YWRhdGFUcmFjaz1ufHxuZXcgaix0aGlzLmxvZz1uZXcgVGUoIk1QNERlbXV4ZXIiLCFzfHwhcy5vcGVuTG9nfHwhcy5vcGVuTG9nKSx0JiZ0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0Oyh0PW8uX3ZpZGVvU2FtcGxlcykucHVzaC5hcHBseSh0LHkoZS5mcmFtZXMpKX0pKSxhJiZhLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0Oyh0PW8uX2F1ZGlvU2FtcGxlcykucHVzaC5hcHBseSh0LHkoZS5mcmFtZXMpKX0pKX1yZXR1cm4gbihlLFt7a2V5OiJwYXJzZVNhbXBsZXMiLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKCFlKXRocm93IG5ldyBFcnJvcigibW9vdiBpcyByZXF1aXJlZCIpO2lmKHRoaXMudmlkZW9UcmFjay5jb2RlY3x8dGhpcy5hdWRpb1RyYWNrLmNvZGVjfHwoZ2UubW9vdlRvVHJhY2soZSx0aGlzLnZpZGVvVHJhY2ssdGhpcy5hdWRpb1RyYWNrKSx0aGlzLnZpZGVvU2VuYz10aGlzLnZpZGVvVHJhY2sudmlkZW9TZW5jLHRoaXMuYXVkaW9TZW5jPXRoaXMuYXVkaW9UcmFjay5hdWRpb1NlbmMpLCF0aGlzLl9hdWRpb1NhbXBsZXMubGVuZ3RoJiYhdGhpcy5fdmlkZW9TYW1wbGVzLmxlbmd0aCl7dmFyIHQ9Z2UubW9vdlRvU2FtcGxlcyhlKTtpZighdCl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBwYXJzZSBzYW1wbGVzIGZyb20gbW9vdiBib3giKTt0aGlzLl92aWRlb1NhbXBsZXM9dC52aWRlb1NhbXBsZXN8fFtdLHRoaXMuX2F1ZGlvU2FtcGxlcz10LmF1ZGlvU2FtcGxlc3x8W119fX0se2tleToiZGVtdXgiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLGEsbil7dGhpcy5wYXJzZVNhbXBsZXMobik7dmFyIGkscyxvLHU9dGhpcy52aWRlb1RyYWNrLGM9dGhpcy5hdWRpb1RyYWNrO2lmKHUuc2FtcGxlcz1bXSxjLnNhbXBsZXM9W10scil7Zm9yKHZhciBsLGY9MCxkPXJbMF0saD1yWzFdO2Q8PWg7ZCsrKXtpZighKGk9dGhpcy5fdmlkZW9TYW1wbGVzW2RdKSl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBmb3VuZCB2aWRlbyBmcmFtZSAjIi5jb25jYXQoZCkpO289aS5vZmZzZXQtdCxzPWUuc3ViYXJyYXkobyxvK2kuc2l6ZSksKGw9bmV3IFIoaS5wdHN8fGkuZHRzLGkuZHRzKSkuZHVyYXRpb249aS5kdXJhdGlvbixsLmdvcElkPWkuZ29wSWQsaS5rZXlmcmFtZSYmbC5zZXRUb0tleWZyYW1lKCk7Zm9yKHZhciBwPTAsdj1zLmxlbmd0aC0xO3A8djspZj1lZShzLHApLHArPTQsbC51bml0cy5wdXNoKHMuc3ViYXJyYXkocCxwK2YpKSxwKz1mO3Uuc2FtcGxlcy5wdXNoKGwpfXUuYmFzZU1lZGlhRGVjb2RlVGltZT11LnNhbXBsZXNbMF0uZHRzfWlmKGEpe2Zvcih2YXIgeT1hWzBdLG09YVsxXTt5PD1tO3krKyl7aWYoIShpPXRoaXMuX2F1ZGlvU2FtcGxlc1t5XSkpdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZm91bmQgdmlkZW8gZnJhbWUgIyIuY29uY2F0KHkpKTtvPWkub2Zmc2V0LXQscz1lLnN1YmFycmF5KG8sbytpLnNpemUpLGMuc2FtcGxlcy5wdXNoKG5ldyBMKGkuZHRzLHMsaS5kdXJhdGlvbikpfWMuYmFzZU1lZGlhRGVjb2RlVGltZT1jLnNhbXBsZXNbMF0uZHRzfXJldHVybnt2aWRlb1RyYWNrOnUsYXVkaW9UcmFjazpjLG1ldGFkYXRhVHJhY2s6dGhpcy5tZXRhZGF0YVRyYWNrfX19LHtrZXk6ImRlbXV4UGFydCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyxvKXtpZih0aGlzLnBhcnNlU2FtcGxlcyhuKSx0aGlzLnZpZGVvVHJhY2sudXNlRU1FPWksdGhpcy5hdWRpb1RyYWNrLnVzZUVNRT1pLHRoaXMuX2xhc3RSZW1haW5CdWZmZXImJnRoaXMuX2xhc3RSZW1haW5CdWZmZXIuYnl0ZUxlbmd0aD4wJiZ0PnRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcyYmdDw9dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zK3RoaXMuX2xhc3RSZW1haW5CdWZmZXIuYnl0ZUxlbmd0aClmb3IodmFyIHU9MDt1PDIwOyl0cnl7dmFyIGM9dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5zdWJhcnJheSgwLHQtdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zKSxsPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCtjLmJ5dGVMZW5ndGgpO2wuc2V0KGMsMCksbC5zZXQobmV3IFVpbnQ4QXJyYXkoZSksYy5ieXRlTGVuZ3RoKSxlPWwsdC09Yy5ieXRlTGVuZ3RoLHRoaXMuX2xhc3RSZW1haW5CdWZmZXI9bnVsbCx0aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9MDticmVha31jYXRjaChCKXtpZighKHU8MjApKXRocm93IG5ldyBFcnJvcigibmV3IFVpbnQ4QXJyYXkgZXJyb3I6LCIrQi5lcnJvck1lc3NhZ2UpO3UrK312YXIgZixkLGgscD10aGlzLnZpZGVvVHJhY2ssdj10aGlzLmF1ZGlvVHJhY2s7cC5zYW1wbGVzPVtdLHYuc2FtcGxlcz1bXSxwLnZpZGVvU2VuYz1udWxsLHYuYXVkaW9TZW5jPW51bGw7dmFyIHk9MCxtPTA7aWYodGhpcy5fdmlkZW9TYW1wbGVzLmxlbmd0aD4wJiZyLmxlbmd0aD4wKXtmb3IodmFyIGcsaz1lLmJ5dGVMZW5ndGgrdCxiPXJbMF07Yjw9clsxXTtiKyspe2lmKCEoZj10aGlzLl92aWRlb1NhbXBsZXNbYl0pKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGZvdW5kIHZpZGVvIGZyYW1lICMiLmNvbmNhdChiKSk7Zi5vZmZzZXQ+PXQmJmYub2Zmc2V0K2Yuc2l6ZTw9ayYmKHk9KGg9Zi5vZmZzZXQtdCkrZi5zaXplLGQ9ZS5zdWJhcnJheShoLHkpLChnPW5ldyBSKGYucHRzfHxmLmR0cyxmLmR0cykpLmR1cmF0aW9uPWYuZHVyYXRpb24sZy5nb3BJZD1mLmdvcElkLGcuc2FtcGxlT2Zmc2V0PWYuaW5kZXgsZi5rZXlmcmFtZSYmZy5zZXRUb0tleWZyYW1lKCksZy5kYXRhPWQsZy5zaXplPWYuc2l6ZSxwLnNhbXBsZXMucHVzaChnKSl9cC5zYW1wbGVzLmxlbmd0aD4wJiYocC5nb3BJZD1wLnNhbXBsZXNbMF0uZ29wSWQscC5iYXNlTWVkaWFEZWNvZGVUaW1lPXAuc2FtcGxlc1swXS5kdHMscC5zdGFydFB0cz1wLnNhbXBsZXNbMF0ucHRzL3AudGltZXNjYWxlLHAuZW5kUHRzPXAuc2FtcGxlc1twLnNhbXBsZXMubGVuZ3RoLTFdLnB0cy9wLnRpbWVzY2FsZSx0aGlzLnZpZGVvU2VuYyYmKHAudmlkZW9TZW5jPXRoaXMudmlkZW9TZW5jLnNsaWNlKHAuc2FtcGxlc1swXS5zYW1wbGVPZmZzZXQscC5zYW1wbGVzWzBdLnNhbXBsZU9mZnNldCtwLnNhbXBsZXMubGVuZ3RoKSxwLmtpZFZhbHVlPXMpKX1pZih0aGlzLl9hdWRpb1NhbXBsZXMubGVuZ3RoPjAmJmEubGVuZ3RoPjApe2Zvcih2YXIgXz1hWzBdO188PWFbMV07XysrKXtpZighKGY9dGhpcy5fYXVkaW9TYW1wbGVzW19dKSl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBmb3VuZCB2aWRlbyBmcmFtZSAjIi5jb25jYXQoXykpO2Yub2Zmc2V0Pj10JiZmLm9mZnNldCtmLnNpemU8PWUuYnl0ZUxlbmd0aCt0JiYobT0oaD1mLm9mZnNldC10KStmLnNpemUsZD1lLnN1YmFycmF5KGgsbSksdi5zYW1wbGVzLnB1c2gobmV3IEwoZi5kdHMsZCxmLmR1cmF0aW9uLGYuaW5kZXgpKSl9di5zYW1wbGVzLmxlbmd0aD4wJiYodi5nb3BJZD12LnNhbXBsZXNbMF0uZ29wSWR8fHAuZ29wSWQsdi5iYXNlTWVkaWFEZWNvZGVUaW1lPXYuc2FtcGxlc1swXS5kdHMsdi5zdGFydFB0cz12LnNhbXBsZXNbMF0ucHRzL3YudGltZXNjYWxlLHYuZW5kUHRzPXYuc2FtcGxlc1t2LnNhbXBsZXMubGVuZ3RoLTFdLnB0cy92LnRpbWVzY2FsZSx0aGlzLmF1ZGlvU2VuYyYmKHYuYXVkaW9TZW5jPXRoaXMuYXVkaW9TZW5jLnNsaWNlKHYuc2FtcGxlc1swXS5zYW1wbGVPZmZzZXQsdi5zYW1wbGVzWzBdLnNhbXBsZU9mZnNldCt2LnNhbXBsZXMubGVuZ3RoKSx2LmtpZFZhbHVlPXMpKX10aGlzLmRlY29kZXJEYXRhKHAsdixvKTtmb3IodmFyIHc9MCx4PTA7eDxwLnNhbXBsZXMubGVuZ3RoO3grKylmb3IodmFyIFM9MCxBPXAuc2FtcGxlc1t4XS5kYXRhLEQ9QS5sZW5ndGgtMTtTPEQ7KXc9ZWUoQSxTKSxTKz00LHAuc2FtcGxlc1t4XS51bml0cy5wdXNoKEEuc3ViYXJyYXkoUyxTK3cpKSxTKz13O3JldHVybiB0aGlzLl9sYXN0UmVtYWluQnVmZmVyPWUuc3ViYXJyYXkoTWF0aC5tYXgoeSxtKSksdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoPjA/dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zPXQrZS5ieXRlTGVuZ3RoLXRoaXMuX2xhc3RSZW1haW5CdWZmZXIuYnl0ZUxlbmd0aDp0aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9MCx7dmlkZW9UcmFjazpwLGF1ZGlvVHJhY2s6dixtZXRhZGF0YVRyYWNrOnRoaXMubWV0YWRhdGFUcmFja319fSx7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl92aWRlb1NhbXBsZXM9W10sdGhpcy5fYXVkaW9TYW1wbGVzPVtdLHRoaXMuX2xhc3RSZW1haW5CdWZmZXI9bnVsbCx0aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9MCx0aGlzLnZpZGVvVHJhY2sucmVzZXQoKSx0aGlzLmF1ZGlvVHJhY2sucmVzZXQoKSx0aGlzLm1ldGFkYXRhVHJhY2sucmVzZXQoKX19LHtrZXk6ImRlY29kZXJEYXRhIix2YWx1ZTpmdW5jdGlvbihlLHQscil7ZS51c2VFTUV8fHQudXNlRU1FfHxVdC5kZWNvZGVyQUVTQ1RSRGF0YShlLHQscil9fV0sW3trZXk6InByb2JlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZ2UucHJvYmUoZSl9fV0pLGV9KCksUHQ9e25vd1RpbWU6ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIHBhcnNlSW50KHBlcmZvcm1hbmNlLm5vdygpLDEwKX1jYXRjaChlKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX19LGNvbmNhdERhdGE6ZnVuY3Rpb24oZSx0KXt2YXIgcj1bXSxhPTA7ZSYmci5wdXNoKGUpLHQmJnIucHVzaCh0KSxyLmV2ZXJ5KChmdW5jdGlvbihlKXtyZXR1cm4gZSYmKGErPWUuYnl0ZUxlbmd0aCksITB9KSk7dmFyIG49bmV3IFVpbnQ4QXJyYXkoYSksaT0wO3JldHVybiByLmV2ZXJ5KChmdW5jdGlvbihlKXtyZXR1cm4gZSYmKG4uc2V0KGUsaSksaSs9ZS5ieXRlTGVuZ3RoKSwhMH0pKSxufX07b25tZXNzYWdlPWZ1bmN0aW9uKGUpe3ZhciByPWUuZGF0YTtzd2l0Y2goci5tZXRob2Qpe2Nhc2UiaW5pdCI6dGhpcy5jb2RlY1R5cGU9ci5hcmdzLmNvZGVjVHlwZSx0aGlzLm9wZW5sb2c9ci5hcmdzLm9wZW5Mb2csdGhpcy5NUDREZW11eGVyPW51bGwsdGhpcy5GTVA0UmVtdXhlcj1udWxsLHRoaXMuX25lZWRJbml0U2VnbWVudD0hMCx0aGlzLnN1cHBvcnRIZXZjPXIuYXJncy5zdXBwb3J0SGV2YzticmVhaztjYXNlInRyYW5zbXV4Ijp2YXIgYT1lLmRhdGEuYXJncyxuPW5ldyBVaW50OEFycmF5KGUuZGF0YS5idWZmZXIpO3RoaXMuTVA0RGVtdXhlcnx8KHRoaXMuTVA0RGVtdXhlcj1uZXcgQ3QobnVsbCxudWxsLG51bGwse29wZW5sb2c6dGhpcy5vcGVubG9nfSkpO3ZhciBpLHM9dGhpcy5NUDREZW11eGVyLmRlbXV4UGFydChuLGEuc3RhcnQsYS52aWRlb0lkeCxhLmF1ZGlvSWR4LGEubW9vdixhLnVzZUVNRSxhLmtpZFZhbHVlKTtpZih0aGlzLkZNUDRSZW11eGVyfHwiaDI2NSI9PT10aGlzLmNvZGVjVHlwZSYmIXRoaXMuc3VwcG9ydEhldmN8fCh0aGlzLkZNUDRSZW11eGVyPW5ldyBVZSh0aGlzLk1QNERlbXV4ZXIudmlkZW9UcmFjayx0aGlzLk1QNERlbXV4ZXIuYXVkaW9UcmFjayx7b3BlbkxvZzp0aGlzLm9wZW5sb2d9KSksdGhpcy5GTVA0UmVtdXhlcil7dmFyIG89dGhpcy5GTVA0UmVtdXhlci5yZW11eCh0aGlzLl9uZWVkSW5pdFNlZ21lbnQse2luaXRNZXJnZTohMH0pO28uaW5pdFNlZ21lbnQmJih0aGlzLl9uZWVkSW5pdFNlZ21lbnQ9ITEpLGk9e2J1ZmZlcjpQdC5jb25jYXREYXRhKG8uYXVkaW9TZWdtZW50LG8udmlkZW9TZWdtZW50KSxyYW5nZTphLmNvbnRleHQucmFuZ2Usc3RhdGU6YS5jb250ZXh0LnN0YXRlLGNvbnRleHQ6e3JhbmdlOmEuY29udGV4dC5yYW5nZSxmcmFnSW5kZXg6YS5jb250ZXh0LmZyYWdJbmRleCxzdGFydFB0czpNYXRoLm1pbihzLnZpZGVvVHJhY2suc3RhcnRQdHMscy5hdWRpb1RyYWNrLnN0YXJ0UHRzKSxlbmRQdHM6TWF0aC5tYXgocy52aWRlb1RyYWNrLmVuZFB0cyxzLmF1ZGlvVHJhY2suZW5kUHRzKX0saW5pdFNlZzpvLmluaXRTZWdtZW50fX10aGlzLnBvc3RNZXNzYWdlKHttZXRob2Q6InRyYW5zbXV4IixpZDplLmRhdGEuaWQsYXJnczp0KHt9LGkpfSk7YnJlYWs7Y2FzZSJyZXNldCI6dGhpcy5GTVA0UmVtdXhlciYmdGhpcy5GTVA0UmVtdXhlci5yZXNldCgpLHRoaXMuTVA0RGVtdXhlciYmdGhpcy5NUDREZW11eGVyLnJlc2V0KCksdGhpcy5GTVA0UmVtdXhlcj1udWxsLHRoaXMuTVA0RGVtdXhlcj1udWxsLHRoaXMuX25lZWRJbml0U2VnbWVudD0hMH19fSgpOwo=",hu="undefined"!==typeof window&&window.Blob&&new Blob([atob(du)],{type:"text/javascript;charset=utf-8"});function fu(){var e=hu&&(window.URL||window.webkitURL).createObjectURL(hu);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+du,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var mu=function(e){Yr(i,e);var t=zr(i);function i(e){var n;return Vr(this,i),n=t.call(this),n.openlog=e.openLog,n.codecType=e.codecType,n.supportHevc=e.supportHevc,n.worker=new fu,n.worker.onmessage=function(e){n.emit(e.data.method,e.data)},n.worker.postMessage({method:"init",id:e.id||0,args:{openlog:n.openlog,supportHevc:n.supportHevc,codecType:n.codecType}}),n}return Fr(i,[{key:"transmux",value:function(e,t,i,n,r,a,s,o,l){var u=t.buffer;this.worker&&this.worker.postMessage({method:"transmux",id:e,buffer:u,args:{start:i,videoIdx:n,audioIdx:r,moov:a,useEME:s,kidValue:o,context:l}},[u])}},{key:"reset",value:function(){this.worker&&this.worker.postMessage({method:"reset"})}},{key:"destroy",value:function(){this.worker&&this.worker.terminate()}}]),i}(X.a),pu={ERROR:"error",META_READY:"metaReady",MOOV_REQ_PROGRESS:"moov_request_Progress",UPDATE_LOAD_IDX:"update_load_fragmentIdx"},vu=function(e){Yr(i,e);var t=zr(i);function i(e,n){var r;if(Vr(this,i),r=t.call(this),Ar(Ur(r),"onprogressDataArrive",function(){var e=Wr(Pr().mark((function e(t,i,n){var a;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t&&t.byteLength>0&&(a=r.timeRange[n.index].range,a&&n.range[1]>=a[1]&&!i&&(i=!0),r.log("[mp4.loadFragment onprogressDataArrive ] receive data, >>> index,",n.index,",range,",JSON.stringify(n.range),", dataLen,",t.byteLength),r._mux(t,n.range[0],n.index,i)),i&&(r.timeRange[n.index].downloaded=!0,r.bufferLoadedPos=-1,r.log("[FragLoadDowned],fragmentIdx,",n.index,",rangeEnd,",n.range[1]));case 2:case"end":return e.stop()}}),e)})));return function(t,i,n){return e.apply(this,arguments)}}()),r.url=e,r.options=i.getDefaultConfig(),Object.keys(n).map((function(e){void 0!==n[e]&&null!==n[e]&&(r.options[e]=n[e])})),r.timeRange=[],r.CHUNK_SIZE=r.options.chunkSize,r.bufferLoaded=new Uint8Array(0),r.bufferLoadedPos=0,r.meta=null,r.videoTrak=null,r.audioTrak=null,r.canDownload=!0,r._loadSuccessCallBack=null,r._isPending=!1,r._metaLoading=!1,r.MP4Loader=new iu(_r(_r({segmentDuration:r.options.segmentDuration,url:e,vid:n.vid,retry:r.options.retryCount,retryDelay:r.options.retryDelay,timeout:r.options.timeout},n.reqOptions),{},{openLog:ou()})),r.fMP4Demuxer=null,r.MP4Demuxer=null,r.FMP4Remuxer=null,r._needInitSegment=!0,r._switchBitRate=!1,r.enableWorker=r.options.enableWorker,r.enableWorker&&"undefined"!==typeof Worker)try{r.workerSequence=0,r.transmuxerWorkerControl=new mu({id:r.workerSequence,codecType:n.codecType,supportHevc:r.options.supportHevc,openLog:ou()}),r.transmuxerWorkerControl.on("transmux",(function(e){var t=e.args;r.log("[transmuxerworker end] ,range, ",JSON.stringify(t.range),",dataLen,",t.buffer.byteLength,t.context),r._loadSuccessCallBack&&r._loadSuccessCallBack(t)}))}catch(a){r.log("Error in worker:",a),r.enableWorker=!1,r.transmuxerWorkerControl=null}return r.enableWorker||(r.MP4Demuxer=null,r.FMP4Remuxer=null),r.seekTime=-1,r.changeBitRateTime=-1,r}return Fr(i,[{key:"changeBitRate",value:function(){var e=Wr(Pr().mark((function e(t){return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.url=t.url,e.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+Date.now(),this.CHUNK_SIZE);case 3:this._switchBitRate=!0,this.log("[switchBitrate] changeUrl, bitRate,",this.url);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"log",value:function(e){for(var t=this.options,i=t&&t.vid?"[MP4] ".concat(t.vid," ").concat(e):"[MP4] ".concat(e),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];uu.apply(void 0,[i].concat(r))}},{key:"errorHandler",value:function(){var e=Wr(Pr().mark((function e(t,i){var n,r,a,s;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.response,r=t.message,a=this.options?this.options.vid:"",s=null,this._isPending=!0,n?(s=new Do("network",n.status,{httpText:n.httpText,message:r,url:n.url}),this.emit(pu.ERROR,s)):(console.log("[MP4] [".concat(a,"] errorHandler,"),t),s=t,this.emit(pu.ERROR,s));case 6:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"init",value:function(){var e=Wr(Pr().mark((function e(){return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.url){e.next=3;break}return e.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+Date.now(),this.CHUNK_SIZE);case 3:return e.next=5,this.getMetaInfo();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTimeRange",value:function(){for(var e=[],t=null,i=0;this.videoTrak&&i<this.videoTrak.length;i++)t={startTime:this.videoTrak[i].startTime,endTime:this.videoTrak[i].endTime,downloaded:!1,isLoading:!1},e.push(t);if(this.audioTrak&&this.audioTrak.length>e.length)for(var n=e.length;n<this.audioTrak.length;n++)t={startTime:Math.max(this.audioTrak[n].startTime,t?t.endTime:0),endTime:Math.max(this.audioTrak[n].endTime,t?t.endTime:0),downloaded:!1,isLoading:!1},e.push(t);return e}},{key:"getMetaInfo",value:function(){var e=Wr(Pr().mark((function e(){var t,i,n,r=this,a=arguments;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=!(a.length>0&&void 0!==a[0])||a[0],e.prev=1,this._metaLoading=!0,this.log("getMetaInfo start"),this.bufferLoaded=new Uint8Array(0),i=0,n=function(){var e=Wr(Pr().mark((function e(n,a,s){var o;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.log("getMetaInfo onProgressHandle, dataLen,",n?n.byteLength:-1,", state,",a,",range,",JSON.stringify(s.range)),n&&s.range[0]===i&&(r.bufferLoaded=qr()(Uint8Array,r.bufferLoaded,new Uint8Array(n)),i+=n.byteLength),s.meta&&!r.meta&&(o=s.meta,r.videoTrak=o.videoSegments,r.audioTrak=o.audioSegments,r.timeRange=r.getTimeRange(),r.meta=_r(_r({},o.meta),{},{ext:{videoTrak:r.videoTrak,audioTrak:r.audioTrak}}),o.bufferLoaded=r.bufferLoaded,r.log("meta reach"),t&&r.emit(pu.META_READY,r.meta)),r.meta&&a&&(r.log("[getMetaInfo req end]"),r._metaLoading=!1),r.meta&&(n||a)&&(r.log("emit moov_req_progress"),r.emit(pu.MOOV_REQ_PROGRESS));case 5:case"end":return e.stop()}}),e)})));return function(t,i,n){return e.apply(this,arguments)}}(),e.next=9,this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,this.CHUNK_SIZE],n);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](1),console.error("[MP4] trigger errorHandler getMetaInfo",null===e.t0||void 0===e.t0?void 0:e.t0.message),this.loadError(e.t0,"getMetaInfo");case 15:case"end":return e.stop()}}),e,this,[[1,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFragmentIdx",value:function(e){var t,i;if(this.videoTrak.length){if(t=this.videoTrak.find((function(t){return t.startTime<=e&&t.endTime>e})),i=this.audioTrak.find((function(t){return t.startTime<=e&&t.endTime>e})),t&&i)return Math.min(t.index,i.index);if(t||i)return t?t.index:i.index;var n=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(n=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(n=Math.min(this.audioTrak.length-1,n)),n}return i=this.audioTrak.find((function(t){return t.startTime<=e&&t.endTime>e})),i?i.index:0}},{key:"_checkHasMeta",value:function(){var e=Wr(Pr().mark((function e(){var t;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.log(" loadMeta start"),this._metaLoading=!0,e.next=4,this.MP4Loader.loadMeta(this.MP4Loader.cache,Math.round(this.CHUNK_SIZE/2));case 4:return t=e.sent,this._metaLoading=!1,this.videoTrak=t.videoSegments,this.audioTrak=t.audioSegments,this.meta=_r(_r({},t.meta),{},{ext:{videoTrak:this.videoTrak,audioTrak:this.audioTrak}}),this.timeRange=this.getTimeRange(),this.bufferLoaded=new Uint8Array(0),t.bufferLoaded=this.bufferLoaded,e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"resetFragmentLoadState",value:function(e){for(var t=0;t<this.timeRange.length;t++)t<e?(this.timeRange[t].downloaded=!0,this.timeRange[t].isLoading=!0):(this.timeRange[t].downloaded=!1,this.timeRange[t].isLoading=!1)}},{key:"getFragRange",value:function(e){var t,i,n,r,a=null;this.videoTrak&&(a=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1]);var s=null;this.audioTrak&&(s=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1]);var o=0,l=0;this.videoTrak&&e>=this.videoTrak.length-1&&(o=-1),this.audioTrak&&e>=this.audioTrak.length-1&&(l=-1);var u=[Math.min((null===(t=a)||void 0===t?void 0:t.range[0])||1/0,(null===(i=s)||void 0===i?void 0:i.range[0])||1/0),Math.max((null===(n=a)||void 0===n?void 0:n.range[1])+o||0,(null===(r=s)||void 0===r?void 0:r.range[1])+l||0)];return e<this.timeRange.length&&(this.timeRange[e].range=u),u}},{key:"load",value:function(){var e=Wr(Pr().mark((function e(t,i){var n,r,a;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._loadSuccessCallBack=i,!this._switchBitRate||this._metaLoading){e.next=12;break}return this.log("[switchBitrate], switch bitRate start load, time,",t>=this.videoTrak.length?this.audioTrak[t].startTime:this.videoTrak[t].startTime,", fragIndex,",t),e.next=5,this._checkHasMeta();case 5:n=e.sent,this.changeBitRateTime>0&&(this.timeRange[t].startTime<=this.changeBitRateTime&&this.changeBitRateTime<this.timeRange[t].endTime?this.log("[switchBitrate], not need update load fragIndex",t,",stTime,",this.changeBitRateTime):(t=this.getFragmentIdx(this.changeBitRateTime),this.log("[switchBitrate], need update load fragIndex",t,",stTime,",this.changeBitRateTime,",newBitrateTimeRange,",this.timeRange[t].startTime,"-",this.timeRange[t].endTime),this.emit(pu.UPDATE_LOAD_IDX,t)),this.seekTime=this.changeBitRateTime,this.changeBitRateTime=-1),this.resetFragmentLoadState(t),this.log("[switchBitrate], reset timerange state,",t),this._needInitSegment=!0,this.resetTansmuxer(),n&&(this._switchBitRate=!1);case 12:if(!this._switchBitRate||!this._metaLoading){e.next=14;break}return e.abrupt("return");case 14:r=this.getFragRange(t),this.log("loadFragment,",t,",range,",JSON.stringify(r)),this.seekTime>0?(a=this.getSubRange(t,this.seekTime,r),this.loadFragment(t,a),this.seekTime=-1):this.loadFragment(t,r);case 17:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"getSubRange",value:function(e,t,i){var n=i[0],r=i[0],a=1,s=!1;if(this.log(">>>>>getSubRange time,",t,JSON.stringify(i)),this.videoTrak){var o=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1];if(0===o.frames.length)return this.log(">>>>>getSubRange video, no frames"),i;var l=o.frames.filter(gu),u=this.meta.videoTimescale,c=l[0].startTime/u;this.log(">>>>>getSubRange video, startTime,",o.startTime,",endTime,",o.endTime);for(var d=0;d<l.length;d++)this.log(">>>>>getSubRange video keyFrameList, startTime,",l[d].startTime/u,",range,",l[d].offset);for(;a<l.length;a++){var h=l[a].startTime/u;if(c<=t&&t<h&&i[0]<l[a-1].offset){n=l[a-1].offset,s=!0,this.log(">>>>>getSubRange video end, startTime,",c,",endTime,",h,",startRange,",n,", keyFrameIndex,",a-1);break}c=h}!s&&c<=t&&t<o.endTime+.8&&(n=l[a-1].offset,this.log(">>>>>getSubRange video last, startTime,",c,",endTime,",o.endTime,",startRange,",n))}if(a=1,this.audioTrak){var f=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1];if(0===f.frames.length)return this.log(">>>>>getSubRange video, no frames"),i;var m=f.frames,p=this.meta.audioTimescale;a=Math.floor((t*p-m[0].startTime)/f.frames[0].duration),a=Math.min(m.length-1,a);for(var v=a>0?m[a-1].startTime/p:m[0].startTime/p;a>=0&&a<m.length;)if(a>0&&v>t)a-=1,v=m[a].startTime/p;else{var g=(m[a].startTime+m[a].duration)/p;if(v<=t&&t<g&&i[0]<m[a].offset){r=m[a].offset,s=!0,this.log(">>>>>getSubRange audio end, startTime,",v,",endTime,",g,",startRange,",r,", index,",a);break}v=g,a++}}var y=[Math.min(r,n),i[1]];return this.log(">>>>>getSubRange finalRange ",JSON.stringify(y),",oldRange,",JSON.stringify(i)),y}},{key:"_mux",value:function(e,t,i,n){var r=this.getSamplesRange(i,"video"),a=this.getSamplesRange(i,"audio"),s=[t,t+e.byteLength];if(this.transmuxerWorkerControl&&!this.meta.isFragmentMP4){var o={range:s,state:n,fragIndex:i};this.log("[transmuxerworker start] ,range, ",JSON.stringify(s),",dataLen,",e.byteLength,o),this.transmuxerWorkerControl.transmux(this.workerSequence,e,t,r,a,this.meta.moov,this.useEME,this.kidValue,o)}else try{var l,u;this.meta.isFragmentMP4?(this.fMP4Demuxer||(this.fMP4Demuxer=new Ja),l=this.fMP4Demuxer.demuxPart(e,t,this.meta.moov)):(this.MP4Demuxer||(this.MP4Demuxer=new zs(this.videoTrak,this.audioTrak,null,{openLog:ou()})),l=this.MP4Demuxer.demuxPart(e,t,r,a,this.meta.moov,this.useEME,this.kidValue)),this.FMP4Remuxer||this.checkCodecH265()&&!this.options.supportHevc||(this.FMP4Remuxer=new qs(l.videoTrack,l.audioTrack,{openLog:ou()})),this.log("[mux], videoTimeRange,",l.videoTrack?[l.videoTrack.startPts,l.videoTrack.endPts]:null,",audioTimeRange,",l.audioTrack?[l.audioTrack.startPts,l.audioTrack.endPts]:null);var c=Math.min(l.videoTrack.startPts,l.audioTrack.startPts),d=Math.max(l.videoTrack.endPts,l.audioTrack.endPts),h=[c,d];if(this.FMP4Remuxer){var f=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0,range:s});f.initSegment&&(this._needInitSegment=!1);var m=Vo.concatData(f.audioSegment,f.videoSegment);u={buffer:m,range:s,state:n,context:{range:s,fragIndex:i,timeRange:h},initSeg:f.initSegment}}else u={videoTrack:l.videoTrack,audioTrack:l.audioTrack,buffer:null,range:s,state:n,context:{range:s,fragIndex:i,timeRange:h}};this._loadSuccessCallBack&&this._loadSuccessCallBack(u)}catch(v){console.error("mux err:",v);var p=new Wo(_o.remux,Xo.muxError,{msg:JSON.stringify(v)});this.errorHandler(p,"mux",{fragIndex:i,range:[t,t+e.byteLength]})}}},{key:"getSamplesRange",value:function(e,t){var i=[];switch(t){case"video":if(this.videoTrak&&e<this.videoTrak.length){var n=this.videoTrak[e].frames;if(!n.length)break;i.push(n[0].index),i.push(n[n.length-1].index)}break;case"audio":if(this.audioTrak&&e<this.audioTrak.length){var r=this.audioTrak[e].frames;if(!r.length)break;i.push(r[0].index),i.push(r[r.length-1].index)}break;default:console.warn("[getSamplesRange] type ",t," is invalid");break}return i}},{key:"loadFragment",value:function(){var e=Wr(Pr().mark((function e(t,i){var n,r,a,s;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this._isPending||i.length>0&&0===i[0]&&0===i[1]||this.timeRange[t].isLoading)){e.next=2;break}return e.abrupt("return");case 2:if(this.log("[MP4.loadFragment] ,fragIndex,",t,",range ",i,",len ,",i[1]-i[0],", bufferLoaded_Len,",this.bufferLoaded.byteLength),!(i.length>=2&&i[1]&&i[1]>0&&i[1]<=this.bufferLoaded.byteLength)){e.next=13;break}this.timeRange[t].isLoading=!0,n=Math.max(i[0],this.bufferLoadedPos),r=new Uint8Array(this.bufferLoaded.slice(n,i[1])),this.log("[mp4.loadFragment] has all data: ",n,i[1]),this.timeRange[t].downloaded=!0,this.bufferLoadedPos=-1,this._mux(r,n,t,!0),e.next=34;break;case 13:if(!(i.length>=2&&i[0]&&i[0]<=this.bufferLoaded.byteLength)){e.next=29;break}if(this.timeRange[t].isLoading){e.next=27;break}if(a=Math.max(i[0],this.bufferLoadedPos),s=new Uint8Array(this.bufferLoaded.slice(a,i[1])),!(s.byteLength>0)){e.next=22;break}return this.bufferLoadedPos=a+s.byteLength,this.log("[mp4.loadFragment] has part data: ",a,a+s.byteLength),this._mux(s,a,t,i[1]<=this.bufferLoadedPos),e.abrupt("return");case 22:if(this._metaLoading||this.timeRange[t].isLoading){e.next=27;break}return this.log("[mp4.loadFragment] ready to load part data >>> ",this.bufferLoaded.byteLength,i[1]),this.timeRange[t].isLoading=!0,e.next=27,this.startLoad([this.bufferLoaded.byteLength,i[1]],t);case 27:e.next=34;break;case 29:if(this._metaLoading&&!(i[0]>=this.CHUNK_SIZE)||this.timeRange[t].isLoading){e.next=34;break}return this.timeRange[t].isLoading=!0,this.log("[mp4.loadFragment],ready to load all data ,segmentIdx, ",t,",range >>> ",JSON.stringify(i)),e.next=34,this.startLoad(i,t);case 34:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"startLoad",value:function(){var e=Wr(Pr().mark((function e(t,i){return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.MP4Loader.loadData(t,this.MP4Loader.cache,{index:i,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen});case 3:e.next=9;break;case 5:e.prev=5,e.t0=e["catch"](0),console.error("[MP4] trigger errorHandler getMetaInfo",null===e.t0||void 0===e.t0?void 0:e.t0.message),this.loadError(e.t0,"loadFragment",{range:t,fragIndex:i});case 9:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"loadError",value:function(e,t,i){var n;!e.response&&(e.response={}),e.isTimeout?e.response.status="timeout":null!==e&&void 0!==e&&null!==(n=e.response)&&void 0!==n&&n.status||(e.response.status="networkError"),this.errorHandler(e,t,i)}},{key:"cancelLoading",value:function(){var e=Wr(Pr().mark((function e(){return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.MP4Loader;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this.MP4Loader.cancel();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"update",value:function(e){this.url=e}},{key:"checkCodecH265",value:function(){var e=this.meta&&(this.meta.videoCodec.indexOf("hvc1")>-1||this.meta.videoCodec.indexOf("hev1")>-1);return e}},{key:"destroy",value:function(){this.hasDestroyed||(this.resetTansmuxer(),this.transmuxerWorkerControl&&this.transmuxerWorkerControl.destroy(),this._isPending=!1,this._metaLoading=!1,this.bufferLoadedPos=0,this.bufferLoaded=new Uint8Array(0),this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy()),this.hasDestroyed=!0)}},{key:"resetTansmuxer",value:function(){this.MP4Demuxer&&this.MP4Demuxer.reset(),this.MP4Demuxer=null,this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.FMP4Remuxer=null,this.transmuxerWorkerControl&&this.transmuxerWorkerControl.reset()}}],[{key:"getDefaultConfig",value:function(){return{segmentDuration:5,onProcessMinLen:1024,chunkSize:8e5,retryCount:3,retryDelay:1e3,timeout:3e3,enableWorker:!1,playerId:"",vid:"",ext:{}}}}]),i}(X.a);function gu(e){if(e.keyframe)return e}var yu=function(){function e(){so(this,e)}return lo(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(t){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var i=[],n=0,r=e.length;n<r;n++){var a=i.length;if(a&&t){var s=i[a-1],o=s[1],l=e.start(n);if(l-o<=t){var u=e.end(n);u>o&&(s[1]=u)}else i.push([e.start(n),e.end(n)])}else i.push([e.start(n),e.end(n)])}return i}},{key:"totalLength",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var r=0,a=0,s=0,o=0,l=0,u=0,c=0,d=e.buffers(t,n),h=0,f=d.length;h<f;h++){var m=d[h];if(i+n>=m[0]&&i<=m[1])r=m[0],a=m[1],s=h;else{if(i+n<m[0]){o=m[0],l=m[1];break}i+n>m[1]&&(u=m[0],c=m[1])}}return{start:r,end:a,index:s,buffers:d,nextStart:o,nextEnd:l,prevStart:u,prevEnd:c,currentTime:i,behind:i-r,remaining:a?a-i:0,length:e.totalLength&&e.totalLength(d)}}},{key:"isBuffered",value:function(t,i){if(t){var n=e.get(t);if(null!==n&&void 0!==n&&n.length)for(var r=0;r<n.length;r++)if(i>=n.start(r)&&i<=n.end(r))return!0}return!1}}]),e}(),bu="undefined"!==typeof window;function Lu(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{return bu?e&&"undefined"!==typeof ManagedMediaSource?ManagedMediaSource:window.MediaSource:null}catch(t){}}function Su(e){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(e))}function Tu(e){var t=[];if(e instanceof TimeRanges)for(var i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}var ku={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},xu=(Error,function(){function e(t,i){var n=this;so(this,e),uo(this,"media",null),uo(this,"mediaSource",null),uo(this,"_openPromise",Nl()),uo(this,"_queue",Object.create(null)),uo(this,"_sourceBuffer",Object.create(null)),uo(this,"_mseFullFlag",{}),uo(this,"_st",0),uo(this,"_opst",0),uo(this,"_logger",null),uo(this,"_config",null),uo(this,"_url",null),uo(this,"_onStartStreaming",(function(){n._logger.debug("startstreaming")})),uo(this,"_onEndStreaming",(function(){n._logger.debug("endstreaming")})),uo(this,"_onSBUpdateEnd",(function(e){var t=n._queue[e];if(t){var i=t[0];if((null===i||void 0===i?void 0:i.opName)!==ku.UPDATE_DURATION&&t.shift(),i){var r,a,s=Fl()-n._opst;n._logger.debug("UpdateEnd(".concat(e,"/").concat(i.opName,")"),Al.stringify(Tu(null===(r=n._sourceBuffer[e])||void 0===r?void 0:r.buffered)),s,i.context),i.promise.resolve({name:i.opName,context:i.context,costtime:s});var o=null===(a=i.context)||void 0===a?void 0:a.callback;o&&"function"===typeof o&&o(i.context),n._startQueue(e)}}})),uo(this,"_onSBUpdateError",(function(e,t){var i=n._queue[e];if(i){var r=i[0];r&&(n._logger.error("UpdateError",e,r.opName,r.context),r.promise.reject(new Go(Io.MEDIA,Io.SUB_TYPES.MSE_APPEND_BUFFER,t)))}})),this._config=Object.assign(e.getDefaultConfig(),i),t&&this.bindMedia(t),this._logger=new yl("MSE"),this._config.openLog&&yl.enable()}return lo(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"hasOpTasks",get:function(){var e=this,t=!1;return Object.keys(this._queue).forEach((function(i){var n=e._queue[i];Array.isArray(n)&&(t||(t=n.length>0))})),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"streaming",get:function(){return!Su(this.mediaSource)||this.mediaSource.streaming}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[e.VIDEO]}},{key:"updateDuration",value:function(e){var t=this,i=this.mediaSource&&this.mediaSource.duration>e;if(this.mediaSource&&this.mediaSource.duration>e){var n=0;if(Object.keys(this._sourceBuffer).forEach((function(e){try{n=Math.max(t.bufferEnd(e)||0,n)}catch(i){}})),e<n)return Promise.resolve()}return this._enqueueBlockingOp((function(){t.isEnded?t._logger.debug("setDuration but ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("setDuration",e))}),ku.UPDATE_DURATION,{isReduceDuration:i})}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,i=function i(){var n=Fl()-e._st;e._logger.debug("sourceopen",n),t.removeEventListener("sourceopen",i),e._openPromise.resolve({costtime:n})};t.addEventListener("sourceopen",i),this._openPromise=Nl()}return this._openPromise}},{key:"bindMedia",value:function(){var e=ao(io().mark((function e(t){var i,n,r,a,s=this;return io().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(i=Lu(this._config.preferMMS),t&&i){e.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=t,n=this.mediaSource=new i,r=Su(n),this._st=Fl(),a=function e(){var i=Fl()-s._st;s._logger.debug("sourceopen"),n.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),s._openPromise.resolve({costtime:i})},n.addEventListener("sourceopen",a),r&&(n.addEventListener("startstreaming",this._onStartStreaming),n.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(n),t.src=this._url,t.disableRemotePlayback=r,e.abrupt("return",this._openPromise);case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unbindMedia",value:function(){var e=ao(io().mark((function e(){var t,i,n,r=this;return io().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource,t){if(Object.keys(this._queue).forEach((function(e){var t=r._queue[e];t&&t.forEach((function(e){var t,i;return null===(t=e.promise)||void 0===t||null===(i=t.resolve)||void 0===i?void 0:i.call(t)}))})),i=!!this.media&&this.media.readyState>=1,n="open"===t.readyState,i&&n)try{t.endOfStream()}catch(a){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(r._sourceBuffer[e])}catch(a){}})),Su(t)&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch(a){}this.media=null}this.mediaSource=null,this._openPromise=Nl(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var i;try{i=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(n){throw new Go(Io.MEDIA,Io.SUB_TYPES.MSE_ADD_SB,n)}i.mimeType=t,i.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),i.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var i=this,n=this._sourceBuffer[e];return this.mediaSource&&n&&n.mimeType!==t?"function"!==typeof n.changeType?Promise.reject(new Go(Io.MEDIA,Io.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(e,(function(){try{n.changeType(t)}catch(r){throw new Go(Io.MEDIA,Io.SUB_TYPES.MSE_CHANGE_TYPE,r)}n.mimeType=t,i._onSBUpdateEnd(e)}),"changeType",{mimeType:t}):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,i){var n=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var r;n.mediaSource&&!n.media.error&&(n._logger.debug("MSE APPEND START",i),n._opst=Fl(),null===(r=n._sourceBuffer[e])||void 0===r||r.appendBuffer(t))}),ku.APPEND,i):Promise.resolve()}},{key:"remove",value:function(e,t,i,n){var r=this,a=!1;return this._mseFullFlag[e]&&(a=!0),this._enqueueOp(e,(function(){if(r.mediaSource&&!r.media.error){var a=r._sourceBuffer[e];t>=i||!a?r._onSBUpdateEnd(e):(r._opst=Fl(),r._logger.debug("MSE REMOVE START",e,t,i,n),a.remove(t,i))}}),ku.REMOVE,n,a)}},{key:"clearBuffer",value:function(e,t){var i,n=this;return Object.keys(this._sourceBuffer).forEach((function(r){i=n.remove(r,e,t)})),i||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(i){var n=t._sourceBuffer[i];e=t.remove(i,0,yu.end(yu.get(n)))})),e}},{key:"clearOpQueues",value:function(e,t){var i;this._logger.debug("MSE clearOpQueue START");var n=this._queue[e];if(t&&n)this._queue[e]=[];else if(n&&n[e]&&!(n.length<5)){var r=[];n.forEach((function(e){e.context&&e.context.isinit&&r.push(e)})),this._queue[e]=n.slice(0,2),r.length>0&&(i=this._queue[e]).push.apply(i,r)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var i=t.mediaSource;i&&"open"===i.readyState&&(t._logger.debug("MSE endOfStream START"),e?i.endOfStream(e):i.endOfStream())}),"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var i=this.mediaSource;e<0||t<e||null===i||void 0===i||!i.setLiveSeekableRange||"open"!==i.readyState||i.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return yu.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return yu.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return yu.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,i,n,r){var a=this;if(!this.mediaSource)return Promise.resolve();var s=this._queue[e]=this._queue[e]||[],o={exec:t,promise:Nl(),opName:i,context:n};return r?(s.splice(0,0,o),this._mseFullFlag[e]=!1,this._startQueue(e)):s.push(o),this.isOpened||this.isEnded?1===s.length&&this._startQueue(e):this._openPromise.then((function(){1===s.length&&a._startQueue(e)})),o.promise}},{key:"_enqueueBlockingOp",value:function(){var e=ao(io().mark((function e(t,i,n){var r,a,s=this;return io().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(r=Object.keys(this._sourceBuffer),r.length){e.next=5;break}return e.abrupt("return",t());case 5:return a=[],r.forEach((function(e){var t=s._queue[e],r=Nl();a.push(r),t.push({exec:function(){r.resolve()},promise:r,opName:i,context:n}),1===t.length&&s._startQueue(e)})),e.abrupt("return",Promise.all(a).then((function(){try{return t()}finally{r.forEach((function(e){var t=s._queue[e],i=s._sourceBuffer[e];null===t||void 0===t||t.shift(),i&&i.updating||s._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)})));function t(t,i,n){return e.apply(this,arguments)}return t}()},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var i=t[0];if(i&&!this._mseFullFlag[e])try{i.exec()}catch(n){n&&n.message&&n.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,i.context&&"object"===no(i.context)&&(i.context.isFull=!0),this._logger.error("[MSE error],  context,",i.context," ,name,",i.opName,",err,SourceBuffer is full"),i.promise.reject(new Go(Io.MEDIA,Io.SUB_TYPES.MSE_FULL,n))):(this._logger.error(n),i.promise.reject(n.constructor===Go?n:new Go(Io.MEDIA,Io.SUB_TYPES.MSE_OTHER,n)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,i){var n=this;return this._enqueueOp(e,(function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)}),"setTimeoffset",i)}},{key:"abort",value:function(e,t){var i=this;return this.isOpened?this._enqueueOp(e,(function(){i._sourceBuffer[e].abort(),i._onSBUpdateEnd(e)}),"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=Lu();if(!t)return!1;try{return t.isTypeSupported(e)}catch(i){return this._logger.error(e,i),!1}}},{key:"isMMSOnly",value:function(){return"undefined"!==typeof ManagedMediaSource&&"undefined"===typeof MediaSource}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),e}());uo(xu,"VIDEO","video"),uo(xu,"AUDIO","audio");var Ru=function(){function e(t){Vr(this,e),this.onTick_=t,this.cancelPending_=null}return Fr(e,[{key:"tickAfter",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.stop();var n=!0,r=null;this.cancelPending_=function(){window.clearTimeout(r),n=!1};var a=function(){n&&(t.onTick_(),i&&i())};return r=window.setTimeout(a,1e3*e),this}},{key:"tickEvery",value:function(e){var t=this;this.tickAfter(e,(function(){t.tickEvery(e)}))}},{key:"stop",value:function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)}}]),e}(),wu=function(){function e(){var t,i;Vr(this,e);var n=new Promise((function(e,n){t=e,i=n})),r=n;return r.resolve=function(e){t(e),r.state="fulfilled"},r.reject=function(e){i(e),r.state="rejected",r.isBreak="DESTROYED"===e},r.state="pending",r}return Fr(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}(),Eu="DESTROYED",Zu=null,Cu=null,Iu=null,Mu=null,Gu=function(e){Yr(i,e);var t=zr(i);function i(e){var r;return Vr(this,i),r=t.call(this,e),Ar(Ur(r),"_onMp4DataCallBack",(function(){r._isMseInit&&r._onTimeUpdate()})),Ar(Ur(r),"_onMp4MetaReady",(function(e){var t=Ur(r),i=t.config,n=r.mp4.checkCodecH265();try{if(n&&!r.config.supportHevc){var a="browser not support HEVC",s=new $(r.player,{errorType:"runtime",errorTypeCode:_o.runtime,errorCode:Xo.h265Error,errorMessage:a,vid:i.vid,mediaError:{code:Xo.h265Error,message:a}});r._errorHandler(s)}else r._initMse(e),r._initPromise.resolve()}catch(l){var o=new $(r.player,{errorType:"runtime",errorTypeCode:_o.runtime,errorCode:Xo.mse,errorMessage:null===l||void 0===l?void 0:l.message,vid:i.vid,mediaError:{code:Xo.other1,message:null===l||void 0===l?void 0:l.message}});return void r._errorHandler(o)}r._loadData()})),Ar(Ur(r),"_onMp4Error",(function(e){var t=r.playerConfig.vid;console.error("[Index] _onMp4Error",t,e),r._errorHandler(e)})),Ar(Ur(r),"_loadDataSuccess",(function(e){if(!r.isDestroy&&r.mse){r.log("[loadFragment] _loadDataSuccess ",JSON.stringify(e.context.range),",dataLen,",e.buffer?e.buffer.byteLength:0,e.state);try{e.initSeg&&(r._appendInitSeg(e.initSeg),(!e.buffer||e.buffer.byteLength<1)&&(r.log("no data, must load data"),r._onTimeUpdate()));var t=e.buffer,i=e.state,n=e.context;if(r.mse&&i&&(!t||t.byteLength<=0)&&n.fragIndex===r.mp4.timeRange.length-1){var a=r.player.buffered;a&&a.length>0&&(r.bufferEndTime=a.end(a.length-1)),r._isEnded(),r.log("loaded ended !!!==>>>",JSON.stringify(n.range),", fragIndex,",n.fragIndex,", bufferEndTime,",r.bufferEndTime,",meta_duration,",r.mp4.meta.duration)}if(r.mse&&i&&n.fragIndex===r.mp4.timeRange.length-1&&(!t||t.byteLength<=0)){var s=r.player.buffered;s&&s.length>0&&(r.bufferEndTime=s.end(s.length-1)),r._isEnded(),r.log("load ended !!!==>>>",r.playerConfig.vid,JSON.stringify(n.range),", fragIndex,",n.fragIndex,", bufferEndTime,",r.bufferEndTime,",meta_duration,",r.mp4.meta.duration)}t&&r.mse&&t&&t.byteLength>0&&r._appendBuffer(xu.VIDEO,t,n,i)}catch(l){r.log("appendBuffer error",l);var o=new $(r.player,{errorType:"runtime",errorTypeCode:_o.runtime,errorCode:Xo.mse,vid:r.player.config.vid,errorMessage:l.message,mediaError:{code:Xo.mse,message:l.message}});r._errorHandler(o)}null!==e&&void 0!==e&&e.state&&r._onTimeUpdate()}})),Ar(Ur(r),"_onWaiting",(function(){var e=Ur(r),t=e.player,i=e.config;clearTimeout(r._waitInBufferTimer),r._waitInBufferTimer=null;var n=t.currentTime,a=t.bufferedPoint;a.end>0&&a.end-t.currentTime>=2&&r._waitAdjustTimeCnt<i.waitJampBufferMaxCnt&&(r._waitInBufferTimer=setTimeout((function(){r._waitAdjustTimeCnt++,t.currentTime=t.currentTime+.5,r.log("[waitInBufferTimeout], waitAdjustTimeCnt,",r._waitAdjustTimeCnt,",curtime,",n,Vo.nowTime())}),i.waitingInBufferTimeOut))})),Ar(Ur(r),"_onSeeking",Wr(Pr().mark((function e(){var t,i,n,a,s,o,l,u,c,d,h;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=Ur(r),i=t.player,n=t.mp4,a=i.currentTime,r.log("[seekTime], curTime,",a,",buffer,",i.buffered2.bufferedList),n&&n.meta){e.next=5;break}return e.abrupt("return");case 5:if(r.endofstream=!1,n.bufferLoadedPos=-1,n._metaLoading=!1,s=i.bufferedPoint,o=!1,l=0,!(s.end>0)){e.next=25;break}if(o=!0,!(n.meta.duration-s.end<.5)){e.next=17;break}return r._startProgress(),r.log("[seeking in buffered range], buffer end,",s.end,", duration,",n.meta.duration),e.abrupt("return");case 17:if(l=n.getFragmentIdx(s.end),r._curLoadSegmentIdx!==l){e.next=22;break}return r._startProgress(),r.log("[seeking in buffered range], seek fragIndex is current load segmentIdx",l),e.abrupt("return");case 22:n.seekTime=s.end,l<0&&(l=r._curLoadSegmentIdx),r.log("[seeking in buffered range], seekTime ",a,",bufferRange,",s.start,"-",s.end,", fragIndex,",l);case 25:return o||(n.seekTime=a,l=n.getFragmentIdx(a),l<0&&(l=r._curLoadSegmentIdx),r.log("[seekTime out buffer range], curTime,",a,", Idx,",l),u=Ur(r),c=u.mse,c&&c.isFull()&&(d=i.buffered2.bufferedList,h=d[d.length-1],c.clearOpQueues(xu.VIDEO),r._checkRemoveSourceBuffer([h.start,h.end],i.currentTime,!0,!0))),e.next=28,n.cancelLoading();case 28:n.resetFragmentLoadState(l),r._curLoadSegmentIdx=l,r._onTimeUpdate(),r._startProgress(),r._isEnded();case 33:case"end":return e.stop()}}),e)})))),Ar(Ur(r),"changeDefineCanPlay",(function(e,t,i,a){var s=Ur(r),o=s.player;if(o.ended)o.currentTime=0;else{r.log("[oldChangeDefinition],this._changeDefState,",r._changeDefState),o.currentTime=r._changeDefState?r._changeDefState.currentTime:e;var l=r._changeDefState?r._changeDefState.paused:t;l?o.pause():o.play(),r._changeDefState=null,o.emit(n.AFTER_DEFINITION_CHANGE,{from:i,to:a})}})),Ar(Ur(r),"changeDefinition",function(){var e=Wr(Pr().mark((function e(t,i){var a,s,o,l,u,c,d;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=Ur(r),s=a.player,o=a.config,l=a.mp4,i||(i=s.curDefinition),r._MSEError=!1,!o.witchBitRateWay){e.next=6;break}return r.oldChangeDefinition(t,i),e.abrupt("return");case 6:if(s.emit(n.DEFINITION_CHANGE,{from:i,to:t}),u=s.currentTime,c=l.getFragmentIdx(u),c<0&&(c=r._curLoadSegmentIdx),r.log("switchBitrate:point,fragIndex,",c,",startTime,",l.timeRange[c].startTime,",currentTime,",s.currentTime),!l){e.next=16;break}return r.mp4.changeBitRateTime=u,e.next=15,l.cancelLoading();case 15:l._metaLoading&&(l._metaLoading=!1);case 16:return r._removeBuffeEndTime=l.timeRange[c].startTime,r._isChangeDefinition=!0,d=s.getBufferedRange(s.buffered),d[1]>0&&d[1]-s.currentTime>5&&(r.mse.clearOpQueues(xu.VIDEO),r.mse.remove(xu.VIDEO,s.currentTime+5,d[1])),r.log("switchBitrate: resetFragmentLoadState,",c),l.resetFragmentLoadState(c),r._curLoadSegmentIdx=c,e.next=25,r.mp4.changeBitRate(t);case 25:r._onTimeUpdate(),s.emit("RESOLUTION_UPDATE",t);case 27:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}()),Ar(Ur(r),"_replayHook",(function(){var e;return null===(e=r.player)||void 0===e||e.play(),!1})),Ar(Ur(r),"_retryHook",(function(){return r.beforePlayerInit(),!1})),r.mp4=null,r.mse=null,r._waitAdjustTimeCnt=0,r._lastCheckTime=Vo.nowTime(),r._removeBuffeEndTime=0,r._pendingPromises=[],r}return Fr(i,[{key:"afterCreate",value:function(){var e=this;window.__mp4player=this;try{xt.defineGetterOrSetter(this.player,{__url:{get:function(){try{return e.mse?e.mse.url:e.config.url}catch(t){return null}}}})}catch(t){}this._proxyPlayer()}},{key:"attachEvents",value:function(){this.off(n.SEEKING,this._onSeeking),this.on(n.SEEKING,this._onSeeking),this.on(n.WAITING,this._onWaiting),this.off(n.URL_CHANGE,this.switchURL),this.on(n.URL_CHANGE,this.switchURL)}},{key:"detachEvents",value:function(){this.off(n.SEEKING,this._onSeeking),this.off(n.WAITING,this._onWaiting),this.off(n.URL_CHANGE,this.switchURL)}},{key:"_proxyPlayer",value:function(){var e=this;"function"===typeof this.player.playNext&&(Zu=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)},Cu=this.player._startInit,Mu=this.player.switchURL,Iu=this.player.changeDefinition,this.player._startInit=this._playerStartInit.bind(this),this.player.switchURL=this.switchURL.bind(this),this.player.changeDefinition=this.changeDefinition.bind(this),this.player.removeHooks("replay",this._replayHook),this.player.removeHooks("retry",this._retryHook)}},{key:"_playerStartInit",value:function(e){var t=this,i=this.config,n=this.playerConfig;void 0===i.supportHevc&&null!==j&&void 0!==j&&j.isHevcSupported&&j.isHevcSupported()&&(i.supportHevc=!0);var r=this.initMp4();this._initPromise=r,this._addPendingPromise(this._initPromise),this.mse&&"String"===F.typeOf(e)&&/^blob/.test(e)&&e!==this.mse.url&&(e=n.url),r.then((function(){t.mse&&(e=t.mse.url),t.attachEvents(),t._startProgress()})).catch((function(i){var n=!!t._initPromise&&t._initPromise.isBreak;if(!t.isDestroy&&!n){var r=i;r.errorCode||(r=new $(t.player,{errorType:_o.RUNTIME,errorCode:(null===i||void 0===i?void 0:i.errorCode)||Xo.other,vid:t.playerConfig.vid,errorMessage:(null===i||void 0===i?void 0:i.errorMessage)||(null===i||void 0===i?void 0:i.message),mediaError:{code:(null===i||void 0===i?void 0:i.httpCode)||Xo.other,message:(null===i||void 0===i?void 0:i.errorMessage)||(null===i||void 0===i?void 0:i.message),errorType:null===i||void 0===i?void 0:i.errorType}}),r.url=e),t.useVideoLoad=!0,t.player.vtype="MP4_1",t.player.emit("playCatch",t.player.vtype,r)}})).finally((function(){if(t._initPromise){var i=t._initPromise.isBreak;i||(t._initPromise&&t._removePendingPromise(t._initPromise),t._initPromise=null,!t.isDestroy&&!i&&Cu.call(t.player,e))}}))}},{key:"initMp4",value:function(){var e=this,t=this.player;t.config.vid||(t.config.vid=Date.now());var i=new wu;return this.mp4&&(this.mp4.off(pu.META_READY,this._onMp4MetaReady),this.mp4.off(pu.ERROR,this._onMp4Error),this.mp4.off(pu.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.mp4=new vu(t.config.url,_r(_r({},this.config),{},{vid:t.config.vid})),this.mp4.on(pu.META_READY,this._onMp4MetaReady),this.mp4.on(pu.ERROR,this._onMp4Error),this.mp4.on(pu.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.on(pu.UPDATE_LOAD_IDX,(function(t){e._curLoadSegmentIdx=t,e.log("[update curLoadSegmentIdx]",t)})),this.mp4.init(),i}},{key:"setConfig",value:function(e){this.config=Object.assign(this.config,e)}},{key:"playNext",value:function(e){var t=this.player;this._defInited=!1,t.resetState(),t._currentTime=0,t._duration=0,t.isPlaying=!1,this._MSEError=!1,t.pause(),this._reset(),t.setConfig(e),this.log("[Index] playNext",e),t.play(),this.emit("playnext")}},{key:"checkDegrade",value:function(e){var t=this.config.closeDowngrade;return!t||"networkError"===e.httpCode}},{key:"_errorHandler",value:function(e){var t,i=this.player,n=this.config;if(i&&!this.useVideoLoad){!e.url&&null!==(t=this.mp4)&&void 0!==t&&t.url&&(e.url=this.mp4.url);var r=i.paused;console.error("final error !!!!, ",n.vid,e),this.player.vtype="MP4_2",this.player.emit("playCatch",this.player.vtype,e);var a=this.checkDegrade(e);if(a)this._initPromise?this._removeAndRejectInitPromise(e):this._startDegradedPlayback(e,r);else{this.player.pause(),this._reset();var s=i.currentTime;this.destroyMSE(),i.currentTime=s,this.emit("error",e)}}}},{key:"_startDegradedPlayback",value:function(e,t){var i=this;console.log(">>>_startDegradedPlayback");var n=this.player,r=this.playerConfig;this.useVideoLoad=!0,this.destroyMSE(),this._currentTime=n.currentTime,this.__onmetadataHandle=function(){i._currentTime&&(n.currentTime=i._currentTime),t?i.player.pause():i.player.play(),n.media.removeEventListener("loadedmetadata",i.__onmetadataHandle),i.__onmetadataHandle=null},n.media.addEventListener("loadedmetadata",this.__onmetadataHandle);var a=r.url;n.media.src=a}},{key:"_addPendingPromise",value:function(e){this._pendingPromises.push(e)}},{key:"_removePendingPromise",value:function(e){var t=this._pendingPromises.indexOf(e);t>-1&&this._pendingPromises.splice(t,1)}},{key:"_cancelPendingPromises",value:function(){this._pendingPromises.length>0&&this._pendingPromises.forEach((function(e){e.reject(Eu)})),this._pendingPromises=[]}},{key:"_removeAndRejectInitPromise",value:function(e){this._initPromise&&(this._removePendingPromise(this._initPromise),this._initPromise.reject(e))}},{key:"_initMse",value:function(){var e=Wr(Pr().mark((function e(t){var i,n,r,a,s,o=this;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.mse){e.next=4;break}return e.next=3,this.mse.unbindMedia();case 3:this.mse=null;case 4:i=!!t.videoCodec,n=!!t.audioCodec,r=i&&n?'video/mp4; codecs="'.concat(t.videoCodec,', mp4a.40.5"'):i?'video/mp4; codecs="'.concat(t.videoCodec,'"'):'video/mp4; codecs="mp4a.40.5"',a=Ar({},xu.VIDEO,{mimeType:"video/mp4",codec:r}),this.mse=new xu,s=this.mse.bindMedia(this.player.video),s.then((function(){var e=Object.keys(a);try{for(var t=0;t<e.length;t++){var i=e[t];o.mse.createSource(i,a[i].codec)}}catch(n){console.error("MSE error: ",n),o._errorHandler(n)}o._isMseInit=!0,o._onTimeUpdate()}));case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroyMSE",value:function(){var e=Wr(Pr().mark((function e(){var t;return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.mse)||void 0===t?void 0:t.unbindMedia();case 2:this.mse=null;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_onTimeUpdate",value:function(){var e=this,t=this.mse,i=this.mp4,n=this.player,r=this.config;if(i){var a=i.timeRange,s=n.getBufferedRange(n.buffered2);if(t&&i&&i.canDownload){Vo.nowTime()-this._lastCheckTime>1e3&&(this._lastCheckTime=Vo.nowTime(),this._loadStuckCheck(),this._checkRemoveSourceBuffer(s,n.currentTime));var o=n.paused?n.currentTime+r.minBufferLength:n.currentTime+r.maxBufferLength;s[1]-o<0&&a.every((function(t,i){return!!t.downloaded||(!e._isChangeDefinition&&t.endTime-t.startTime>1&&e._isInBuffer(t)?(t.downloaded=!0,t.isLoading=!0,e.log("onTimeUpdate, ".concat(i," download segment, has buffer"),t.startTime,t.endTime),!0):void(t.startTime-n.currentTime<r.maxBufferLength&&(e._curLoadSegmentIdx=i,e.log("[onTimeUpdate],load index==>>>, ",i,",IdxTimeRange, ",t.startTime,"-",t.endTime,",buffEnd, ",s[1],",playCurTime,",n.currentTime,", bufferLen,",s[1]-n.currentTime,",bufferRangeList,",e.player.buffered2?e.player.buffered2.bufferedList:null),e._loadData())))})),this._isEnded()}this.checkRemoveOldBitrateBuffer()}}},{key:"checkRemoveOldBitrateBuffer",value:function(){var e=this.mse,t=this.player;e&&this._removeBuffeEndTime>0&&t.currentTime>this._removeBuffeEndTime+1&&(this.log("remove old bitrate buffer",this._removeBuffeEndTime),e.remove(xu.VIDEO,0,this._removeBuffeEndTime-1),this._removeBuffeEndTime=0)}},{key:"_isInBuffer",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!1,n=this.player.video.buffered,r=0;r<n.length;r++){var a=n.start(r)-t,s=n.end(r)+t;if(a<=e.startTime&&e.endTime<=s){i=!0;break}}return i}},{key:"_loadData",value:function(){var e=Wr(Pr().mark((function e(){return Pr().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.mp4&&this._isMseInit){e.next=3;break}return this.log("loadData, player.mp4 null",this._isMseInit),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.mp4.load(this._curLoadSegmentIdx,this._loadDataSuccess);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](3),console.error("[Index] _loadData error",this.playerConfig.vid,e.t0);case 11:case"end":return e.stop()}}),e,this,[[3,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_appendInitSeg",value:function(e){var t=this;this.mp4&&this.mse&&this.mse.append(xu.VIDEO,e,{vid:this.playerConfig.vid,range:null,dataLen:e.byteLength,isinit:!0}).then((function(e){t.log("appendInitSeg end ==>>>",e.context?e.context:null,", costTime,",e.costtime)}))}},{key:"_appendBuffer",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,a=this.mse,s=this.config;a.append(e,t,{vid:s.vid,fragIndex:n.fragIndex,range:n.range,dataLen:t.byteLength,state:r}).then((function(e){if(i.log("player appendBuffer end ==>>>",e.context?e.context:null,", costTime,",e.costtime,", opt,",e.name,",bufferRange,",i.player.getBufferedRange()),i.mse&&n.state&&n.fragIndex===i.mp4.timeRange.length-1){var t=i.player.buffered;t&&t.length>0&&(i.bufferEndTime=t.end(t.length-1)),i._isEnded(),i.log("loaded ended !!!==>>>",n.range,", fragIndex,",n.fragIndex,", bufferEndTime,",i.bufferEndTime,",meta_duration,",i.mp4.meta.duration)}})).catch((function(e){if(console.log("[MSE error]",e),e&&null!==a&&void 0!==a&&a.isFull()){var t=i.player.getBufferedRange(i.player.buffered2);i._checkRemoveSourceBuffer(t,i.player.currentTime,!0)}}))}},{key:"_checkRemoveSourceBuffer",value:function(e,t,i){var n=this,r=this.mse,a=this.mp4,s=this.player;if(r&&a&&s&&(i&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),e||(e=s.getBufferedRange(s.buffered2)),t||(t=s.currentTime),!(!i&&Vo.nowTime()-this._checkRemoveBufferLastTime<=this.config.removeBufferLen||this.endofstream)&&(this._checkRemoveBufferLastTime=Vo.nowTime(),e&&e[0]>=0&&(t-e[0]>this.config.removeBufferLen||r.isFull())))){var o=e[1],l=a.getFragmentIdx(o);if(l>=0&&a.timeRange[l].startTime<t){var u=Math.floor(Math.min(a.timeRange[l].startTime,e[1]));e[0]<u?(this.log("[checkremoveSourceBuffer], remove range==>>>",e[0],u),r.remove(xu.VIDEO,e[0],u)):r.isFull()&&!this._removeBufferTimer&&(this._removeBufferTimer=setTimeout((function(){n._checkRemoveSourceBuffer(null,null,!0)}),1e4))}}}},{key:"_isEnded",value:function(){var e=this.player,t=this.mp4,i=e.bufferedPoint,n=i?i.end:0;return!this.endofstream&&this.mse&&t.meta.duration-e.currentTime<.5&&(this.log("[check player isEnded],deal mse.endOfStream, currentTime,",e.currentTime,", bufferend,",n,", duration,",t.meta.duration),this.endofstream=!0,this.mse.endOfStream()),!!(t&&t.meta&&t.meta.duration-e.currentTime<.5)&&(this._stopProgress(),this.log("[check player isEnded],stopProgress and endOfStream,currentTime, ",e.currentTime,", bufferend,",n,", duration,",t.meta.duration),this.mse&&this.mse.endOfStream(),!0)}},{key:"switchURL",value:function(e){this.changeDefinition(e)}},{key:"oldChangeDefinition",value:function(e,t){var i=this,n=this.config,r=this.player;this.log("[oldChangeDefinition],currentTime,",r.currentTime,",from,",t,",to,",e);var a=r.currentTime,s=r.paused;this._changeDefState||(this._changeDefState={currentTime:a,paused:s},this.log("[oldChangeDefinition],currentTime,",r.currentTime,",pause,",s)),r.config.url=e.url,n.focusUserDefinition=!0,r.currentTime=0,r.pause(),this._reset(),this._isMseInit=!1,this._changeDefineCanPlay&&r.off("canplay",this._changeDefineCanPlay),this._changeDefineCanPlay=function(){i.changeDefineCanPlay(a,s,t,e),i._changeDefineCanPlay=null},r.once("canplay",this._changeDefineCanPlay),this.player.video.load(),this.initMp4()}},{key:"_loadStuckCheck",value:function(){var e=this,t=this.config,i=this.player;t.disableBufferBreakCheck||(i.currentTime-(this._lastCurrentTime||0)>.1||i.paused?1!==this._bufferBreakFlag&&2!==this._bufferBreakFlag||(this.log(","),this._bufferBreakFlag=0,clearTimeout(this._bufferBreakTimer),this._bufferBreakFlag=null):this._bufferBreakFlag||(this._bufferBreakFlag=1,this.log("! ".concat(t.waitingTimeOut,"")),this._bufferBreakTimer=setTimeout((function(){e.isDestroy||(1===e._bufferBreakFlag&&(e._bufferBreakFlag=2,e.log("!!!"),e._errorHandler(new $(e.player,{errorType:"runtime",errorTypeCode:_o.runtime,errorCode:Xo.waitTimeout,errorMessage:"wait_timeout",vid:t.vid}))),e._bufferBreakTimer=null)}),t.waitingTimeOut)),this._lastCurrentTime=i.currentTime)}},{key:"isDestroy",get:function(){return!this.player}},{key:"_stopProgress",value:function(){this._hasStartProgress=!1,this._requestTimer&&(this._requestTimer.stop(),this._requestTimer=null),this._bufferBreakTimer&&(clearTimeout(this._bufferBreakTimer),this._bufferBreakTimer=null,this._bufferBreakFlag=void 0)}},{key:"_startProgress",value:function(){var e=this;this._hasStartProgress||(this._stopProgress(),this._requestTimer=new Ru((function(){e._requestTimer&&e._onTimeUpdate()})),this._requestTimer.tickEvery(this.config.tickInSeconds),this._hasStartProgress=!0)}},{key:"log",value:function(e){for(var t=this.playerConfig,i=t&&t.vid?"[Index]".concat(t.vid," ").concat(e):"[Index] ".concat(e),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];uu.apply(void 0,[i].concat(r))}},{key:"_reset",value:function(){this._isMseInit=!1,this.endofstream=!1,this._curLoadSegmentIdx=0,this._removeBuffeEndTime=0,this._isChangeDefinition=!1,this._stopProgress(),this.mp4&&(this.mp4.off(pu.META_READY,this._onMp4MetaReady),this.mp4.off(pu.ERROR,this._onMp4Error),this.mp4.off(pu.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.mse&&(this.mse.unbindMedia(),this.mse=null),this._unloadVideo()}},{key:"_unloadVideo",value:function(){var e=this.player;try{this.log("unloadVideo src ".concat(e.video.src)),e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(t){this.log("unloadVideo error",t)}}},{key:"destroy",value:function(){var e=this.player;e.removeHooks("replay",this._replayHook),e.removeHooks("retry",this._retryHook),this.detachEvents(),this._reset(),this.player.playNext=Zu,this.player._startInit=Cu,this.player.changeDefinition=Iu,this.player.switchURL=Mu,this._bufferBreakTimer&&clearInterval(this._bufferBreakTimer),this._removeBufferTimer&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),this._waitInBufferTimer&&(clearTimeout(this._waitInBufferTimer),this._waitInBufferTimer=null)}}],[{key:"pluginName",get:function(){return"mp4Plugin"}},{key:"defaultConfig",get:function(){return{maxBufferLength:40,minBufferLength:5,disableBufferBreakCheck:!1,waitingTimeOut:15e3,waitingInBufferTimeOut:5e3,waitJampBufferMaxCnt:3,tickInSeconds:.1,reqOptions:null,closeDowngrade:!1}}},{key:"version",get:function(){return"3.0.19"}}]),i}(xt),Xu=(i("b321"),{name:"detail",props:{},components:{},data:function(){return{detailData:{},isloading:!0,isError:!1,showPopover:!1,checkactions:!1,hasCollect:"",collectFlag:0,showShare:!1,options:[{name:"",icon:"wechat",id:1},{name:"QQ",icon:"qq",id:2},{name:"",icon:"link",id:3}],player:null}},computed:{actions:function(){return"0"===this.identity||"1"===this.identity&&this.detailData.author.objectId===this.UserId||"2"===this.identity&&this.detailData.author.objectId===this.UserId?[{text:this.hasCollect,value:this.collectFlag},{text:"",value:2},{text:"",value:3},{text:"",value:4}]:[{text:this.hasCollect,value:this.collectFlag},{text:"",value:3}]}},watch:{},created:function(){},mounted:function(){this.getData()},methods:{destroyVideo:function(){this.player&&this.player.destroy()},getData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getResData();case 2:e.detailData.videoLink.includes("mp4")?e.initMp4Video():e.detailData.videoLink.includes("m3u8")?e.initHlsVideo():e.$notify({type:"danger",message:""});case 3:case"end":return t.stop()}}),t)})))()},initMp4Video:function(){this.destroyVideo(),this.player=new vr({id:"mse",url:this.detailData.videoLink,playsinline:!0,whitelist:[""],plugins:[Gu],fluid:!0,playbackRate:[.5,1,1.5,2],pip:!0,keyShortcut:"on"})},initHlsVideo:function(){this.destroyVideo(),this.player=new vr({id:"mse",url:this.detailData.videoLink,playsinline:!0,whitelist:[""],plugins:[Gr],fluid:!0,playbackRate:[.5,1,1.5,2],pip:!0,keyShortcut:"on"})},onSelect:function(e){0===e.value?this.collectResData():1===e.value?this.cancelCollect():2===e.value?this.deleteResData():4===e.value?this.editResData():this.shareResLink()},editResData:function(){window.localStorage.setItem("editResData",JSON.stringify(this.detailData)),this.$router.push({path:"/publish",query:{id:this.detailData.objectId}})},onShareSelect:function(e){1===e.id?this.$toast(""):2===e.id?this.shareQQ():this.copyLink(),this.showShare=!1},shareQQ:function(){var e="https://connect.qq.com/widget/shareqq/iframe_index.html?";e+="url="+encodeURIComponent(location.href),e+="&title="+encodeURIComponent(document.title),window.open(e,"_blank")},copyLink:function(){var e=document.createElement("input");e.value=window.location.href,document.body.appendChild(e),e.select(),document.execCommand("copy"),this.$toast.success(""),document.body.removeChild(e)},shareResLink:function(){this.showShare=!0},collectResData:function(){var e=this;this.displayoverlay();var t=this.$Bmob.Relation("_User"),i=t.add(this.UserId),n=this.$Bmob.Query("Resources");n.get(this.$route.query.oid).then((function(t){t.set("collect",i),t.save().then((function(t){e.hideoverlay(),e.$toast.success(""),e.hasCollect="",e.collectFlag=1}))})).catch((function(t){e.hideoverlay(),e.$toast.fail("")}))},checkIsCollect:function(){var e=this;return new Promise((function(t,i){var n=e.$Bmob.Query("Resources");n.field("collect",e.$route.query.oid),n.relation("_User").then((function(i){console.log(i);var n=i.results.some((function(t){if(t.objectId===e.UserId)return!0}));t(!!n),e.isloading=!1,e.isError=!1})).catch((function(t){console.log(t),i(!1),e.isloading=!1,e.isError=!0}))}))},cancelCollect:function(){var e=this;this.displayoverlay();var t=this.$Bmob.Query("Resources"),i=this.$Bmob.Relation("_User"),n=i.remove(this.UserId);t.get(this.$route.query.oid).then((function(t){t.set("collect",n),t.save().then((function(t){e.hideoverlay(),e.$toast.success(""),e.hasCollect="",e.collectFlag=0}))})).catch((function(t){e.hideoverlay(),e.$toast.fail("")}))},topResData:function(){var e=this;this.displayoverlay();var t=this.$Bmob.Query("Resources");t.set("id",this.$route.query.oid),t.set("ishot",1),t.save().then((function(t){e.hideoverlay(),e.$toast.success(""),e.detailData.ishot=!0})).catch((function(t){e.hideoverlay(),e.$toast.fail("")}))},canceltopResData:function(){var e=this;this.displayoverlay();var t=this.$Bmob.Query("Resources");t.set("id",this.$route.query.oid),t.set("ishot",0),t.save().then((function(t){e.hideoverlay(),e.$toast.success(""),e.detailData.ishot=!1})).catch((function(t){e.hideoverlay(),e.$toast.fail("")}))},deleteResData:function(){var e=this;this.displayoverlay();var t=this.$Bmob.Query("Resources");t.destroy(this.$route.query.oid).then((function(t){e.hideoverlay(),e.$toast.success(""),e.$route.query.type?e.$router.replace("minePublish"):e.reloadHomeData()})).catch((function(t){e.hideoverlay(),e.$toast.fail("")}))},hideResData:function(){var e=this;this.displayoverlay();var t=this.$Bmob.Query("Resources");t.set("id",this.$route.query.oid),t.set("show",!1),t.save().then((function(t){e.hideoverlay(),e.$toast.success(""),e.detailData.show=!1})).catch((function(t){e.hideoverlay(),e.$toast.fail("")}))},show:function(){var e=this;this.displayoverlay();var t=this.$Bmob.Query("Resources");t.set("id",this.$route.query.oid),t.set("show",!0),t.save().then((function(t){e.hideoverlay(),e.$toast.success(""),e.detailData.show=!0})).catch((function(t){console.log(t),e.hideoverlay(),e.$toast.fail("")}))},getResData:function(){var e=this,t=this.$Bmob.Query("Resources");return t.include("author"),t.order("-createdAt"),t.get(this.$route.query.oid).then(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(i){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$route.query.type){t.next=14;break}if(!i.show){t.next=10;break}return e.detailData=i,t.next=5,e.checkIsCollect();case 5:n=t.sent,n&&(e.hasCollect="",e.collectFlag=1),e.checkactions=!0,t.next=12;break;case 10:e.$toast(""),e.reloadHomeData();case 12:t.next=20;break;case 14:return e.detailData=i,t.next=17,e.checkIsCollect();case 17:r=t.sent,r&&(e.hasCollect="",e.collectFlag=1),e.checkactions=!0;case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){101===t.code&&(e.$toast(""),e.reloadHomeData()),e.isloading=!1,e.isError=!0}))},onClickLeft:function(){if("minePublish"===this.$route.query.type)this.$router.replace("minePublish");else if("mineCollect"===this.$route.query.type)this.$router.replace("mineCollect");else{if(!this.detailData.show)return void this.reloadHomeData();this.$router.replace("home")}},openImage:function(e){"IMG"===e.target.nodeName&&Object(o["a"])([e.target.currentSrc])}},beforeDestroy:function(){this.destroyVideo()}}),_u=Xu,Pu=_u,Du=(i("25ec"),i("2877")),Wu=Object(Du["a"])(Pu,r,a,!1,null,"55ba438b",null);t["default"]=Wu.exports},"8c50":function(e,t,i){var n=i("94d8");function r(e,t,i,n,r){var a=s.apply(this,arguments);return e.addEventListener(i,a,r),{destroy:function(){e.removeEventListener(i,a,r)}}}function a(e,t,i,n,a){return"function"===typeof e.addEventListener?r.apply(null,arguments):"function"===typeof i?r.bind(null,document).apply(null,arguments):("string"===typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return r(e,t,i,n,a)})))}function s(e,t,i,r){return function(i){i.delegateTarget=n(i.target,t),i.delegateTarget&&r.call(e,i)}}e.exports=a},"94d8":function(e,t){var i=9;if("undefined"!==typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}function r(e,t){while(e&&e.nodeType!==i){if("function"===typeof e.matches&&e.matches(t))return e;e=e.parentNode}}e.exports=r},"96cf":function(e,t,i){var n=function(e){"use strict";var t,i=Object.prototype,n=i.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(G){l=function(e,t,i){return e[t]=i}}function u(e,t,i,n){var r=t&&t.prototype instanceof v?t:v,a=Object.create(r.prototype),s=new C(n||[]);return a._invoke=R(e,i,s),a}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(G){return{type:"throw",arg:G}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",f="executing",m="completed",p={};function v(){}function g(){}function y(){}var b={};l(b,a,(function(){return this}));var L=Object.getPrototypeOf,S=L&&L(L(I([])));S&&S!==i&&n.call(S,a)&&(b=S);var T=y.prototype=v.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function i(r,a,s,o){var l=c(e[r],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"===typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,s,o)}),(function(e){i("throw",e,s,o)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,o)}))}o(l.arg)}var r;function a(e,n){function a(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(a,a):a()}this._invoke=a}function R(e,t,i){var n=d;return function(r,a){if(n===f)throw new Error("Generator is already running");if(n===m){if("throw"===r)throw a;return M()}i.method=r,i.arg=a;while(1){var s=i.delegate;if(s){var o=w(s,i);if(o){if(o===p)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===d)throw n=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=f;var l=c(e,t,i);if("normal"===l.type){if(n=i.done?m:h,l.arg===p)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n=m,i.method="throw",i.arg=l.arg)}}}function w(e,i){var n=e.iterator[i.method];if(n===t){if(i.delegate=null,"throw"===i.method){if(e.iterator["return"]&&(i.method="return",i.arg=t,w(e,i),"throw"===i.method))return p;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=c(n,e.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,p;var a=r.arg;return a?a.done?(i[e.resultName]=a.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,p):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Z(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function I(e){if(e){var i=e[a];if(i)return i.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function i(){while(++r<e.length)if(n.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=t,i.done=!0,i};return s.next=s}}return{next:M}}function M(){return{value:t,done:!0}}return g.prototype=y,l(T,"constructor",y),l(y,"constructor",g),g.displayName=l(y,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,o,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},k(x.prototype),l(x.prototype,s,(function(){return this})),e.AsyncIterator=x,e.async=function(t,i,n,r,a){void 0===a&&(a=Promise);var s=new x(u(t,i,n,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},k(T),l(T,o,"Generator"),l(T,a,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){while(t.length){var n=t.pop();if(n in e)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=I,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(Z),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(n,r){return o.type="throw",o.arg=e,i.next=n,r&&(i.method="next",i.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(l&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),Z(i),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;Z(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,n){return this.delegate={iterator:I(e),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=n}catch(r){"object"===typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},"9f55":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=!0,s=!1,o=void 0;try{for(var l,u=n[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;t+=c.length}}catch(b){s=!0,o=b}finally{try{!a&&u.return&&u.return()}finally{if(s)throw o}}var d=new e(t),h=0,f=!0,m=!1,p=void 0;try{for(var v,g=n[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var y=v.value;d.set(y,h),h+=y.length}}catch(b){m=!0,p=b}finally{try{!f&&g.return&&g.return()}finally{if(m)throw p}}return d}},ab13:function(e,t,i){var n=i("b622"),r=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[r]=!1,"/./"[e](t)}catch(n){}}return!1}},aeb1:function(e,t,i){var n,r,a;(function(i,s){r=[],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})(0,(function(){return function e(t,i,n){var r,a,s=window,o="application/octet-stream",l=n||o,u=t,c=!i&&!n&&u,d=document.createElement("a"),h=function(e){return String(e)},f=s.Blob||s.MozBlob||s.WebKitBlob||h,m=i||"download";if(f=f.call?f.bind(s):Blob,"true"===String(this)&&(u=[u,l],l=u[0],u=u[1]),c&&c.length<2048&&(m=c.split("/").pop().split("?")[0],d.href=c,-1!==d.href.indexOf(c))){var p=new XMLHttpRequest;return p.open("GET",c,!0),p.responseType="blob",p.onload=function(t){e(t.target.response,m,o)},setTimeout((function(){p.send()}),0),p}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(u)){if(!(u.length>2096103.424&&f!==h))return navigator.msSaveBlob?navigator.msSaveBlob(b(u),m):L(u);u=b(u),l=u.type||o}else if(/([\x80-\xff])/.test(u)){var v=0,g=new Uint8Array(u.length),y=g.length;for(v;v<y;++v)g[v]=u.charCodeAt(v);u=new f([g],{type:l})}function b(e){var t=e.split(/[:;,]/),i=t[1],n="base64"==t[2]?atob:decodeURIComponent,r=n(t.pop()),a=r.length,s=0,o=new Uint8Array(a);for(s;s<a;++s)o[s]=r.charCodeAt(s);return new f([o],{type:i})}function L(e,t){if("download"in d)return d.href=e,d.setAttribute("download",m),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){s.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var i=document.createElement("iframe");document.body.appendChild(i),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),i.src=e,setTimeout((function(){document.body.removeChild(i)}),333)}if(r=u instanceof f?u:new f([u],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(r,m);if(s.URL)L(s.URL.createObjectURL(r),!0);else{if("string"===typeof r||r.constructor===h)try{return L("data:"+l+";base64,"+s.btoa(r))}catch(S){return L("data:"+l+","+encodeURIComponent(r))}a=new FileReader,a.onload=function(e){L(this.result)},a.readAsDataURL(r)}return!0}}))},b321:function(e,t,i){},ba10:function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function a(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,n,a){if("function"!==typeof i)throw new TypeError("The listener must be a function");var o=new s(i,n||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0===--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},u.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,a=i.length,s=new Array(a);n<a;n++)s[n]=i[n].fn;return s},u.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},u.prototype.emit=function(e,t,i,n,a,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,n),!0;case 5:return c.fn.call(c.context,t,i,n,a),!0;case 6:return c.fn.call(c.context,t,i,n,a,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},u.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},u.prototype.removeListener=function(e,t,i,n){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||n&&!s.once||i&&s.context!==i||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||n&&!s[o].once||i&&s[o].context!==i)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u},e9c4:function(e,t,i){var n=i("23e7"),r=i("da84"),a=i("d066"),s=i("2ba4"),o=i("e330"),l=i("d039"),u=r.Array,c=a("JSON","stringify"),d=o(/./.exec),h=o("".charAt),f=o("".charCodeAt),m=o("".replace),p=o(1..toString),v=/[\uD800-\uDFFF]/g,g=/^[\uD800-\uDBFF]$/,y=/^[\uDC00-\uDFFF]$/,b=function(e,t,i){var n=h(i,t-1),r=h(i,t+1);return d(g,e)&&!d(y,r)||d(y,e)&&!d(g,n)?"\\u"+p(f(e,0),16):e},L=l((function(){return'"\\udf06\\ud834"'!==c("\udf06\ud834")||'"\\udead"'!==c("\udead")}));c&&n({target:"JSON",stat:!0,forced:L},{stringify:function(e,t,i){for(var n=0,r=arguments.length,a=u(r);n<r;n++)a[n]=arguments[n];var o=s(c,null,a);return"string"==typeof o?m(o,v,b):o}})}}]);